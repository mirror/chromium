{
  "comments": [
    {
      "key": {
        "uuid": "827cfcf3_a82410a7",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 205,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T01:08:58Z",
      "side": 1,
      "message": "I don\u0027t see an Init()?",
      "range": {
        "startLine": 205,
        "startChar": 17,
        "endLine": 205,
        "endChar": 23
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dcfc6698_196a1a33",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 205,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T12:36:04Z",
      "side": 1,
      "message": "Oops, leftover from previous WIP impl, removed, thanks",
      "parentUuid": "827cfcf3_a82410a7",
      "range": {
        "startLine": 205,
        "startChar": 17,
        "endLine": 205,
        "endChar": 23
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd88d044_9e014559",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 206,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T01:08:58Z",
      "side": 1,
      "message": "nit: ClassWithBlockingConstructor?",
      "range": {
        "startLine": 206,
        "startChar": 7,
        "endLine": 206,
        "endChar": 25
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c86cb7a2_5aac61e1",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 206,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T12:36:04Z",
      "side": 1,
      "message": "Yeah, not a fan either but this is consistent with \"SlowConstructor\" in this file above.",
      "parentUuid": "bd88d044_9e014559",
      "range": {
        "startLine": 206,
        "startChar": 7,
        "endLine": 206,
        "endChar": 25
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f72b968_3d3e2106",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T01:08:58Z",
      "side": 1,
      "message": "Isn\u0027t this spinning in exactly the same way that we just fixed in LazyInstance? :O",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dabc45f9_e560aa7d",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T12:36:04Z",
      "side": 1,
      "message": "Yes, but this is spinning in a background thread. I don\u0027t want to use sleep or any other synchronization primitives because I don\u0027t want to hint the kernel that it\u0027s important to schedule this thread at any point.\n\nThe previous bug was spinning in a foreground thread while a background thread was assigned to construct. Now this is testing that the background thread is scheduled at all to see this bit and complete construction (i.e. foreground threads aren\u0027t stalling it -- which depends on LazyInstance impl when while on instance as desired for this test).",
      "parentUuid": "0f72b968_3d3e2106",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "708e01a1_2272af01",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T21:04:20Z",
      "side": 1,
      "message": "If you don\u0027t want to hint anything to the kernel then why are you calling YieldCurrentThread()? Typically that is implemented as a zero-length sleep, which means it\u0027s either a no-op or hints something to the kernel - either way it\u0027s not useful, right?",
      "parentUuid": "dabc45f9_e560aa7d",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "792dd483_3a4f9cf8",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T21:29:42Z",
      "side": 1,
      "message": "The way I understand it, it yields this thread\u0027s quantum, putting it back on the ready queue.\n\nIf many foreground threads are doing this they may be yielding to each other without ever giving a slot for a background thread. But a background thread is definitely yielding to foreground threads (without hinting that it intends to).\n\nI\u0027m afraid Sleep would potentially hint the kernel that the thread is important when it wakes up.",
      "parentUuid": "708e01a1_2272af01",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "047917bb_9ee69446",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2018-01-17T21:58:08Z",
      "side": 1,
      "message": "Sleep(0) would also work - I don\u0027t think it would give any problematic hints to the scheduler. But, I also don\u0027t see any advantages to Sleep(0). Sleep(1) would *actually* give up the time slice. It\u0027s okay for the background thread to do that, but if the foreground priority threads do that it would ruin the test.",
      "parentUuid": "792dd483_3a4f9cf8",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d58c113_5b6c7083",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T22:37:43Z",
      "side": 1,
      "message": "My point was that YieldCurrentThread *is* Sleep() under Windows - so if Sleep gives a priority-boosting hint then it\u0027s not doing what you intend.  However, it sounds from what Bruce says that Sleep(0) is special-cased not to flag the thread as important when it is due to wake?",
      "parentUuid": "047917bb_9ee69446",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0f96bac2_7a40e2fa",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 213,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-18T11:06:46Z",
      "side": 1,
      "message": "FWIW, I just tried both (Yield() vs Sleep(1)) and both result in the same behaviour in this test (~30ms in success case with Bruce\u0027s fix, ~5500ms w/o Bruce\u0027s fix).\n\nI think we\u0027re okay to leave it as-is.",
      "parentUuid": "8d58c113_5b6c7083",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 49
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c90fed21_2d405f92",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 276,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T01:08:58Z",
      "side": 1,
      "message": "Is it not possible to just make these class members, rather than statics?  Does LazyInstance not allow that?",
      "range": {
        "startLine": 270,
        "startChar": 0,
        "endLine": 276,
        "endChar": 30
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4be77a3d_77756edb",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 276,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T12:36:04Z",
      "side": 1,
      "message": "No because external callers must be able to set them without getting/constructing the object.",
      "parentUuid": "c90fed21_2d405f92",
      "range": {
        "startLine": 270,
        "startChar": 0,
        "endLine": 276,
        "endChar": 30
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44fec2ad_edae9a70",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 276,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T21:04:20Z",
      "side": 1,
      "message": "Sorry, I meant put them in a test-scoped class/struct, that you pass to the BlockingConstructor\u0027s constructor, to avoid the need for statics.",
      "parentUuid": "4be77a3d_77756edb",
      "range": {
        "startLine": 270,
        "startChar": 0,
        "endLine": 276,
        "endChar": 30
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2144e8d4_2671f5f5",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 276,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T21:29:42Z",
      "side": 1,
      "message": "Ah, yes I could do that. Thought for the LazyInstance I\u0027d rather keep it static to test it the way it\u0027s meant to be used. It\u0027s destroyed at the end of the test anyways via the AtExitManager.\n\nWill follow-up on the two statics in a fixture.",
      "parentUuid": "44fec2ad_edae9a70",
      "range": {
        "startLine": 270,
        "startChar": 0,
        "endLine": 276,
        "endChar": 30
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "61a41d2b_d3ef4e65",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 276,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-18T10:59:44Z",
      "side": 1,
      "message": "Actually, I can\u0027t do this either because BlockingConstructor() cannot take parameters (LazyInstance only supports initializing from the default constructor).",
      "parentUuid": "2144e8d4_2671f5f5",
      "range": {
        "startLine": 270,
        "startChar": 0,
        "endLine": 276,
        "endChar": 30
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "998c847f_5119c0d6",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 321,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T01:08:58Z",
      "side": 1,
      "message": "nit: Would it make sense to use action_timeout() here?",
      "range": {
        "startLine": 321,
        "startChar": 12,
        "endLine": 321,
        "endChar": 43
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ff4348a_6eff460e",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 321,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T12:36:04Z",
      "side": 1,
      "message": "Meh... I don\u0027t think so: it\u0027s not related to an action. The 5s is merely from local experimentation of timing in regression case.",
      "parentUuid": "998c847f_5119c0d6",
      "range": {
        "startLine": 321,
        "startChar": 12,
        "endLine": 321,
        "endChar": 43
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1cba9888_d806c0d2",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 321,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T21:04:20Z",
      "side": 1,
      "message": "action_timeout() and friends are what we override/adjust to account for differences in run-time on different environments, though - we may find that on Fuchsia+QEMU+GCE the timing is rather worse, for example. Speaking hypothetically, that is. ;)",
      "parentUuid": "7ff4348a_6eff460e",
      "range": {
        "startLine": 321,
        "startChar": 12,
        "endLine": 321,
        "endChar": 43
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a2d5b960_ec6766e1",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 321,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-17T21:29:42Z",
      "side": 1,
      "message": "Hmm, ok, but action_timeout() still feels weird for this... I\u0027d rather not if we don\u0027t find this to be flaky on other platforms.",
      "parentUuid": "1cba9888_d806c0d2",
      "range": {
        "startLine": 321,
        "startChar": 12,
        "endLine": 321,
        "endChar": 43
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3cbae66c_fd14d72a",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 8
      },
      "lineNbr": 321,
      "author": {
        "id": 1001385
      },
      "writtenOn": "2018-01-17T22:37:43Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a2d5b960_ec6766e1",
      "range": {
        "startLine": 321,
        "startChar": 12,
        "endLine": 321,
        "endChar": 43
      },
      "revId": "a1f83bd3b901ee2730bd25e5e56b21f83c4b5a86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}