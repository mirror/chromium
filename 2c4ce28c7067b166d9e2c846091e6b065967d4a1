{
  "comments": [
    {
      "key": {
        "uuid": "bbe7bf79_63506de9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2017-08-16T13:49:03Z",
      "side": 1,
      "message": "I don\u0027t see where this deduplication takes place. Can you give me a pointer to the code?",
      "range": {
        "startLine": 13,
        "startChar": 60,
        "endLine": 13,
        "endChar": 71
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39ea268b_ec15d08f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1194993
      },
      "writtenOn": "2017-08-16T15:57:20Z",
      "side": 1,
      "message": "In Predictor::AppendToResolutionQueue() we look into the |results_| table and if the entry already exists for the |url|, we just reuse it. Then we check UrlInfo::NeedsDnsUpdate() to decide whether append the |url| to the resolution queue or not. \nhttps://cs.chromium.org/chromium/src/chrome/browser/net/predictor.cc?rcl\u003d09503699783ba50bb017f498dbc7972f20744623\u0026l\u003d1006\n\nThe full life cycle for the UrlInfo looks like this:\n1. Predictor::AppendToResolutionQueue() creates a new UrlInfo in PENDING state keyed by a url.\n2. Predictor::AppendToResolutionQueue() puts the url into the |work_queue_| and sets QUEUED state.\n3. Predictor::StartSomeQueuedResolutions() pops the url from the queue and sets ASSIGNED state.\n4. After lookup is finished, Predictor::LookupFinished() sets whether FOUND or NO_SUCH_NAME state.\n5. If Predictor::AppendToResolutionQueue() is called with the same url later, the predictor checks UrlInfo::NeedsDnsUpdate() before adding the url to the queue.\n\nThis change sets ASSIGNED_BUT_MARKED state on the stage 3, so the entry will be deleted on the stage 4.",
      "parentUuid": "bbe7bf79_63506de9",
      "range": {
        "startLine": 13,
        "startChar": 60,
        "endLine": 13,
        "endChar": 71
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dffed96d_ffb0479e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2017-08-16T16:29:25Z",
      "side": 1,
      "message": "If the UrlInfo is deleted from |results_|  in Stage 4, and we encounter the same Url in Stage 5, does it mean we will do Dns resolution for the same url again?",
      "parentUuid": "39ea268b_ec15d08f",
      "range": {
        "startLine": 13,
        "startChar": 60,
        "endLine": 13,
        "endChar": 71
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b8d275de_0d07a2f7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1194993
      },
      "writtenOn": "2017-08-16T18:03:34Z",
      "side": 1,
      "message": "Predictor indeed will put the url in its own resolution queue and will ask the net::HostResolver to resolve the same url again but it is likely to be done synchronously because net::HostResolver has its own cache. https://cs.chromium.org/chromium/src/net/dns/host_resolver_impl.h?rcl\u003d0984bd3a49d6d118e3c61ed5bff5490f6db1834a\u0026l\u003d326\n\nOperating system often has its own DNS cache so even without the cache in the browser the second dns resolution will be much faster.",
      "parentUuid": "dffed96d_ffb0479e",
      "range": {
        "startLine": 13,
        "startChar": 60,
        "endLine": 13,
        "endChar": 71
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f37d6152_007d7ff8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2017-08-16T18:19:50Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "b8d275de_0d07a2f7",
      "range": {
        "startLine": 13,
        "startChar": 60,
        "endLine": 13,
        "endChar": 71
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9bed2b24_d43d5189",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 15,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2017-08-16T13:49:03Z",
      "side": 1,
      "message": "Can you add a comment to |results_| in the header that to mention that the map is only used to feed into about:dns?",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 30
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "197eee73_84a3ddbd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 15,
      "author": {
        "id": 1194993
      },
      "writtenOn": "2017-08-16T15:57:20Z",
      "side": 1,
      "message": "The map is not used only to feed about:dns. It holds the state of existing/prior resolutions that may be reused by following requests, i.e. it forms additional caching layer.",
      "parentUuid": "9bed2b24_d43d5189",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 30
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a458218_db15caca",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 15,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2017-08-16T16:29:25Z",
      "side": 1,
      "message": "In the next paragraph, you mentioned that the additional caching layer is not needed, so I assumed that |results_| is only kept for about:dns. \nDoesn\u0027t deleting UrlInfo from |results_| during LookupFinished() essentially get rid of the caching layer?",
      "parentUuid": "197eee73_84a3ddbd",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 30
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9011efe7_221957a5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 15,
      "author": {
        "id": 1194993
      },
      "writtenOn": "2017-08-16T18:03:34Z",
      "side": 1,
      "message": "After this change |results_| will still contain UrlInfos that currently are in progress. So if the predictor gets a request for the same url after Stage 2 or Stage 3 it won\u0027t queue an additional job. By caching I meant that we keep a result of resolution, sorry that I wasn\u0027t clear.\n\nAs Charlie said before, whole this machinery can be simplified if we decide to delete UrlInfo after lookup is finished.",
      "parentUuid": "9a458218_db15caca",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 30
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf704a52_2c71453f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 15,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2017-08-16T18:19:50Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "9011efe7_221957a5",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 30
      },
      "revId": "2c4ce28c7067b166d9e2c846091e6b065967d4a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}