{
  "comments": [
    {
      "key": {
        "uuid": "35ca3279_28812af0",
        "filename": "chrome/browser/apps/app_url_redirector.cc",
        "patchSetId": 22
      },
      "lineNbr": 74,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-25T07:43:48Z",
      "side": 1,
      "message": "Drop \"no need to intercept the navigation\"; just combine into one sentence.",
      "range": {
        "startLine": 73,
        "startChar": 53,
        "endLine": 74,
        "endChar": 22
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac599ce8_83d14c83",
        "filename": "chrome/browser/apps/app_url_redirector.cc",
        "patchSetId": 22
      },
      "lineNbr": 74,
      "author": {
        "id": 1133035
      },
      "writtenOn": "2017-07-26T05:12:02Z",
      "side": 1,
      "message": "I changed the approach a bit. Since we are going to have a bunch of these if statements I figured it would be better if we separated each condition and added some logging. WDYT?",
      "parentUuid": "35ca3279_28812af0",
      "range": {
        "startLine": 73,
        "startChar": 53,
        "endLine": 74,
        "endChar": 22
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17ae5486_9c4d7250",
        "filename": "chrome/browser/apps/app_url_redirector.cc",
        "patchSetId": 22
      },
      "lineNbr": 74,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-27T01:13:36Z",
      "side": 1,
      "message": "Ack.",
      "parentUuid": "ac599ce8_83d14c83",
      "range": {
        "startLine": 73,
        "startChar": 53,
        "endLine": 74,
        "endChar": 22
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9910d31d_d0270997",
        "filename": "chrome/browser/extensions/bookmark_app_helper.cc",
        "patchSetId": 22
      },
      "lineNbr": 348,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-25T07:43:48Z",
      "side": 1,
      "message": "DCHECK(extension-\u003efrom_bookmark());",
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2168198f_226fd11b",
        "filename": "chrome/browser/extensions/bookmark_app_helper.cc",
        "patchSetId": 22
      },
      "lineNbr": 348,
      "author": {
        "id": 1133035
      },
      "writtenOn": "2017-07-26T05:12:02Z",
      "side": 1,
      "message": "Done. Also changed the name of the function to make it more explicit that this should only be used for Bookmark Apps.",
      "parentUuid": "9910d31d_d0270997",
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8fa198e6_32304a24",
        "filename": "chrome/browser/extensions/bookmark_app_helper.cc",
        "patchSetId": 22
      },
      "lineNbr": 353,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-25T07:43:48Z",
      "side": 1,
      "message": "I\u0027m getting worried about this. For one thing, what if there is a Bookmark app created before this CL landed? It wouldn\u0027t have this property would it?\n\nThat suggests maybe these DCHECKs should be standard if statements that return a sensible value on failure.\n\nAnd maybe we could just add a new field to the Bookmark app extension to store the scope instead of assuming that it\u0027s url_handlers[0].pattern[:-1]. Chris what do you think?",
      "range": {
        "startLine": 353,
        "startChar": 5,
        "endLine": 353,
        "endChar": 33
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fd982b33_8ce4cd47",
        "filename": "chrome/browser/extensions/bookmark_app_helper.cc",
        "patchSetId": 22
      },
      "lineNbr": 353,
      "author": {
        "id": 1133035
      },
      "writtenOn": "2017-07-26T05:12:02Z",
      "side": 1,
      "message": "Right, it wouldn\u0027t have this property but the previous line would have already returned an empty GURL. I agree it\u0027s a bit fragile but there are quite a few tests that exercise this code:\n\nBookmarkAppHelperExtensionServiceTest.CreateBookmarkAppNoContents\nBookmarkAppHelperExtensionServiceTest.CreateAndUpdateBookmarkApp\nBookmarkAppHelperExtensionServiceTest.GetWebApplicationInfo\nBookmarkAppHelperExtensionServiceTest.CreateBookmarkAppWithManifest\nExtensionFromWebApp.Basic\nExtensionFromWebApp.Minimal (This tests an extension that doesn\u0027t have the url_handlers field)\nExtensionFromWebApp.ScopeDoesNotEndInSlash\n\nI\u0027m OK with changing this to if statements but I can\u0027t see when we would hit them.\n\nI wasn\u0027t sure if this was the right approach either that\u0027s why I sent out the CL for a directional review. Neither Ben nor Chris had any objections :/",
      "parentUuid": "8fa198e6_32304a24",
      "range": {
        "startLine": 353,
        "startChar": 5,
        "endLine": 353,
        "endChar": 33
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e698d972_d7407a4f",
        "filename": "chrome/browser/extensions/bookmark_app_helper.cc",
        "patchSetId": 22
      },
      "lineNbr": 353,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-27T01:13:36Z",
      "side": 1,
      "message": "Sorry to ask about this so late.\n\nMy concern is not with the current code to generate bookmark apps interacting with this code, but rather with PREVIOUS code to generate bookmark apps. Am I correct that this is based on state that\u0027s stored in prefs? So if a previous version of Chrome generated a Bookmark app with a different URL handler, that would get incorrectly interpreted here?\n\nProbably all past versions of Chrome would\u0027ve generated Bookmark apps with 0 handlers, so that will get caught by the above if statement. But it is kind of fragile as it spans across versions making it hard to maintain.\n\nFor example, what if we ever want to add a new URL handler in the future that doesn\u0027t correspond to the manifest scope? We\u0027d probably decide this hack is worth refactoring into a different data model, but that would then require a data migration.\n\nI really think we should explicitly store the manifest scope as a separate field instead of assuming that the one URL handler is the manifest scope + \"*\".\n\nNOTE: The above doesn\u0027t apply if I\u0027m mistaken and this data is generated at runtime, not stored in prefs. (In which case it isn\u0027t dependent on old versions of Chrome and we can always change the model later without a data migration.)",
      "parentUuid": "fd982b33_8ce4cd47",
      "range": {
        "startLine": 353,
        "startChar": 5,
        "endLine": 353,
        "endChar": 33
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f6f13bdb_1ad143ee",
        "filename": "chrome/browser/extensions/convert_web_app.cc",
        "patchSetId": 22
      },
      "lineNbr": 136,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-25T07:43:48Z",
      "side": 1,
      "message": "// Note that this handler is also used to retrieve the scope for the app (by removing the \u0027*\u0027), so if you change this, you also have to change BookmarkAppHelper::GetScopeFromExtension.\n\n(This is why I\u0027m worried about BookmarkAppHelper::GetScopeFromExtension relying on this... see comment above.)",
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d4ee3d2_eccb73cb",
        "filename": "chrome/browser/extensions/convert_web_app.cc",
        "patchSetId": 22
      },
      "lineNbr": 136,
      "author": {
        "id": 1133035
      },
      "writtenOn": "2017-07-26T05:12:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f6f13bdb_1ad143ee",
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ac33ff1_f414d38e",
        "filename": "chrome/browser/ui/extensions/application_launch.cc",
        "patchSetId": 22
      },
      "lineNbr": 156,
      "author": {
        "id": 1115963
      },
      "writtenOn": "2017-07-25T07:43:48Z",
      "side": 1,
      "message": "Ah I didn\u0027t realise this would be necessary. This is a bit messy, let\u0027s just remove the DCHECK_IS_ON from the function definition. It will probably get compiled out in Release builds anyway.",
      "range": {
        "startLine": 156,
        "startChar": 4,
        "endLine": 156,
        "endChar": 16
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c84767b_7352f6fb",
        "filename": "chrome/browser/ui/extensions/application_launch.cc",
        "patchSetId": 22
      },
      "lineNbr": 156,
      "author": {
        "id": 1133035
      },
      "writtenOn": "2017-07-26T05:12:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4ac33ff1_f414d38e",
      "range": {
        "startLine": 156,
        "startChar": 4,
        "endLine": 156,
        "endChar": 16
      },
      "revId": "49acd61d7d9a9a4a222d729e80f7264f70a2dee3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}