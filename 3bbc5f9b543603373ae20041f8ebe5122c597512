{
  "comments": [
    {
      "key": {
        "uuid": "a4d277a4_8dca6017",
        "filename": "chrome/browser/android/banners/app_banner_manager_android.cc",
        "patchSetId": 4
      },
      "lineNbr": 282,
      "author": {
        "id": 1174915
      },
      "writtenOn": "2017-09-29T05:32:22Z",
      "side": 1,
      "message": "It looks like ReportStatus is called here, and in CheckPlatformAndId (but only if CheckPlatformAndId returns false). It\u0027s not called if we return false on line 278.\n\nIt\u0027s odd that ReportStatus is called in some cases but not others. It would seem to imply that state_ is one of {ACTIVE,SENDING_EVENT,SENDING_EVENT_GOT_EARLY_PROMPT,INACTIVE,COMPLETE}, otherwise the subsequent call to Stop (if line 196 is reached) would fail when it tried to call ReportStatus again.  However, if it *is* in one of these states, and this function (for whichever reason) doesn\u0027t call ReportStatus, then ReportStatus would never be called.\n\nFurthermore, it seems that if there are multiple related applications, ReportStatus could be called multiple times here (because CanHandleNonWebApp is called once per application). Is that correct and expected?\n\nI\u0027ve tried to reason about what guarantees this function (and by extension PerformInstallableCheck) can give about whether ReportStatus has been called, and I\u0027ve failed. If you can clarify, it would be appreciated.",
      "range": {
        "startLine": 282,
        "startChar": 4,
        "endLine": 282,
        "endChar": 51
      },
      "revId": "3bbc5f9b543603373ae20041f8ebe5122c597512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc952192_30ed8b82",
        "filename": "chrome/browser/android/banners/app_banner_manager_android.cc",
        "patchSetId": 4
      },
      "lineNbr": 282,
      "author": {
        "id": 1186534
      },
      "writtenOn": "2017-09-29T05:43:18Z",
      "side": 1,
      "message": "Good find. This is definitely a bit crusty, and is a holdover from the very first app banner implementation (which was just to promote native apps).\n\nI have some in-progress work to add a new state_ (PENDING_NATIVE) for the native fetch. It\u0027s taking a while because there are Android instrumentation tests which it breaks and I\u0027m yet to work out exactly why.\n\nI think making CanHandleNonWebApp return an InstallableStatusCode should tidy this up. Do you want me to try and finish that before you land this CL? Or do you want to leave this file for now until that is done?",
      "parentUuid": "a4d277a4_8dca6017",
      "range": {
        "startLine": 282,
        "startChar": 4,
        "endLine": 282,
        "endChar": 51
      },
      "revId": "3bbc5f9b543603373ae20041f8ebe5122c597512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0529e63b_fc37e5d2",
        "filename": "chrome/browser/android/banners/app_banner_manager_android.cc",
        "patchSetId": 4
      },
      "lineNbr": 282,
      "author": {
        "id": 1174915
      },
      "writtenOn": "2017-09-29T05:52:01Z",
      "side": 1,
      "message": "How about I submit this with a TODO in your name to convert CanHandleNonWebApp to return an InstallableStatusCode and have PerformInstallableCheck pass it to StopWithCode? That might unblock me.",
      "parentUuid": "cc952192_30ed8b82",
      "range": {
        "startLine": 282,
        "startChar": 4,
        "endLine": 282,
        "endChar": 51
      },
      "revId": "3bbc5f9b543603373ae20041f8ebe5122c597512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}