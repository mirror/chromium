{
  "comments": [
    {
      "key": {
        "uuid": "9df60f25_2a31a104",
        "filename": "chrome/browser/chromeos/crostini/crostini_util.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-02-03T01:04:30Z",
      "side": 1,
      "message": "nit: maybe IsCrostiniAllowedByPolicy to make the meaning of this a bit clearer for people looking at the calling code?",
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a53df7c0_73b3decc",
        "filename": "chrome/browser/chromeos/crostini/crostini_util.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1212939
      },
      "writtenOn": "2018-02-05T23:35:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9df60f25_2a31a104",
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3141068c_412dbcd6",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11147,
      "author": {
        "id": 1175129
      },
      "writtenOn": "2018-02-05T11:15:01Z",
      "side": 1,
      "message": "nit: will be allowed / are allowed",
      "range": {
        "startLine": 11147,
        "startChar": 53,
        "endLine": 11147,
        "endChar": 60
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c3a2cf2_801c29f8",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11147,
      "author": {
        "id": 1212939
      },
      "writtenOn": "2018-02-05T23:35:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3141068c_412dbcd6",
      "range": {
        "startLine": 11147,
        "startChar": 53,
        "endLine": 11147,
        "endChar": 60
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "54e0ac33_a776c8ca",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11149,
      "author": {
        "id": 1175129
      },
      "writtenOn": "2018-02-05T11:15:01Z",
      "side": 1,
      "message": "BTW, what will happen on initial device enrollment?\nI.e., when the device is booted up on first boot (no device policy present), then enrolled into a domain which sets CrostiniAllowed \u003d false. Will the device respect that, or will it need a reboot to respect the policy?",
      "range": {
        "startLine": 11149,
        "startChar": 6,
        "endLine": 11149,
        "endChar": 112
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "97e4fb5c_ae85ca5a",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11149,
      "author": {
        "id": 1212939
      },
      "writtenOn": "2018-02-05T23:35:27Z",
      "side": 1,
      "message": "Done.\nI\u0027ve changed dynamic_refresh to true. Separately, virtual machines are disallowed for enterprise policy by default according to requirement.",
      "parentUuid": "54e0ac33_a776c8ca",
      "range": {
        "startLine": 11149,
        "startChar": 6,
        "endLine": 11149,
        "endChar": 112
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f30bac9f_83411d06",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11149,
      "author": {
        "id": 1175129
      },
      "writtenOn": "2018-02-06T18:16:03Z",
      "side": 1,
      "message": "Re 1: IIUC this policy is evaluated by a D-Bus call to chrome when deciding if a VM may be started.\nIn this case, I\u0027d suggest adding a sentence here to mention that when this policy is changed to False, it applies to starting new VMs and does not automatically shut down already-running VMs.\n\nRe 2: I\u0027m not sure I\u0027m following - the newest patchset seems to allow VMs by default?",
      "parentUuid": "97e4fb5c_ae85ca5a",
      "range": {
        "startLine": 11149,
        "startChar": 6,
        "endLine": 11149,
        "endChar": 112
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "24d2e069_9fcbdb77",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11149,
      "author": {
        "id": 1212939
      },
      "writtenOn": "2018-02-06T19:30:35Z",
      "side": 1,
      "message": "Done.\nMy other comment was to explain why I added default_for_enterprise_users to be False. Virtual machines are allowed when no enterprise policy applies by default but enterprise policy defaults it to False.",
      "parentUuid": "f30bac9f_83411d06",
      "range": {
        "startLine": 11149,
        "startChar": 6,
        "endLine": 11149,
        "endChar": 112
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ea843595_a5bef3d1",
        "filename": "components/policy/resources/policy_templates.json",
        "patchSetId": 2
      },
      "lineNbr": 11149,
      "author": {
        "id": 1175129
      },
      "writtenOn": "2018-02-06T20:08:41Z",
      "side": 1,
      "message": "Ohh I understand, sorry, I missed the default_for_enterprise_users addition.\n\nUnfortunately, IIUC default_for_enterprise_users works with user policy only and it\u0027s a noop for device policies like this one. Instead of that, I think what you want to do is to explicitly set the default based on an IsEnterpriseManaged check in device_settings_provider.cc, see this as an example:\nhttps://cs.chromium.org/chromium/src/chrome/browser/chromeos/settings/device_settings_provider.cc?rcl\u003dcbd36495fc5ac6c3fc7eb59fa2eb667358336ced\u0026l\u003d484\nAlternatively, you could do the IsEnterpriseManaged check in virtual_machines_util.cc.\nAlso, please describe in the policy description that unmanaged users will be able to use VMs, but managed users will default to False if the policy is not set.\n\n\nDetails about default_for_enterprise_users:\ndefault_for_enterprise_users is used by the generate_policy_source.py script[1] to generate the SetEnterpriseUsersDefault[2] function. This function sets the defaults on a PolicyMap instance, but it\u0027s only called for user policy.\nI\u0027ve filed crbug.com/809653 for me to add a PRESUBMIT hook which would warn about this usage.\n\n[1] https://cs.chromium.org/chromium/src/components/policy/tools/generate_policy_source.py\n[2] https://cs.chromium.org/chromium/src/out/Debug/gen/components/policy/policy_constants.cc?rcl\u003d95f527753193a3ffafdd3bffeb3251ddd121eeea\u0026l\u003d978",
      "parentUuid": "24d2e069_9fcbdb77",
      "range": {
        "startLine": 11149,
        "startChar": 6,
        "endLine": 11149,
        "endChar": 112
      },
      "revId": "4631d9c9552432abf066358da4db68aa4dd84d30",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}