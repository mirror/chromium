{
  "comments": [
    {
      "key": {
        "uuid": "1d6b3a87_ca77d987",
        "filename": "chrome/android/java/res/values-v17/styles.xml",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1116074
      },
      "writtenOn": "2017-08-16T23:53:32Z",
      "side": 1,
      "message": "do we also want to set another background here?",
      "range": {
        "startLine": 55,
        "startChar": 17,
        "endLine": 55,
        "endChar": 31
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a6d087b_f092ce14",
        "filename": "chrome/android/java/res/values-v17/styles.xml",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T00:09:07Z",
      "side": 1,
      "message": "We could set it to black, but we don\u0027t really need it since the CCT is started with an opacity animation that keeps it hidden until code in VrShellDelegate cancels that animation. We need that hack in this case anyway to avoid weird fade out of the exiting app due to disabling preview window, which makes it unnecessary to set the background. Can add it later if things changes?",
      "parentUuid": "1d6b3a87_ca77d987",
      "range": {
        "startLine": 55,
        "startChar": 17,
        "endLine": 55,
        "endChar": 31
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "30057348_2fd2d913",
        "filename": "chrome/android/java/res/values-v17/styles.xml",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1116074
      },
      "writtenOn": "2017-08-17T00:11:24Z",
      "side": 1,
      "message": "Yes, I agree there is no need to do it in this patch necessarily, but since we are relying on our animation being \"long enough\", there might always be devices or situations that the launch of the activity actually takes slightly longer than that and maybe setting the window_background might be a fallback for those cases?",
      "parentUuid": "5a6d087b_f092ce14",
      "range": {
        "startLine": 55,
        "startChar": 17,
        "endLine": 55,
        "endChar": 31
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08ef5d10_d193c950",
        "filename": "chrome/android/java/res/values-v17/styles.xml",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T05:37:33Z",
      "side": 1,
      "message": "RE \"relying on our animation being long enough\": The animation is 10s and is cancelled from VrShellDelegate. Starting CCT should never take that long hopefully.\n\nYou\u0027re right that it probably makes sense to add it though. Done :)",
      "parentUuid": "30057348_2fd2d913",
      "range": {
        "startLine": 55,
        "startChar": 17,
        "endLine": 55,
        "endChar": 31
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0d8f4861_59913b4d",
        "filename": "chrome/android/java/res/values-v17/styles.xml",
        "patchSetId": 5
      },
      "lineNbr": 62,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-17T00:25:51Z",
      "side": 1,
      "message": "do we need to set the windowBackground to black or does this flag ensure no window background is shown?",
      "range": {
        "startLine": 62,
        "startChar": 18,
        "endLine": 62,
        "endChar": 46
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d887b01_c11d8160",
        "filename": "chrome/android/java/res/values-v17/styles.xml",
        "patchSetId": 5
      },
      "lineNbr": 62,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T05:37:33Z",
      "side": 1,
      "message": "See comment with Yusuf above.",
      "parentUuid": "0d8f4861_59913b4d",
      "range": {
        "startLine": 62,
        "startChar": 18,
        "endLine": 62,
        "endChar": 46
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f98c50c_1f274f8e",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-17T00:25:51Z",
      "side": 1,
      "message": "nit, no need for public in interface methods.  they\u0027re all public",
      "range": {
        "startLine": 36,
        "startChar": 8,
        "endLine": 36,
        "endChar": 14
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "874b5cd9_6a8883d7",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T05:37:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1f98c50c_1f274f8e",
      "range": {
        "startLine": 36,
        "startChar": 8,
        "endLine": 36,
        "endChar": 14
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e29a9384_7986e4c2",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T05:37:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1f98c50c_1f274f8e",
      "range": {
        "startLine": 36,
        "startChar": 8,
        "endLine": 36,
        "endChar": 14
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f55e95d2_456b0312",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 122,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-17T00:25:51Z",
      "side": 1,
      "message": "Did you see that this works?  I recall trying this in the past (and I just tried it locally) and I can never get FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY to return true.\n\nI tried setting \"Don\u0027t keep activities\" and returning to a non-VR SeparateTask CCT.  I also tried without, but in those cases you get no signal at all.  How were you able to get this to return as you expect?  Does it work for non-vr activities?",
      "range": {
        "startLine": 122,
        "startChar": 33,
        "endLine": 122,
        "endChar": 55
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aad63560_51b70708",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 122,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T05:37:33Z",
      "side": 1,
      "message": "Yes, I did test that it works locally for both VR and non-VR SeparateTask CCT.\n\nIt looks like it has something to do with finishing the activity before its re-created from the recent apps page. FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY is always false if I don\u0027t finish the activity when its stopped. I can\u0027t seem to find documentation to confirm, but it seems like the system only sets it in this case. It doesn\u0027t seem to work from \"Don\u0027t keep activities\" but I\u0027m not sure what\u0027s different between this setting and finishing the activity.",
      "parentUuid": "f55e95d2_456b0312",
      "range": {
        "startLine": 122,
        "startChar": 33,
        "endLine": 122,
        "endChar": 55
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39e69537_3b3dc9e6",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 122,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-17T17:35:06Z",
      "side": 1,
      "message": "How do you go about finishing the activity?  Separate task CCTs don\u0027t actually call finish(), they call finish and remove task, which means the entry shouldn\u0027t be in recents at all.  When you hit the home button on Android, finish is not called.\n\nI guess I\u0027m curious the exact steps in non-VR as I simply couldn\u0027t get this to work.\n\nI added the following to SeparateTaskCustomTabActivity, and it always returned false.  I changed handleFinishAndClose to just call finish as well, but that didn\u0027t seem to help.\n\n    @Override\n    public void preInflationStartup() {\n        super.preInflationStartup();\n\n        System.out.println(\"TED - SeparateTaskCustomTabActivity.java#preInflationStartup : \"\n                 + launchedFromRecentApps(getIntent()) + \", \" + launchedFromRecentApps(getInitialIntent()));\n    }\n\n    @Override\n    protected void onNewIntent(Intent intent) {\n        super.onNewIntent(intent);\n\n        System.out.println(\"TED - SeparateTaskCustomTabActivity.java#preInflationStartup : \"\n                + launchedFromRecentApps(getIntent()) + \", \" + launchedFromRecentApps(getInitialIntent()));\n    }\n\n    static boolean launchedFromRecentApps(Intent intent) {\n        return ((intent.getFlags() \u0026 Intent.FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY) !\u003d 0);\n    }\n\nAgain sorry to belabor this point, but I\u0027m just very curious under what circumstances you get a non false value.",
      "parentUuid": "aad63560_51b70708",
      "range": {
        "startLine": 122,
        "startChar": 33,
        "endLine": 122,
        "endChar": 55
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b4831b4_79ba3941",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 122,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-17T18:19:43Z",
      "side": 1,
      "message": "The way I\u0027m testing is hitting the recent apps button and clicking on the CCT again. I call finishAndClose every time the activity is stopped (e.g when you hit any of the home, app, or recent apps button).\n\nAlso, I\u0027m calling finishAndClose() on CustomTabActivity not SeparateTaskCustomTabActivity, that\u0027s what keeps it in the recents. FWIW, calling finishAndRemoveTask() still shows a window in the recent apps (if you hit the recent apps button), and then when you click on the window, it just disappears.\n\nThe behavior I was going for was that coming back from recents to CCT VR should not just kill the activity, but instead start the CCT in non-VR mode (this would be a rare use case anyway).\n\nSo it looks like to have FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY set, you need to have the task still running and the activity finished and re-started from the recent apps.\n\nI tried this on a sample app activity and this seems to work:\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Log.e(\"ymalik\", \"launched from history: \" + launchedFromRecentApps(getIntent()));\n    }\n\n    @Override\n    protected void onStop() {\n        super.onStop();\n        finish();\n    }\n\n    static boolean launchedFromRecentApps(Intent intent) {\n        return ((intent.getFlags() \u0026 Intent.FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY) !\u003d 0);\n    }",
      "parentUuid": "39e69537_3b3dc9e6",
      "range": {
        "startLine": 122,
        "startChar": 33,
        "endLine": 122,
        "endChar": 55
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef3a0091_5ff55f9c",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 122,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-17T21:32:37Z",
      "side": 1,
      "message": "Your activity extends from SeparateTaskCustomTabActivity, so you can\u0027t call finishAndClose on the CustomTabActivity at least in your current setup.\n\nBut we don\u0027t call finish in onStop in either CustomTabActivity or SeparateTaskCustomTabActivity, and in fact we can\u0027t because it would destroy the activity every time we triggered an external intent.\n\nI guess I don\u0027t see what changes we can make to the existing code to trigger this without creating a test app.",
      "parentUuid": "7b4831b4_79ba3941",
      "range": {
        "startLine": 122,
        "startChar": 33,
        "endLine": 122,
        "endChar": 55
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2c6c69d_a3a93821",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/VrIntentUtils.java",
        "patchSetId": 5
      },
      "lineNbr": 122,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-18T23:18:54Z",
      "side": 1,
      "message": "There are some discussions around whether this is predictable.  Seems like it \"should\" be but maybe isn\u0027t.  Please file a bug about this so we can track this, but to unblock this, we can land this as is for now.",
      "parentUuid": "ef3a0091_5ff55f9c",
      "range": {
        "startLine": 122,
        "startChar": 33,
        "endLine": 122,
        "endChar": 55
      },
      "revId": "3d1102b4baf2b9759e4bd9f9cad8f0a5151a1fd4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}