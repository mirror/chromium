{
  "comments": [
    {
      "key": {
        "uuid": "cedece0b_35fd8e36",
        "filename": "net/http/http_server_properties_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1157934
      },
      "writtenOn": "2017-07-07T22:24:00Z",
      "side": 0,
      "message": "This is storing all the nonbroken alternative services right? I think the check is still needed. If an alt svc is marked as broken, it shouldn\u0027t be saved to the nonbroken list. |alternative_service_map_| is used to get alternative service to use when we race TCP and QUIC in particular, thus we do require a nonbroken alt svc to be returned when we iterate the map. Why do we want to ignore the brokenness now? You might have context I missed I guess.",
      "range": {
        "startLine": 935,
        "startChar": 60,
        "endLine": 935,
        "endChar": 0
      },
      "revId": "b040ffbbdf06588a82e77702ba782a927601445b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27d6f391_40eb6634",
        "filename": "net/http/http_server_properties_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1228995
      },
      "writtenOn": "2017-07-08T00:00:44Z",
      "side": 0,
      "message": "Interesting. Ryan mentioned a while ago that all alternative services should now be persisted as part of this change. I assume because now that we store which ones are broken, when chrome restarts, we\u0027ll still be able to tell which alt svcs are broken or nonbroken.\n\nrch@, is this the behavior we want?",
      "parentUuid": "cedece0b_35fd8e36",
      "range": {
        "startLine": 935,
        "startChar": 60,
        "endLine": 935,
        "endChar": 0
      },
      "revId": "b040ffbbdf06588a82e77702ba782a927601445b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b08e0371_93ce58f9",
        "filename": "net/http/http_server_properties_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1116006
      },
      "writtenOn": "2017-07-10T13:52:05Z",
      "side": 0,
      "message": "The reason we did\u0027t save broken services in the past is that we didn\u0027t store the broken-state/backoff, so when we restarted, we\u0027d try to use them again even though we should have known they were broken. Now that we\u0027re saving the brokenness/backoff I don\u0027t think we\u0027ll have this problem.\n\nSo I think your code now has the correct behavior.",
      "parentUuid": "27d6f391_40eb6634",
      "range": {
        "startLine": 935,
        "startChar": 60,
        "endLine": 935,
        "endChar": 0
      },
      "revId": "b040ffbbdf06588a82e77702ba782a927601445b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5551702e_5eca2ba7",
        "filename": "net/http/http_server_properties_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1157934
      },
      "writtenOn": "2017-07-10T17:40:21Z",
      "side": 0,
      "message": "That\u0027s the good point. The reason that led me to conclude we should ignore persisting broken ones comes from the fact that we always remove the borken alt svc entry from |alternative_service_map_| when its brokenness fires. Now I believe it\u0027s a bug elsewhere.\n\nThe |altenative_service_map_| should contain all the alt svcs regardless of brokenness. |broken_alternativer_service_| will listing broken alt svcs and their brokenness. |recently_broken_alternative_services_| will track the broken count. When we request a alt svc, we will iterate the |altenative_service_map_| while keep asking is this entry broken. The broken list only needs to main the brokenness of alt svc vs time while recently broken list should be tracking the broken count and generate correct expiration time for broken list. \n\nThe code here has the correct logic, but to have things work together, I think the logic when we expire alt svc\u0027s brokenness should be fixed: https://cs.chromium.org/chromium/src/net/http/http_server_properties_impl.cc?sq\u003dpackage:chromium\u0026l\u003d675.",
      "parentUuid": "b08e0371_93ce58f9",
      "range": {
        "startLine": 935,
        "startChar": 60,
        "endLine": 935,
        "endChar": 0
      },
      "revId": "b040ffbbdf06588a82e77702ba782a927601445b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}