{
  "comments": [
    {
      "key": {
        "uuid": "bdfa845e_c28f7ea6",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1144414
      },
      "writtenOn": "2017-12-02T01:19:42Z",
      "side": 1,
      "message": "Can you just make this an anonymous runnable or lambda? i.e.:\n```\nmHandler.post(new Runnable() {\n  @Override\n  public void run() {\n  }\n});\n```\n\nor,\n\n```\npublic void onSinksReceivedInternal(...) {\n}\n\n...\nmHandler.post(() -\u003e {\n    onSinksReceivedInternal(...);\n  });\n```",
      "range": {
        "startLine": 38,
        "startChar": 27,
        "endLine": 38,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07bfa873_bbeff355",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-12-02T02:31:59Z",
      "side": 1,
      "message": "IIRC Chrome/Android in general prefers static inner classes for performance reasons.\n\nAlso I can\u0027t recall from https://codereview.chromium.org/1380213003/ but have a feeling that the weak reference to the manager was important.\n\nAlso I doubt Java 8 is enabled yet for Chrome, with its lambdas and functions.",
      "parentUuid": "bdfa845e_c28f7ea6",
      "range": {
        "startLine": 38,
        "startChar": 27,
        "endLine": 38,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70b84b5a_16d79007",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1144414
      },
      "writtenOn": "2017-12-02T02:50:34Z",
      "side": 1,
      "message": "Java lambdas are already supported: https://groups.google.com/a/google.com/forum/#!msg/clank-team/xcA9ZTRea4s/kKSsOrSOBQAJ\nThere are a number of Java lambda uses in Chromium already: https://cs.chromium.org/search/?q\u003d%22()+-%3E+%7B%22+f:chrome\u0026sq\u003dpackage:chromium\u0026type\u003dcs\n\nI think the weak reference shouldn\u0027t matter much for this Runnable. It is posted from `onSinksReceived()` and will soon be executed after that. If anything can cause a GC issue, it should be the object that is referencing this BaseMRP for calling `onSinksReceived()`, not this Runnable.\n\nI don\u0027t have strong opinions BTW, but using lambda could improve the readability. You can do in either way :)",
      "parentUuid": "07bfa873_bbeff355",
      "range": {
        "startLine": 38,
        "startChar": 27,
        "endLine": 38,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5c1186b5_4ed20bbc",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-12-02T03:18:28Z",
      "side": 1,
      "message": "Ah, neat!\nMy concern was that its the native class MediaRouterAndroid that references ChromeMediaRouter and therefore media route providers (https://cs.chromium.org/chromium/src/chrome/browser/media/android/router/media_router_android_bridge.h?rcl\u003db1abba979fd58e1ba57fb4009517268dc64f1ce8\u0026l\u003d81).\n\nIf the native class is destroyed before the runnable is run, the runnable will try to reach it via JNI and will crash.\n\nOtherwise I prefer new lambdas too!",
      "parentUuid": "70b84b5a_16d79007",
      "range": {
        "startLine": 38,
        "startChar": 27,
        "endLine": 38,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55eba0ad_bcab8ede",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1144414
      },
      "writtenOn": "2017-12-02T22:03:57Z",
      "side": 1,
      "message": "I see. I guess this is a broader issue on JNI then? If any other Java class holds a reference to ChromeMediaRouter, it has the potential to crash.\n\nWe could have a `tearDown()` method in in ChromeMediaRouter, such that when native MediaRouterAndroid calls the method when it\u0027s destroyed. Then we guard all JNI calls from ChromeMediaRouter to MediaRouterAndroid with mNativeMediaRouterAndroidBridge. Then lambda should be safe here.",
      "parentUuid": "5c1186b5_4ed20bbc",
      "range": {
        "startLine": 38,
        "startChar": 27,
        "endLine": 38,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "25c8df46_e99f81cb",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1150472
      },
      "writtenOn": "2017-12-07T03:40:40Z",
      "side": 1,
      "message": "I have added a teardown() method and made sure all native calls were guarded.",
      "parentUuid": "55eba0ad_bcab8ede",
      "range": {
        "startLine": 38,
        "startChar": 27,
        "endLine": 38,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "166dc1e5_73ff4c61",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 76,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-12-02T02:31:59Z",
      "side": 1,
      "message": "nit: Sounds like supportsSource() from MediaRouteProvider could be implemented using this method right here?\n\nConsider regrouping the members of the new classes a little for easier reading, e.g. this could be next to the protected ctor?\n\nAlso, document protected methods as well as what class/interface the overridden methods are from (e.g. MediaRouteProvider below for the rest of the methods).",
      "range": {
        "startLine": 76,
        "startChar": 35,
        "endLine": 76,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "932a3600_2ccbe166",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 76,
      "author": {
        "id": 1150472
      },
      "writtenOn": "2017-12-07T03:40:40Z",
      "side": 1,
      "message": "Added supportsSource() here.\nMoved next to protected ctor.\nAdded comment.",
      "parentUuid": "166dc1e5_73ff4c61",
      "range": {
        "startLine": 76,
        "startChar": 35,
        "endLine": 76,
        "endChar": 50
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6915ff96_b8d16085",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 147,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-12-02T02:31:59Z",
      "side": 1,
      "message": "nit: Should these empty methods be abstract?\n\njoinRoute and sendStringMessage are not needed for RemotePlayback so could have default implementation.",
      "range": {
        "startLine": 147,
        "startChar": 65,
        "endLine": 147,
        "endChar": 67
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa3dc14d_16b307cf",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/media/router/BaseMediaRouteProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 147,
      "author": {
        "id": 1150472
      },
      "writtenOn": "2017-12-07T03:40:40Z",
      "side": 1,
      "message": "Converted to abstract :)",
      "parentUuid": "6915ff96_b8d16085",
      "range": {
        "startLine": 147,
        "startChar": 65,
        "endLine": 147,
        "endChar": 67
      },
      "revId": "ed9136ff663a360f06eacc5321946ac1fb24497e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}