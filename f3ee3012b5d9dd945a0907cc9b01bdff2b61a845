{
  "comments": [
    {
      "key": {
        "uuid": "4fa05ad9_93639836",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1238,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-06T02:01:09Z",
      "side": 1,
      "message": "Now I think we may need to lie about effect node here to incorporate mask-based clip-paths, because ClipPathClipper will paint mask-based clip-path into a kDstIn child effect node of the main effect node.\n\nTo be specific, still use the transform and clip node from PreEffectProperties(), but override effect node with the one from BorderBoxProperties().\n\n(Yes, this is weird and wrong, I hope we can remove this hack once ancestor_clipping_mask_layer_ no longer includes clip-path.)",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89b8f6b7_9242c07b",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1244,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-02T00:28:10Z",
      "side": 1,
      "message": "Similar to comment below, I\u0027d rather unify the code between SPv1 and SPv175. Clip masks aren\u0027t really normal paint phase, in the sense that they don\u0027t go to the painters, and the drawings don\u0027t even have proper property tree state to represent them. It feels more correct to completely move them out of PaintFragmentWithPhase().",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bb3e436c_e0ade20b",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1244,
      "author": {
        "id": 1002481
      },
      "writtenOn": "2017-12-04T05:55:38Z",
      "side": 1,
      "message": "For now the object painter path is still needed to paint clipping mask in some cases (see BoxPainter::PaintClippingMask()). We could refactor to remove that path, but that could be a separate CL because it might cause SPv1 regressions not discoverable by the current layout tests.",
      "parentUuid": "89b8f6b7_9242c07b",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a7c71bd_11b72a3c",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1244,
      "author": {
        "id": 1002481
      },
      "writtenOn": "2017-12-04T17:04:23Z",
      "side": 1,
      "message": "https://chromium-review.googlesource.com/c/chromium/src/+/806424 refactors SPv1 clipping mask painting, but for now it fails fast/borders/border-radius-mask-canvas*.html because of missing border radius clipping on canvas. I may need to change PaintLayerClipper to add back the clipping which was done in BoxClipper, but I would like to put it in priority lower than SPv175 work.",
      "parentUuid": "bb3e436c_e0ade20b",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9b8ee938_62150dab",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1244,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-06T02:01:09Z",
      "side": 1,
      "message": "I\u0027m thinking we should even move these to CLM. These are very specific to CLM using masks to synthesize clips. But like you said we don\u0027t have to be blocked by this.",
      "parentUuid": "3a7c71bd_11b72a3c",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f216b901_e80751f8",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1278,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-02T00:28:10Z",
      "side": 1,
      "message": "I\u0027d rather copy/move line 995~1013 to here, and unify code for SPv1 and SPv175. The code structure would look like:\n\nDCHECK(!RuntimeEnabledFeatures::SlimmingPaintV2Enabled()); // Clip mask are synthesized by PAC in SPv2.\nClipRecorder clip_recorder(blah, blah, blah); // Applies border radius clip. No-op in SPv175.\nOptional\u003cScopedPaintChunkProperties\u003e scope;\nif (RuntimeEnabledFeatures::SlimmingPaintV175Enabled()) {\n  // Applies border radius clip as property node.\n  scope.emplace(rare_data-\u003eContentsProperties());\n}\nFillMaskingFragment(blah, blah, blah);",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6902c1f_fe9fdc8a",
        "filename": "third_party/WebKit/Source/core/paint/PaintLayerPainter.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1278,
      "author": {
        "id": 1002481
      },
      "writtenOn": "2017-12-04T05:55:38Z",
      "side": 1,
      "message": "Ditto.",
      "parentUuid": "f216b901_e80751f8",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "74921703_e42d77b4",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositingLayerPropertyUpdater.cpp",
        "patchSetId": 10
      },
      "lineNbr": 70,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-02T00:28:10Z",
      "side": 1,
      "message": "This looks wrong. If we do this then the painted clip masks will be subject to any effects that we have on this layout object. e.g. if we have a blur filter, the clip mask will be blurry.\n\nI think we should use rare_paint_data-\u003eLocalBorderBoxProperties() here. Then at PaintLayerPainter::FillMaskingFragment() assign its DrawingDisplayItem with the clip node that are going to apply to in-flow children.\n\nActually there are a few things going very wrong in SPv1. 1. clip-path shouldn\u0027t be a part of child_clipping_mask_layer, because it applies to the post-effect contents instead of pre-effect contents. 2. Out-of-flow children won\u0027t be able to escape clips that are applied as child_clipping_mask_layer.\n\nI think (1) is relatively easy to fix by moving clip-path to mask_layer. (2) will be impossible to fix without radical change to CLM (which I think will be fun to do as SPv1.875).",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c67497fd_9b312674",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositingLayerPropertyUpdater.cpp",
        "patchSetId": 10
      },
      "lineNbr": 70,
      "author": {
        "id": 1002481
      },
      "writtenOn": "2017-12-04T05:55:38Z",
      "side": 1,
      "message": "Done:\n- replacing PreEffectProperties() with LocalBorderBoxProperties() here\n- In PaintLayerPainter::PaintAncestorClippingMask, using paint_layer_\u0027s PreEffectProperties() except the effect node.",
      "parentUuid": "74921703_e42d77b4",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31e852c9_64161503",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositingLayerPropertyUpdater.cpp",
        "patchSetId": 10
      },
      "lineNbr": 94,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-02T00:28:10Z",
      "side": 1,
      "message": "I wouldn\u0027t worry about subpixel position, as the compositing code only see post-snapping coordinates. Subpixel accumulation will be applied at paint time instead.\n\nI don\u0027t like accumulating position here though. Is it possible to cache it in OffsetFromLayoutObject, and make it a comment somewhere that the referenced layout object is clip_inheritance_ancestor instead of the owning_layer?",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1dc059f5_7eb642e3",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositingLayerPropertyUpdater.cpp",
        "patchSetId": 10
      },
      "lineNbr": 94,
      "author": {
        "id": 1002481
      },
      "writtenOn": "2017-12-04T05:55:38Z",
      "side": 1,
      "message": "I tried to change AncestorClippingMaskLayer\u0027s OffsetFromLayoutObject to be relative to ClipInheritanceAncestor but I found that would affect many places assuming different meaning of it. I could manage to make all layout tests pass but I\u0027m afraid that might break something not covered by the current layout tests. So I would like to keep it out of the critical path to SPv175 and SPv2.\n\nI changed the above offset accumuation to \"PaintLayer::ConvertToLayerCoords(clip_inheritance_ancestor, snapped_paint_offset + ancestor_clipping_mask_layer-\u003eOffsetFromLayoutObject()) which may look better.",
      "parentUuid": "31e852c9_64161503",
      "revId": "f3ee3012b5d9dd945a0907cc9b01bdff2b61a845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}