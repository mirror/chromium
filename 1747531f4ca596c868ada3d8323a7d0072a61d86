{
  "comments": [
    {
      "key": {
        "uuid": "5613cded_3eebbd47",
        "filename": "chrome/browser/offline_pages/background_loader_offliner.cc",
        "patchSetId": 11
      },
      "lineNbr": 509,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-06-14T18:41:46Z",
      "side": 1,
      "message": "s/when/after/",
      "revId": "1747531f4ca596c868ada3d8323a7d0072a61d86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fddcd4b0_eaa7239d",
        "filename": "chrome/browser/offline_pages/background_loader_offliner.cc",
        "patchSetId": 11
      },
      "lineNbr": 509,
      "author": {
        "id": 1212384
      },
      "writtenOn": "2017-06-14T22:09:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5613cded_3eebbd47",
      "revId": "1747531f4ca596c868ada3d8323a7d0072a61d86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d6a8ae13_dad5e26d",
        "filename": "chrome/browser/offline_pages/background_loader_offliner.cc",
        "patchSetId": 11
      },
      "lineNbr": 511,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-06-14T18:41:46Z",
      "side": 1,
      "message": "This seems really risky to me.  You all know this particular code better than I do, but I\u0027ve seen lots of bugs (including a release-blocking use-after-free bug I\u0027m working on right now) due to asynchronous deletion.  If snapshot_controller_ has any way to continue accessing deleted state before this deletion task runs, we\u0027ll have big problems (potentially security bugs).\n\nIf you\u0027re certain that it\u0027s safe, can you include a comment above explaining why?",
      "revId": "1747531f4ca596c868ada3d8323a7d0072a61d86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "341a58de_f37c0815",
        "filename": "chrome/browser/offline_pages/background_loader_offliner.cc",
        "patchSetId": 11
      },
      "lineNbr": 511,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-06-14T20:38:19Z",
      "side": 1,
      "message": "Charlie, did you mean deleted state of BLO? or something else?\n\nI can only see a scenario, where there is more posted tasks queued for snapshot controller ahead of delete, in which case BLO::StartSnapshot may be called a few more times, but state being reset, that should not be a problem.\n\nHearing the above, we could call something like snapshot_controller_-\u003eStop() or Reset() to ensure we don\u0027t Start another snapshot. It would be safer then.",
      "parentUuid": "d6a8ae13_dad5e26d",
      "revId": "1747531f4ca596c868ada3d8323a7d0072a61d86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27432f53_ad22ac4a",
        "filename": "chrome/browser/offline_pages/background_loader_offliner.cc",
        "patchSetId": 11
      },
      "lineNbr": 511,
      "author": {
        "id": 1212384
      },
      "writtenOn": "2017-06-14T22:09:55Z",
      "side": 1,
      "message": "Added a comment. Let me know if this isn\u0027t the type of explanation you wanted?\n\nThanks!",
      "parentUuid": "341a58de_f37c0815",
      "revId": "1747531f4ca596c868ada3d8323a7d0072a61d86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "03e54c26_01879315",
        "filename": "chrome/browser/offline_pages/background_loader_offliner.cc",
        "patchSetId": 11
      },
      "lineNbr": 511,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-06-14T23:23:50Z",
      "side": 1,
      "message": "Thanks.  Yes, I was concerned that SnapshotController might have pointers to things that get cleared here, and that leaving it around could lead to use-after-frees.  (Similarly, it might call into BLO in ways that crash after ResetState.)\n\nIt sounds like that\u0027s not possible, and that SnapshotController only interacts with this class via StartSnapshot(), which returns early in this case.  If it doesn\u0027t seem likely that future dependencies will be added between the two, then we\u0027re probably ok here.",
      "parentUuid": "27432f53_ad22ac4a",
      "revId": "1747531f4ca596c868ada3d8323a7d0072a61d86",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}