{
  "comments": [
    {
      "key": {
        "uuid": "7edafd4d_954f3d47",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 69,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "I am not an expert in JUnit test rules. (https://carlosbecker.com/posts/junit-rules/ has some documentation). I think that we want to use EmbeddedTestServerRule. EmbeddedTestServerRule provides the logic for cleaning up the test server at the end of the test",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b6157714_16be59da",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 69,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7edafd4d_954f3d47",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9294bb80_6a17c7c0",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "If we use EmbeddedServerTestRule, I think that we can call EmbeddedServerTestRule#getServer() here",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c550a25_7d2e9d23",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Moved the create and destroy in setup and teardown.",
      "parentUuid": "9294bb80_6a17c7c0",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "78d99404_280fedc0",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 111,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "I found the proper way to clear SharedPreferences! ApplicationTestUtils#clearAppData() does it.\nChromeActivityTestRule#apply() calls ApplicationTestUtils#clearAppData()\n\nWe need to call super.apply() the way that ChromeActivityTestRule#apply() does",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89995db1_0458dddb",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 111,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "78d99404_280fedc0",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5f806464_4a8b99d9",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 161,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-14T16:26:56Z",
      "side": 1,
      "message": "I looked at how RuleChain#apply() is implemented in Android (Grepcode is a good place to get the source code of Android classes) http://grepcode.com/file/repo1.maven.org/maven2/junit/junit/4.10/org/junit/rules/RuleChain.java\n\nand https://stackoverflow.com/questions/29195750/aggregating-junit-rules-with-dependencies-between-one-another\n\nIf I change the WebappActivityTestRule#apply() implementation to this, I am able to use EmbeddedTestServerRule.\n\n    @Override\n    public Statement apply(Statement base, Description description) {\n        base \u003d super.apply(base, description);\n        final Statement base2 \u003d mTestServerRule.apply(base, description);\n        return new Statement() {\n            @Override\n            public void evaluate() throws Throwable {\n                // Register the webapp so when the data storage is opened, the test doesn\u0027t crash.\n                WebappRegistry.refreshSharedPrefsForTesting();\n                TestFetchStorageCallback callback \u003d new TestFetchStorageCallback();\n                WebappRegistry.getInstance().register(WEBAPP_ID, callback);\n                callback.waitForCallback(0);\n                callback.getStorage().updateFromShortcutIntent(createIntent());\n\n                base2.evaluate();\n            }\n        };\n    }",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f504a47d_6295f3ea",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 161,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "I tried this approach, test fails because it does not clean the data properly so I just stick with the original EmbeddedTestServer approach.",
      "parentUuid": "5f806464_4a8b99d9",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f0c6f27e_f9f161aa",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 161,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-15T15:55:42Z",
      "side": 1,
      "message": "Fixed it:\n\n    @Override\n    public Statement apply(final Statement base, Description description) {\n        Statement webappTestRuleStatement \u003d new Statement() {\n            @Override\n            public void evaluate() throws Throwable {\n                // Register the webapp so when the data storage is opened, the test doesn\u0027t crash.\n                WebappRegistry.refreshSharedPrefsForTesting();\n                TestFetchStorageCallback callback \u003d new TestFetchStorageCallback();\n                WebappRegistry.getInstance().register(WEBAPP_ID, callback);\n                callback.waitForCallback(0);\n                callback.getStorage().updateFromShortcutIntent(createIntent());\n                base.evaluate();\n            }\n        };\n\n        Statement testServerStatement \u003d mTestServerRule.apply(webappTestRuleStatement, description);\n        return super.apply(testServerStatement, description);\n    }\n\nNot sure how readable this is.\nChromeActivityTestRule#evaluate() is called first\nChromeActivityTestRule#evaluate() calls evaluate on EmbeddedTestServerRule (EmbeddedTestServerRule inherits from TestWatcher)\nEmbeddedTestServerRule#evaluate() calls WebappActivityTestRule#evaluate()\nThe rule of thumb is that outermost is called last.",
      "parentUuid": "f504a47d_6295f3ea",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fd346169_140e93f5",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "- Maybe rename this method to startWebappActivityAndWaitForSplashScreen() and have the method return the splash screen ViewGroup? This would enable you to remove a bunch of waitUntilSplashScreenAppears() calls\n- Is there a reason that this method is final?",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51c76cf4_6bce680e",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Renamed. I preferred to keep its behavior consist with startWebappActivity().\nI saw startWebappActivity is final so I just make this final as well.",
      "parentUuid": "fd346169_140e93f5",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8c726196_6504b269",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-15T15:55:42Z",
      "side": 1,
      "message": "Not sure why startWebappActivity() is final. WebappActivityTestRule does not have any subclasses so I don\u0027t think that final makes a difference.\n\nI think that having startSplashScreenWebappActivity() and waitUntilSplashScreenAppears() which both do some waiting (but the conditions that the two methods wait for is different) is confusing.\n\nI think that it is logical to return the splash screen from this method given that the method waits till the splash screen is fully loaded.",
      "parentUuid": "51c76cf4_6bce680e",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0c549c79_e3b7b8f4",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 204,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "Does checking:\n\nprivate boolean mStartedLoading;\n\n@Override\npublic boolean isSatisfied() {\n    mStartedLoading |\u003d activity.getActivityTab() !\u003d null \u0026\u0026 activity.getActivityTab().isLoading();\n\n    // Wait till native has been loaded.\n    if (!mStartedLoading) return false;\n\n    // Wait till the splash screen has finished initializing.\n     ViewGroup splashScreen \u003d getActivity().getSplashScreenForTests();\n    return splashScreen !\u003d null \u0026\u0026 splashScreen.getChildCount() \u003e 0;\n}\n\nwork?\n\nWebappSplashScreenController#initializeLayout() only logs UMA if native has loaded",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17333486_0b246c89",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappActivityTestRule.java",
        "patchSetId": 1
      },
      "lineNbr": 204,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Done. Forgot to restore the test function.",
      "parentUuid": "0c549c79_e3b7b8f4",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "597146ca_5c3d2042",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappSplashScreenIconTest.java",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "You should use startWebappActivityAndWaitForSplashScreen() instead?",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95fd5684_d9ad896e",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappSplashScreenIconTest.java",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "597146ca_5c3d2042",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abb09b93_a8c20d6f",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappSplashScreenThemeColorTest.java",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-08-11T22:09:29Z",
      "side": 1,
      "message": "Should this method call startWebappActivityAndWaitForSplashScreen() instead?",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb803a91_17621db3",
        "filename": "chrome/android/javatests/src/org/chromium/chrome/browser/webapps/WebappSplashScreenThemeColorTest.java",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1117450
      },
      "writtenOn": "2017-08-14T17:00:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "abb09b93_a8c20d6f",
      "revId": "24732b255bcd55a5ac25c32d935a93c0ad812920",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}