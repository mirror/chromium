{
  "comments": [
    {
      "key": {
        "uuid": "9106b71d_416b687c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1144624
      },
      "writtenOn": "2017-09-19T20:15:47Z",
      "side": 1,
      "message": "On Mac, we are actively removing the pre-sandboxed warmup phase from all process types. So I don\u0027t think we should introduce this at all on Mac. What resource is the sandbox blocking?",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac066f5b_5d53286a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1137859
      },
      "writtenOn": "2017-09-19T21:42:07Z",
      "side": 1,
      "message": "Right on Mac we need to just add the resources to the profile, there isn\u0027t going to be any pre-sandbox warmup anymore. It\u0027s not needed since we can whitelist any resource access that\u0027s necessary and appropriate.",
      "parentUuid": "9106b71d_416b687c",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9b49d1aa_719536f3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-09-19T21:57:10Z",
      "side": 1,
      "message": "Cool. I was following the PPAPI model and didn\u0027t know about this.\n\nOn Mac, the only thing we need is to preload the CDM itself. I have no idea what \"add the resources to the profile\" means. Do you have any examples I can look at?\n\n---\n\nWhat about Windows? Does the current preloading logic look fine to you? On Windows, I need to do more pre-sandbox-startup, e.g. preload dxva2.dll [1], and initialize VMP [2]\n\n[1] https://cs.chromium.org/chromium/src/content/ppapi_plugin/ppapi_thread.cc?rcl\u003d0bdf1625e816838b2a545f6a4e845770f4613e3e\u0026l\u003d405\n[2] https://cs.chromium.org/chromium/src/content/ppapi_plugin/ppapi_thread.cc?rcl\u003d0bdf1625e816838b2a545f6a4e845770f4613e3e\u0026l\u003d376",
      "parentUuid": "ac066f5b_5d53286a",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "982e52d8_b8576f5e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1137859
      },
      "writtenOn": "2017-09-19T21:58:40Z",
      "side": 1,
      "message": "Do you mean it just needs a path to the CDM library? That\u0027s a one line change in our sandbox profile. In fact, the new sandbox can read the entire bundle contents so once that lands this won\u0027t even be a special case.",
      "parentUuid": "9b49d1aa_719536f3",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a78b2394_72e5444b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-09-19T23:21:30Z",
      "side": 1,
      "message": "Yes, I only need the path to the CDM. Note that we also support component-updated CDM, which can live in the user profile, so the CDM doesn\u0027t necessarily live in the bundle. Also because of that, the CDM path will only be known at run time. So can we make that one line change in the sandbox profile at runtime?",
      "parentUuid": "982e52d8_b8576f5e",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a95f2f1f_07e346b0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1137859
      },
      "writtenOn": "2017-09-20T00:47:14Z",
      "side": 1,
      "message": "Yes, the browser will resolve the path to the CDM and pass it to the sandbox profile. Note that this doesn\u0027t require the CDM to trust the browser because if the browser lies about the CDM path, Widevine just won\u0027t initialize. But it can\u0027t be used to load a false CDM or anything.",
      "parentUuid": "a78b2394_72e5444b",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "baf9e8d9_4288b262",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-09-20T01:07:52Z",
      "side": 1,
      "message": "Cool, this sounds pretty good. Could you please show me any code/link that I can start from? Thanks!",
      "parentUuid": "a95f2f1f_07e346b0",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cb0aa549_5f6dcf6e",
        "filename": "content/browser/media/media_interface_proxy.cc",
        "patchSetId": 6
      },
      "lineNbr": 53,
      "author": {
        "id": 1116053
      },
      "writtenOn": "2017-09-19T18:07:09Z",
      "side": 1,
      "message": "stray logging here.",
      "range": {
        "startLine": 53,
        "startChar": 0,
        "endLine": 53,
        "endChar": 23
      },
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a61c1fdf_c9a0bb4c",
        "filename": "content/common/sandbox_mac.mm",
        "patchSetId": 6
      },
      "lineNbr": 65,
      "author": {
        "id": 1116053
      },
      "writtenOn": "2017-09-19T18:07:09Z",
      "side": 1,
      "message": "We\u0027ll pick this out of my CL for SANDBOX_TYPE_WIDEVINE.",
      "range": {
        "startLine": 65,
        "startChar": 1,
        "endLine": 65,
        "endChar": 56
      },
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79639533_b22c18e1",
        "filename": "content/zygote/zygote_main_linux.cc",
        "patchSetId": 6
      },
      "lineNbr": 341,
      "author": {
        "id": 1144624
      },
      "writtenOn": "2017-09-19T20:15:47Z",
      "side": 1,
      "message": "I\u0027m wondering if this is needed. I think the browser can open() the .so and transfer the FD to the CDM modules over IPC, and then you could dlopen using /proc/self/fd/\u003cfd\u003e.",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2b21df4a_efb30477",
        "filename": "content/zygote/zygote_main_linux.cc",
        "patchSetId": 6
      },
      "lineNbr": 341,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-09-19T21:57:10Z",
      "side": 1,
      "message": "Thanks! I am not super familiar with this. Do you have any example I can look at?",
      "parentUuid": "79639533_b22c18e1",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "29690b7d_aa73c6af",
        "filename": "content/zygote/zygote_main_linux.cc",
        "patchSetId": 6
      },
      "lineNbr": 341,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-09-20T06:56:00Z",
      "side": 1,
      "message": "I tried it and it fails due to some permission issue. Here\u0027s the CL (on top of this CL):\n\nhttps://chromium-review.googlesource.com/#/c/chromium/src/+/674708\n\nWhen I test it, I got some permission error:\n\n[1:1:0919/234456.177568:VERBOSE2:cdm_module.cc(59)] Initialize: cdm_path \u003d /proc/self/fd/283\n[1:1:0919/234456.178570:ERROR:cdm_module.cc(70)] CDM at /proc/self/fd/283 could not be loaded.\n[1:1:0919/234456.178733:ERROR:cdm_module.cc(71)] Error: /proc/self/fd/283: cannot open shared object file: Operation not permitted\n\nI also tried with --no-sandbox, and the test passes. So at least I am sure I opened the right file, and passed the fd correctly to the utility process.\n\nI am not familiar with linux sandbox so I don\u0027t have much clue here. Do we even have access to /proc/self/fd in the utility sandbox (forked from zygote)?",
      "parentUuid": "2b21df4a_efb30477",
      "revId": "50e419878cdddd906647c7dc2beed04633fc1276",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}