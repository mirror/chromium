{
  "comments": [
    {
      "key": {
        "uuid": "32ed6063_428996ff",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/contextualsearch/ContextualSearchRankerLoggerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1212246
      },
      "writtenOn": "2018-01-17T17:11:30Z",
      "side": 1,
      "message": "Could it happen that we have not logged outcomes at this point (and mFeaturesToLog contains inference features) if writeLogAndReset is called from the destructor? If for some reason, the condition in runPredictionForTapSuppression was false at the time, and changed to true before writeLogAndReset has been called?\n\nWouldn\u0027t it be more reliable to call this function from ContextualSearchPanelMetrics.writeRankerLoggerOutcomesAndReset where we actually record the outcomes? Or, would it be worth to log both of these events, since we still are in the dark about why the outcomes are not being logged?",
      "range": {
        "startLine": 189,
        "startChar": 36,
        "endLine": 189,
        "endChar": 63
      },
      "revId": "e638642b832fca2a62066e5eb842aee41478d4d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "417ff472_c09d5c5d",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/contextualsearch/ContextualSearchRankerLoggerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1107894
      },
      "writtenOn": "2018-01-17T19:26:41Z",
      "side": 1,
      "message": "Eclipse tells me that destroy is never being called on this class, so I think the only flow through the code right now is from ContextualSearchPanelMetrics.writeRankerLoggerOutcomesAndReset.  Added a TODO to call destroy, but that will only happen when the CSManager is destroyed since they share the same lifetime, which is quite long.  \n\nI\u0027d like to keep the histogram writing here since addressing the TODO will give us multiple paths here.\n\nNow that we assert mHasInferenceOccurred and since we check that there are features to log, I think that this will only be executed when there are actual outcomes to be logged.  That assumes that when the asserts fire we\u0027ll see that, which I\u0027m not completely convinced of (debug builds only, but some do run on the waterfall).\n\nI think adding more uma-logging is a good idea.  We already write to UMA in ContextualSearchPanelMetrics.writeRankerLoggerOutcomesAndReset (where we call ContextualSearchUma.logRankerInference).  But I\u0027ll add some log statements in the predictor so we can rule out issues between this Java code and the UKM writing.",
      "parentUuid": "32ed6063_428996ff",
      "range": {
        "startLine": 189,
        "startChar": 36,
        "endLine": 189,
        "endChar": 63
      },
      "revId": "e638642b832fca2a62066e5eb842aee41478d4d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "387000fe_c7a1b386",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/contextualsearch/ContextualSearchRankerLoggerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1212246
      },
      "writtenOn": "2018-01-17T21:35:24Z",
      "side": 1,
      "message": "Ok, if you are confident this is never called.\n\nIf we want to confirm this, we could add a histogram here, but it seems overkill, given the extra histograms you just added.",
      "parentUuid": "417ff472_c09d5c5d",
      "range": {
        "startLine": 189,
        "startChar": 36,
        "endLine": 189,
        "endChar": 63
      },
      "revId": "e638642b832fca2a62066e5eb842aee41478d4d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d1244da6_d7c5476a",
        "filename": "components/assist_ranker/predictor_config_definitions.cc",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1107894
      },
      "writtenOn": "2018-01-17T04:43:32Z",
      "side": 1,
      "message": "Philippe, I noticed that contextual_search_ranker_logger_impl.cc is still writing these, but they are not in the whitelist.  Maybe CS doesn\u0027t need to write them?",
      "range": {
        "startLine": 47,
        "startChar": 31,
        "endLine": 47,
        "endChar": 32
      },
      "revId": "e638642b832fca2a62066e5eb842aee41478d4d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "887d4773_8c4454b0",
        "filename": "components/assist_ranker/predictor_config_definitions.cc",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1212246
      },
      "writtenOn": "2018-01-17T17:11:30Z",
      "side": 1,
      "message": "We do want to log these. Thanks for adding them.\nYou should also add them to tools/metrics/ukm/ukm.xml. Otherwise, features that are not in ukm.xml will not show up in readable ukm logs. I used that file to build the whitelist, and we should keep them in sync . Could you please add a comment that mentions this. \nEventually, we should be able to use directly the ukm API, and rely only on ukm.xml. But a few pieces are still missing on the ukm side to allow this.",
      "parentUuid": "d1244da6_d7c5476a",
      "range": {
        "startLine": 47,
        "startChar": 31,
        "endLine": 47,
        "endChar": 32
      },
      "revId": "e638642b832fca2a62066e5eb842aee41478d4d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e8f87520_9572eb36",
        "filename": "components/assist_ranker/predictor_config_definitions.cc",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1107894
      },
      "writtenOn": "2018-01-17T19:26:41Z",
      "side": 1,
      "message": "Sorry that I keep forgetting to update ukm.xml.  I think I\u0027ve got it now!",
      "parentUuid": "887d4773_8c4454b0",
      "range": {
        "startLine": 47,
        "startChar": 31,
        "endLine": 47,
        "endChar": 32
      },
      "revId": "e638642b832fca2a62066e5eb842aee41478d4d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}