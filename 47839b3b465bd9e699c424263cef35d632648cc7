{
  "comments": [
    {
      "key": {
        "uuid": "c4143a69_957f7289",
        "filename": "chrome/browser/resources/settings/site_settings/site_details_permission.js",
        "patchSetId": 6
      },
      "lineNbr": 140,
      "author": {
        "id": 1136204
      },
      "writtenOn": "2017-12-15T22:08:46Z",
      "side": 1,
      "message": "Consider making a new function that works with hasPermissionInfoString_() and permissionInfoString_(). I\u0027ll call it permissionInfoStringIndex_ but feel free to call it something else.\n\npermissionInfoStringIndex_(source, category, setting) will have most of the guts of permissionInfoString_(), but it will not take any of the i18n values as args and it will return a {number}. The number will be which i18n string to use, N for the this.i18nAdvanced() value, or -1 (or null if you prefer) to signal that no string applies.\n\nLine 134 would turn into something like:\nreturn this.permissionInfoStringIndex_(source, category, setting) \u003e\u003d 0;\n\nThe permissionInfoString_() function would get much smaller, it would call permissionInfoStringIndex_() to get the index for the string to use and return that string (or make the his.i18nAdvanced() call) or return \u0027\u0027 if the index is invalid.\n\n(It may also help to pass in the i18n strings as an array in one parameter than separate parameters for each string, but that\u0027s entirely optional).\n\nThere are other ways to arrange this code. The above is just an idea, feel free to suggest something else.",
      "revId": "47839b3b465bd9e699c424263cef35d632648cc7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c96d81a9_ec9314ce",
        "filename": "chrome/browser/resources/settings/site_settings/site_details_permission.js",
        "patchSetId": 6
      },
      "lineNbr": 140,
      "author": {
        "id": 1160861
      },
      "writtenOn": "2017-12-18T06:21:41Z",
      "side": 1,
      "message": "I\u0027m not sure what you mean by converting the i18nAdvanced string ids into numbers - do you mean adding an array of the string ids and returning the indexes of that array in permissionInfoStringIndex_()? This sounds like it no longer uses the automatic translation in the HTML via i18nPolymer(), so if we\u0027re trying to reduce the number of parameters passed in here, it might be simpler to just to do all the translations via i18nAdvanced() in the JS.\n\nI\u0027ve gone ahead and done that in the next patchset, but let me know if I\u0027ve misunderstood something or you still think it\u0027s worth having the translations pre-done in the HTML.",
      "parentUuid": "c4143a69_957f7289",
      "revId": "47839b3b465bd9e699c424263cef35d632648cc7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3e1b2dc_1702bc4e",
        "filename": "chrome/browser/resources/settings/site_settings/site_details_permission.js",
        "patchSetId": 6
      },
      "lineNbr": 140,
      "author": {
        "id": 1136204
      },
      "writtenOn": "2017-12-18T22:12:39Z",
      "side": 1,
      "message": "Sorry about that. I meant something more like this (This is an untested mock up):\n\n  inner-h-t-m-l\u003d\"[[permissionInfoString_(\n                site.source,\n                category,\n                site.setting,\n                [\u0027$i18nPolymer{siteSettingsSourceAdsBlacklist}\u0027,\n                    \u0027$i18nPolymer{siteSettingsAdsBlockSingular}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourceEmbargo}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourceInsecureOrigin}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourceKillSwitch}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourceExtensionAllow}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourceExtensionBlock}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourceExtensionAsk}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourcePolicyAllow}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourcePolicyBlock}\u0027,\n                    \u0027$i18nPolymer{siteSettingsSourcePolicyAsk}\u0027])]]\"\u003e\n\n\n  hasPermissionInfoString_: function(source, category, setting) {\n    return permissionInfoStringIndex_(source, category, setting) \u003e\u003d 0;\n  }\n  \n  permissionInfoString_: function(\n      source, category, setting, uiStrings) {\n    let index  \u003d permissionInfoStringIndex_(source, category, setting);\n    if (index \u003c 0)\n      return \u0027\u0027;\n    if (index \u003c uiStrings.length)\n      return uiStrings[index];\n    return this.i18nAdvanced(\u0027siteSettingsSourceDrmDisabled\u0027, {\n        substitutions:\n            [settings.routes.SITE_SETTINGS_PROTECTED_CONTENT.getAbsolutePath()];\n  }\n  \n  permissionInfoStringIndex_: function(\n      source, category, setting) {\n    if (source \u003d\u003d settings.SiteSettingSource.ADS_FILTER_BLACKLIST) {\n      assert(\n          settings.ContentSettingsTypes.ADS \u003d\u003d category,\n          \u0027The ads filter blacklist only applies to Ads.\u0027);\n      return INDEX_ADS_BLACK_LIST_STRING;\n    } else if (\n        category \u003d\u003d settings.ContentSettingsTypes.ADS \u0026\u0026\n        setting \u003d\u003d settings.ContentSetting.BLOCK) {\n      return INDEX_ADS_BLOCKING_STRING;\n    } else if (source \u003d\u003d settings.SiteSettingSource.DRM_DISABLED) {\n      assert(\n          settings.ContentSetting.BLOCK \u003d\u003d setting,\n          \u0027If DRM is disabled, Protected Content must be blocked.\u0027);\n      assert(\n          settings.ContentSettingsTypes.PROTECTED_CONTENT \u003d\u003d category,\n          \u0027The DRM disabled source only applies to Protected Content.\u0027);\n      return INDEX_DRM_DISABLED;\n      });\n    } else if (source \u003d\u003d settings.SiteSettingSource.EMBARGO) {\n      assert(\n          settings.ContentSetting.BLOCK \u003d\u003d setting,\n          \u0027Embargo is only used to block permissions.\u0027);\n      return INDEX_EMBARGO_STRING;\n    } else if (source \u003d\u003d settings.SiteSettingSource.EXTENSION) {\n      return extensionStrings[setting];\n    } else if (source \u003d\u003d settings.SiteSettingSource.INSECURE_ORIGIN) {\n      assert(\n          settings.ContentSetting.BLOCK \u003d\u003d setting,\n          \u0027Permissions can only be blocked due to insecure origins.\u0027);\n      return INDEX_INSECURE_ORIGIN_STRING;\n    } else if (source \u003d\u003d settings.SiteSettingSource.KILL_SWITCH) {\n      assert(\n          settings.ContentSetting.BLOCK \u003d\u003d setting,\n          \u0027The permissions kill switch can only be used to block permissions.\u0027);\n      return INDEX_KILL_SWITCH;\n    } else if (source \u003d\u003d settings.SiteSettingSource.POLICY) {\n      return policyStrings[setting];\n    } else if (\n        source \u003d\u003d settings.SiteSettingSource.DEFAULT ||\n        source \u003d\u003d settings.SiteSettingSource.PREFERENCE) {\n      return -1;  /* Invalid index. */\n    }\n    assertNotReached(`No string for ${category} setting source \u0027${source}\u0027`);\n  },\n\nOr if you\u0027d like to do something different, here are some goals:\n- please keep the string setup in the HTML (as much as possible).\n- try not to have an internal function (like hasPermissionInfoString_ use the output of a front facing function (like permissionInfoString_). The reason is that this does unnecessary work at runtime (possibly building the siteSettingsSourceDrmDisabled string for example; and  creating/destroying string objects unnecessarily; or potentially passes unnecessary parameters).",
      "parentUuid": "c96d81a9_ec9314ce",
      "revId": "47839b3b465bd9e699c424263cef35d632648cc7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}