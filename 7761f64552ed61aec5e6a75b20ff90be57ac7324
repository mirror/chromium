{
  "comments": [
    {
      "key": {
        "uuid": "927b388a_b2456c5c",
        "filename": "third_party/WebKit/Source/core/workers/WorkletGlobalScope.cpp",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-11-06T08:04:52Z",
      "side": 1,
      "message": "This referrer policy value\u0027s not really used anywhere for now then?",
      "revId": "7761f64552ed61aec5e6a75b20ff90be57ac7324",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe76e53a_ec40c40a",
        "filename": "third_party/WebKit/Source/core/workers/WorkletGlobalScope.cpp",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1115949
      },
      "writtenOn": "2017-11-06T13:02:21Z",
      "side": 1,
      "message": "I think the idea of this CL is that this is used via Modulator::GetReferrerPolicy?",
      "parentUuid": "927b388a_b2456c5c",
      "revId": "7761f64552ed61aec5e6a75b20ff90be57ac7324",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "726d7539_b7489e83",
        "filename": "third_party/WebKit/Source/core/workers/WorkletGlobalScope.cpp",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-11-06T13:56:38Z",
      "side": 1,
      "message": "Hmm... I assumed that the referrer policy has been taken on the Document side, and this referrer policy hasn\u0027t been used. However, as kouhei@ pointed out, this has been used via Modulator::GetReferrerPolicy on the Worklet side and it has been passed to the Document side as FetchParameters. In the case, I\u0027m not sure why the tests could pass before this change. I\u0027ll investigate the reason before landing this CL.",
      "parentUuid": "fe76e53a_ec40c40a",
      "revId": "7761f64552ed61aec5e6a75b20ff90be57ac7324",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "653357c7_1b26404d",
        "filename": "third_party/WebKit/Source/core/workers/WorkletGlobalScope.cpp",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-11-07T05:25:38Z",
      "side": 1,
      "message": "I might understand what happens. ModulatorImpl::GetReferrerPolicy() is never called for worklets in ModuleScriptLoader::Fetch() because ModuleScriptFetchRequest.GetReferrer() is null[1]. [2] says,\n\n  \"Referrer is set only for internal module script fetch algorithms triggered from ModuleTreeLinker to fetch descendant module scripts.\"\n\nTherefore, the default ReferrerPolicy is passed from the Worklet to the Document. The policy is eventually overridden maybe by FrameFetchContext::GetReferrerPolicy() in BaseFetchContext::AddAdditionalRequestHeaders()[3]. This is the owner Document\u0027s referrer policy, so the current impl can pass the tests.\n\n[1] https://chromium.googlesource.com/chromium/src/+/4c9259938599dbc41ba3d965876e35c59f483476/third_party/WebKit/Source/core/loader/modulescript/ModuleScriptLoader.cpp#137\n[2] https://chromium.googlesource.com/chromium/src/+/4c9259938599dbc41ba3d965876e35c59f483476/third_party/WebKit/Source/core/loader/modulescript/ModuleScriptFetchRequest.h#34\n[3] https://chromium.googlesource.com/chromium/src/+/46b158a614a705f542576bc4da4c9e45cca1e0e6/third_party/WebKit/Source/core/loader/BaseFetchContext.cpp#24",
      "parentUuid": "726d7539_b7489e83",
      "revId": "7761f64552ed61aec5e6a75b20ff90be57ac7324",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "35294f08_0e88578e",
        "filename": "third_party/WebKit/Source/core/workers/WorkletGlobalScope.cpp",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-11-08T02:27:51Z",
      "side": 1,
      "message": "Chatted with kouhei@.\n\n1) Overriding the referrer policy is correct for top-level module fetch.\n2) Modulator::GetReferrerPolicy() is called for non-top-level module fetch. \n\nThis CL is necessary for 2) non-top-level module fetch. Currently, we don\u0027t have tests for the referrer policy for non-top-level module fetch. I\u0027ll include the tests in this CL.",
      "parentUuid": "653357c7_1b26404d",
      "revId": "7761f64552ed61aec5e6a75b20ff90be57ac7324",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}