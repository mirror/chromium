{
  "comments": [
    {
      "key": {
        "uuid": "d38d1394_77fcd997",
        "filename": "chrome/browser/extensions/extension_service.cc",
        "patchSetId": 4
      },
      "lineNbr": 982,
      "author": {
        "id": 1115745
      },
      "writtenOn": "2017-09-21T15:14:50Z",
      "side": 1,
      "message": "We should decide what we want to be the go-to source for extension state modification - the service or the registrar.  Right now, if someone else were to call ExtensionRegistrar::DeactivateExtension(), the service would *not* do the extra cleanup work of PostDeactivateExtension().\n\nTwo ideas:\n1. Give ExtensionRegistrar a delegate** with methods for PostDeactivateExtension, etc.  Make ExtensionService implement that delegate.  Then any time the extension is deactivated, extension service is called.\n2. Make ExtensionService directly (and privately) own ExtensionRegistrar so no one else can call these methods (and have it similarly privately owned in appshell by another object).\n\n(These aren\u0027t mutually exclusive).\n\nI think we should at least do 1, even long-term.  For 2, I think it would be helpful during this migration, so that everyone still calls into ExtensionService (which has special logic).  Once we move more of the logic to ExtensionRegistrar, we could change that so that objects could call ExtensionRegistrar instead of ExtensionService.\n\n**Why a delegate instead of an observer?  The delegate would be responsible for doing actions directly necessary to complete the deactivation (or other operation), rather than reacting to it.  These would need to be done first (before observers are notified), and there should likely only be one implementation per embedder.",
      "revId": "27fb4d2fda18f5c5571c8988503d6f11355b2e28",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9543f229_262e63d2",
        "filename": "chrome/browser/extensions/extension_service.cc",
        "patchSetId": 4
      },
      "lineNbr": 982,
      "author": {
        "id": 1003321
      },
      "writtenOn": "2017-09-21T23:26:36Z",
      "side": 1,
      "message": "Yes, I have an ExtensionRegistrar::Delegate in a follow-up CL I\u0027ll upload. It does (1) to allow an ExtensionService spin-off implement the Post* actions whenever the * happens.\n\nI did look into observing ExtensionRegistrar, and I think we actually could move in that direction, but there are subtle timing issues we would have to investigate first and verify existing behavior doesn\u0027t depend on. So I agree here that there should be a single embedder-provided delegate that runs the relevant code at the same time ExtensionService runs it today -- it\u0027d really suck to introduce different behavior during this move.",
      "parentUuid": "d38d1394_77fcd997",
      "revId": "27fb4d2fda18f5c5571c8988503d6f11355b2e28",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a1eac36_34d4b216",
        "filename": "chrome/browser/extensions/extension_service.cc",
        "patchSetId": 4
      },
      "lineNbr": 982,
      "author": {
        "id": 1003321
      },
      "writtenOn": "2017-09-26T08:01:09Z",
      "side": 1,
      "message": "Added TODOs to introduce a delegate for this, which the next CL does. Leaving out the delegate keeps this CL smaller.",
      "parentUuid": "9543f229_262e63d2",
      "revId": "27fb4d2fda18f5c5571c8988503d6f11355b2e28",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "37fad276_c22f0304",
        "filename": "chrome/browser/extensions/extension_service.cc",
        "patchSetId": 4
      },
      "lineNbr": 1095,
      "author": {
        "id": 1115745
      },
      "writtenOn": "2017-09-21T15:14:50Z",
      "side": 1,
      "message": "NotifyExtensionLoaded seems like a weird place to ActivateExtension().  It seems like this should happen as part of the loading process, rather than as part of the notification process.",
      "revId": "27fb4d2fda18f5c5571c8988503d6f11355b2e28",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cdc83a28_ee721ec9",
        "filename": "chrome/browser/extensions/extension_service.cc",
        "patchSetId": 4
      },
      "lineNbr": 1095,
      "author": {
        "id": 1003321
      },
      "writtenOn": "2017-09-21T23:26:36Z",
      "side": 1,
      "message": "NotifyExtensionLoaded has always been a crappy name IMO. What it does today is notify about the fact that the extension has been *enabled* and finish setting up dependencies to use the now-enabled extension. (As further evidence that \"Load\" is not being used consistently here, NotifyExtensionLoaded doesn\u0027t even run when an extension is successfully loaded but not enabled.) But you had comments on my previous patch splitting the non-notifying stuff out so I kept the name here...",
      "parentUuid": "37fad276_c22f0304",
      "revId": "27fb4d2fda18f5c5571c8988503d6f11355b2e28",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3279adc1_ae46edc3",
        "filename": "chrome/browser/extensions/extension_service.cc",
        "patchSetId": 4
      },
      "lineNbr": 1095,
      "author": {
        "id": 1003321
      },
      "writtenOn": "2017-09-26T08:01:09Z",
      "side": 1,
      "message": "I\u0027ve renamed ExtensionRegistrar\u0027s ActivateExtension function to EnableExtension, and moved this call out to the call sites, so NotifyExtensionLoaded() now just does the stuff below this line.",
      "parentUuid": "cdc83a28_ee721ec9",
      "revId": "27fb4d2fda18f5c5571c8988503d6f11355b2e28",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}