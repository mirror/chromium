{
  "comments": [
    {
      "key": {
        "uuid": "97d2b898_0c6655db",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 1116023
      },
      "writtenOn": "2017-07-21T17:28:24Z",
      "side": 1,
      "message": "Do we still need this logic? As far as I can tell ResolutionChooser will always return even dimensions for even input size?\n\nAlso note that with this change the frame will be cropped even if it\u0027s downscaled, which is not ideal.",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 282,
        "endChar": 57
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92721e2c_7b440f95",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 1126869
      },
      "writtenOn": "2017-07-21T18:18:58Z",
      "side": 1,
      "message": "Consider the below comment, I think it\u0027s good not to do align here. But we need to fix the 1x1 frame issue on OSX first. (check below responses)\n\nI don\u0027t quite understand the comments \"with this change the frame will be cropped even if it\u0027s downscaled, which is not ideal.\". Could you please help to elaborate a bit? Thanks.",
      "parentUuid": "97d2b898_0c6655db",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 282,
        "endChar": 57
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36210538_7381d410",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 1196069
      },
      "writtenOn": "2017-07-21T18:38:47Z",
      "side": 1,
      "message": "I think what Sergey means is: for example, the frame size is 15 x 15, the target size (from resolution_chooser_) is 8 x 8, we will first crop the size to 14 x 14, then scale to 8 x 8. The first cropping is not necessary. So we should cropping or scaling, but not both.",
      "parentUuid": "92721e2c_7b440f95",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 282,
        "endChar": 57
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c4132c9_6d0827fd",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 1126869
      },
      "writtenOn": "2017-07-21T18:42:59Z",
      "side": 1,
      "message": "But it seems scaling from 15x15 to 8x8 will cause the blurring. We should always keep the frame with even dimensions. \nThere a lot of codes added to ensure that in chromium, see my other responses.\nSo it should be good to keep the source with even dimensions as possible.",
      "parentUuid": "36210538_7381d410",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 282,
        "endChar": 57
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "024b8da4_cda98596",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-22T01:23:22Z",
      "side": 1,
      "message": "Yes, it sounds like the \"blurry\" result was being caused by the downscaling from an odd-numbered original size towards an even-numbered output capture resolution. FWIW, this is a known issue in bi-linear downscaling. I assume other scaling algorithms aren\u0027t available?",
      "parentUuid": "6c4132c9_6d0827fd",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 282,
        "endChar": 57
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b724b48_94f980bf",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 1126869
      },
      "writtenOn": "2017-07-24T17:05:16Z",
      "side": 1,
      "message": "It seems that we still need this for Linux. Some unittests on Linux will fail if I remove this logic. See failed tests on Linux bots of PS#2.\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n../../content/browser/media/capture/desktop_capture_device_unittest.cc:240: Failure\n      Expected: size_for_even_frames_\n      Which is: 888x500\nTo be equal to: format.frame_size\n      Which is: 889x500",
      "parentUuid": "6c4132c9_6d0827fd",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 282,
        "endChar": 57
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5bc08f31_cbfa1b09",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 290,
      "author": {
        "id": 1116023
      },
      "writtenOn": "2017-07-21T17:28:24Z",
      "side": 1,
      "message": "1x1 frame will be cropped to 0x0 and then dropped in line 283. I don\u0027t think this is the right behavior here.",
      "range": {
        "startLine": 289,
        "startChar": 0,
        "endLine": 290,
        "endChar": 56
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e84f0d15_e34088c0",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 290,
      "author": {
        "id": 1126869
      },
      "writtenOn": "2017-07-21T18:18:58Z",
      "side": 1,
      "message": "It seems that this line will not run in current chrome at all. Line282 will get a 0x0 output size for a 1x1 input and Line283 will be hit. \nIf I don\u0027t align to even at line281/282 and make output_size as 1x1, then frame will still become 0x0 somewhere later and cause CHECK failure in VideoCaptureDeviceClient.\n\nSo this process never works. Actually there is issue report on OSX that window capture will get a frame in-mid of minimizing animation, not a previous frame or black frame.\n\nI\u0027ll have a look and talk with you in email.",
      "parentUuid": "5bc08f31_cbfa1b09",
      "range": {
        "startLine": 289,
        "startChar": 0,
        "endLine": 290,
        "endChar": 56
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6e56fd0_c06fe54a",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 290,
      "author": {
        "id": 1116023
      },
      "writtenOn": "2017-07-21T18:32:00Z",
      "side": 1,
      "message": "Line 282 copies the size to output_size, while here we look at the original frame-\u003esize().",
      "parentUuid": "e84f0d15_e34088c0",
      "range": {
        "startLine": 289,
        "startChar": 0,
        "endLine": 290,
        "endChar": 56
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bbf1a2a1_1ef5622c",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 290,
      "author": {
        "id": 1126869
      },
      "writtenOn": "2017-07-21T18:42:59Z",
      "side": 1,
      "message": "But line283 will be satisfied first, and there is no chance we can run to here for 1x1 frame.\n\nAlso I found there is more align 2x2 process along the code path. For example https://cs.chromium.org/chromium/src/media/capture/video/video_capture_device_client.cc?sq\u003dpackage:chromium\u0026l\u003d169. \nSo there is no chance that a 1x1 frame can survive to rendering/encoding.\nMaybe we can make the black frame to 2x2?",
      "parentUuid": "e6e56fd0_c06fe54a",
      "range": {
        "startLine": 289,
        "startChar": 0,
        "endLine": 290,
        "endChar": 56
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ccdc8cd_dfe8550f",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 303,
      "author": {
        "id": 1196069
      },
      "writtenOn": "2017-07-21T18:05:39Z",
      "side": 1,
      "message": "Putting the new cropping logic here would be a better choice to fix both issues Sergey mentioned.",
      "range": {
        "startLine": 302,
        "startChar": 0,
        "endLine": 303,
        "endChar": 29
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85626e6f_b2995b5c",
        "filename": "content/browser/media/capture/desktop_capture_device.cc",
        "patchSetId": 1
      },
      "lineNbr": 303,
      "author": {
        "id": 1126869
      },
      "writtenOn": "2017-07-21T18:18:58Z",
      "side": 1,
      "message": "perhaps. Actually I did it here in the very beginning. Then some other codes are needed to avoid scaling if size matches. \nI\u0027ll try again after the 1x1 frame issue is cleared.",
      "parentUuid": "5ccdc8cd_dfe8550f",
      "range": {
        "startLine": 302,
        "startChar": 0,
        "endLine": 303,
        "endChar": 29
      },
      "revId": "a0884fc33adc2071e255250fa6599e13eec4f45d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}