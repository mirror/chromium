{
  "comments": [
    {
      "key": {
        "uuid": "ff1620ad_9f9e1f0b",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 582,
      "author": {
        "id": 1128909
      },
      "writtenOn": "2017-08-14T20:15:48Z",
      "side": 1,
      "message": "High level comment: I think that I like the architecture of having StopTracing return a vector of BattOrSamples and allowing the user to provide how they want to use those BattOr samples. Given that power_tracing_agent.cc and the non-interactive battor_agent_bin will want to print them in the standard format, but we want to provide a means to print a summary format, it probably makes sense to expose a BattOrAgent static method:\n\npublic std::string BattOrAgent::SamplesToString();\n\nto provide for this common output format.",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6207a94a_02bf58ac",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 582,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2017-08-27T23:51:00Z",
      "side": 1,
      "message": "\u003e having StopTracing return a vector of BattOrSamples\n\nThat doesn\u0027t seem to fit the current design. I could see calling Listener::OnStopTracingComplete with a vector of samples, which can then be converted to a detailed or summary string. Is that what you meant?",
      "parentUuid": "ff1620ad_9f9e1f0b",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7e74d4d_a40c6af8",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 582,
      "author": {
        "id": 1128909
      },
      "writtenOn": "2017-08-28T13:17:37Z",
      "side": 1,
      "message": "Yep! (as in BattOrSamples, not RawBattOrSamples)",
      "parentUuid": "6207a94a_02bf58ac",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ae7e798d_af3db929",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 582,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2017-09-01T21:11:27Z",
      "side": 1,
      "message": "I started looking at this and realized that it works poorly. The current SamplesToString function takes as input the BattOrSample results extracted from *battor_eeprom and calibration_frame_, and it also takes as input BattOrSampleConverter::MinSample() and BattOrSampleConverter::MaxSample(), battor_eeprom_-\u003esd_sample_rate, battor_eeprom_-\u003elow_gain, calibration_frame_, and clock_sync_marker_.\n\nSo, if we give the user a std::vector\u003cBattOrSample\u003e then they don\u0027t have enough information to print the detailed report that we use.\n\nSo...\n\nI could call OnStopTracingComplete with an object that contains all of the information needed to create a report - all of the items listed above. I think that this option breaks encapsulation too much by forcing us to create what is almost a copy of the BattOrAgent object.\n\nOr I could split up SamplesToString() into SamplesToDetailed() and SamplesToSummary() (to clean up the code) and then package both results into BattOrResults which is then passed to OnStopTracingComplete.\n\nOr, BattOrResults could include the detailed summary and the std::vector\u003cBattOrSample\u003e and samples per second. That would give clients enough information to generate a power summary, without breaking encapsulation as much.",
      "parentUuid": "b7e74d4d_a40c6af8",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4b2101a_6d7d4454",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 588,
      "author": {
        "id": 1128909
      },
      "writtenOn": "2017-08-14T20:15:48Z",
      "side": 1,
      "message": "I think that the more correct way to do this would be to pull the sample rate from the EEPROM (battor_eeprom_.sd_sample_rate): https://cs.chromium.org/chromium/src/tools/battor_agent/battor_protocol_types.h?l\u003d115\n\nThe sampling rate on the BattOr is technically configurable. This way, if the sampling rate on the BattOr were ever to become higher, then this math would remain correct.",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "889a2dc4_db444c1b",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 588,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2017-08-27T23:51:00Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "e4b2101a_6d7d4454",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e3b7691d_4c557834",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 613,
      "author": {
        "id": 1128909
      },
      "writtenOn": "2017-08-14T20:15:48Z",
      "side": 1,
      "message": "I think this logic should live in the BattOrSampleConverter so that you can just pull out sample.power_mW",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17006d83_8212d53f",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 613,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2017-08-27T23:51:00Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "e3b7691d_4c557834",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fedca82e_9bf9494e",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 620,
      "author": {
        "id": 1128909
      },
      "writtenOn": "2017-08-14T20:15:48Z",
      "side": 1,
      "message": "supernit (here and elsewhere in comments): SI units aren\u0027t proper nouns, even if they\u0027re someone\u0027s name (so \"watts\", not \"Watts\")",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "643b5690_c8a2b37c",
        "filename": "tools/battor_agent/battor_agent.cc",
        "patchSetId": 4
      },
      "lineNbr": 620,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2017-08-27T23:51:00Z",
      "side": 1,
      "message": "Ack - I think I was extrapolating from \u0027W\u0027 (which is capitalized) to \u0027Watts\u0027 which isn\u0027t.",
      "parentUuid": "fedca82e_9bf9494e",
      "revId": "495f5e59f6d3cb11a83f3ee39974f968f2cfa48a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}