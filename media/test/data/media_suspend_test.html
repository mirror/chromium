<!DOCTYPE html>
<title>Test harness for suspend/resume browser tests.</title>
<video></video>
<script>
var QueryString = function() {
  // Allows access to query parameters on the URL; e.g., given a URL like:
  //    http://<server>/my.html?test=123&bob=123
  // Parameters can then be accessed via QueryString.test or QueryString.bob.
  var params = {};
  // RegEx to split out values by &.
  var r = /([^&=]+)=?([^&]*)/g;
  // Lambda function for decoding extracted match values. Replaces '+' with
  // space so decodeURIComponent functions properly.
  function d(s) { return decodeURIComponent(s.replace(/\+/g, ' ')); }
  var match;
  while (match = r.exec(window.location.search.substring(1)))
    params[d(match[1])] = d(match[2]);
  return params;
}();

function endTest() {
  console.log('Test completed.');
  document.title = 'ENDED';
}

function startPlayback() {
  console.log('Starting playback...');
  video.play();
}

var video = document.querySelector('video');

video.addEventListener(QueryString.event, function(e) {
  console.log('Element loading complete; waited for ' + QueryString.event);
  document.title = 'LOADED';
}, false);

video.addEventListener("timeupdate", function(e) {
  if (video.currentTime > 0)
    endTest();
}, false);

video.addEventListener("ended", function(e) {
  endTest();
}, false);

// TODO(dalecurtis): Expand this to include MSE.
video.src = 'bear.webm'

</script>
