{
  "comments": [
    {
      "key": {
        "uuid": "c4ff8f4a_a3fb4760",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 5335,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-10-18T23:38:23Z",
      "side": 1,
      "message": "Maybe this should always be false in the case of OnFailedNavigation?  I can\u0027t think of why we would want to do the debug URL actions in the failed case.\n\n(I\u0027m wondering if this is just a matter of reusing too much code between the success and failed cases.)",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64723807_45f0a80a",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 5335,
      "author": {
        "id": 1144419
      },
      "writtenOn": "2017-10-19T14:31:34Z",
      "side": 1,
      "message": "The chrome:// links processed by MaybeHandleDebugURL can come from this path. E.g., chrome://hang when not blocked falls in this function with error_code\u003d-300 (I think that\u0027s ERR_INVALID_URL). I\u0027m actually not sure if any of the URLs processed by MaybeHandleDebugURL can come there through success flow (from NavigateInternal).",
      "parentUuid": "c4ff8f4a_a3fb4760",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a16e65d_e25b888b",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 5335,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-10-19T20:25:17Z",
      "side": 1,
      "message": "Nice!  I think you\u0027ve just found a bug.  :)\n\nWithout PlzNavigate (using --disable-browser-side-navigation), debug URLs go through NavigateInternal.  The browser process special cases them and sends them straight to the renderer.\n\nWith PlzNavigate, you\u0027re right-- we appear to be sending the debug URL to the network stack, failing, telling the renderer that we failed, and then running the debug URL\u0027s action via OnFailedNavigation.  That\u0027s definitely not what we should be doing.\n\nLet\u0027s fix that, and then we can proceed with the discussion below.  I\u0027ve filed https://crbug.com/776528 to track it.",
      "parentUuid": "64723807_45f0a80a",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "673944ff_167078f7",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6450,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-10-18T23:38:23Z",
      "side": 1,
      "message": "nit: should_handle_debug_url",
      "range": {
        "startLine": 6450,
        "startChar": 15,
        "endLine": 6450,
        "endChar": 31
      },
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4baf9e35_6415ec14",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6450,
      "author": {
        "id": 1144419
      },
      "writtenOn": "2017-10-19T14:31:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "673944ff_167078f7",
      "range": {
        "startLine": 6450,
        "startChar": 15,
        "endLine": 6450,
        "endChar": 31
      },
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ffc3018f_d80f1360",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6455,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-10-18T23:38:23Z",
      "side": 1,
      "message": "Hmm, I\u0027m concerned about continuing when the parameter is false.  We don\u0027t expect to get a committed URL of chrome://kill, for example, even if it\u0027s just for error pages.\n\nMaybe we should move where MaybeHandleDebugURL is called instead?  That might (1) let us avoid calling it from the OnFailedNavigation case without a bool parameter, and (2) let us more sanely handle the case that the process doesn\u0027t crash and the URL gets committed.",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9efddbe3_8382a8c1",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6455,
      "author": {
        "id": 1115881
      },
      "writtenOn": "2017-10-19T13:20:29Z",
      "side": 1,
      "message": "Since this is the first thing we do in PrepareRenderViewForNavigation, we could call it from NavigateInternal or OnFailedNavigation directly.",
      "parentUuid": "ffc3018f_d80f1360",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "35628f35_4df129bc",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6455,
      "author": {
        "id": 1144419
      },
      "writtenOn": "2017-10-19T14:31:34Z",
      "side": 1,
      "message": "IIUC, currently it is called from both functions (NavigateInternal and OnFailedNavigation). Do you suggest duplicating the call from both functions?",
      "parentUuid": "9efddbe3_8382a8c1",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "697ad5e9_4419bcc0",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6455,
      "author": {
        "id": 1144419
      },
      "writtenOn": "2017-10-19T14:31:34Z",
      "side": 1,
      "message": "This is the flow that follows any other URL that is blocked currently. They just aren\u0027t affected by MaybeHandleDebugURL. I don\u0027t know details in this part, but do you think that the URLs like chrome://kill should be treated differently when blocked?",
      "parentUuid": "ffc3018f_d80f1360",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b5a0752_505d7095",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6455,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-10-19T20:25:17Z",
      "side": 1,
      "message": "My point was that I don\u0027t think we should be calling MaybeHandleDebugURL from OnFailedNavigation at all.  (Once we fix the bug mentioned above, anyway.)  If the navigation is marked as failed, we don\u0027t want to go through with the debug action, right?  So maybe we can just move the call to NavigateInternal.\n\nFor the second part of my question, what happens in the case that it\u0027s blocked?  What do we end up showing to the user?\n\nI just checked on chrome://shorthang, and when that works \"successfully,\" we end up committing an error page that shows chrome://shorthang in the omnibox.  location.href is chrome-error://chromewebdata and document.origin is null.  It also stays in process, similar to other blocked navigations.\n\nIs that what happens when chrome://kill is blocked?  Maybe that\u0027s ok.",
      "parentUuid": "697ad5e9_4419bcc0",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eff4732a_46bb25dd",
        "filename": "content/renderer/render_frame_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 6455,
      "author": {
        "id": 1144419
      },
      "writtenOn": "2017-10-20T08:26:55Z",
      "side": 1,
      "message": "I agree, if the special pages will go through NavigateInternal, while OnFailedNavigation will never call MaybeHandleDebugURL then we should be fine.\n\nIn current implementation, when chrome://kill is blocked, it runs MaybeHandleDebugURL and kills the page. That is the problem I\u0027m trying to fix with this CL.\n\nI guess if we have a fix for 776528, we shouldn\u0027t need an additional CL like this anymore.",
      "parentUuid": "7b5a0752_505d7095",
      "revId": "9d5b68c312fab6a15e12e612728316c6f162cc80",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}