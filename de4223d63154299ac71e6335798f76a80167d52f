{
  "comments": [
    {
      "key": {
        "uuid": "03318080_fe6c887c",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 533,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-10-18T20:48:48Z",
      "side": 1,
      "message": "Something in this code is causing a check to fail for me:\n\n[15184:28163:1018/133932.577090:378230052070365:FATAL:paint_op_buffer.cc(190)] Check failed: op-\u003eIsValid(). \n0  base::debug::StackTrace::StackTrace(unsigned long) + 174\n1  base::debug::StackTrace::StackTrace(unsigned long) + 29\n2  base::debug::StackTrace::StackTrace() + 28\n3  logging::LogMessage::~LogMessage() + 479\n4  logging::LogMessage::~LogMessage() + 21\n5  cc::Rasterizer\u003ccc::DrawRectOp, true\u003e::Raster(cc::DrawRectOp const*, SkCanvas*, cc::PlaybackParams const\u0026) + 203\n6  _ZNK2cc4$_14clEPKNS_7PaintOpEP8SkCanvasRKNS_14PlaybackParamsE + 44\n7  _ZN2cc4$_148__invokeEPKNS_7PaintOpEP8SkCanvasRKNS_14PlaybackParamsE + 40\n\nCommenting out EnforceDotsAtEndpoints fixes the bug but I didn\u0027t look further.",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a716e4a7_83fb0968",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 533,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-18T21:01:06Z",
      "side": 1,
      "message": "I\u0027ll run debug tests.",
      "parentUuid": "03318080_fe6c887c",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf2ca8d7_cc774a27",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 533,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-19T19:36:16Z",
      "side": 1,
      "message": "This is probably due to not initializing the rects. I could not repro.",
      "parentUuid": "a716e4a7_83fb0968",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "480496b2_d8bacd35",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 548,
      "author": {
        "id": 1003156
      },
      "writtenOn": "2017-10-19T14:34:06Z",
      "side": 1,
      "message": "You need to initialize these explicitly (SkRect::MakeEmpty()).",
      "range": {
        "startLine": 547,
        "startChar": 0,
        "endLine": 548,
        "endChar": 70
      },
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19b8413b_3f58f413",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 548,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-19T19:36:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "480496b2_d8bacd35",
      "range": {
        "startLine": 547,
        "startChar": 0,
        "endLine": 548,
        "endChar": 70
      },
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ca1b4279_ded5bb92",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 553,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-10-18T20:48:48Z",
      "side": 1,
      "message": "I wanted to check this in a local build but wasn\u0027t able to, so asking instead: can you add logging and confirm that each of these codepaths hit in the new testcase?",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9800bb8_a92b9732",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 553,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-18T21:01:06Z",
      "side": 1,
      "message": "Sure, but given the bugs I found I\u0027m pretty sure they are all hit.",
      "parentUuid": "ca1b4279_ded5bb92",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "60c02acb_3a3ed2fd",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 553,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-19T19:36:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c9800bb8_a92b9732",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b7cc46e1_05ae2844",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 559,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-10-18T20:48:48Z",
      "side": 1,
      "message": "These used to be else-ifs but are now ifs (except the last one). Can the conditionals be written to only set p1 or p2 once?",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e0b55f93_9aa4d884",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 559,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-18T21:01:06Z",
      "side": 1,
      "message": "They can\u0027t be else-if because each block only changes one dash or dot and some edges need to change more than one thing. Some of the clauses in the conditionals are repeated and need to fire more than once.\n\nIt is the case that any code path through only touches p1, p2 start_dot or end_dot at most once. I know this because it breaks if that is not the case.\n\nThe last one is still if/else because it can be (the if conditions have no duplicate clauses).",
      "parentUuid": "b7cc46e1_05ae2844",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36432464_28942c06",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 559,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-19T19:36:16Z",
      "side": 1,
      "message": "Log output from the new thin lines test. Every branch case gets hit at least once and in any given line we only ever set p1/start and p2/end once.\n\n[1:1:1019/140421.349267:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.349613:INFO:GraphicsContext.cpp(561)] Case 1 set p1\n[1:1:1019/140421.349837:INFO:GraphicsContext.cpp(562)] Case 1 set start_dot\n[1:1:1019/140421.352629:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.352754:INFO:GraphicsContext.cpp(561)] Case 1 set p1\n[1:1:1019/140421.352868:INFO:GraphicsContext.cpp(562)] Case 1 set start_dot\n[1:1:1019/140421.353006:INFO:GraphicsContext.cpp(603)] Case 6 set p2\n[1:1:1019/140421.353124:INFO:GraphicsContext.cpp(604)] Case 6 set end_dot\n[1:1:1019/140421.357521:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.357642:INFO:GraphicsContext.cpp(570)] Case 2 set p1\n[1:1:1019/140421.357750:INFO:GraphicsContext.cpp(571)] Case 2 set start_dot\n[1:1:1019/140421.359125:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.359266:INFO:GraphicsContext.cpp(587)] Case 4 set p1\n[1:1:1019/140421.359396:INFO:GraphicsContext.cpp(588)] Case 4 set start_dot\n[1:1:1019/140421.359525:INFO:GraphicsContext.cpp(596)] Case 5 set p2\n[1:1:1019/140421.359634:INFO:GraphicsContext.cpp(597)] Case 5 set end_dot\n[1:1:1019/140421.361613:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.361719:INFO:GraphicsContext.cpp(561)] Case 1 set p1\n[1:1:1019/140421.361815:INFO:GraphicsContext.cpp(562)] Case 1 set start_dot\n[1:1:1019/140421.363072:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.363173:INFO:GraphicsContext.cpp(570)] Case 2 set p1\n[1:1:1019/140421.363266:INFO:GraphicsContext.cpp(571)] Case 2 set start_dot\n[1:1:1019/140421.363420:INFO:GraphicsContext.cpp(578)] Case 3 set p2\n[1:1:1019/140421.363602:INFO:GraphicsContext.cpp(579)] Case 3 set end_dot\n[1:1:1019/140421.365698:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.365822:INFO:GraphicsContext.cpp(587)] Case 4 set p1\n[1:1:1019/140421.365938:INFO:GraphicsContext.cpp(588)] Case 4 set start_dot\n[1:1:1019/140421.368144:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.368263:INFO:GraphicsContext.cpp(587)] Case 4 set p1\n[1:1:1019/140421.368384:INFO:GraphicsContext.cpp(588)] Case 4 set start_dot\n[1:1:1019/140421.370635:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.370769:INFO:GraphicsContext.cpp(561)] Case 1 set p1\n[1:1:1019/140421.370888:INFO:GraphicsContext.cpp(562)] Case 1 set start_dot\n[1:1:1019/140421.372933:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.373051:INFO:GraphicsContext.cpp(570)] Case 2 set p1\n[1:1:1019/140421.373163:INFO:GraphicsContext.cpp(571)] Case 2 set start_dot\n[1:1:1019/140421.375348:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.375493:INFO:GraphicsContext.cpp(570)] Case 2 set p1\n[1:1:1019/140421.375606:INFO:GraphicsContext.cpp(571)] Case 2 set start_dot\n[1:1:1019/140421.376935:INFO:GraphicsContext.cpp(555)] New line\n[1:1:1019/140421.377051:INFO:GraphicsContext.cpp(570)] Case 2 set p1\n[1:1:1019/140421.377160:INFO:GraphicsContext.cpp(571)] Case 2 set start_dot\n[1:1:1019/140421.377274:INFO:GraphicsContext.cpp(578)] Case 3 set p2\n[1:1:1019/140421.377393:INFO:GraphicsContext.cpp(579)] Case 3 set end_dot",
      "parentUuid": "e0b55f93_9aa4d884",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "91dc7cec_59f79155",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 589,
      "author": {
        "id": 1003156
      },
      "writtenOn": "2017-10-19T14:49:39Z",
      "side": 1,
      "message": "I\u0027m not sure if the end result would be more readable, but what if instead of adjusting the dots/points on the fly in all these branches we just track some linear adjustments?\n\ne.g.\n\nfloat start_dot_adjust \u003d 0, end_dot_adjust \u003d 0, start_gap_adjust \u003d 0, end_gap_adjust \u003d 0;\n\nif (...) {\n  start_dot_adjust \u003d 1;\n}\n\nif (...) {\n  start_gap_adjust \u003d -1;\n}\n\n...\n\nthen do the 2D geometry voodoo at the end\n\nif (start_dot_adjust || start_gap_adjust) {\n  // draw the start dot and move the line start\n  ...\n}\n\nif (end_dot_adjust || end_gap_adjust) {\n  // draw the end dot and move the line end\n  ..\n}",
      "range": {
        "startLine": 587,
        "startChar": 0,
        "endLine": 589,
        "endChar": 24
      },
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c8f8843f_b80fe960",
        "filename": "third_party/WebKit/Source/platform/graphics/GraphicsContext.cpp",
        "patchSetId": 12
      },
      "lineNbr": 589,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-19T19:36:16Z",
      "side": 1,
      "message": "This is probably worth doing. We always set the start dot and modify p1 together, and set the end dot and modify p2 together. The code to offset the rect in each branch is the same and could move to the end.",
      "parentUuid": "91dc7cec_59f79155",
      "range": {
        "startLine": 587,
        "startChar": 0,
        "endLine": 589,
        "endChar": 24
      },
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c176d7b_c3b42b2d",
        "filename": "third_party/WebKit/Source/platform/graphics/StrokeData.cpp",
        "patchSetId": 12
      },
      "lineNbr": 140,
      "author": {
        "id": 1003156
      },
      "writtenOn": "2017-10-19T14:34:06Z",
      "side": 1,
      "message": "Won\u0027t this fall out naturally from the conditional below?\n\n(if max_gap \u003c\u003d 0 and min_gap \u003e 0 and k \u003e 0, fabs(min_gap - k) \u003c fabs(max_gap - k) and we select the former)",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ba926d36_95de1e88",
        "filename": "third_party/WebKit/Source/platform/graphics/StrokeData.cpp",
        "patchSetId": 12
      },
      "lineNbr": 140,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-10-19T19:36:16Z",
      "side": 1,
      "message": "Yes, changed it to be one conditional.",
      "parentUuid": "0c176d7b_c3b42b2d",
      "revId": "de4223d63154299ac71e6335798f76a80167d52f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}