{
  "comments": [
    {
      "key": {
        "uuid": "92a4c776_93f47206",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-08-11T01:26:27Z",
      "side": 1,
      "message": "Will add \"delete this;\"",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3aa214f3_8731e3cf",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 1000537
      },
      "writtenOn": "2017-08-12T02:54:53Z",
      "side": 1,
      "message": "sg.",
      "parentUuid": "92a4c776_93f47206",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "251c3c10_503677aa",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 87,
      "author": {
        "id": 1000537
      },
      "writtenOn": "2017-08-10T22:15:46Z",
      "side": 1,
      "message": "Could you please add a test that demonstrates what happens when the SLAS falls out of scope before the animation completes?",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f0041ee6_56c564aa",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 87,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-08-11T01:26:27Z",
      "side": 1,
      "message": "This should be the same as the test: LayerAnimatorTest, ImplicitAnimationObservers\nSince it just equals to SLAS-\u003eAddObserver().\nhttps://cs.chromium.org/chromium/src/ui/compositor/layer_animator_unittest.cc?l\u003d1674\u0026rcl\u003dcc46b05b55683ecf63128f6062811093fcf2ad79",
      "parentUuid": "251c3c10_503677aa",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d0a422a_7f359eb3",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 87,
      "author": {
        "id": 1000537
      },
      "writtenOn": "2017-08-12T02:54:53Z",
      "side": 1,
      "message": "Good point :) Yes, I think this covers it.",
      "parentUuid": "f0041ee6_56c564aa",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de0caa30_17278947",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 87,
      "author": {
        "id": 1002110
      },
      "writtenOn": "2017-08-15T23:59:27Z",
      "side": 1,
      "message": "It looks like the destructor of ScopedLayerAnimationSettings removes all of its observers from animator_. So just to double-check, how does the observer continue to get notified after the SLAS falls out of scope?",
      "parentUuid": "5d0a422a_7f359eb3",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32703b76_83a5f18c",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 87,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-08-16T01:34:02Z",
      "side": 1,
      "message": "IIUC, the animator_-\u003eobservers_ are added to the animation_sequence in LayerAnimator::OnScheduled [1]. So even animator_ removed all the observer, when animation_sequence finishes, the observer will still be called.\n[1] https://cs.chromium.org/chromium/src/ui/compositor/layer_animator.cc?l\u003d877\u0026rcl\u003daa7fa15ec4c7e97eaf67f08a3c3f985191b2c563",
      "parentUuid": "de0caa30_17278947",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20513996_efeb9acf",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 1
      },
      "lineNbr": 87,
      "author": {
        "id": 1002110
      },
      "writtenOn": "2017-08-16T14:58:57Z",
      "side": 1,
      "message": "Ah, thanks, that makes sense!",
      "parentUuid": "32703b76_83a5f18c",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "49e1f2f6_96a16d4c",
        "filename": "ui/compositor/scoped_layer_animation_settings.h",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1000537
      },
      "writtenOn": "2017-08-12T02:54:53Z",
      "side": 1,
      "message": "Is there a way to police this lifetime issue?",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f20ee3d3_61b69100",
        "filename": "ui/compositor/scoped_layer_animation_settings.h",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-08-15T21:33:10Z",
      "side": 1,
      "message": "I have thought about two ways to guard on this:\n1. Pass the layer weak ptr to the new observer.\n2. Set layer through the animator-\u003edelegate_, so it will not take random layer to the observer. \nBut a. Can the layer also be destroyed during animation? b. another problem is that, animator could be attached to other delegate_(layer). Will this happen during animation? Will this operation stop the previous animation and change the delegate_? I just worry about we need manually take care of some clear up work such as to reset previous cache flag, and set the cache on new layer.",
      "parentUuid": "49e1f2f6_96a16d4c",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59e88ca3_9273ff90",
        "filename": "ui/compositor/scoped_layer_animation_settings.h",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1002110
      },
      "writtenOn": "2017-08-15T23:59:27Z",
      "side": 1,
      "message": "The logic here: https://cs.chromium.org/chromium/src/ui/compositor/layer.cc?rcl\u003d74ccc9ea10c5f94bcdddb1e0dc052f3f6fdcc762\u0026l\u003d150\nsuggests that the ui::Layer won\u0027t be destroyed before the animation is destroyed (the comment there is very old, so the references to \"WebLayer\" should be interpreted as \"cc::Layer\"). \n\nSimilarly, there\u0027s logic here: https://cs.chromium.org/chromium/src/ui/compositor/layer.cc?rcl\u003d74ccc9ea10c5f94bcdddb1e0dc052f3f6fdcc762\u0026l\u003d613\nto destroy composited animations whenever the ui::Layer\u0027s cc::Layer is changed.\n\nThe delegate_ is itself a ui::Layer (in practice). Is the delegate change you\u0027re asking about the one in LayerAnimator::SetDelegate? That stops all animations before changing the delegate: https://cs.chromium.org/chromium/src/ui/compositor/layer_animator.cc?rcl\u003d27c9dfacea818a6aca8ca96a2e01fcb72e966322\u0026l\u003d128\n\nDid you have any other lifetime issues in mind?",
      "parentUuid": "f20ee3d3_61b69100",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2d8d539_c5a5b274",
        "filename": "ui/compositor/scoped_layer_animation_settings.h",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-08-16T01:34:02Z",
      "side": 1,
      "message": "No. Thanks a lot. It is very helpful.\nI will upload the second solution soon.",
      "parentUuid": "59e88ca3_9273ff90",
      "revId": "a5323f2ad8444dcfd5e32026b84bfae420f0eabb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}