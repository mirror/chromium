{
  "comments": [
    {
      "key": {
        "uuid": "6249ea22_8386fa21",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 53,
      "author": {
        "id": 1001168
      },
      "writtenOn": "2017-12-22T21:31:49Z",
      "side": 1,
      "message": "Nit: const char kRFC2047EncodingPrefix[] \u003d \"\u003d?utf-8?Q?\";\n\nsame for the other string constants.",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1efbf66a_6f63b90f",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 53,
      "author": {
        "id": 1115922
      },
      "writtenOn": "2017-12-22T21:41:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6249ea22_8386fa21",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b0266d0f_a598243b",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1001168
      },
      "writtenOn": "2017-12-22T21:31:49Z",
      "side": 1,
      "message": "Doesn\u0027t QuotedPrintableEncode do line splitting as well? It seems a bit surprising that we\u0027d need a separate bit of logic here for line splitting.",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2471cb8_8dc4016e",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1115922
      },
      "writtenOn": "2017-12-22T21:41:14Z",
      "side": 1,
      "message": "QuotedPrintableEncode does do line splitting, but it does not add the encoding info \"?utf-8?Q?\" which is unique to RFC 2047.",
      "parentUuid": "b0266d0f_a598243b",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2260a72_58804b8b",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1001168
      },
      "writtenOn": "2017-12-25T21:29:55Z",
      "side": 1,
      "message": "Could QuotedPrintableEncode just handle this as well? We already have header-specific behavior, so it seems like it would be reasonable to encode the additional line wrapping logic there as well.",
      "parentUuid": "c2471cb8_8dc4016e",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f998c5e0_f7332dfe",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1115922
      },
      "writtenOn": "2018-01-02T21:42:24Z",
      "side": 1,
      "message": "Yes, we can let QuotedPrintableEncode handle this. But it will make the semantics of QuotedPrintableEncode a bit confusing because QuotedPrintableEncode is supposed to convert a character only, regardless how it represents, UTF-8 or not. So having QuotedPrintableEncode output ?\"utf-8?Q?\" sounds a bit unnatural.\n\nWe can pass a delegate to QuotedPrintableEncode to do some specific things:\n  class QuotedPrintableEncodeDelegate {\n   public:\n    // Returns maximum number of characters allowed for an encoded line,\n    // excluding prefix and soft line break.\n    size_t GetMaxLineLengthForEncodedContent() const;\n\n    // Returns true if space and tab characters need to be encoded.\n    bool ShouldEncodeWhiteSpaceCharacters(bool end_of_line) const;\n\n    // Adds a prefix.\n    void AddPrefix(Vector\u003cchar\u003e\u0026 out);\n\n    // Adds a soft line break.\n    void AddSoftLineBreak(Vector\u003cchar\u003e\u0026 out);\n  };\n\n  PLATFORM_EXPORT void QuotedPrintableEncode(const char*,\n                                             size_t,\n                                             QuotedPrintableEncodeDelegate*,\n                                             Vector\u003cchar\u003e\u0026);\n\nHow do you think?",
      "parentUuid": "b2260a72_58804b8b",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72d2d0b4_12ec4960",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1001168
      },
      "writtenOn": "2018-01-05T23:50:34Z",
      "side": 1,
      "message": "Hmm... yeah I guess there\u0027s no real great option. To summarize:\n\n1. The current solution is unfortunate because it requires processing each line multiple times for headers.\n2. Encoding the logic directly into QuotedPrintableEncode doesn\u0027t really make sense either (because when encoding the body, there\u0027s no required utf-8 encoding)\n3. Creating a delegate works but (still) feels very specific to this particular problem.\n\nI guess let\u0027s just go with #3. If we do #3, we should consider just having an AppendOutput() function as well for outputting the normal characters: then we can avoid creating a scratch Vector, copying it to another Vector, and then turning it into a String (below). In that case, we could just call AddPrefix and AddSoftLineBreak to something like DidStartLine and DidFinishLine. Does this sound OK?",
      "parentUuid": "f998c5e0_f7332dfe",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ee47681_bd94b17b",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1115922
      },
      "writtenOn": "2018-01-06T00:07:52Z",
      "side": 1,
      "message": "For AppendOutput(), do you mean that it will write the encoded characters like \"\u003d6A\"? If so, the delegate implementation will know how to encode a single ASCII character to a bunch of encoded characters. In addition, QuotedPrintableEncodeDelegate will have a problem to figure out the length of accumulated characters so far.",
      "parentUuid": "72d2d0b4_12ec4960",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3da45dc0_c54886ae",
        "filename": "third_party/WebKit/Source/platform/mhtml/MHTMLArchive.cpp",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1115922
      },
      "writtenOn": "2018-01-17T01:25:34Z",
      "side": 1,
      "message": "Updated to using delegate. Please review again.",
      "parentUuid": "3ee47681_bd94b17b",
      "revId": "9af8acb880dbbd2303a49000023a16ae0cffbbcf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}