{
  "comments": [
    {
      "key": {
        "uuid": "3776c349_2735a328",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2089,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2018-01-11T16:26:38Z",
      "side": 1,
      "message": "When can this happen? CoalescePendingMotionEvents() should not discard the move event that happened. Once we call EventTypeFromNative() above (line 2074), the rest of the code assumes that that remains the case. So if it becomes UNKNOWN for some reason, it would be useful to understand why/how that happens.",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d25c267d_36d3ff4d",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2089,
      "author": {
        "id": 1228974
      },
      "writtenOn": "2018-01-12T07:26:12Z",
      "side": 1,
      "message": "The problem is that I can\u0027t make the browser crash. The issue couldn\u0027t be replicated. Given that it\u0027s the only affected path, I\u0027ve come with the above mentioned conclusion.",
      "parentUuid": "3776c349_2735a328",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "954dab6c_f72642d4",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2089,
      "author": {
        "id": 1228974
      },
      "writtenOn": "2018-01-12T14:19:00Z",
      "side": 1,
      "message": "Ok, I\u0027ve been able to reproduce the issue.\n\nCoalescePendingMotionEvents can return a mouse scroll event, if user has a context menu or anything other window opened, which requires to translate event locations. To reproduce this, do the following: open a browser, open a context menu, start moving a mouse pointer around and scroll at the same time.\n\nAnd when MouseEvent is constructed, the EventTypeFromXEvent returns ET_UNKNOWN for the XI_Motion type events. It\u0027s this line - https://cs.chromium.org/chromium/src/ui/events/x/events_x_utils.cc?q\u003devents_x_ut\u0026sq\u003dpackage:chromium\u0026l\u003d439.\n\nAnd then we we do event-\u003eAsLocatedEvent(), it fails with a CHECK(IsLocatedEvent), because the current type is unknown and that event mustn\u0027t have been created.",
      "parentUuid": "d25c267d_36d3ff4d",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2427946_e42bdb12",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2089,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2018-01-12T16:30:32Z",
      "side": 1,
      "message": "Very interesting! Thank you for digging into this.\n\nCoalescePendingMotionEvents() seems to try to not coalesce with a scroll event though [1]. Is there a reason that isn\u0027t helping in this case?\n\nSince this can affect only mouse events, I think if we want to have this check, we should have it only for mouse events (i.e below).\n\n[1] https://cs.chromium.org/chromium/src/ui/base/x/x11_util.cc?l\u003d351",
      "parentUuid": "954dab6c_f72642d4",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4ad8e685_fd935b53",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2089,
      "author": {
        "id": 1228974
      },
      "writtenOn": "2018-01-12T19:18:05Z",
      "side": 1,
      "message": "Mmm, I don\u0027t know why. Let me check further then.\n\nSure, I will remove the check from the touch events.. I thought it could be a problem here as well, but it doesn\u0027t look like it is.",
      "parentUuid": "e2427946_e42bdb12",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b780cbf_b7f87628",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2089,
      "author": {
        "id": 1228974
      },
      "writtenOn": "2018-01-15T08:51:34Z",
      "side": 1,
      "message": "Ok. The problem is the following: even though the check [1] is false (there is an internal check called IsCMTDeviceEvent, which always returns false, btw. AFAIK, cmt driver is used only in ChromeOS), the EventTypeFromXEvent method calls DeviceDataManagerX11::GetInstance()-\u003eHasEventData(xievent, DeviceDataManagerX11::DT_CMT_SCROLL_X), which seems to be incorrect, because the event wasn\u0027t from cmt device, actually. And thus it goes through that path [2], which then triggers a check (IsLocatedEvent) to fail, because the type of the event is unknown.\n\nAdding a \"IsCMTDeviceEvent\" to [1] resolves the issue as well.\n\n[1] https://cs.chromium.org/chromium/src/ui/base/x/x11_util.cc?l\u003d351\n[2] https://cs.chromium.org/chromium/src/ui/events/x/events_x_utils.cc?q\u003devents_x_util\u0026dr\u003dC\u0026l\u003d435",
      "parentUuid": "4ad8e685_fd935b53",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "98ac0d37_155021c4",
        "filename": "ui/views/widget/desktop_aura/desktop_window_tree_host_x11.cc",
        "patchSetId": 4
      },
      "lineNbr": 2110,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2018-01-11T16:26:38Z",
      "side": 1,
      "message": "ditto",
      "revId": "1c2451dc7381bb104b6b6f70490f7e7a81ad901d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}