{
  "comments": [
    {
      "key": {
        "uuid": "c9109197_6aabdde2",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "If we\u0027re moving the logic here, might make sense to just store this inside this class on each startOrUpdateForegroundService() call we get.",
      "range": {
        "startLine": 52,
        "startChar": 12,
        "endLine": 52,
        "endChar": 63
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "42219d48_141445ba",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "We don\u0027t call startOrUpdateForegroundService each time the notification is updated though, so it is possible that DownloadForegroundServiceManager has a more updated version of the notification than we do. I guess we could just not pass in the notificationId because we have pinnedNotificationId, but I\u0027ll just put in a check instead.",
      "parentUuid": "c9109197_6aabdde2",
      "range": {
        "startLine": 52,
        "startChar": 12,
        "endLine": 52,
        "endChar": 63
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70d484fe_9644750d",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-30T00:15:29Z",
      "side": 1,
      "message": "Doesn\u0027t it only matter what this class thinks the old notification is?  e.g. if we haven\u0027t explicitly called startOrUpdateForegroundService() or stopDownloadForegroundService() with a notification we don\u0027t really have anything to fix?",
      "parentUuid": "42219d48_141445ba",
      "range": {
        "startLine": 52,
        "startChar": 12,
        "endLine": 52,
        "endChar": 63
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "76cbad21_ed687fec",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-30T01:03:00Z",
      "side": 1,
      "message": "I\u0027m not quite sure what you mean, so this is what I mean:\n\nFor example, the case that we need to startOrUpdateForegroundService and handle relaunching a notification is likely when there are multiple downloads and Download1, the one that was originally pinned to the foreground finishes and so we need to switch the foreground to pin to the next download, Download2 that is still continuing. In this case, the last call this class got from Download1 was the original in-progress notification from when that download was just starting, but since then, that download has been completed and a complete notification has been built. This is the notification we want to relaunch, not the original starting notification. DownloadForegroundServiceManager is getting an update every time the notification is getting updated and has the latest/newest notification, so we will just have it pass that notification.\n\nLet me know if this addresses your point or if there is something else! /We can talk in person!",
      "parentUuid": "70d484fe_9644750d",
      "range": {
        "startLine": 52,
        "startChar": 12,
        "endLine": 52,
        "endChar": 63
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fd3ffdb2_f7d9ef14",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 63,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Do we want something like:\n\nif (mOldNotification \u003d\u003d null) {\n  startForegroundInternal(...):\n} else {\n  if (isSdkAtLeast24()) {  ... } else { ... }\n}",
      "range": {
        "startLine": 54,
        "startChar": 8,
        "endLine": 63,
        "endChar": 0
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efe9482d_31b5f301",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 63,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fd3ffdb2_f7d9ef14",
      "range": {
        "startLine": 54,
        "startChar": 8,
        "endLine": 63,
        "endChar": 0
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "86269f21_19fdd1d5",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "If you store the oldNotification stuff from the start call you should have these in this class already too.",
      "range": {
        "startLine": 88,
        "startChar": 38,
        "endLine": 88,
        "endChar": 95
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "199c8449_b5801d32",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Do we need both of these or just one?  I feel like conceptually we want \"keep the notification around after stopping foreground\" or \"don\u0027t keep the notification around after stopping foreground.\"",
      "range": {
        "startLine": 87,
        "startChar": 49,
        "endLine": 88,
        "endChar": 36
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52e6c93d_732aaecd",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Discussed offline.",
      "parentUuid": "199c8449_b5801d32",
      "range": {
        "startLine": 87,
        "startChar": 49,
        "endLine": 88,
        "endChar": 36
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b3eba912_f1acb7a0",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "See above.",
      "parentUuid": "86269f21_19fdd1d5",
      "range": {
        "startLine": 88,
        "startChar": 38,
        "endLine": 88,
        "endChar": 95
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "560b91a4_e6273a85",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Can we simplify this a bit?\n\nif (detach) {\n  // ... This has all of the if/else based on Android versions and you can update the logic to assume detachNotification is true always.\n} else {\n  // Just stop foreground and kill the notification in the process.\n  ServiceCompat.stopForeground(this, ServiceCompat.STOP_FOREGROUND_REMOVE);\n}",
      "range": {
        "startLine": 95,
        "startChar": 8,
        "endLine": 95,
        "endChar": 52
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0ee2c3c_7abadc09",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Did it the other way around (kill first, then handle detach cases).",
      "parentUuid": "560b91a4_e6273a85",
      "range": {
        "startLine": 95,
        "startChar": 8,
        "endLine": 95,
        "endChar": 52
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79418da6_71aeaa5e",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 96,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Do we need this if we\u0027re relaunching before we call stopForeground?  We might not need any of the persisted notification data in that case?",
      "range": {
        "startLine": 96,
        "startChar": 8,
        "endLine": 96,
        "endChar": 44
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b3b35b2_72925b80",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 96,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Discussed offline.",
      "parentUuid": "79418da6_71aeaa5e",
      "range": {
        "startLine": 96,
        "startChar": 8,
        "endLine": 96,
        "endChar": 44
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "98969a11_aee7f44b",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 97,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Can this be getCurrentSdk() \u003e 24?  That way for the tests you can just override getCurrentSdk() and not isSdkAtLeast21, 23, 24.",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 28
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af72de2d_55d4e93b",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 97,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "98969a11_aee7f44b",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 28
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "724f733a_a1e484ee",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 116,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Except for the else case below?",
      "range": {
        "startLine": 116,
        "startChar": 43,
        "endLine": 116,
        "endChar": 52
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d634cc1_f7afe2a2",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 116,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "724f733a_a1e484ee",
      "range": {
        "startLine": 116,
        "startChar": 43,
        "endLine": 116,
        "endChar": 52
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "069ece0d_51429b04",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 127,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Not 100% sure on the difference between isSdkAtLeast21() and the else if we get rid of killNotification",
      "range": {
        "startLine": 127,
        "startChar": 8,
        "endLine": 127,
        "endChar": 16
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c37c0ad_ca194746",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 127,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "069ece0d_51429b04",
      "range": {
        "startLine": 127,
        "startChar": 8,
        "endLine": 127,
        "endChar": 16
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8322e64e_f3d26166",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 131,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "I think this gets a bit more complicated.  The backend layer needs to update it\u0027s ID as well.  Should this be something like buildNewNotificationIdFor(pinnedNotificationId)?  The method call would have to update the stored notification id in the DownloadSharedPreferenceEntry.",
      "range": {
        "startLine": 131,
        "startChar": 40,
        "endLine": 131,
        "endChar": 63
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "248efa96_d8f14351",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 131,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8322e64e_f3d26166",
      "range": {
        "startLine": 131,
        "startChar": 40,
        "endLine": 131,
        "endChar": 63
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6448b553_3c149059",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 152,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Maybe cache this instead of querying for the system service each time.",
      "range": {
        "startLine": 150,
        "startChar": 12,
        "endLine": 152,
        "endChar": 58
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce0a67c3_b6bf6e4d",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 152,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6448b553_3c149059",
      "range": {
        "startLine": 150,
        "startChar": 12,
        "endLine": 152,
        "endChar": 58
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a548e16d_6fd74f0d",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 152,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-30T00:15:29Z",
      "side": 1,
      "message": "I would just cache in onCreate() and assume it isn\u0027t null here.",
      "parentUuid": "ce0a67c3_b6bf6e4d",
      "range": {
        "startLine": 150,
        "startChar": 12,
        "endLine": 152,
        "endChar": 58
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "205b07d6_a62bfec3",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundService.java",
        "patchSetId": 6
      },
      "lineNbr": 152,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-30T01:03:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a548e16d_6fd74f0d",
      "range": {
        "startLine": 150,
        "startChar": 12,
        "endLine": 152,
        "endChar": 58
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "06325364_cddeffd5",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundServiceManager.java",
        "patchSetId": 6
      },
      "lineNbr": 239,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2018-01-24T22:40:07Z",
      "side": 1,
      "message": "Don\u0027t these just boil down to detach for everything except cancel?  If we have to re-launch and re-show that\u0027s a detach implementation issue?",
      "range": {
        "startLine": 234,
        "startChar": 8,
        "endLine": 239,
        "endChar": 57
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d6c397e_dac13dd9",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/download/DownloadForegroundServiceManager.java",
        "patchSetId": 6
      },
      "lineNbr": 239,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2018-01-29T22:56:34Z",
      "side": 1,
      "message": "Discussed offline.",
      "parentUuid": "06325364_cddeffd5",
      "range": {
        "startLine": 234,
        "startChar": 8,
        "endLine": 239,
        "endChar": 57
      },
      "revId": "4306e0908f6a22ccc591cf20bb4206f47b6d67f5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}