{
  "comments": [
    {
      "key": {
        "uuid": "3d0643be_7d2084d2",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 238,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "It looks to me like this would be a better fit in OmniboxEditController, alongside the analogous OnAutocompleteAccept. The controller is implemented in part by the location bar classes on Views and Cocoa, which are subclasses of OmniboxEditController, so this logic could go in LocationBarView. That seems like a natural fit, since location_bar_view_ is mostly what we\u0027re interacting with here.",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9fe7b69b_67f66a30",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 238,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "It doesn\u0027t matter to me where it is. I can appreciate saying \u0027location_bar_view_-\u003e\u0027 less, but I don\u0027t understand the extra hop through the controller. Looking at how littered this file is with those references, it looks to me like others have had this same thought, and that a lot of the location bar\u0027s responsibilities should move here.",
      "parentUuid": "3d0643be_7d2084d2",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf1d3710_0f9dd80a",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 239,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "LocationBarView also has access to the profile and can determine if we\u0027re in incognito mode, so I think you wouldn\u0027t need to pass this value. Better yet, I think you could restrict the search to browser objects with the same profile like you\u0027re doing in ChromeAutocompleteProviderClient.",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87e0f3cb_2065ca1c",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 239,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "Funny, I thought I\u0027d already done that.",
      "parentUuid": "cf1d3710_0f9dd80a",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ef4ddaf9_7d968e7d",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 252,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "Do we need the same check in the provider so we don\u0027t suggest the current page as a tab switch result?",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d917aa48_cbbe7baa",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 252,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "It was only there to avoid needless work (and in fact it\u0027s wrong). I moved it where more appropriate.\n\nI think the provider side needs some thinking. I could see a tab match lowering the score as easily as I could see simply avoiding the tab, or even leaving this as is. I think it\u0027s bound up in the \"when does user want to navigate\" question.",
      "parentUuid": "ef4ddaf9_7d968e7d",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0dbbf90b_180593b3",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 253,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "I\u0027m not sure we want to do either of these things (close the current tab or focus the web contents. But I\u0027m eager to try this out and see how if feels in practice, so I think these make sense to have them for now.",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab019cd6_3be69385",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 253,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "If we don\u0027t close it, the user isn\u0027t likely go looking for it when they want to open something new. They will accumulate NTPs like they collect tabs today. I\u0027m not sure why we would want that.\n\nRegarding focusing, if we don\u0027t do this, the focus is still in the Omnibox. This is not what happens, for example, when we navigate to a URL.\n\nMy comment is more regarding this file being the wrong place to be playing with focus. I feel like it belongs over in the other files (chrome/browser/ui.) Specifically, if someone were looking into a focus bug, they would want all that logic in the same place.",
      "parentUuid": "0dbbf90b_180593b3",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3bc5e57a_0637459d",
        "filename": "chrome/browser/ui/views/omnibox/omnibox_view_views.cc",
        "patchSetId": 5
      },
      "lineNbr": 253,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-20T20:20:57Z",
      "side": 1,
      "message": "\u003e If we don\u0027t close it, the user isn\u0027t likely go looking for it when they want to open something new. They will accumulate NTPs like they collect tabs today. I\u0027m not sure why we would want that.\n\nThey might. But then closing the tab if it has history could be destructive. And only closing the tab if it doesn\u0027t have history could be confusing. I think \"Open All\" in the bookmarks UI is instructive here. I use this very often and I\u0027m always slightly annoyed that it doesn\u0027t close the new tab I opened just before invoking it. But I suspect when developing that feature they found that there was no safe/reliable/not-confusing way to close a tab that the user had just opened.\n\nIf you\u0027ve figured out a way to only close the tab if it doesn\u0027t have history (see comment below about GetText().empty()) then ok. But if there\u0027s no simple solution to that question then I think we\u0027d be better off avoiding trying to do this in this CL.\n\n\u003e Regarding focusing, if we don\u0027t do this, the focus is still in the Omnibox. This is not what happens, for example, when we navigate to a URL.\n\nYeah, I think you\u0027re right. But as a counterexample, if you switch to an open tab via mouse click, the focus and state of the current tab is preserved. Again, I think you\u0027re right but I\u0027m not 100% sure and wanted to note that for further thought.",
      "parentUuid": "ab019cd6_3be69385",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8c31f0ab_df8a4c87",
        "filename": "components/omnibox/browser/history_quick_provider.cc",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-20T20:20:57Z",
      "side": 1,
      "message": "I assume this is for debugging purposes and can be removed now?",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d36df644_e537867a",
        "filename": "components/omnibox/browser/history_quick_provider.cc",
        "patchSetId": 5
      },
      "lineNbr": 203,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-20T20:20:57Z",
      "side": 1,
      "message": "More than just a constant, this should be an i18n\u0027d template.",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d708c417_48f9f39e",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 683,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "It think this needs to include a check for TAB_SEARCH. Something like:\n\n  // Revert for all dispositions except opening a new tab in the\n  // background. Tab search matches always open a different tab so revert\n  // in that case regardless of the disposition.\n  if (disposition !\u003d WindowOpenDisposition::NEW_BACKGROUND_TAB ||\n      match.type \u003d\u003d AutocompleteMatchType::TAB_SEARCH) {",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d5eb030_2c20d2af",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 683,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "AFAICT, the conditional isn\u0027t even necessary before my change. It\u0027s only ever called with current tab and new foreground.\n\nAnd a note to myself, mostly: If this is needed for some reason, we\u0027ll have to handle that below if the tab search fails.",
      "parentUuid": "d708c417_48f9f39e",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9eb2a28_000dbc50",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 683,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-20T20:20:57Z",
      "side": 1,
      "message": "\u003e AFAICT, the conditional isn\u0027t even necessary before my change. It\u0027s only ever called with current tab and new foreground.\n\nI don\u0027t think this is true. This method is called in a lot of different circumstances. If you\u0027re interested, you can test the one I\u0027m thinking of by middle-clicking on a tab search match. I believe it will switch to the open tab but then not revert the text field state. (Unless the loss of focus does it?)\n\nBut I\u0027m now realizing that the NEW_BACKGROUND_TAB case is more complicated than I\u0027d thought about. Leaving this alone instead of mucking with it in cases we don\u0027t fully understand yet seems reasonable.",
      "parentUuid": "2d5eb030_2c20d2af",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a73f43a_aa32f28e",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 697,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "Looking through this entire method, this looks like the correct spot to me. There are some fuzzy implications about how the metrics recorded above should apply to opening an existing tab but nothing that\u0027s obviously wrong. Obviously mpearson will know best.",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "852bffe2_db04c255",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 697,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1a73f43a_aa32f28e",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d3f51072_9633466b",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 708,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "Maybe client_-\u003eIsNewTabPage(client_-\u003eGetURL())?",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70dfdf0a_8263a836",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 708,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "No, you can build up a huge history, then go to chrome://newtab, then tab search, and this would close it. :(\n\nI guess I was hoping for something like \u0027if history is empty\u0027.",
      "parentUuid": "d3f51072_9633466b",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a755a3b_097c3c15",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 708,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-20T20:20:57Z",
      "side": 1,
      "message": "Good point. But GetText().empty() has the same problem, doesn\u0027t it?",
      "parentUuid": "70dfdf0a_8263a836",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3d25a7bf_36929ca2",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 709,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-10-18T23:31:14Z",
      "side": 1,
      "message": "Can we have SwitchToTabWithURL return a success bool and only return here if true? Navigating to the URL is probably a better fallback in case of failure than doing nothing.",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "980d8029_6e73dc02",
        "filename": "components/omnibox/browser/omnibox_edit_model.cc",
        "patchSetId": 5
      },
      "lineNbr": 709,
      "author": {
        "id": 1105777
      },
      "writtenOn": "2017-10-19T20:25:05Z",
      "side": 1,
      "message": "sg",
      "parentUuid": "3d25a7bf_36929ca2",
      "revId": "92c2304b73771363ad89fca52ff24ab5815422d1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}