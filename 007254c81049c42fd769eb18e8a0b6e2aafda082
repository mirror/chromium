{
  "comments": [
    {
      "key": {
        "uuid": "a91bdb5b_b8270d02",
        "filename": "components/leveldb/leveldb_database_impl.cc",
        "patchSetId": 2
      },
      "lineNbr": 306,
      "author": {
        "id": 1125359
      },
      "writtenOn": "2017-06-21T22:02:52Z",
      "side": 1,
      "message": "IIUC, the block cache size is accounted for in the previous version.\nhttps://chromium.googlesource.com/external/leveldb.git/+/a53934a3ae1244679f812d998a4f16f2c7f309a6/db/db_impl.cc#1431\n\nAm I missing something?",
      "revId": "007254c81049c42fd769eb18e8a0b6e2aafda082",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a842fe4_806b88c6",
        "filename": "components/leveldb/leveldb_database_impl.cc",
        "patchSetId": 2
      },
      "lineNbr": 306,
      "author": {
        "id": 1125359
      },
      "writtenOn": "2017-06-21T22:05:34Z",
      "side": 1,
      "message": "Ah okay Just read your message about reporting separately. Still getting used to Gerrit.",
      "parentUuid": "a91bdb5b_b8270d02",
      "revId": "007254c81049c42fd769eb18e8a0b6e2aafda082",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "42933bf9_de62ae6f",
        "filename": "components/leveldb/leveldb_database_impl.cc",
        "patchSetId": 2
      },
      "lineNbr": 306,
      "author": {
        "id": 1110029
      },
      "writtenOn": "2017-06-21T22:05:35Z",
      "side": 1,
      "message": "Yes, approximate-memory-usage is effectively the sum of block-cache (read cache) and memtables (write cache). Having those two split out seems like it would make the reported data much more actionable.\n\nNot sure what the best way to report this is? Maybe with two separate allocations, one for cache_-\u003eTotalCharge() and one with memory_usage - cache_-\u003eTotalCharge()?",
      "parentUuid": "a91bdb5b_b8270d02",
      "revId": "007254c81049c42fd769eb18e8a0b6e2aafda082",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "387d7c62_6e00eb0c",
        "filename": "components/leveldb/leveldb_database_impl.cc",
        "patchSetId": 2
      },
      "lineNbr": 306,
      "author": {
        "id": 1125359
      },
      "writtenOn": "2017-06-21T22:16:44Z",
      "side": 1,
      "message": "You can do:\nstring name \u003d base::StringPrintf(\"leveldb/mojo/0x%\" PRIXPTR, reinterpret_cast\u003cuintptr_t\u003e(db_.get());\nmad \u003d pmd-\u003eCreateAllocatorDump(name)\n....\n\ncache_mad \u003d pmd-\u003eCreateAllocatorDump(name + \"/read_cache\");\ncache_mad-\u003eAddScalar(base::trace_event::MemoryAllocatorDump::kNameSize,\n                 base::trace_event::MemoryAllocatorDump::kUnitsBytes,\n                 size);\n\nYou don\u0027t have to add an entry for other parts, unless you want to name it.\nThis would just show up in UI as a child node and the rest will show up as \"\u003cunspecified\u003e\". If you want to name it, you\u0027d have to create another dump (name + \"/memtable\"). This also requires you to update background_whitelist.cc.\nIf you do this the data will also be available from slow reports. Else the data will only be seen on local traces.\n\nI am fine with either.",
      "parentUuid": "42933bf9_de62ae6f",
      "revId": "007254c81049c42fd769eb18e8a0b6e2aafda082",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}