{
  "comments": [
    {
      "key": {
        "uuid": "c761569d_ec62f5b5",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/notifications/NotificationPlatformBridge.java",
        "patchSetId": 9
      },
      "lineNbr": 630,
      "author": {
        "id": 1187649
      },
      "writtenOn": "2017-11-27T12:03:52Z",
      "side": 1,
      "message": "The version check isn\u0027t really necessary here, I would just set the channel name even on \u003cO since it doesn\u0027t involve any extra work. (Unlike getting the channel ID).",
      "range": {
        "startLine": 629,
        "startChar": 0,
        "endLine": 630,
        "endChar": 26
      },
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87d7b522_832db0c5",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/notifications/NotificationPlatformBridge.java",
        "patchSetId": 9
      },
      "lineNbr": 630,
      "author": {
        "id": 1117405
      },
      "writtenOn": "2017-11-27T15:11:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c761569d_ec62f5b5",
      "range": {
        "startLine": 629,
        "startChar": 0,
        "endLine": 630,
        "endChar": 26
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5e5d7b_5dd17221",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/notifications/NotificationPlatformBridge.java",
        "patchSetId": 9
      },
      "lineNbr": 631,
      "author": {
        "id": 1187649
      },
      "writtenOn": "2017-11-27T12:03:52Z",
      "side": 1,
      "message": "Extract this to a named variable eg \u0027originForDisplay\u0027 before creating the notification builder further up to avoid duplication with line 597 and improve readability.",
      "range": {
        "startLine": 631,
        "startChar": 22,
        "endLine": 631,
        "endChar": 94
      },
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bdcf75f8_7e612081",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/notifications/NotificationPlatformBridge.java",
        "patchSetId": 9
      },
      "lineNbr": 631,
      "author": {
        "id": 1117405
      },
      "writtenOn": "2017-11-27T15:11:10Z",
      "side": 1,
      "message": "Thanks! I found the channel name in another place and didn\u0027t notice line 597 do the same thing. Done!",
      "parentUuid": "da5e5d7b_5dd17221",
      "range": {
        "startLine": 631,
        "startChar": 22,
        "endLine": 631,
        "endChar": 94
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e9856358_2b2a109b",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkServiceClient.java",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1187649
      },
      "writtenOn": "2017-11-27T12:03:52Z",
      "side": 1,
      "message": "I want to check I understand what this is calling in practice, because it\u0027s confusing.\n\nMy best guess:\n- This calls through to the WebApkServiceImpl.notifyNotificationWithChannel method if the runtime library has updated so this method exists there\n- Otherwise it calls through to WebApkServiceImplWrapper.notifyNotification via some special casing in WebApkServiceImplWrapper.onTransact (which creates and sets the General channel on the notification, then posts it to the NotificationManager)\n\nIs this understanding correct? Please correct me if it\u0027s wrong.",
      "range": {
        "startLine": 96,
        "startChar": 0,
        "endLine": 96,
        "endChar": 54
      },
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9de475c2_5c059a17",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkServiceClient.java",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1117405
      },
      "writtenOn": "2017-11-27T15:11:10Z",
      "side": 1,
      "message": "Your understanding mostly correct. A little background here: WebAPKs loads a runtime library (webapk_1.dex) which is backed in Chrome to construct the WebApkServiceImpl. The WebApkServiceImpl is updated when Chrome is updated.\n\n1) With new Chrome, yes, it always calls WebApkServiceImpl.notifyNotificationWithChannel method.\n2) When Shell APK has updated while Chrome doesn\u0027t, Chrome still calls the notifyNotification method, and WebAPKs still load old WebApkServiceImpl. This is the situation in my previous CL. When old Chrome calls the WebAPK servie aidl notifyNotification method, we introduce a WebApkServiceImplWrapper, which has extra logic to add a channel when WebAPK is targeting to sdk 26. The only reason to have the wrapper is because we can\u0027t wait for another 6 weeks for Chrome to roll out to stable channel. Since all the changes are in the wrapper which is in the WebAPKs, we can easily push the changes to our server, and the notification issue will be fixed after WebAPKs are updated.\n\nHope it help to understand.",
      "parentUuid": "e9856358_2b2a109b",
      "range": {
        "startLine": 96,
        "startChar": 0,
        "endLine": 96,
        "endChar": 54
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de1506c8_97910f52",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkServiceClient.java",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1187649
      },
      "writtenOn": "2017-11-27T15:45:20Z",
      "side": 1,
      "message": "Yes, that helps, thanks.",
      "parentUuid": "9de475c2_5c059a17",
      "range": {
        "startLine": 96,
        "startChar": 0,
        "endLine": 96,
        "endChar": 54
      },
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f34b0c9d_a8c0245a",
        "filename": "chrome/android/webapk/libs/runtime_library/src/org/chromium/webapk/lib/runtime_library/WebApkServiceImpl.java",
        "patchSetId": 9
      },
      "lineNbr": 97,
      "author": {
        "id": 1187649
      },
      "writtenOn": "2017-11-27T12:03:52Z",
      "side": 1,
      "message": "nit: javadoc goes on top of @Annotations",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b0db5eb5_0ed0277a",
        "filename": "chrome/android/webapk/libs/runtime_library/src/org/chromium/webapk/lib/runtime_library/WebApkServiceImpl.java",
        "patchSetId": 9
      },
      "lineNbr": 97,
      "author": {
        "id": 1117405
      },
      "writtenOn": "2017-11-27T15:11:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f34b0c9d_a8c0245a",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "95950813_4c5d0ec3",
        "filename": "chrome/android/webapk/libs/runtime_library/src/org/chromium/webapk/lib/runtime_library/WebApkServiceImpl.java",
        "patchSetId": 9
      },
      "lineNbr": 98,
      "author": {
        "id": 1187649
      },
      "writtenOn": "2017-11-27T12:03:52Z",
      "side": 1,
      "message": "Hmm there\u0027s some duplication here with the wrapper\u0027s ensureNotificationChannelExists method. Can it be avoided?",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "91cb85ca_72f3fcbe",
        "filename": "chrome/android/webapk/libs/runtime_library/src/org/chromium/webapk/lib/runtime_library/WebApkServiceImpl.java",
        "patchSetId": 9
      },
      "lineNbr": 98,
      "author": {
        "id": 1117405
      },
      "writtenOn": "2017-11-27T15:11:10Z",
      "side": 1,
      "message": "I am afraid it can\u0027t. This is because that the shell_apk and the runtime_library shouldn\u0027t have dependencies to each other. On one hand, the runtime_library is backed in Chrome, so it isn\u0027t be part of the shell_apk, so shell_apk shouldn\u0027t depend on the runtime_library. On the other hand, the runtime_library doesn\u0027t depend on either Chrome or shell_apk.\n\nWe hope to remove the Wrapper soon, and we will get rid of the duplication then.",
      "parentUuid": "95950813_4c5d0ec3",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "2dc7ee77cec1c4158005b2ab0eb1f3ba9a3c5808",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}