{
  "comments": [
    {
      "key": {
        "uuid": "a1177eec_19e06b39",
        "filename": "remoting/client/chromoting_session.cc",
        "patchSetId": 2
      },
      "lineNbr": 503,
      "author": {
        "id": 1000528
      },
      "writtenOn": "2017-12-13T03:32:19Z",
      "side": 1,
      "message": "This still seems odd. Under what circumstances can client_ be null, and why would it be bad to execute the rest of this function if it is? I\u0027m concerned that adding a null check here is just papering over the cracks of a more fundamental architectural problem.",
      "range": {
        "startLine": 503,
        "startChar": 17,
        "endLine": 503,
        "endChar": 0
      },
      "revId": "5230f039be5677b0532cdc2e1b0f78f6525dd3e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc8bd03a_076f310d",
        "filename": "remoting/client/chromoting_session.cc",
        "patchSetId": 2
      },
      "lineNbr": 503,
      "author": {
        "id": 1152109
      },
      "writtenOn": "2017-12-13T09:02:51Z",
      "side": 1,
      "message": "client_ is null before the caller calls Connect() or after the caller calls Disconnect(). The actual problem here is that weak_factory_.InvalidateWeakPtrs() below can only be called once. We may do something like this instead:\n\n  if (weak_factory_.IsValid()) {\n    weak_factory_.InvalidateWeakPtrs();\n  }\n\nAnyway. The flaw of this design is that the caller can only disconnect once. To reconnect they will need to create a new ChromotingSession instance. I think the proper fix is to factor out a Core class that lives between (Connected, Disconnect), but I don\u0027t think it would get into M64...",
      "parentUuid": "a1177eec_19e06b39",
      "range": {
        "startLine": 503,
        "startChar": 17,
        "endLine": 503,
        "endChar": 0
      },
      "revId": "5230f039be5677b0532cdc2e1b0f78f6525dd3e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7839da27_3c638a8c",
        "filename": "remoting/client/chromoting_session.cc",
        "patchSetId": 2
      },
      "lineNbr": 503,
      "author": {
        "id": 1000528
      },
      "writtenOn": "2017-12-13T17:01:08Z",
      "side": 1,
      "message": "I see InvalidateWeakPtrs has a DCHECK(ptr_); is that the problem? If so, then I think your proposed solution is much cleaner--check the safety of the risky operation rather than something that (for now) has the same lifetime. A comment explaining why the weak factory might not be valid is probably worthwhile as well.",
      "parentUuid": "dc8bd03a_076f310d",
      "range": {
        "startLine": 503,
        "startChar": 17,
        "endLine": 503,
        "endChar": 0
      },
      "revId": "5230f039be5677b0532cdc2e1b0f78f6525dd3e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ed7869a_2b53591c",
        "filename": "remoting/client/chromoting_session.cc",
        "patchSetId": 2
      },
      "lineNbr": 503,
      "author": {
        "id": 1152109
      },
      "writtenOn": "2017-12-13T19:36:22Z",
      "side": 1,
      "message": "\u003e I see InvalidateWeakPtrs has a DCHECK(ptr_); is that the problem?\nYes\n\n\u003e If so, then I think your proposed solution is much cleaner--check the safety of the risky operation rather than something that (for now) has the same lifetime.\nDone. Looks like |weak_factory_| doesn\u0027t have IsValid() but checking the validity of |weak_ptr_| should be the same.\n\n\u003e A comment explaining why the weak factory might not be valid is probably worthwhile as well.\nDone.",
      "parentUuid": "7839da27_3c638a8c",
      "range": {
        "startLine": 503,
        "startChar": 17,
        "endLine": 503,
        "endChar": 0
      },
      "revId": "5230f039be5677b0532cdc2e1b0f78f6525dd3e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}