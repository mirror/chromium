{
  "comments": [
    {
      "key": {
        "uuid": "02bbb5ae_d6b2ce34",
        "filename": "third_party/WebKit/Source/bindings/core/v8/V8ScriptRunner.cpp",
        "patchSetId": 6
      },
      "lineNbr": 124,
      "author": {
        "id": 1000781
      },
      "writtenOn": "2018-01-09T05:21:29Z",
      "side": 1,
      "message": "I think you have to update ShouldProduceCodeCache() in v8/src/compiler.cc.\n\n bool ShouldProduceCodeCache(ScriptCompiler::CompileOptions options) {\n   return options \u003d\u003d ScriptCompiler::kProduceCodeCache ||\n-         options \u003d\u003d ScriptCompiler::kProduceFullCodeCache;\n+         options \u003d\u003d ScriptCompiler::kProduceFullCodeCache ||\n+         options \u003d\u003d ScriptCompiler::kEagerCompile;\n }",
      "revId": "bb1c700eac810b4d691b7eb24bdd9e0400fea1bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4e94f733_0972b8d6",
        "filename": "third_party/WebKit/Source/bindings/core/v8/V8ScriptRunner.cpp",
        "patchSetId": 6
      },
      "lineNbr": 124,
      "author": {
        "id": 1145189
      },
      "writtenOn": "2018-01-09T15:11:18Z",
      "side": 1,
      "message": "I am sorry, I should have mentioned the related v8 changes earlier. The idea is to remove the ProduceCodeCache and ProduceFullCodeCache options from the CompileOptions since we are requesting the code cache explicitly. I have updated the V8 to trigger a  EagerCompile when we pass EagerCompile option, so that when we request the cache we get a full code cache. Here is the v8 side cl: https://chromium-review.googlesource.com/c/v8/v8/+/828977. I will remove ProduceCodeCache and ProduceFullCodeCache options once I land the chromium side changes as well.",
      "parentUuid": "02bbb5ae_d6b2ce34",
      "revId": "bb1c700eac810b4d691b7eb24bdd9e0400fea1bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b3a2a084_3dbdcad0",
        "filename": "third_party/WebKit/Source/bindings/core/v8/V8ScriptRunner.cpp",
        "patchSetId": 6
      },
      "lineNbr": 520,
      "author": {
        "id": 1000781
      },
      "writtenOn": "2018-01-09T05:21:29Z",
      "side": 1,
      "message": "Currently DevTools shows \"producedCacheSize\" using this cache_result if CompileAndProduceCache function is selected.\nhttps://bugs.chromium.org/p/chromium/issues/detail?id\u003d769166#c9\n\nBut with this patch, when CompileEager function is selected which doesn\u0027t set ProduceResult.cache_size, DevTools can\u0027t show \"producedCacheSize\".\n\nSo the LayoutTest http/tests/devtools/service-workers/service-worker-v8-cache.js fails.\n\nCould you please add TRACE_EVENT in V8ScriptRunner::ProduceCache() to show the \"producedCacheSize\" in DevTools?",
      "revId": "bb1c700eac810b4d691b7eb24bdd9e0400fea1bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c47761c0_21c7fc55",
        "filename": "third_party/WebKit/Source/bindings/core/v8/V8ScriptRunner.cpp",
        "patchSetId": 6
      },
      "lineNbr": 520,
      "author": {
        "id": 1145189
      },
      "writtenOn": "2018-01-09T15:11:18Z",
      "side": 1,
      "message": "Thanks, I missed this. I added trace events for produce cache as well. Now, there will be two different trace events when producing code cache. The first one is for the compilation and the second one where we produce the cache. The parser cache and the consume cache options remain unchanged. Done.",
      "parentUuid": "b3a2a084_3dbdcad0",
      "revId": "bb1c700eac810b4d691b7eb24bdd9e0400fea1bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ef273a0_8c99f54b",
        "filename": "third_party/WebKit/Source/bindings/core/v8/V8ScriptRunner.cpp",
        "patchSetId": 6
      },
      "lineNbr": 520,
      "author": {
        "id": 1000781
      },
      "writtenOn": "2018-01-10T03:32:11Z",
      "side": 1,
      "message": "Please update service-worker-v8-cache-expected.txt.",
      "parentUuid": "c47761c0_21c7fc55",
      "revId": "bb1c700eac810b4d691b7eb24bdd9e0400fea1bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e289d1ae_b48fe685",
        "filename": "third_party/WebKit/Source/bindings/core/v8/V8ScriptRunner.cpp",
        "patchSetId": 6
      },
      "lineNbr": 520,
      "author": {
        "id": 1145189
      },
      "writtenOn": "2018-01-10T12:10:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4ef273a0_8c99f54b",
      "revId": "bb1c700eac810b4d691b7eb24bdd9e0400fea1bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}