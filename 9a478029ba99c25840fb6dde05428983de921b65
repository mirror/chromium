{
  "comments": [
    {
      "key": {
        "uuid": "43595b5d_56d608ba",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-13T22:21:39Z",
      "side": 1,
      "message": "These three arguments represent pseudo-duplicated state. That\u0027s fine, since we don\u0027t want to waste CPU cycles doing the look-up to get the WebContents instance when the caller already knew that information. However, since it is code in another module calling this here, we should state the assumption with an appropriate DCHECK, like:\n\n  DCHECK_EQ(RenderFrameHost::FromID(process_id, routing_id)-\u003edelegate()-\u003eAsWebContents(), web_contents);",
      "range": {
        "startLine": 35,
        "startChar": 41,
        "endLine": 37,
        "endChar": 66
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a14731a_f6abbef2",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-13T23:09:50Z",
      "side": 1,
      "message": "Makes sense, but AFAICT the RenderFrameHost doesn\u0027t expose its delegate",
      "parentUuid": "43595b5d_56d608ba",
      "range": {
        "startLine": 35,
        "startChar": 41,
        "endLine": 37,
        "endChar": 66
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "043e9ee7_b3a892ef",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-14T01:24:38Z",
      "side": 1,
      "message": "Since this is internal-to-libcontent code, we are allowed to cast-to-RenderFrameHostImpl:\n\n  DCHECK_EQ(static_cast\u003cRenderFrameHostImpl*\u003e(RenderFrameHost::FromID(process_id, routing_id))-\u003edelegate()-\u003eAsWebContents(), web_contents);",
      "parentUuid": "0a14731a_f6abbef2",
      "range": {
        "startLine": 35,
        "startChar": 41,
        "endLine": 37,
        "endChar": 66
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f6f9e76_c188ff1f",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-16T20:59:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "043e9ee7_b3a892ef",
      "range": {
        "startLine": 35,
        "startChar": 41,
        "endLine": 37,
        "endChar": 66
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "399c7198_13c817a9",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 38,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-13T22:21:39Z",
      "side": 1,
      "message": "If this subclassed WebContentsObserver, you could just add the WebContentsObserver(web_contents) ctor call here in the initializer list, and then you don\u0027t need to ever again worry about registering or deregistering the MediaPlayerRenderer: No extra Add/RemoveMediaPlayerRenderer() mechanisms or separate observer classes or flat_sets listing players. Note that WebContentsObservers remove themselves at destruction time *and* WebContentsObservers (i.e., this subclass too) are notified when a WebContents is destroyed.",
      "range": {
        "startLine": 38,
        "startChar": 4,
        "endLine": 38,
        "endChar": 5
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85a26903_0db5ce03",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 38,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-13T22:29:01Z",
      "side": 1,
      "message": "See above comment on MPR being a WCO",
      "parentUuid": "399c7198_13c817a9",
      "range": {
        "startLine": 38,
        "startChar": 4,
        "endLine": 38,
        "endChar": 5
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "36ea9fe2_cc5afca4",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 44,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-13T22:21:39Z",
      "side": 1,
      "message": "1. Should the player be muted if there is no WebContents instance?\n\n2. Is it possible for |web_contents| to ever be null? If not, just put this in the initializer list and remove the guards. Maybe add a DCHECK(web_contents) as a statement of this assumption.",
      "range": {
        "startLine": 44,
        "startChar": 2,
        "endLine": 44,
        "endChar": 21
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "131a6d8f_e97d89a4",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 44,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-13T22:29:01Z",
      "side": 1,
      "message": "1. Good question, not really sure what we should do in that case\n\n2. This was discussed in a previous patch, and we decided that it could happen and there wasn\u0027t much harm in leaving the guard either way",
      "parentUuid": "36ea9fe2_cc5afca4",
      "range": {
        "startLine": 44,
        "startChar": 2,
        "endLine": 44,
        "endChar": 21
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "888a79bb_c829c90a",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 310,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-13T22:21:39Z",
      "side": 1,
      "message": "Should this call OnUpdateAudioMutingState(false)? Meaning, when the WebContents is gone, there shouldn\u0027t be any audio coming from this player, right? In fact, maybe the whole player should be force-stopped and as many resources freed as possible?",
      "range": {
        "startLine": 310,
        "startChar": 0,
        "endLine": 310,
        "endChar": 35
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ec624d16_bd1acacf",
        "filename": "content/browser/media/android/media_player_renderer.cc",
        "patchSetId": 6
      },
      "lineNbr": 310,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-13T22:29:01Z",
      "side": 1,
      "message": "Whatever we decide to do for your question 1 above, we should likely do here as well",
      "parentUuid": "888a79bb_c829c90a",
      "range": {
        "startLine": 310,
        "startChar": 0,
        "endLine": 310,
        "endChar": 35
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cdbf27c0_7ae80352",
        "filename": "content/browser/media/android/media_player_renderer.h",
        "patchSetId": 6
      },
      "lineNbr": 42,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-13T22:21:39Z",
      "side": 1,
      "message": "Suggest making this subclass WebContentsObserver instead of having the separate observer class. See other comments for more discussion.",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 75
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4e55eafa_45fd0cf6",
        "filename": "content/browser/media/android/media_player_renderer.h",
        "patchSetId": 6
      },
      "lineNbr": 42,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-13T22:29:01Z",
      "side": 1,
      "message": "I had experimented with this here: crrev.com/c/713758, but after some discussion it was determined that we don\u0027t want to create n WCOs for n MPRs",
      "parentUuid": "cdbf27c0_7ae80352",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 75
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2c15b8d1_589f9a8f",
        "filename": "content/browser/media/android/media_player_renderer.h",
        "patchSetId": 6
      },
      "lineNbr": 42,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-14T01:24:38Z",
      "side": 1,
      "message": "Hmm...There is something I\u0027m misunderstanding here. I took a look at the design doc, and the comments don\u0027t seem to explain *why* we are afraid of N WebContentsObservers; just that we are. If we are going with this approach, then the rationale should be documented in the MediaPlayerRendererWebContentsObserver class comments.\n\nFrom what I can see on the surface, this solution feels over-engineered: We are adding about 4X the LOC, having WebContents own its own observer (a little weird), and managing an extra set of raw pointers.\n\nIs this a performance consideration, w.r.t. WebContents\u0027s observer list growing too large? If so, consider: How many MPR\u0027s are there ever going to be for one WebContents instance? Typically 1 to 2, right? Maybe up to 5 at most in extreme cases? More than that, and I bet the Android device is already so slowed to a crawl that we don\u0027t really care how large the WCO list is.",
      "parentUuid": "4e55eafa_45fd0cf6",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 75
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2838ce5d_92982012",
        "filename": "content/browser/media/android/media_player_renderer.h",
        "patchSetId": 6
      },
      "lineNbr": 42,
      "author": {
        "id": 1002169
      },
      "writtenOn": "2017-10-16T20:06:58Z",
      "side": 1,
      "message": "I disagree with yuri here.\n\nWebContents owning its own observer is not weird; it\u0027s precisely the TabHelper pattern, and it\u0027s used all over.\n\nWe are trying to prevent the observer list from growing into the thousands. Hence we want each feature to observe the WCO at most once. I don\u0027t think there\u0027s a limit to the number of \u003cvideo\u003e elements a page might have?",
      "parentUuid": "2c15b8d1_589f9a8f",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 75
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9df66986_47b814b1",
        "filename": "content/browser/media/android/media_player_renderer.h",
        "patchSetId": 6
      },
      "lineNbr": 42,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-16T20:59:49Z",
      "side": 1,
      "message": "Added class comment to MPRWCO",
      "parentUuid": "2838ce5d_92982012",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 75
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "33b35bdf_8263ce55",
        "filename": "content/browser/media/android/media_player_renderer_web_contents_observer.h",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-13T22:21:39Z",
      "side": 1,
      "message": "Unless I\u0027m misunderstanding something key, we don\u0027t need this class at all, right? In other words, why isn\u0027t MediaPlayerRenderer just subclassing WebContentsObserver itself?",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 18,
        "endChar": 74
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9f960dc_c7cdd34b",
        "filename": "content/browser/media/android/media_player_renderer_web_contents_observer.h",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-10-13T22:29:01Z",
      "side": 1,
      "message": "see above",
      "parentUuid": "33b35bdf_8263ce55",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 18,
        "endChar": 74
      },
      "revId": "9a478029ba99c25840fb6dde05428983de921b65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}