{
  "comments": [
    {
      "key": {
        "uuid": "445fbe2f_7819838a",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1355,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "Can you early return here if container is in already_checked?",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "23a0ba4f_ad8b493b",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1355,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "No. Because we insert container into already_checked before using it(at line 1454).",
      "parentUuid": "445fbe2f_7819838a",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6fc0c9ca_07cf476b",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1355,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-16T19:52:57Z",
      "side": 1,
      "message": "Please correct me if I\u0027m wrong:\n\nLine 454 means the container is an iframe, so it marks the iframe element as already_checked; pushes the iframe\u0027s document onto the stack; and continues. \n On the next loop iteration, FindFocusCandidateInContainer is called with the iframe document as the container (not the iframe element).  So it seems like it would be safe to return early if (already_checked.contains(container)), and it would save some unnecessary work.",
      "parentUuid": "23a0ba4f_ad8b493b",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b0d0b424_255804b3",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1355,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-17T11:02:09Z",
      "side": 1,
      "message": "Ah, you are right. We use iframe\u0027s document as a container, not iframe element.\nSo this condition prevents unnecessary work when pruned_sub_tree_root in AdvanceFocusDirectionallyInContainer() is iframe\u0027s document. In that case, FindFocusCandidateInContainer() can find pruned_sub_tree_root as iframe element again. So we can simply out at your condition or we will do unnecessary work again.",
      "parentUuid": "6fc0c9ca_07cf476b",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "33c75fe6_d4b7e77d",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1393,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "This should be a HeapVector\u003cMember\u003cNode\u003e\u003e",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64da4c5c_1b01377a",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1393,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "33c75fe6_d4b7e77d",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "870c4736_f7bc14de",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1417,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "This seems like very odd behavior.  If the scrolling container does not have a focus candidate, why do we scroll it?  And why return here; why not continue looking for a focus candidate outside the current scrolling container?",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4cb05c2a_d0e590cb",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1417,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "\u003e If the scrolling container does not have a focus candidate, why do we scroll it?\n\nImagine following scenario:\n\u003cfocused element\u003e\n\u003cscrolling container\u003e\n  valuable contents inside,\n  but not have focusable element,\n  quite long length.\n\u003c/scrolling container\u003e\n\u003cnext focus candidate\u003e\n\nIn above scenario, spatial navigation try to scroll first to show content inside scrolling container.\n\n\u003e And why return here;\n\nBecause current implementation allows only one action(scroll or focus move) for a input.\n\n\u003e why not continue looking for a focus candidate outside the current scrolling container?\n\nBecause we want to find candidate outside after reaching to edge of current container(fully scroll in direction).",
      "parentUuid": "870c4736_f7bc14de",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d0ebf95_663a8f68",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1417,
      "author": {
        "id": 1245462
      },
      "writtenOn": "2018-01-15T16:37:41Z",
      "side": 1,
      "message": "Yes, spatnav is often used where there is no mouse, so without a mouse pointer/mouse scroll wheel, the user relies on the arrow keys for scrolling.\n\nI see it as spatnav \"takes control\" over the 4 arrow keys. When spatnav can\u0027t find anything to focus nearby, it falls back to scrolling. Here we give the user a chance to scroll the current container line by line because she might want to read some (unfocusable) text between the focusables.\n\nYes, we do continue, but only when the container is already scrolled to its end.",
      "parentUuid": "870c4736_f7bc14de",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c2cd966_ad05e3ce",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1417,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-16T19:52:57Z",
      "side": 1,
      "message": "Thank you for the explanation, that makes sense.\n\nYou should consider, in a future patch, delegating the scrolling behavior to ScrollManager::LogicalScroll, to avoid code duplication and potential differences from the default arrow key scrolling behavior.",
      "parentUuid": "4d0ebf95_663a8f68",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e4d878c_182b3d82",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1417,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-17T11:02:09Z",
      "side": 1,
      "message": "Ack.\nhttps://bugs.chromium.org/p/chromium/issues/detail?id\u003d770147#c12",
      "parentUuid": "3c2cd966_ad05e3ce",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1ad7d7d_85ea2f51",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1426,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "Why just scroll 40 pixels and stop here?  Why not scroll all the way to the candidate?",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4843840c_7ef02f8e",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1426,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "I just added these code to don\u0027t break existing tests.\n\nThe origin of this code is from: https://chromium.googlesource.com/chromium/blink/+/a9562bacebd076981df5eec2d0380cc62d91f566\n\nHonestly, I also cannot understand why this condition must exist. But at least, if we remove is_offscreen_after_scrolling, 5 tests break. For example:\nsnav-iframe-with-offscreen-focusable-element.html\nexpected:\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"end\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"start\"\n\nactual:\nTEST COMPLETE\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"1\"\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was 2.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was end.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was end.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was end.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was end.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was end.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was end.\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"end\"\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"2\"\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was 1.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was start.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was start.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was start.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was start.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 2. Was start.\nFAIL gFocusedDocument.activeElement.getAttribute(\"id\") should be 1. Was start.\nPASS gFocusedDocument.activeElement.getAttribute(\"id\") is \"start\"\n\n\nI also hope make this condition more clear. But I think that is outside of this CL\u0027s scope.",
      "parentUuid": "f1ad7d7d_85ea2f51",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8f2acc7_5b50c9af",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1426,
      "author": {
        "id": 1245462
      },
      "writtenOn": "2018-01-15T16:37:41Z",
      "side": 1,
      "message": "I think this also is to give mouse-less users a chance to scroll and read the document (here inside an iframe) line by line.",
      "parentUuid": "f1ad7d7d_85ea2f51",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "856db518_4f1f7503",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1426,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-16T19:52:57Z",
      "side": 1,
      "message": "Thanks; I understand now.  I don\u0027t really have an opinion about \"correct\" behavior, since I don\u0027t use the feature; but if it\u0027s working as intended, that\u0027s good enough for me.",
      "parentUuid": "a8f2acc7_5b50c9af",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c0ff7d65_28083c47",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1443,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "Same question.",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe5555e2_eb1a7d4d",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1443,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "Please see above answer.",
      "parentUuid": "c0ff7d65_28083c47",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efb6434f_9e0f1606",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1461,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "Same question.",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ff2dd70_0a4cb764",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1461,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "Please see above answer.",
      "parentUuid": "efb6434f_9e0f1606",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c8776af_258bb185",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1508,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-12T23:39:55Z",
      "side": 1,
      "message": "Can you please refactor this slightly:\n\nwhile (container) {\n  consumed \u003d ...;\n  if (consumed)\n    break;\n\nJust a small optimization to avoid an unnecessary layout if the next container is a document.",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f265bca_9252300e",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1508,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-15T12:47:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1c8776af_258bb185",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "192e5c60_e5bd027e",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1508,
      "author": {
        "id": 1001706
      },
      "writtenOn": "2018-01-16T19:52:57Z",
      "side": 1,
      "message": "I don\u0027t see any difference in the latest patch.",
      "parentUuid": "2f265bca_9252300e",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae5042fe_356c4a41",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1508,
      "author": {
        "id": 1245462
      },
      "writtenOn": "2018-01-17T08:11:33Z",
      "side": 1,
      "message": "Sorry. My idea was that we could land starting_rect\u0027s simplification + your suggestion about breaking out if (consumed) prior to landing this larger CL.",
      "parentUuid": "192e5c60_e5bd027e",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0898fd25_1e731bfd",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 21
      },
      "lineNbr": 1508,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-17T11:02:09Z",
      "side": 1,
      "message": "Yes, I moved the change into: https://chromium-review.googlesource.com/c/chromium/src/+/870029/1",
      "parentUuid": "ae5042fe_356c4a41",
      "revId": "32fe40465ec130f29ea6cb08fd469c80a09bc6d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}