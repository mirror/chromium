{
  "comments": [
    {
      "key": {
        "uuid": "2dc0955c_5b01ee99",
        "filename": "chrome/browser/extensions/extension_message_bubble_controller.cc",
        "patchSetId": 7
      },
      "lineNbr": 329,
      "author": {
        "id": 1115745
      },
      "writtenOn": "2017-08-14T20:32:26Z",
      "side": 1,
      "message": "As briefly mentioned in this comment:\nhttps://chromium-review.googlesource.com/c/596528/6/chrome/browser/extensions/extension_message_bubble_controller.cc#340\n\nWe might still need to at least remove the extension registry observer here.  Otherwise, there could be a race condition where we start uninstalling the extension before the bubble is fully closed, which then results in calling the native close callback even though the close process has started.  (In practice, I *think* that both UI implementations of closing are safe to call multiple times, but it\u0027d be better to have this be more deterministic.\n\nSo let\u0027s go ahead and add extension_registry_observer_.RemoveAll() here.",
      "revId": "3fd2ce58e3843367ff9c8a0008cb3c6347f66ec1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86e18232_e576e067",
        "filename": "chrome/browser/extensions/extension_message_bubble_controller.cc",
        "patchSetId": 7
      },
      "lineNbr": 329,
      "author": {
        "id": 1172795
      },
      "writtenOn": "2017-08-14T21:00:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2dc0955c_5b01ee99",
      "revId": "3fd2ce58e3843367ff9c8a0008cb3c6347f66ec1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "69f17e44_e5447b27",
        "filename": "chrome/browser/extensions/extension_message_bubble_controller.cc",
        "patchSetId": 7
      },
      "lineNbr": 329,
      "author": {
        "id": 1172795
      },
      "writtenOn": "2017-08-14T21:12:17Z",
      "side": 1,
      "message": "Restating what your explanation to ensure I understand correctly: It\u0027s possible that as the extension is being uninstalled, an unrelated OnClose() call is being made. In this scenario, there would be a race condition b/c as soon as extension is uninstalled, the native close callback will try to close the bubble too. By removing the extension registry observer in OnClose(), then OnExtensionUnloaded will not be called and we\u0027d prevent the native close callback from being called as well. \n\nAnother conceptual benefit to adding extension_registry_observer_.RemoveAll() here is if the bubble closes due to user action or other factors, we should remove the extension registry observer altogether.",
      "parentUuid": "86e18232_e576e067",
      "revId": "3fd2ce58e3843367ff9c8a0008cb3c6347f66ec1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}