{
  "comments": [
    {
      "key": {
        "uuid": "b7dc63c4_f4a74633",
        "filename": "third_party/WebKit/Source/core/paint/InlineTextBoxPainter.cpp",
        "patchSetId": 9
      },
      "lineNbr": 49,
      "author": {
        "id": 1144165
      },
      "writtenOn": "2017-08-23T20:04:57Z",
      "side": 1,
      "message": "This function might be expensive on long text nodes. In total, we spend time quadratic to the number of markers on this function.\n\nAny way to optimize?\n\nOne idea is to sort the endpoints of suggestion markers. If we scan other markers in sorted order (say, spelling markers), we can maintain the number of overlapping suggestion markers. In this way, the cost is a sorting cost.\n\nWe may want to do some refactoring/optimization to PaintDocumentMarkers(), though. For example, we may want to iterate different marker types separately.",
      "range": {
        "startLine": 49,
        "startChar": 5,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "964d4beb66eedabdc0fec88e53651fc0c75c7079",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d7d6755c_fe1f55c9",
        "filename": "third_party/WebKit/Source/core/paint/InlineTextBoxPainter.cpp",
        "patchSetId": 9
      },
      "lineNbr": 49,
      "author": {
        "id": 1229332
      },
      "writtenOn": "2017-08-23T22:11:33Z",
      "side": 1,
      "message": "The two faster ways I can think of are:\n\n- Put all the start/end point of all suggestion/composition/spelling markers into a vector, sort it by start and end point, then walk the vector and make a list of all the composition and spelling markers that don\u0027t overlap a suggestion marker (so we actually want to paint them). I think this is O(n log n) in the total number of suggestion + composition + spelling markers.\n\n- Build an interval tree of all the intervals marked by a suggestion marker, then query it for each composition and spelling marker. This is O(n log n) to construct (where n is the number of suggestion markers, rather than the total number of suggestion + composition + spelling), then O(log n + m) to query (where m is the number of results returned by the query).\n\nI think the first method is quicker in theory if we expect there to be a ton of overlaps, and the second method is quicker otherwise, since we\u0027re taking the log of a smaller number. The first method seems simpler though, so that\u0027s probably where we\u0027d want to start.\n\n\nAlternatively, instead of doing this check every time we paint, maybe we could make adding a suggestion marker clear all the spelling markers it intersects (since we can get them back by re-running spell check) and all the composition markers it intersects (is this OK?).",
      "parentUuid": "b7dc63c4_f4a74633",
      "range": {
        "startLine": 49,
        "startChar": 5,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "964d4beb66eedabdc0fec88e53651fc0c75c7079",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d9cdb61_867485c3",
        "filename": "third_party/WebKit/Source/core/paint/InlineTextBoxPainter.cpp",
        "patchSetId": 9
      },
      "lineNbr": 49,
      "author": {
        "id": 1144165
      },
      "writtenOn": "2017-08-24T00:07:28Z",
      "side": 1,
      "message": "It seems better to remove other markers when adding a suggestion marker. It\u0027s more intuitive than leaving invisible spelling/composition markers there.\n\nBtw, in any case we won\u0027t need an interval tree since the problem is offline.",
      "parentUuid": "d7d6755c_fe1f55c9",
      "range": {
        "startLine": 49,
        "startChar": 5,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "964d4beb66eedabdc0fec88e53651fc0c75c7079",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c1a1a43_e41697a8",
        "filename": "third_party/WebKit/Source/core/paint/InlineTextBoxPainter.cpp",
        "patchSetId": 9
      },
      "lineNbr": 49,
      "author": {
        "id": 1229332
      },
      "writtenOn": "2017-08-24T01:16:16Z",
      "side": 1,
      "message": "Actually, if we do this, we still have to prevent the other marker types from being re-added on top of a suggestion marker. Does that sound like a reasonable thing to do?",
      "parentUuid": "3d9cdb61_867485c3",
      "range": {
        "startLine": 49,
        "startChar": 5,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "964d4beb66eedabdc0fec88e53651fc0c75c7079",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "afb32390_143a5267",
        "filename": "third_party/WebKit/Source/core/testing/Internals.idl",
        "patchSetId": 9
      },
      "lineNbr": 124,
      "author": {
        "id": 1144165
      },
      "writtenOn": "2017-08-23T20:04:57Z",
      "side": 1,
      "message": "nit: fix indentation.",
      "revId": "964d4beb66eedabdc0fec88e53651fc0c75c7079",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}