{
  "comments": [
    {
      "key": {
        "uuid": "ebac23b5_63b48724",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2018-01-11T19:14:43Z",
      "side": 1,
      "message": "Matt, there is a DCHECK in https://cs.chromium.org/chromium/src/net/socket/client_socket_pool_base.cc?rcl\u003d288809e277eb622527ea5f3798122d8e55bbda98\u0026l\u003d159 which asserts that LOAD_IGNORE_LIMITS is only used with MAXIMUM_PRIORITY.",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a551ddc_b177c7e4",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2018-01-11T19:17:32Z",
      "side": 1,
      "message": "That\u0027s a problem.  We\u0027re going to need to figure out what to do here.  The problem is we don\u0027t want consumers to be subject to socket pool limits, and that\u0027s the only way to avoid them.  But we presumably don\u0027t want to co-opt the shared HostResolver, which respects priorities.  Not currently sure what to do here.",
      "parentUuid": "ebac23b5_63b48724",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "285d8ed7_fc24c731",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2018-01-11T19:19:50Z",
      "side": 1,
      "message": "Can I revert this part of this change and move the discussion off to a crbug?",
      "parentUuid": "6a551ddc_b177c7e4",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0ad749d_8c1fabe6",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2018-01-11T21:42:38Z",
      "side": 1,
      "message": "I reverted this change and filed a follow-up bug at https://bugs.chromium.org/p/chromium/issues/detail?id\u003d801321. This is an orthogonal issue that can be addressed separately, right? let me know if you\u0027d like me to do it in this CL.",
      "parentUuid": "285d8ed7_fc24c731",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c066e0c3_20b73ac0",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2018-01-11T21:47:46Z",
      "side": 1,
      "message": "It depends on how many requests socket_host_tcp makes at once.  If it makes more than 32 total, or more than 6 per host-port-pair, this will significantly affect behavior, since we\u0027re now respecting socket pool limits.  We\u0027d be better off using MAXIMUM_PRIORITY and LOAD_IGNORE_LIMITS than using MEDIUM priority, I think.  I don\u0027t know how many requests this makes, or to how many domains, so have no way of gauging the impact of either option.",
      "parentUuid": "d0ad749d_8c1fabe6",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e9526cb_443344f1",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2018-01-11T21:57:12Z",
      "side": 1,
      "message": "I see. Thanks. Before this isn\u0027t a problem, because the socket is re-creating the HttpNetworkSession every time. Now it is a problem, because the socket pool is being reused.\n\nLet me think about it some more.",
      "parentUuid": "c066e0c3_20b73ac0",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "173939af_351809c1",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2018-01-12T22:23:12Z",
      "side": 1,
      "message": "Sorry for the slow followup.  So, here are some options (Other ideas welcome):\n\n1) Set an option on the socket pools so they effectively have no limit (Either set a bool to disable it, or set the limits themselves, and make them effectively unbounded).  We already have a way to set global socket pool limits (See ClientSocketPoolManager::set_max_sockets_per_group), but could imagine setting it on the HttpNetworkSession instead, which I imagine wouldn\u0027t be too bad.\n2) Allow LOAD_IGNORE_LIMITS with lower priorities (Maybe treat them as HIGHEST priority requests, but use the lower limit for DNS lookups).\n3) Just make these HIGHEST priority and use LOAD_IGNORE_LIMITS, and hope it doesn\u0027t create too many problems.\n4) Add a way to remove sockets from the pool, once we have them.  This would still bound the rate we can establish sockets, unfortunately, and I believe is a lot more complicated to implement than it sounds.\n5) Decide the pool limits are ok.\n\nI think 1 and 3 are our best bets.",
      "parentUuid": "9e9526cb_443344f1",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6666c15_9b9f2164",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1120845
      },
      "writtenOn": "2018-01-16T16:36:50Z",
      "side": 1,
      "message": "Thanks, Matt. I decided to do #3.  I also added a unit test for this.",
      "parentUuid": "173939af_351809c1",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2046dd0e_0dd3b8d5",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2018-01-22T23:10:30Z",
      "side": 1,
      "message": "I\u0027m sorry, I misread this comment as \"I will also add\", so I was waiting for your next CL.  I\u0027ll get to this tomorrow.  Please do feel free to ping if I haven\u0027t said anything for a day or so.",
      "parentUuid": "d6666c15_9b9f2164",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "224b814c_9ce957f3",
        "filename": "net/socket/client_socket_pool_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 409,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2018-01-22T23:11:03Z",
      "side": 1,
      "message": "(That\u0027s in general, not just for the next round on this CL)",
      "parentUuid": "2046dd0e_0dd3b8d5",
      "revId": "b7d8b8269410f53a94d237ffbd7088fef4028973",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}