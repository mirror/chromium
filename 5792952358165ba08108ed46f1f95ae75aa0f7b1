{
  "comments": [
    {
      "key": {
        "uuid": "933997aa_4a502b4d",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/metrics/WebApkUma.java",
        "patchSetId": 3
      },
      "lineNbr": 76,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-13T18:34:39Z",
      "side": 1,
      "message": "\u003e\u003e Xi Han 2017/09/11 15:24:23 You can remove this function now.\n\nThis is called from WebApkUpdateManager#updateNow()",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4702435f_fd385629",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/metrics/WebApkUma.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-13T18:34:39Z",
      "side": 1,
      "message": "\u003e\u003e Xi Han 2017/09/11 15:24:23 You can remove this too.\n\nThis is called from WebApkUpdateManager#scheduleUpdate()",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "102b4f8f_11ad6877",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 27,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-13T18:34:39Z",
      "side": 1,
      "message": "\u003e\u003e Xi Han 2017/09/11 15:24:23\n\u003e\u003e It is worthy mentioning that: the scheduled task will update all WebAPKs that\n\u003e\u003e are out-of-date. It is possible that multiple background tasks are created when\n\u003e\u003e there are multiple webapks are launched and need to be updated, and it is fine\n\u003e\u003e since the background tasks will be executed one by one.\n\nAdded sentence \"Will update multiple ...\"",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b0a8842_eba5f0cb",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 27,
      "author": {
        "id": 1117405
      },
      "writtenOn": "2017-10-13T19:12:14Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "102b4f8f_11ad6877",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0c5f0113_64ba4256",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-10-16T21:10:01Z",
      "side": 1,
      "message": "Callback will be ignored if onStopTaskXXX already happened. There is no point calling it in that case. You can put:\nif (mStopped) return;\non top.",
      "range": {
        "startLine": 65,
        "startChar": 16,
        "endLine": 66,
        "endChar": 65
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac223ec1_f6a572ef",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-18T04:37:32Z",
      "side": 1,
      "message": "Removed mStopped member variable. From reading NativeBackgroundTask#buildStartWithNativeRunnable() it looks like NativeBackgroundTask#onStartTaskWithNative() cannot be called after the tasked has been stopped.",
      "parentUuid": "0c5f0113_64ba4256",
      "range": {
        "startLine": 65,
        "startChar": 16,
        "endLine": 66,
        "endChar": 65
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "90d046ee_efffa0fb",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-10-18T22:52:52Z",
      "side": 1,
      "message": "Your observation is correct. Sequence I was worried about, however, is:\n* onStartTaskWithNative called,\n* task runs out of time, or is terminated by OS, leading to:\n* onStopTaskWithNative, sets mStopped \u003d true; -\u003e Task is finished from the perspective of BTS. \n* Your code finishes and calls the callback, which is going to be ignored.",
      "parentUuid": "ac223ec1_f6a572ef",
      "range": {
        "startLine": 65,
        "startChar": 16,
        "endLine": 66,
        "endChar": 65
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f783f726_3463c4e7",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-22T22:48:59Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "90d046ee_efffa0fb",
      "range": {
        "startLine": 65,
        "startChar": 16,
        "endLine": 66,
        "endChar": 65
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c6c28099_2ea04d4d",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 69,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-10-16T21:10:01Z",
      "side": 1,
      "message": "Please explain to me the logic a little be better.\n\nDo you expect updateManager.updateNow to be called multiple times during a single task execution, or is this callback called when all updates are done (hance only once)?\n\nDo you think it would be unreasonable that you have a callback that accepts a boolean, stating whether there is more work to be done?",
      "range": {
        "startLine": 69,
        "startChar": 32,
        "endLine": 69,
        "endChar": 48
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "01e6f4ad_1d514e43",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 69,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-18T04:37:32Z",
      "side": 1,
      "message": "This is my understanding:\n\nI expect updateManager.updateNow() to be called just once per task execution. However, if there is more work to be done, onStartTaskWithNative() schedules the task to be run again. This will create a new instance of the WebApkUpdateTask and will run updateManager.updateNow() again.\n\nI have changed \"whether there is more work to be done\" to be a class member variable. Hopefully this makes things clearer.",
      "parentUuid": "c6c28099_2ea04d4d",
      "range": {
        "startLine": 69,
        "startChar": 32,
        "endLine": 69,
        "endChar": 48
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cea210a7_f519bd48",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 69,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-10-18T22:52:52Z",
      "side": 1,
      "message": "You are accepting the possibility that the task is scheduled at some point later, is that correct?\n\nI\u0027d put a comment on top of updateNow() call:\n// Updates one WebAPK and finishes indicating if more work is needed.",
      "parentUuid": "01e6f4ad_1d514e43",
      "range": {
        "startLine": 69,
        "startChar": 32,
        "endLine": 69,
        "endChar": 48
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "662c6092_8c320b52",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 69,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-22T22:48:59Z",
      "side": 1,
      "message": "- My understanding is that passing true to the callback causes the task to be rescheduled.\n- I understand that the task will not be rescheduled if it is stopped prior to finishing. I don\u0027t think that this scenario will occur often though",
      "parentUuid": "cea210a7_f519bd48",
      "range": {
        "startLine": 69,
        "startChar": 32,
        "endLine": 69,
        "endChar": 48
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd887497_b4396013",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 112,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-10-16T21:10:01Z",
      "side": 1,
      "message": "I presume that this code does not invoke native anywhere based on being called from  onStartTaskBeforeNativeLoaded. Is that correct?",
      "range": {
        "startLine": 112,
        "startChar": 30,
        "endLine": 112,
        "endChar": 67
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "139c2eaa_8c578a61",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 112,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-18T04:37:32Z",
      "side": 1,
      "message": "That is correct",
      "parentUuid": "dd887497_b4396013",
      "range": {
        "startLine": 112,
        "startChar": 30,
        "endLine": 112,
        "endChar": 67
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cb84784c_af8d32da",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/webapps/WebApkUpdateTask.java",
        "patchSetId": 3
      },
      "lineNbr": 112,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-10-18T22:52:52Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "139c2eaa_8c578a61",
      "range": {
        "startLine": 112,
        "startChar": 30,
        "endLine": 112,
        "endChar": 67
      },
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "edc88dc7_b3807442",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/webapps/WebApkUpdateManagerTest.java",
        "patchSetId": 3
      },
      "lineNbr": 338,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-13T18:34:39Z",
      "side": 1,
      "message": "\u003e\u003e Xi Han 2017/09/11 15:24:23\n\u003e\u003e Nit: add a new line here, and remove line 326.\n\nDone",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f372d0b1_0d17d596",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/webapps/WebApkUpdateManagerTest.java",
        "patchSetId": 3
      },
      "lineNbr": 344,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-13T18:34:39Z",
      "side": 1,
      "message": "\u003e\u003e Xi Han 2017/09/11 15:24:23\n\u003e\u003e Nit: add a new line here.\n\nDone",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2069868a_a5539ac3",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/webapps/WebApkUpdateManagerTest.java",
        "patchSetId": 3
      },
      "lineNbr": 525,
      "author": {
        "id": 1176654
      },
      "writtenOn": "2017-10-13T18:34:39Z",
      "side": 1,
      "message": "\u003e\u003e Xi Han 2017/09/11 15:24:23\n\u003e\u003e The block from line 511 to line 518 looks the same as the block from line 536 to\n\u003e\u003e line 548, can you put them in one helper function like: File\n\u003e\u003e createPendingUpdateFile()?\n\u003e\u003e\n\u003e\u003e If returning a File object doesn\u0027t work for the assumption in line 524, you can\n\u003e\u003e simply return a string in the helper function.\n\nThe block of code isn\u0027t doing just one thing. Most of the lines of code are verifying state instead of modifying state. I did shorten the block of code though.\n\nGiven that this test is all about checking that the file is deleted, I think that checking for the file\u0027s existence in a very explicit way is important\n\n1) I introduced onGotDifferentData() which does\nManifestData manifestData \u003d defaultManifestData();\nmanifestData.name \u003d DIFFERENT_NAME;\nonGotManifestData(updateManager, manifestData);\n\n2) I moved writeRandomTextToFile() into TestWebApkUpdateManager#storeWebApkUpdateRequestToFile()\n\n3) I moved ShadowApplication.getInstance().runBackgroundTasks(); into tryCompletingUpdate()",
      "revId": "5792952358165ba08108ed46f1f95ae75aa0f7b1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}