{
  "comments": [
    {
      "key": {
        "uuid": "b581b925_d61c0a50",
        "filename": "chrome/browser/chrome_network_service_restart_browsertest.cc",
        "patchSetId": 9
      },
      "lineNbr": 252,
      "author": {
        "id": 1166494
      },
      "writtenOn": "2017-12-01T21:03:33Z",
      "side": 1,
      "message": "jam@ I changed CHECK() to Process::Terminate() but the test is becoming flaky on Win bots...\n\nCan I have some help on why this call to |LoadBasicRequest()| may (~60%) hit DCHECK in |disk_cache::BackendImpl::SubstractStorageSize|?\n(It feels to me that the newly restarted Network Service process is trying to clean some invalid entries.)\n\nThe DCHECK only happens when |simple_loader-\u003eDownloadToStringOfUnboundedSizeUntilCrashAndDie()| was issued to the restarted Network Service process.\n\nThanks!\n\nSample Log:\n```\n[4960:5840:1201/122820.824:ERROR:chrome_network_service_restart_browsertest.cc(250)] Finished Flashing NetworkServiceTestPtr\n[4960:5840:1201/122820.824:ERROR:chrome_network_service_restart_browsertest.cc(76)] Begin ChromeNetworkServiceRestartBrowserTest.LoadBasicRequest\n[4960:5840:1201/122820.824:ERROR:chrome_network_service_restart_browsertest.cc(80)] 1. ChromeNetworkServiceRestartBrowserTest.LoadBasicRequest\n[4960:5840:1201/122820.824:ERROR:chrome_network_service_restart_browsertest.cc(83)] 2. ChromeNetworkServiceRestartBrowserTest.LoadBasicRequest\n[4960:5840:1201/122820.824:ERROR:chrome_network_service_restart_browsertest.cc(88)] 3. ChromeNetworkServiceRestartBrowserTest.LoadBasicRequest\n[4960:5840:1201/122820.824:ERROR:chrome_network_service_restart_browsertest.cc(91)] 4. ChromeNetworkServiceRestartBrowserTest.LoadBasicRequest\n[3924:1740:1201/122820.827:WARNING:backend_impl.cc(1823)] Destroying invalid entry.\n[3924:1740:1201/122820.827:ERROR:backend_impl.cc(1844)] BackendImpl::SubstractStorageSize\n[3924:1740:1201/122820.827:ERROR:backend_impl.cc(1845)] base::Process::Current().Pid() \u003d 3924\n[3924:1740:1201/122820.827:FATAL:backend_impl.cc(1847)] Check failed: data_-\u003eheader.num_bytes \u003e\u003d 0 (-4 vs. 0)\nBacktrace:\n\tbase::debug::StackTrace::StackTrace [0x00007FF6563FFB14+36]\n\tlogging::LogMessage::~LogMessage [0x00007FF65635520E+94]\n\tdisk_cache::BackendImpl::SubstractStorageSize [0x00007FF65663BAC9+329]\n\tdisk_cache::BackendImpl::ModifyStorageSize [0x00007FF65663B93B+43]\n\tdisk_cache::EntryImpl::DeleteEntryData [0x00007FF656707B0E+910]\n\tdisk_cache::EntryImpl::~EntryImpl [0x00007FF65670A53F+143]\n\tdisk_cache::EntryImpl::`scalar deleting destructor\u0027 [0x00007FF65670A240+16]\n\tdisk_cache::BackendImpl::MatchEntry [0x00007FF656639D8D+717]\n\tdisk_cache::BackendImpl::OpenEntryImpl [0x00007FF656637FE8+152]\n\tdisk_cache::BackendImpl::SyncOpenEntry [0x00007FF656637EE7+119]\n\tdisk_cache::BackendIO::ExecuteBackendOperation [0x00007FF6566F9526+342]\n\tbase::debug::TaskAnnotator::RunTask [0x00007FF6563FC210+288]\n\tbase::internal::IncomingTaskQueue::RunTask [0x00007FF65641C6BB+123]\n\tbase::MessageLoop::RunTask [0x00007FF656387AA9+665]\n\tbase::MessageLoop::DeferOrRunPendingTask [0x00007FF656387F03+195]\n\tbase::MessageLoop::DoWork [0x00007FF65638816D+557]\n\tbase::MessagePumpForIO::DoRunLoop [0x00007FF6564202DD+173]\n\tbase::MessagePumpWin::Run [0x00007FF65641F415+101]\n\tbase::MessageLoop::Run [0x00007FF6563872F9+201]\n\tbase::RunLoop::Run [0x00007FF6563643C8+248]\n\tbase::Thread::Run [0x00007FF6563A4D35+197]\n\tbase::Thread::ThreadMain [0x00007FF6563A5217+727]\n\tbase::PlatformThread::GetCurrentThreadPriority [0x00007FF65637C439+569]\n\tBaseThreadInitThunk [0x00007FFC0A908364+20]\n\tRtlUserThreadStart [0x00007FFC0CC25E91+33]\nReceived fatal exception EXCEPTION_BREAKPOINT\nBacktrace:\n\tbase::debug::BreakDebugger [0x00007FF656409D6D+13]\n\tlogging::LogMessage::~LogMessage [0x00007FF656355590+992]\n\tdisk_cache::BackendImpl::SubstractStorageSize [0x00007FF65663BAC9+329]\n\tdisk_cache::BackendImpl::ModifyStorageSize [0x00007FF65663B93B+43]\n\tdisk_cache::EntryImpl::DeleteEntryData [0x00007FF656707B0E+910]\n\tdisk_cache::EntryImpl::~EntryImpl [0x00007FF65670A53F+143]\n\tdisk_cache::EntryImpl::`scalar deleting destructor\u0027 [0x00007FF65670A240+16]\n\tdisk_cache::BackendImpl::MatchEntry [0x00007FF656639D8D+717]\n\tdisk_cache::BackendImpl::OpenEntryImpl [0x00007FF656637FE8+152]\n\tdisk_cache::BackendImpl::SyncOpenEntry [0x00007FF656637EE7+119]\n\tdisk_cache::BackendIO::ExecuteBackendOperation [0x00007FF6566F9526+342]\n\tbase::debug::TaskAnnotator::RunTask [0x00007FF6563FC210+288]\n\tbase::internal::IncomingTaskQueue::RunTask [0x00007FF65641C6BB+123]\n\tbase::MessageLoop::RunTask [0x00007FF656387AA9+665]\n\tbase::MessageLoop::DeferOrRunPendingTask [0x00007FF656387F03+195]\n\tbase::MessageLoop::DoWork [0x00007FF65638816D+557]\n\tbase::MessagePumpForIO::DoRunLoop [0x00007FF6564202DD+173]\n\tbase::MessagePumpWin::Run [0x00007FF65641F415+101]\n\tbase::MessageLoop::Run [0x00007FF6563872F9+201]\n\tbase::RunLoop::Run [0x00007FF6563643C8+248]\n\tbase::Thread::Run [0x00007FF6563A4D35+197]\n\tbase::Thread::ThreadMain [0x00007FF6563A5217+727]\n\tbase::PlatformThread::GetCurrentThreadPriority [0x00007FF65637C439+569]\n\tBaseThreadInitThunk [0x00007FFC0A908364+20]\n\tRtlUserThreadStart [0x00007FFC0CC25E91+33]\n[4960:5840:1201/122822.266:ERROR:chrome_network_service_restart_browsertest.cc(94)] Finished ChromeNetworkServiceRestartBrowserTest.LoadBasicRequest\n../../chrome/browser/chrome_network_service_restart_browsertest.cc(252): error:       Expected: net::OK\n      Which is: 0\nTo be equal to: LoadBasicRequest(partition-\u003eGetNetworkContext())\n      Which is: -2\n```\n\nFull Log:\nhttps://logs.chromium.org/v/?s\u003dchromium%2Fbb%2Ftryserver.chromium.win%2Fwin10_chromium_x64_rel_ng%2F39275%2F%2B%2Frecipes%2Fsteps%2Fbrowser_tests__with_patch__on_Windows-10-14393%2F0%2Flogs%2FChromeNetworkServiceRestartBrowserTest.StoragePartitionGetNetworkContext2%2F0",
      "range": {
        "startLine": 252,
        "startChar": 21,
        "endLine": 252,
        "endChar": 37
      },
      "revId": "f5aed3014b066f077b91f057deb141fda5119ddb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}