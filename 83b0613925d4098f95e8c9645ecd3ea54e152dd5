{
  "comments": [
    {
      "key": {
        "uuid": "83a6c971_2800145c",
        "filename": "services/ui/ws/window_manager_display_root.cc",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-06-07T19:56:03Z",
      "side": 1,
      "message": "Is this line necessary? The reason I didn\u0027t update the client_visible_root is that I assumed the window-manager (ash) would handle updating the size of the root. If you update it here, then we may have ordering issues because both the window-manager and mus will attempt to set the size. It should end up ok, but it seems best to let ash deal with this as it already has code for this.",
      "range": {
        "startLine": 69,
        "startChar": 5,
        "endLine": 69,
        "endChar": 21
      },
      "revId": "83b0613925d4098f95e8c9645ecd3ea54e152dd5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7cd14873_6c45675e",
        "filename": "services/ui/ws/window_manager_display_root.cc",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1146978
      },
      "writtenOn": "2017-06-07T20:18:26Z",
      "side": 1,
      "message": "I actually don\u0027t think ash is resizing it\u0027s root window correctly, at the very least ash doesn\u0027t submitting CompositorFrames with the new size. Also, the parent (eg. mus-ws) needs to provide the new LocalSurfaceId to the child (ash) for surface sync as far as I understand.\n\nThe hierarchy looks like this now:\n\n0:2 (owned by ws::Display, corresponds to ws::FrameGenerator, submits CompositorFrames)\n  0:3 (owned by ws::WindowManagerDisplayRoot)\n    1:1 (owned by ash, corresponds to the ash root window and submits CompositorFrames)\n\nThe problem was that 0:3 was getting resized and got the new LocalSurfaceId. 0:3 never submits CompositorFrames though, so that does nothing. \n\nAsh doesn\u0027t seem to submit CompositorFrames with the new size until the parent tells it to.\n\nAt some point in the past I thought that 0:3 was visible in the ash WindowTree and that ash submitted CompositorFrames to FrameSinkId(WindowIdToTransportId(WindowId(0, 3), 0) instead of FrameSinkId(WindowIdToTransportId(WindowId(1, 1)), 0). I\u0027m not sure when that changed.",
      "parentUuid": "83a6c971_2800145c",
      "range": {
        "startLine": 69,
        "startChar": 5,
        "endLine": 69,
        "endChar": 21
      },
      "revId": "83b0613925d4098f95e8c9645ecd3ea54e152dd5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c6de32e_4e1481c4",
        "filename": "services/ui/ws/window_manager_display_root.cc",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-06-07T20:33:42Z",
      "side": 1,
      "message": "I would expect mus to changes the bounds of 0:2 and 0:3. I would expect ash to update the bounds of 1:1 (animations are another cases where mus would update the bounds after a delay). I believe the calls to ash updating the bounds of 1:1 come through via https://cs.chromium.org/chromium/src/ash/host/transformer_helper.cc?q\u003dTransformerHelper\u0026sq\u003dpackage:chromium\u0026dr\u003dCSs\u0026l\u003d114 . Maybe that doesn\u0027t makes it way to a mus correctly?",
      "parentUuid": "7cd14873_6c45675e",
      "range": {
        "startLine": 69,
        "startChar": 5,
        "endLine": 69,
        "endChar": 21
      },
      "revId": "83b0613925d4098f95e8c9645ecd3ea54e152dd5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12bbf493_01621424",
        "filename": "services/ui/ws/window_manager_display_root.cc",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-06-07T20:58:36Z",
      "side": 1,
      "message": "If the call to set the window bounds is being dropped, it could be because I assumed all bounds to the embed point would be routed through WindowTreeHostMus::SetBoundsInPixels.",
      "parentUuid": "6c6de32e_4e1481c4",
      "range": {
        "startLine": 69,
        "startChar": 5,
        "endLine": 69,
        "endChar": 21
      },
      "revId": "83b0613925d4098f95e8c9645ecd3ea54e152dd5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66ef7a0e_8700819d",
        "filename": "services/ui/ws/window_manager_display_root.cc",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1146978
      },
      "writtenOn": "2017-06-07T21:05:52Z",
      "side": 1,
      "message": "So ash does call TransformerHelper::UpdateWindowSize() like you expected. That changes the ash root window size correctly.\n\nThe issue is I think the ui::Compositor is waiting for the parent to tell it a new size and LocalSurfaceId. That never happens, so the CompositorFrames that get submitted are the old size and SurfaceId.",
      "parentUuid": "12bbf493_01621424",
      "range": {
        "startLine": 69,
        "startChar": 5,
        "endLine": 69,
        "endChar": 21
      },
      "revId": "83b0613925d4098f95e8c9645ecd3ea54e152dd5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}