{
  "comments": [
    {
      "key": {
        "uuid": "c14b704a_305e41ab",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 22,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T18:08:49Z",
      "side": 1,
      "message": "It might be nice to name the png_ptr field riffled_palette or rgba_palette, to indicate what it means and match how it\u0027s used in these two functions.  row_tmp is a little noncommittal.",
      "range": {
        "startLine": 22,
        "startChar": 13,
        "endLine": 22,
        "endChar": 55
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "84b655f1_99d05440",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 22,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c14b704a_305e41ab",
      "range": {
        "startLine": 22,
        "startChar": 13,
        "endLine": 22,
        "endChar": 55
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5daaa934_fccfd527",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 32,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T17:55:08Z",
      "side": 1,
      "message": "Any particular reason we do this 8 at a time, not 16 with vld3q_u8 and vst4q_u8?",
      "range": {
        "startLine": 32,
        "startChar": 9,
        "endLine": 32,
        "endChar": 10
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dcb4b12c_d2b3c480",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 32,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "5daaa934_fccfd527",
      "range": {
        "startLine": 32,
        "startChar": 9,
        "endLine": 32,
        "endChar": 10
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "18bd8064_e0a00ffb",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 41,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T17:55:08Z",
      "side": 1,
      "message": "my first thought when reading \"garbage\" was that it was uninitialized, but here it\u0027s actually just 0xff... might want to replace \"garbage\" with \"0xff\" or \"opaque\" or \"phony\"?",
      "range": {
        "startLine": 41,
        "startChar": 16,
        "endLine": 41,
        "endChar": 23
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f6ac9a4_58013501",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 41,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "18bd8064_e0a00ffb",
      "range": {
        "startLine": 41,
        "startChar": 16,
        "endLine": 41,
        "endChar": 23
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0bc32535_ee94c3b9",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 42,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T17:55:08Z",
      "side": 1,
      "message": "Since you\u0027ve already checked above, this might read more clearly as just \"256\"?",
      "range": {
        "startLine": 42,
        "startChar": 19,
        "endLine": 42,
        "endChar": 45
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b036f36e_502bf31b",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 42,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "I hope we can relax the restriction in the future with some more validation.",
      "parentUuid": "0bc32535_ee94c3b9",
      "range": {
        "startLine": 42,
        "startChar": 19,
        "endLine": 42,
        "endChar": 45
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ad08af6_c2a06f5b",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 52,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T17:55:08Z",
      "side": 1,
      "message": "Can we do this all in one pass with something like\n\n  uint8x8x3_t v \u003d vld3_u8((png_const_bytep)(palette + i));\n  vst4_u8(riffled_palette + (i \u003c\u003c 2), (uint8x8x4_t){\n    v.val[0],\n    v.val[1];\n    v.val[2];\n    num_trans \u003d\u003d 256 ? vld1_u8(trans_alpha + i) : vdup_n_u8(0xff)\n  });\n\n?  (Am I right in thinking num_trans is either 0 or 256?)",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6bf531f_8c2a73c7",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 52,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "According to https://www.w3.org/TR/2003/REC-PNG-20031110/#11PLTE (section 11.3.2), num_trans is guaranteed to never be more than the number of palette entries, but it can be less. One pass could work, as the `if (i \u003c num_trans) vld1_u8 else vdup` is likely something all branch predictors can handle.",
      "parentUuid": "6ad08af6_c2a06f5b",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66fb2e37_0d597285",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 80,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T18:08:49Z",
      "side": 1,
      "message": "Did you happen to time the performance of an approach using vld4 and vst4, similar to _rgb() below?\n\nI see that it\u0027s nice and easy here to fill 32-bit lanes with 32-bit pixels, and that vld3/vst3 is more natural/essential for the 24-bit pixels in _rgb(), but it might be interesting to know how that strategy performs even when not so strictly necessary.",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86d53cb0_c63281eb",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 80,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "As far as I can remember I chose the vld1q instruction because (in theory) it reduces execution latency on the A72.",
      "parentUuid": "66fb2e37_0d597285",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c909f0fb_5bc8fd4d",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 103,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T18:08:49Z",
      "side": 1,
      "message": "Same sort of question here as in riffle_palette_rgba()... it seems just as easy to use q-registers and handle 16 pixels at a time.  Why stop at 8?",
      "range": {
        "startLine": 103,
        "startChar": 21,
        "endLine": 103,
        "endChar": 41
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a7523a3_12edce48",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 103,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "I\u0027ll give it a try next week.",
      "parentUuid": "c909f0fb_5bc8fd4d",
      "range": {
        "startLine": 103,
        "startChar": 21,
        "endLine": 103,
        "endChar": 41
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7827dfe3_947753f1",
        "filename": "third_party/libpng/arm/palette_neon_intrinsics.c",
        "patchSetId": 5
      },
      "lineNbr": 131,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "Typo, \"output\"",
      "range": {
        "startLine": 131,
        "startChar": 16,
        "endLine": 131,
        "endChar": 21
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9286f35_eea87121",
        "filename": "third_party/libpng/patches/0000-plte.patch",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1189229
      },
      "writtenOn": "2018-01-02T18:55:28Z",
      "side": 1,
      "message": "This is a note for third_party/libpng/ owners who will be reviewing:\n\nI am not a third_party/libpng/ owner and this would be the first entry into patches/.\nWe do the patches/ thing in third_party/zlib/. It has been there for a while and is a bit of a legacy. It may or may not be what you want to do. The purpose (imho) is to assist in reapplying pulled updates.\n\nIf libpng is updated and we pull it, we\u0027ll want to reapply the patches. It may be difficult to have to do a typical merge if we get too many patches. So rather than apply the libpng update on top of the patches (all of them), you can wipe local libpng when pulling and then reapply the patches one at a time.\n\nThat info can also be found just by getting it from git when the time comes. So it doesn\u0027t really need to be stored as a .patch inside the repo. I think the benefit is when the second upstream pull happens, you don\u0027t have to hunt back to the first time the patch landed each time. Over enough upstream pulls, this could become a game of telephone where the original patch becomes slightly twisted each time.",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9ac82ce_faf83d47",
        "filename": "third_party/libpng/patches/0000-plte.patch",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-02T19:48:13Z",
      "side": 1,
      "message": "Has anyone gotten in touch with Glenn to see about upstreaming this?",
      "parentUuid": "e9286f35_eea87121",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b634e198_ce0f5813",
        "filename": "third_party/libpng/patches/0000-plte.patch",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T17:32:06Z",
      "side": 1,
      "message": "We will try to upstream this optimization to the canonical libpng in the near future.",
      "parentUuid": "f9ac82ce_faf83d47",
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48fee479_4a2150a6",
        "filename": "third_party/libpng/pngrtran.c",
        "patchSetId": 5
      },
      "lineNbr": 4218,
      "author": {
        "id": 1193769
      },
      "writtenOn": "2018-01-05T17:55:08Z",
      "side": 1,
      "message": "This i -\u003e pixel_in_row rewrite seems like more of a style change than one of interesting substance.  Consider reverting it for now?  It\u0027s kind of a different type of change than the more interesting one we\u0027re making here, and might be better upstreamed independently, first or as a follow up.",
      "range": {
        "startLine": 4218,
        "startChar": 15,
        "endLine": 4218,
        "endChar": 27
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "042ab0ae_5fe04ff0",
        "filename": "third_party/libpng/pngrtran.c",
        "patchSetId": 5
      },
      "lineNbr": 4218,
      "author": {
        "id": 1177474
      },
      "writtenOn": "2018-01-05T18:39:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "48fee479_4a2150a6",
      "range": {
        "startLine": 4218,
        "startChar": 15,
        "endLine": 4218,
        "endChar": 27
      },
      "revId": "d9560ad3fa25fa47eb580adf3d582f2ef2292de0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}