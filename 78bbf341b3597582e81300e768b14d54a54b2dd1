{
  "comments": [
    {
      "key": {
        "uuid": "b5325b43_86e3a877",
        "filename": "base/android/java/src/org/chromium/base/JavaHandlerThread.java",
        "patchSetId": 4
      },
      "lineNbr": 67,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-08-11T18:24:46Z",
      "side": 1,
      "message": "idle handler o_O?\n\nwhat precisely is wrong with the old code?",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66f4a756_bd01020c",
        "filename": "base/android/java/src/org/chromium/base/JavaHandlerThread.java",
        "patchSetId": 4
      },
      "lineNbr": 67,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-11T18:57:57Z",
      "side": 1,
      "message": "There are two problems with the old code as far as I can tell.\n1. When we call quitSafely() only the existing tasks are run, and any new tasks posted will fail to be queued, which is different from the behavior on other platforms where we wait for and idle state to shut down.\n2. Using quit()/quitSafely() doesn\u0027t give us a change to run doIdleWork before the thread is stopped, so the run loop and message pump aren\u0027t given a chance to quit.\n\nUsing the idle handler guarantees that this runs after the run loop has quit.",
      "parentUuid": "b5325b43_86e3a877",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24892e8e_179b0c6f",
        "filename": "base/android/java/src/org/chromium/base/JavaHandlerThread.java",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-08-11T18:24:46Z",
      "side": 1,
      "message": "mention that delayed tasks are delivered (same as quitSafely)",
      "range": {
        "startLine": 70,
        "startChar": 31,
        "endLine": 70,
        "endChar": 45
      },
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72a74491_c55914c3",
        "filename": "base/android/java/src/org/chromium/base/JavaHandlerThread.java",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-11T18:57:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "24892e8e_179b0c6f",
      "range": {
        "startLine": 70,
        "startChar": 31,
        "endLine": 70,
        "endChar": 45
      },
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3cb53768_2aac3775",
        "filename": "base/android/java/src/org/chromium/base/JavaHandlerThread.java",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-08-11T19:54:57Z",
      "side": 1,
      "message": "\u003e Done\n\nOh darn, I forgot a \"not\" in my comment... delayed tasks are *not* delivered, which is same as quitSafely",
      "parentUuid": "72a74491_c55914c3",
      "range": {
        "startLine": 70,
        "startChar": 31,
        "endLine": 70,
        "endChar": 45
      },
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c056c948_a7a9ae83",
        "filename": "base/android/java/src/org/chromium/base/JavaHandlerThread.java",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-14T19:14:14Z",
      "side": 1,
      "message": "Oh, sorry yes I was wrong. Delayed tasks are not delivered regardless. I\u0027ve updated the comment.",
      "parentUuid": "3cb53768_2aac3775",
      "range": {
        "startLine": 70,
        "startChar": 31,
        "endLine": 70,
        "endChar": 45
      },
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5041eec5_1a9a2ab7",
        "filename": "base/android/java/src/org/chromium/base/SystemMessageHandler.java",
        "patchSetId": 4
      },
      "lineNbr": 39,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-08-11T18:24:46Z",
      "side": 1,
      "message": "this looks like an independent change? pull out into a different CL?",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cd11ea2d_01b93d2f",
        "filename": "base/android/java/src/org/chromium/base/SystemMessageHandler.java",
        "patchSetId": 4
      },
      "lineNbr": 39,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-11T18:57:57Z",
      "side": 1,
      "message": "It\u0027s a necessary change to fix the shutdown ordering, the old code to handle handle Idle periods was wrong and would frequently fail to get called even when we did go idle. We need Idle periods to be detected correctly so that the run loop can actually quit when idle and not hang around indefinitely.\n\nI could move all of the base changes into a separate CL from the vr-specific changes if you would prefer.",
      "parentUuid": "5041eec5_1a9a2ab7",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "faabd7bf_1e038ff7",
        "filename": "base/android/java_handler_thread.h",
        "patchSetId": 4
      },
      "lineNbr": 60,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-08-11T18:24:46Z",
      "side": 1,
      "message": "Hmm... what happens if this is using the second constructor to an already running looper?\n\nMaybe rename these to OnMessageLoopStarted/Stopped, and mention that it says nothing about state of the java looper.",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8559e69_54081bd4",
        "filename": "base/android/java_handler_thread.h",
        "patchSetId": 4
      },
      "lineNbr": 60,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-11T18:57:57Z",
      "side": 1,
      "message": "I called these Init() and Cleanup() because they\u0027re semantically the same as Init/Cleanup for base::Thread. I guess the comment about \u0027running\u0027 the message loop is wrong.\n\nI\u0027ve added more commentary, but kept the names as-is. Feel free to insist on changing them though.",
      "parentUuid": "faabd7bf_1e038ff7",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "29443b41_5b481cac",
        "filename": "base/android/java_handler_thread.h",
        "patchSetId": 4
      },
      "lineNbr": 60,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-08-11T19:54:57Z",
      "side": 1,
      "message": "\u003e I called these Init() and Cleanup() because they\u0027re semantically the same as Init/Cleanup for base::Thread. I guess the comment about \u0027running\u0027 the message loop is wrong.\n\u003e \n\u003e I\u0027ve added more commentary, but kept the names as-is. Feel free to insist on changing them though.\n\nthat\u0027s fine",
      "parentUuid": "a8559e69_54081bd4",
      "revId": "78bbf341b3597582e81300e768b14d54a54b2dd1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}