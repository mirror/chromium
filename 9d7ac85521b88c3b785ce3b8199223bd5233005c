{
  "comments": [
    {
      "key": {
        "uuid": "e102d7e3_501717c4",
        "filename": "chrome/browser/chrome_network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 67,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-09T20:43:07Z",
      "side": 1,
      "message": "Should also test g_browser_process()-\u003esystem_network_context_manager()\u0027s NetworkContext.",
      "range": {
        "startLine": 67,
        "startChar": 23,
        "endLine": 67,
        "endChar": 60
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0353d055_5b6b06e1",
        "filename": "chrome/browser/chrome_network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 67,
      "author": {
        "id": 1166494
      },
      "writtenOn": "2017-11-09T21:37:37Z",
      "side": 1,
      "message": "I was planning to patch other |NetworkContext| providers in several CLs to keep each CL smaller, but sure I can change this CL to cover all |NetworkContext| providers if that could make the logic cleaner.",
      "parentUuid": "e102d7e3_501717c4",
      "range": {
        "startLine": 67,
        "startChar": 23,
        "endLine": 67,
        "endChar": 60
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "809e7fbb_8f83cfa7",
        "filename": "chrome/browser/chrome_network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 85,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-09T20:43:07Z",
      "side": 1,
      "message": "I\u0027m rather surprised this works - I want to dig into this a little myself to better understand it.",
      "range": {
        "startLine": 85,
        "startChar": 38,
        "endLine": 85,
        "endChar": 47
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "319c2523_2052b88d",
        "filename": "chrome/browser/chrome_network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 85,
      "author": {
        "id": 1166494
      },
      "writtenOn": "2017-11-09T21:37:37Z",
      "side": 1,
      "message": "Sure. It feels to me that we are only retrieving some info from Profile while setting up new NetworkContext.",
      "parentUuid": "809e7fbb_8f83cfa7",
      "range": {
        "startLine": 85,
        "startChar": 38,
        "endLine": 85,
        "endChar": 47
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85675653_dba2e232",
        "filename": "content/browser/network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 52,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-09T20:43:07Z",
      "side": 1,
      "message": "I think these tests may be racy - are we guaranteed that the network context pipe has noticed that it\u0027s been shut down by the time FlushForTesting() completes?  We may have to call FlushForTesting() on the NetworkContext, too.  That will either get the new NetworkContext, and do basically nothing, or get the old NetworkContext, and wait until it crashes.  Or are we guaranteed that we learn about the NetworkContext\u0027s death at the same time we learn about the NetworkServiceTest\u0027s death?",
      "range": {
        "startLine": 52,
        "startChar": 43,
        "endLine": 52,
        "endChar": 0
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b3e1711_a9990a76",
        "filename": "content/browser/network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 52,
      "author": {
        "id": 1166494
      },
      "writtenOn": "2017-11-09T21:37:37Z",
      "side": 1,
      "message": "My understanding is that |NetworkContext| pipe won\u0027t notice it\u0027s death until one of:\n  1. network_context.FlushForTesting(), or\n  2. LoadBasicRequest(network_context)\nwas called.\n\nMy tests are relying on |LoadBasicRequest()|, where |NetworkContext| pipe could still be open at first, but the connection will eventually fail and |SimpleURLLoader| will handle connection error as |net::ERR_FAILED|.\n\nDoes that make sense?",
      "parentUuid": "85675653_dba2e232",
      "range": {
        "startLine": 52,
        "startChar": 43,
        "endLine": 52,
        "endChar": 0
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "596a4cc6_ecc2d0dc",
        "filename": "content/browser/network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 52,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-09T21:54:02Z",
      "side": 1,
      "message": "It does, though I\u0027m not sure its accurate.  Namely, I\u0027m not sure if the NetworkContext\u0027s notices if the pipe is closed by a crash.  I suspect it is.  Regardless of that, though, I\u0027m now convinced that NetworkServiceProcessRecovery is non-racy.  I\u0027m not sure about the other test, however.",
      "parentUuid": "6b3e1711_a9990a76",
      "range": {
        "startLine": 52,
        "startChar": 43,
        "endLine": 52,
        "endChar": 0
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac6f2210_f3cf8ca4",
        "filename": "content/browser/network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 93,
      "author": {
        "id": 1166494
      },
      "writtenOn": "2017-11-09T21:37:37Z",
      "side": 1,
      "message": "|encountered_error()| would be false if I don\u0027t run |LoadBasicRequest()| or |network_context.FlushForTesting()| first.",
      "range": {
        "startLine": 93,
        "startChar": 30,
        "endLine": 93,
        "endChar": 47
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86105bae_84b96f09",
        "filename": "content/browser/network_service_restart_browsertest.cc",
        "patchSetId": 4
      },
      "lineNbr": 115,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-09T21:54:02Z",
      "side": 1,
      "message": "SimulateNetworkServiceCrash spins the RunLoop...So if anything else touches partition-\u003eGetNetworkContext() in the mean time, there\u0027s a chance we\u0027ll notice it was destroyed and make a new one.  That would result in deleting network_context, and lead to a use-after-free crash.\n\nI don\u0027t think this is an issue with the above test, because we own the NetworkContextPtr (And you\u0027re right about why there\u0027s no race).",
      "range": {
        "startLine": 115,
        "startChar": 29,
        "endLine": 115,
        "endChar": 30
      },
      "revId": "9d7ac85521b88c3b785ce3b8199223bd5233005c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}