{
  "comments": [
    {
      "key": {
        "uuid": "871e6a8f_011dd1b3",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/document/ChromeLauncherActivity.java",
        "patchSetId": 3
      },
      "lineNbr": 408,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-03T18:22:16Z",
      "side": 1,
      "message": "nit: unnecessary change?",
      "range": {
        "startLine": 406,
        "startChar": 8,
        "endLine": 408,
        "endChar": 46
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dee895ae_59cdf23e",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/ChromeTabbedActivityVrLaunch.java",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-01T00:17:23Z",
      "side": 1,
      "message": "@Ted/Yusuf, note that adding this class should have no UI / visual changes to the user when they\u0027re using Chrome in standard 2D mode, except for one thing which is worth pointing out.\n\nSo the main gist of this CL is to start a CTA subclass with the \"android:windowDisablePreview:true\" attribute so that the system UI doesn\u0027t show when android is showing the preview window. This has the side-effect that when CTAVrLaunch is used for 2D browsing (e.g after they exit VR mode), we may loose the benefit of the \"android:windowDisablePreview:true\". But here\u0027s why I think this is okay:\n- The preview window is only helpful on slow devices. This activity will only be ON for Daydream enabled devices (pixel / pixel xl) which seem to be pretty fast.\n- I believe android shows the preview window only when its spinning up the process because it could take a while. FWIW, I tried locally with the \"Don\u0027t keep activities\" developer setting and didn\u0027t see any visual difference at all.\n- This only happens when CTA-VR is actually running in the background and we get a 2D intent. The subset of users is really small. We can actually make it smaller by killing Chrome for cases when the user goes back to Daydream instead of exiting VR into Chrome (which is probably the more common case). But I don\u0027t think we should do that unless we find that we really have to.\n\nThis is one of those cases where the culprit is really the android platform. Apps with VR mode enabled shouldn\u0027t have to do these hacks to hide the system UI (other VR apps also do this). I\u0027ll be making a feature request to hide the system UI for this case, but I don\u0027t think we want to block on that.\n\nThe best long term solution is probably truly sharing the tab state, so that this VR activity is only used for VR browsing and not 2D browsing. We probably don\u0027t want to block on that either :)\n\nWould this approach be okay given the things above?",
      "range": {
        "startLine": 26,
        "startChar": 13,
        "endLine": 26,
        "endChar": 41
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "feb77f7f_cbc62e8b",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/ChromeTabbedActivityVrLaunch.java",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 1116074
      },
      "writtenOn": "2017-08-07T23:44:37Z",
      "side": 1,
      "message": "I will leave it to Ted to comment on policy and what we can tolerate as behavior change on 2D use.\n\nThings that do worry me about this approach:\n\n-Although we are assuming this behavior relates to cold starts on devices we test, in other devices, OEMs may use this feature for other purposes and we might be breaking the 2D flow in unintended ways.\n- More than the initial point, adding this \"getTabbedActivityClassToUseRightNow\" on top of the MultiWindow functionality worries me quite a bit. I would very much expect us to have a trail of getActivity, getClass failure bugs as a result of this in various flows and we may have to use the new convenience calls you are adding in a lot of places.\n\nThat is why I am still liking the idea of adding a VR mode only activity that will be launched for VR only and reparent/merge the tab in use and then not change any 2D related logic.\n\nAll that said, I know Ted has been involved with VR changes already from the start, so if you can find a way to address any worries he has about this, consider me convinced as well.",
      "parentUuid": "dee895ae_59cdf23e",
      "range": {
        "startLine": 26,
        "startChar": 13,
        "endLine": 26,
        "endChar": 41
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "63cedd6c_99f83b55",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/ChromeTabbedActivityVrLaunch.java",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 1144349
      },
      "writtenOn": "2017-08-08T14:28:59Z",
      "side": 1,
      "message": "\u003e I will leave it to Ted to comment on policy and what we can tolerate as behavior change on 2D use.\n\u003e \n\u003e Things that do worry me about this approach:\n\u003e \n\u003e -Although we are assuming this behavior relates to cold starts on devices we test, in other devices, OEMs may use this feature for other purposes and we might be breaking the 2D flow in unintended ways.\n\nThis is a good point. We can probably mitigate some of this risk by killing Chrome when the user returns to Daydream. That way, we apply this behavior only during VR cold start, which is probably fine because other VR apps do this anyway. There\u0027s still the case for exiting VR and using standard Chrome for 2D browsing, and we can\u0027t kill Chrome then.\n\n\u003e - More than the initial point, adding this \"getTabbedActivityClassToUseRightNow\" on top of the MultiWindow functionality worries me quite a bit. I would very much expect us to have a trail of getActivity, getClass failure bugs as a result of this in various flows and we may have to use the new convenience calls you are adding in a lot of places.\n\nI\u0027m also a bit worried about this, but I expect that the fix should be fairly straightforward? Since the change hooks into ChromeLauncherActivity, which globally handles all intents for Chrome and CTA, I can\u0027t think of cases where this would break for intents. RE \"getActivity\" and \"getClass\", I did a code search for \"ChromeTabbedActivity.class\", and tried to use the convenience methods where it seemed appropriate. Can you think of any cases off the top of your head that I may have missed? \n\n\u003e That is why I am still liking the idea of adding a VR mode only activity that will be launched for VR only and reparent/merge the tab in use and then not change any 2D related logic.\n\u003e \n\nIIUC, the main problem here is that we won\u0027t get the previously open tabs? Perhaps you could reparent/merge the old tabs into the new instance and undo that upon exiting VR. There\u0027s still the issue of when to reparent in the case where the user opens Chrome from Daydream in VR mode and returns to Daydream while still in VR. In this case, we lose the benefit of Chrome running in the recent tasks (because we\u0027d have to do something like reparent on resume and start non-VR CTA which may also look weird in terms of UX). I can explore that solution if Ted doesn\u0027t prefer the current solution either, but getting the UX right along with the desired behavior may be tricky.\n\n\u003e All that said, I know Ted has been involved with VR changes already from the start, so if you can find a way to address any worries he has about this, consider me convinced as well.",
      "parentUuid": "feb77f7f_cbc62e8b",
      "range": {
        "startLine": 26,
        "startChar": 13,
        "endLine": 26,
        "endChar": 41
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3e90e5fb_8919f10c",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/ChromeTabbedActivityVrLaunch.java",
        "patchSetId": 3
      },
      "lineNbr": 41,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-03T18:22:16Z",
      "side": 1,
      "message": "If you register the change listener before you set the UI visibility, aren\u0027t you just overriding mRestoreSystemUiVisibilityFlag with the visibility we set?",
      "range": {
        "startLine": 41,
        "startChar": 12,
        "endLine": 41,
        "endChar": 61
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "488abb7d_b52e9c1a",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/ChromeTabbedActivityVrLaunch.java",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-03T18:22:16Z",
      "side": 1,
      "message": "This has to be wrong...",
      "range": {
        "startLine": 53,
        "startChar": 41,
        "endLine": 53,
        "endChar": 74
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16fdd356_2d8c69ab",
        "filename": "chrome/android/java/src/org/chromium/chrome/browser/vr_shell/ChromeTabbedActivityVrLaunch.java",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-08-03T18:22:16Z",
      "side": 1,
      "message": "nit: remove this?",
      "range": {
        "startLine": 66,
        "startChar": 15,
        "endLine": 66,
        "endChar": 30
      },
      "revId": "30be6cee30f35605d950381ea98f38946065b288",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}