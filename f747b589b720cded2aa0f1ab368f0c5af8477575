{
  "comments": [
    {
      "key": {
        "uuid": "dbd1e63b_3b1f16ae",
        "filename": "net/disk_cache/simple/simple_backend_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 326,
      "author": {
        "id": 1116284
      },
      "writtenOn": "2017-12-12T17:48:19Z",
      "side": 1,
      "message": "spacing",
      "range": {
        "startLine": 326,
        "startChar": 5,
        "endLine": 326,
        "endChar": 10
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "18cda483_f96e8630",
        "filename": "net/disk_cache/simple/simple_backend_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 326,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-12T18:22:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dbd1e63b_3b1f16ae",
      "range": {
        "startLine": 326,
        "startChar": 5,
        "endLine": 326,
        "endChar": 10
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e7adbd21_c61c4f98",
        "filename": "net/disk_cache/simple/simple_entry_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 1240,
      "author": {
        "id": 1116284
      },
      "writtenOn": "2017-12-12T16:29:38Z",
      "side": 1,
      "message": "Hmm, can\u0027t I call:\n\nA-\u003eClose();\nA-\u003eDoom();  // while close operation is processing\n\nAnd then DoomEntryInternal won\u0027t run until Close completes. So it seems like we could be in the entry method.",
      "range": {
        "startLine": 1240,
        "startChar": 7,
        "endLine": 1240,
        "endChar": 77
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "482c1d84_69ecbcee",
        "filename": "net/disk_cache/simple/simple_entry_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 1240,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-12T16:44:46Z",
      "side": 1,
      "message": "Not supposed to use a pointer to an entry after calling close on it, since it\u0027s a potentially-deleting op. And I think aliases don\u0027t matter since Close doesn\u0027t actually do anything until you\u0027re closing the last one.",
      "parentUuid": "e7adbd21_c61c4f98",
      "range": {
        "startLine": 1240,
        "startChar": 7,
        "endLine": 1240,
        "endChar": 77
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bbc6435c_359113e6",
        "filename": "net/disk_cache/simple/simple_entry_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 1240,
      "author": {
        "id": 1116284
      },
      "writtenOn": "2017-12-12T17:48:19Z",
      "side": 1,
      "message": "Fair enough, though I think the docs should explicitly state that after calling Close() the entry shouldn\u0027t be used again.",
      "parentUuid": "482c1d84_69ecbcee",
      "range": {
        "startLine": 1240,
        "startChar": 7,
        "endLine": 1240,
        "endChar": 77
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d6931a8_0f8d1dd7",
        "filename": "net/disk_cache/simple/simple_entry_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 1240,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-12T18:22:38Z",
      "side": 1,
      "message": "Hmm. I\u0027ve checked what they actually say, and I need to rethink it: they mention that callbacks can be invoked after close; and probably it would be OK for such a callback to call Doom, won\u0027t it? Need to gives this another round of thinking...",
      "parentUuid": "bbc6435c_359113e6",
      "range": {
        "startLine": 1240,
        "startChar": 7,
        "endLine": 1240,
        "endChar": 77
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb8f58a2_4cb559d4",
        "filename": "net/disk_cache/simple/simple_entry_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 1240,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-13T16:27:19Z",
      "side": 1,
      "message": "So an alternative to thinking so hard would be to revive this ---\nhttps://chromium-review.googlesource.com/c/chromium/src/+/695762/5..6\nWDYT?\n(with some comments revisions, also DCHECKs that Create/Open aren\u0027t called on an entry in doomed state).",
      "parentUuid": "4d6931a8_0f8d1dd7",
      "range": {
        "startLine": 1240,
        "startChar": 7,
        "endLine": 1240,
        "endChar": 77
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9120d15f_bf47eb3f",
        "filename": "net/disk_cache/simple/simple_entry_impl.cc",
        "patchSetId": 18
      },
      "lineNbr": 1240,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-14T15:35:42Z",
      "side": 1,
      "message": "\u003e also DCHECKs that Create/Open aren\u0027t called on an entry in doomed state).\n\nSo turns out this can happen, before this CL, under following interleaving:\n\n1. I/O thread: some op (read/write) is dispatched to a disk thread.\n2. disk thread: begin disk I/O\n3. I/O thread: CreateEntry called on same key. The entry is in active_entries_, so it just \n   queues up a CreateEntryInternal on its big queue\n4. disk thread: disk I/O failed, doom the entries files, and report failure to I/O thread\n5. I/O thread: notice op failed, mark self as doomed, removing from active_entries_\n6. CreateEntryInternal runs, and since the state isn\u0027t STATE_UNITIALIZED (it\u0027s STATE_FAILED),\n   just returns the entry out to the caller of CreateEntry. Since it\u0027s in STATE_FAILED, all \n   ops will fail on it.\n\nNot immediately sure what to do about it yet, and even if it\u0027s completely a bug. \n\nNote that this can\u0027t happen if the doom is initiated on the I/O thread, since that yanks the entry out of active_entries_  immediately. (The weird/hard-to-think-about case are when both happen though)...",
      "parentUuid": "fb8f58a2_4cb559d4",
      "range": {
        "startLine": 1240,
        "startChar": 7,
        "endLine": 1240,
        "endChar": 77
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "04054ea2_7fd71b9d",
        "filename": "net/disk_cache/simple/simple_synchronous_entry.cc",
        "patchSetId": 18
      },
      "lineNbr": 1140,
      "author": {
        "id": 1116284
      },
      "writtenOn": "2017-12-12T17:48:19Z",
      "side": 1,
      "message": "This condition needs braces.",
      "range": {
        "startLine": 1137,
        "startChar": 0,
        "endLine": 1140,
        "endChar": 17
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87f1bdfd_3ec6dc17",
        "filename": "net/disk_cache/simple/simple_synchronous_entry.cc",
        "patchSetId": 18
      },
      "lineNbr": 1140,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-12T18:22:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "04054ea2_7fd71b9d",
      "range": {
        "startLine": 1137,
        "startChar": 0,
        "endLine": 1140,
        "endChar": 17
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32b54df3_ad1502b5",
        "filename": "net/disk_cache/simple/simple_synchronous_entry.h",
        "patchSetId": 18
      },
      "lineNbr": 181,
      "author": {
        "id": 1116284
      },
      "writtenOn": "2017-12-12T17:48:19Z",
      "side": 1,
      "message": "Also add that the renamed file will be deleted once the entry is closed.",
      "range": {
        "startLine": 181,
        "startChar": 40,
        "endLine": 181,
        "endChar": 0
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dbd1a2fb_e697ed81",
        "filename": "net/disk_cache/simple/simple_synchronous_entry.h",
        "patchSetId": 18
      },
      "lineNbr": 181,
      "author": {
        "id": 1226494
      },
      "writtenOn": "2017-12-12T18:22:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "32b54df3_ad1502b5",
      "range": {
        "startLine": 181,
        "startChar": 40,
        "endLine": 181,
        "endChar": 0
      },
      "revId": "f747b589b720cded2aa0f1ab368f0c5af8477575",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}