{
  "comments": [
    {
      "key": {
        "uuid": "1be01ee8_368aa458",
        "filename": "content/browser/frame_host/render_frame_proxy_host.cc",
        "patchSetId": 6
      },
      "lineNbr": 359,
      "author": {
        "id": 1118209
      },
      "writtenOn": "2017-08-29T01:11:28Z",
      "side": 1,
      "message": "Just to make sure I understand this.  If we\u0027re hitting TAB to move focus from embedder into a \u003cwebview\u003e, previously as part of target_rfh-\u003eAdvanceFocus(), the webview would\u0027ve sent FrameHostMsg_FrameFocused, which called SetFocusedFrame, which gave focus to the webview.  Now, that won\u0027t work since the source SiteInstance will be the webview SiteInstance and not the embedder\u0027s SiteInstance, so it won\u0027t pass your new check in SetFocusedFrame.  Hence, you focus the webview explicitly here.  Is that right?  Might be good to document some of this in a comment.",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87295454_6c2b14c4",
        "filename": "content/browser/frame_host/render_frame_proxy_host.cc",
        "patchSetId": 6
      },
      "lineNbr": 359,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-08-29T18:24:40Z",
      "side": 1,
      "message": "Yes, that\u0027s exactly how it works. I\u0027ve added a comment to WebContentsImpl::OnAdvanceFocus documenting this.",
      "parentUuid": "1be01ee8_368aa458",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6dadd323_52d96ad7",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5266,
      "author": {
        "id": 1118209
      },
      "writtenOn": "2017-08-29T01:11:28Z",
      "side": 1,
      "message": "Does window.focus() on a webview use this branch or the next one?  Might be worth mentioning in the corresponding comment, so it\u0027s easier to understand this code in the future.",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b03e3254_4b2a8bba",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5266,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-08-29T18:24:40Z",
      "side": 1,
      "message": "Calling focus() on the webview uses the next code path (where node is the main frame of the guest). I don\u0027t think we have any code path that actually uses this path, which is calling SetFocusedFrame(node, source) where node is the node in the embedder\u0027s FrameTree.\n\nThat said, this should be the correct implementation -- we should focus the inner contents in this case. I\u0027ve expanded the comment below to clear this.",
      "parentUuid": "6dadd323_52d96ad7",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a3a1a4e_13ba56e4",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5273,
      "author": {
        "id": 1118209
      },
      "writtenOn": "2017-08-29T01:11:28Z",
      "side": 1,
      "message": "It likely doesn\u0027t matter, but is |node| necessarily the main FrameTreeNode for the inner contents?  (it\u0027s not verified in the if statement)",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8ca1d80_d9d9a313",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5273,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-08-29T18:24:40Z",
      "side": 1,
      "message": "Yes, it\u0027s always the main FrameTreeNode, but as you mention it wouldn\u0027t really matter.\n\nThe reason it\u0027s always the main frame is that for \u003cwebview\u003es, the embedder process only sees one RenderFrameProxy (we don\u0027t replicate the FrameTree). Since the if statement verifies that the source SiteInstance is in the embedder\u0027s FrameTree, it follows that the node has to be the main frame of the guest.",
      "parentUuid": "3a3a1a4e_13ba56e4",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "afb3792a_1bc86245",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5277,
      "author": {
        "id": 1118209
      },
      "writtenOn": "2017-08-29T01:11:28Z",
      "side": 1,
      "message": "If an embedder has two webviews, webview1 is focused, and embedder executes document.querySelector(\u0027webview2\u0027).focus(), what should happen? :)\n\nShould the embedder be able to steal focus from the first webview and give it to the second webview?  If so, do we need this check?",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6bfe0c78_74d10c6d",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5277,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-08-29T18:24:40Z",
      "side": 1,
      "message": "I\u0027ve checked this, and surprisingly it already works and the embedder is allowed to steal focus from the guest.\n\nThis happens because \u003cwebview\u003e is a custom element, so calling webview.focus() will first focus the frame that contains the webview, then dispatches the \u003cwebview\u003e\u0027s custom focus implementation which calls focus on the remote iframe. So, the browser process gets a FrameFocused IPC from the embedder frame, which is allowed by the outermost contents below, and then another FrameFocused IPC from the proxy, which is also allowed by this branch.",
      "parentUuid": "afb3792a_1bc86245",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0641ba14_89810d9d",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5319,
      "author": {
        "id": 1118209
      },
      "writtenOn": "2017-08-29T01:11:28Z",
      "side": 1,
      "message": "I was wondering whether we need any additional test coverage for this, but looks like existing tests already cover it, like Focus_AdvanceFocus and Focus_FocusTakeFocus?",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31ec976a_c5d22a41",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 5319,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-08-29T18:24:40Z",
      "side": 1,
      "message": "Yes, I\u0027ve learned that I had to handle this due to the failing tests :).",
      "parentUuid": "0641ba14_89810d9d",
      "revId": "e5ca39ec74c77d08dbe2f591595703e535684baf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}