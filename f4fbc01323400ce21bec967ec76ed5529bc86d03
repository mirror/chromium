{
  "comments": [
    {
      "key": {
        "uuid": "2c041c05_34ae25d6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 24,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "This might not be always the case. Wallpaper Picker App has a direct call to reset the default wallpaper, see https://cs.chromium.org/chromium/src/chrome/browser/resources/chromeos/wallpaper_manager/js/wallpaper_manager.js?rcl\u003d5aad0df3b1f9e508f77bc6011fe7e82b2643c598\u0026l\u003d622",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07695223_63b6ef57",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 24,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-10-30T19:06:02Z",
      "side": 1,
      "message": "Although there seem to be many use cases of setting default wallpaper directly, if we look deeper, none of them really need that. The name of \u0027set default wallpaper\u0027 is misused multiple times.\n\nNote that there are three functions in wallpaper_manager:\n\n1) SetDefaultWallpaper (called twice, one of them is the link you provided, the other place is in arc_wallpaper_service.cc)\n\n2) SetDefaultWallpaperNow (only called internally)\n\n3) SetDefaultWallpaperDelayed (called only once publicly, which is from LoadSigninWallpaper)\n\nI combined 2) and 3) in another CL. But after combination it\u0027s still unclear what their difference with 1) is based on the names.\n\nThe actual difference is: in 1) it deletes the custom user wallpaper first, and may/may not set a default wallpaper (one caller does, the other does not).\n\nIn 2), it only sets the default wallpaper once for this user, and does not touch the user\u0027s wallpaper info. It\u0027s just a one-time thing.\n\nSo I think it makes sense to distinguish these two, although both of them is named as \u0027set default wallpaper\u0027, their use cases are different. \u0027SetDefaultWallpaper\u0027 may not be a proper name in the first place.\n\nFor 1) it should be renamed to something like \u0027delete wallpaper\u0027 as that\u0027s the main thing this function is doing.\n\nFor 2) we should realize that the only place that it\u0027s used publicly (i.e. when client actually needs to set the default wallpaper for one time) is the sign-in wallpaper (See https://cs.chromium.org/chromium/src/chrome/browser/chromeos/login/ui/webui_login_display.cc?type\u003dcs\u0026q\u003dloadsigninwallpaper\u0026sq\u003dpackage:chromium\u0026l\u003d232)\n\nAs we\u0027ve discussed, it can be replaced by SetUserWallpaper or SetSigninWallpaper. Anyways, it should not contain \u0027default\u0027 anymore because it also contains the device policy logic.\n\nSo that\u0027s why we can remove the use cases of setting default wallpaper.",
      "parentUuid": "2c041c05_34ae25d6",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3891c620_3628479b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 24,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "Added SetDefaultWallpaper back after offline discussion.",
      "parentUuid": "07695223_63b6ef57",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9211b18a_f2cc7c40",
        "filename": "chrome/browser/chromeos/arc/wallpaper/arc_wallpaper_service.cc",
        "patchSetId": 9
      },
      "lineNbr": 230,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "Looks like this is another cause that the client wants to set a default wallpaper directly.",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9646d90b_6e78fc80",
        "filename": "chrome/browser/chromeos/arc/wallpaper/arc_wallpaper_service.cc",
        "patchSetId": 9
      },
      "lineNbr": 230,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-10-30T19:06:02Z",
      "side": 1,
      "message": "IMO this needs to be renamed too, as detailed in the other comment, it\u0027s unclear from this name that whether it needs to set the default wallpaper only once, or deletes the user custom wallpaper. Actually it\u0027s doing the latter.",
      "parentUuid": "9211b18a_f2cc7c40",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2b87b546_0d431748",
        "filename": "chrome/browser/chromeos/arc/wallpaper/arc_wallpaper_service.cc",
        "patchSetId": 9
      },
      "lineNbr": 230,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "Changed back.",
      "parentUuid": "9646d90b_6e78fc80",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ba34502_52b746ad",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 839,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "I suggest not change the order of the previous function in this CL to avoid the possible regression... In previous function, it updates cache first and then set wallpaper. It does look inconsistent with SetCustomWallpaper(). If you think it\u0027s safe, you can ignore this comment. But if you\u0027re not very sure, I would suggest do it in a following small CL.",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f1d68556_fe2a0199",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 839,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "I\u0027m basically sure it won\u0027t introduce regression... so I\u0027ll keep the change.",
      "parentUuid": "6ba34502_52b746ad",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27954aa3_d120047a",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 976,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "It seems this function can be easily integrated to ShowUserWallpaper()? Why do we need a separate function?",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1704d058_3f2497d6",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 976,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-10-30T19:06:02Z",
      "side": 1,
      "message": "I tried calling ShowUserWallpaper(user_manager::SignInAccountId()) but it\u0027s not changing the wallpaper to default. I\u0027m still investigating.",
      "parentUuid": "27954aa3_d120047a",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "394d9421_8d8ef62a",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 976,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "Unfortunately it\u0027s not very easy to integrate into ShowUserWallpaper(). ShowUserWallpaper() first finds the user from UserManager, but user_manager::SignInAccountId() returns an empty pointer. \n\nIf we adjust the call order in ShowUserWallpaper(), it still can\u0027t be done cleanly and may introduce regression, because the subsequent calls rely on the user pointer to be non-null.\n\nAlthough we can directly compare if (account_id \u003d\u003d user_manager::SignInAccountId()) and special handle this case, it looks a little hacky...\n\nSo I think it\u0027s fine to have a ShowSigninWallpaper() function.. since the concept of SigninWallpaper has existed in the code base for a long time.\n\nShowSigninWallpaper() will not take any parameter, and user_manager::SignInAccountId() becomes an implementation detail, in order to make it clear that all users should have the same sign in wallpaper.",
      "parentUuid": "1704d058_3f2497d6",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93509acf_e65847fa",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 976,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-11-03T23:49:02Z",
      "side": 1,
      "message": "Maybe you can do the comparison as the first condition, like:\nvoid WallpaperMananger::ShowUserWallpaper(..) {\n  if (!user_manager::UserManager::IsInitialized() || ...)\n    return;\n  if (IsSignInAccount()) {\n    DoSomething();\n    return;\n  }\n  ... (the other codes remain the same)\n}\nWhat do you think? IMO it should be fine as SignIn user can also regards as a particular type user. But I\u0027m also fine if you want to keep this function, but probably better to rename it to ShowDefaultSigninWallpaper() as this is only for new user case and the other normal users has his own signin wall[paper?",
      "parentUuid": "394d9421_8d8ef62a",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be4bf23c_83ba0010",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 2005,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "why this change?",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "306d8b26_1cd3d6b4",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.cc",
        "patchSetId": 9
      },
      "lineNbr": 2005,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "This part has been separated to another CL.",
      "parentUuid": "be4bf23c_83ba0010",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d01bbd7_d88a7261",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.h",
        "patchSetId": 9
      },
      "lineNbr": 291,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "It\u0027s weird that DeleteWallpaper() does things more than just deleting wallpaper, but also set another wallpaper.",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95b80d5c_6ddaaee7",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.h",
        "patchSetId": 9
      },
      "lineNbr": 291,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-10-30T19:06:02Z",
      "side": 1,
      "message": "We can rename this, but as in the other comment explained we should still emphasize \u0027delete\u0027 or \u0027remove\u0027.\n\nAnd personally I think the name is OK, because after deleting wallpaper file, one may wonder: what to do with the current wallpaper? Then |show_default_wallpaper| provides an answer.\n\nI think we can also improve this by checking user.is_active for the caller, currently the caller does it (https://cs.chromium.org/chromium/src/chrome/browser/chromeos/arc/wallpaper/arc_wallpaper_service.cc?type\u003dcs\u0026sq\u003dpackage:chromium\u0026l\u003d237)\n\nSo DeleteWallpaper will only take one parameter. I think it\u0027s understandable that we continue to set the default wallpaper after the deletion, because everyone knows that we must have a wallpaper instead of the black screen. \n\nI think this is consistent with the goal that makes default wallpaper internal, because it\u0027s up to the WallpaperManager to fall back to the default wallpaper if we don\u0027t have other choices. The client should not worry about it.",
      "parentUuid": "9d01bbd7_d88a7261",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b819c87f_0edc28a7",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.h",
        "patchSetId": 9
      },
      "lineNbr": 291,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "Renamed to RemoveWallpaper, which replaces RemoveUserWallpaperInfo. It only removes the wallpaper and related info but do not set new ones.",
      "parentUuid": "95b80d5c_6ddaaee7",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "065bae2e_e1c6f388",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.h",
        "patchSetId": 9
      },
      "lineNbr": 429,
      "author": {
        "id": 1118421
      },
      "writtenOn": "2017-10-30T17:43:57Z",
      "side": 1,
      "message": "Seems the comments is outdated. Could you remove the sentence \"Note if the device policy....\"? Thanks!",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36c82e47_a5f8b3ed",
        "filename": "chrome/browser/chromeos/login/users/wallpaper/wallpaper_manager.h",
        "patchSetId": 9
      },
      "lineNbr": 429,
      "author": {
        "id": 1179965
      },
      "writtenOn": "2017-11-03T01:38:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "065bae2e_e1c6f388",
      "revId": "f4fbc01323400ce21bec967ec76ed5529bc86d03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}