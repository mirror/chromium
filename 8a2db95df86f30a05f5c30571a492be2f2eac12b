{
  "comments": [
    {
      "key": {
        "uuid": "833107ed_a727b5ea",
        "filename": "media/remoting/proto_utils_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 170,
      "author": {
        "id": 1115974
      },
      "writtenOn": "2017-11-01T20:42:50Z",
      "side": 1,
      "message": "We could even EXPECT_EQ() the `real_size` here to make sure if the size changes, it will fail the test.",
      "revId": "8a2db95df86f30a05f5c30571a492be2f2eac12b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "45b75269_ff567618",
        "filename": "media/remoting/proto_utils_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 170,
      "author": {
        "id": 1157930
      },
      "writtenOn": "2017-11-01T21:08:36Z",
      "side": 1,
      "message": "I like this solution. Much simpler than what I originally proposed. Thanks. :)\n\nFYI: My original proposal was to run this test twice with different memset value (e.g, 0xcd, ~0xcd). \n\nvoid VerifyPipelineStatisticsConversion(int init_memset_value) {\n  PipelineStatistics original;\n  // Note: Fill the structure with non-zero bytes to ensure this test is\n  // initializing *all* fields.\n  memset(\u0026original, init_memset_value, sizeof(original));\n  PipelineStatistics default_stats;\n  original \u003d default_stats;  // Initialize fields with default values.\n  original.audio_bytes_decoded \u003d 123;\n  original.video_bytes_decoded \u003d 456;\n  original.video_frames_decoded \u003d 789;\n  original.video_frames_dropped \u003d 21;\n  original.audio_memory_usage \u003d 32;\n  original.video_memory_usage \u003d 43;\n  original.video_keyframe_distance_average \u003d base::TimeDelta::Max();\n  original.video_frame_duration_average \u003d base::TimeDelta::Max();\n\n  // There is no convert-to-proto function, so just do that here.\n  pb::PipelineStatistics pb_stats;\n  pb_stats.set_audio_bytes_decoded(original.audio_bytes_decoded);\n  pb_stats.set_video_bytes_decoded(original.video_bytes_decoded);\n  pb_stats.set_video_frames_decoded(original.video_frames_decoded);\n  pb_stats.set_video_frames_dropped(original.video_frames_dropped);\n  pb_stats.set_audio_memory_usage(original.audio_memory_usage);\n  pb_stats.set_video_memory_usage(original.video_memory_usage);\n  pb_stats.set_video_frame_duration_average_usec(\n      original.video_frame_duration_average.InMicroseconds());\n\n  PipelineStatistics converted;\n  memset(\u0026converted, init_memset_value, sizeof(converted));\n  ConvertProtoToPipelineStatistics(pb_stats, \u0026converted);\n\n  // If this fails, did media::PipelineStatistics add/change fields that are not\n  // being set by media::remoting::ConvertProtoToPipelineStatistics()?\n  EXPECT_EQ(0, memcmp(\u0026original, \u0026converted, sizeof(converted)));\n}\n\nThen the tests will become:\n\nTEST_F(ProtoUtilsTest, PipelineStatisticsConversion) {\n  VerifyPipelineStatisticsConversion(0xcd);\n  VerifyPipelineStatisticsConversion(~0xcd);\n}",
      "parentUuid": "833107ed_a727b5ea",
      "revId": "8a2db95df86f30a05f5c30571a492be2f2eac12b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f68d23ed_5a6909d4",
        "filename": "media/remoting/proto_utils_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 170,
      "author": {
        "id": 1129179
      },
      "writtenOn": "2017-11-02T16:57:17Z",
      "side": 1,
      "message": "While Mounirs PS7 is a smaller code change, I prefer the test you posted in the comment above. \n\nMounir\u0027s approach forces a particular ordering of things in the structure definition and the padding size assumptions will be off next time someone changes and they\u0027ll have to grok all this silly context. I prefer that people who come to this structure later not have to ask themselves questions about padding.",
      "parentUuid": "45b75269_ff567618",
      "revId": "8a2db95df86f30a05f5c30571a492be2f2eac12b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ddef1698_8eb78f4e",
        "filename": "media/remoting/proto_utils_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 170,
      "author": {
        "id": 1115974
      },
      "writtenOn": "2017-11-02T19:38:12Z",
      "side": 1,
      "message": "Unfortunately, this doesn\u0027t work because the copy assignment operator is trival which means that it is implemented as a `memmove()`. \n\nQuote:\n\"A trivial copy assignment operator makes a copy of the object representation as if by std::memmove. All data types compatible with the C language (POD types) are trivially copy-assignable.\"\n\nSource: http://en.cppreference.com/w/cpp/language/copy_assignment\n\nShould we go ahead with my solution and disable the test on Windows? I wonder if this isn\u0027t the best way to avoid spending more time on this :) At this point, IMO, the alternative is to disable the test.",
      "parentUuid": "f68d23ed_5a6909d4",
      "revId": "8a2db95df86f30a05f5c30571a492be2f2eac12b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7759a8cc_ead98b2a",
        "filename": "media/remoting/proto_utils_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 170,
      "author": {
        "id": 1157930
      },
      "writtenOn": "2017-11-02T23:22:56Z",
      "side": 1,
      "message": "I did test my proposal on Linux workstation. Unfortunately I can not test it on windows since my windows machine does not work right now.\n\nI don\u0027t want to block this CL just by this unit test. How about revert the change to this unit test, but simply memset both 0xcd to |original| and |converted| (in original code). This should pass the trybots but the test can not detect any newly added field in PipelineStatistics. Please open a bug for this and assigned it to me. \n\nWDYT?",
      "parentUuid": "ddef1698_8eb78f4e",
      "revId": "8a2db95df86f30a05f5c30571a492be2f2eac12b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}