{
  "comments": [
    {
      "key": {
        "uuid": "5d94c758_850a8715",
        "filename": "content/browser/media/audio_stream_monitor.h",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T14:01:36Z",
      "side": 1,
      "message": "Is this still used?",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08385661_cacad09d",
        "filename": "content/browser/media/audio_stream_monitor.h",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-10-27T12:07:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5d94c758_850a8715",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ac290450_b802602a",
        "filename": "content/browser/media/audio_stream_monitor.h",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T14:01:36Z",
      "side": 1,
      "message": "Maybe names like StreamStarted/StreamStopped would make more sense?",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ceb63d0d_d987837e",
        "filename": "content/browser/media/audio_stream_monitor.h",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "Kept original names since everything else (including UpdateStreamAudibleState) is in imperative style.\nI can do the rename in the next patchset if you think we should really do it.",
      "parentUuid": "ac290450_b802602a",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08172f76_beeb05ff",
        "filename": "content/browser/renderer_host/media/audio_output_delegate_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T15:42:03Z",
      "side": 1,
      "message": "Thinking a bit more, maybe we can get rid of the polling? AudioOutputController scans every buffer anyways it gets anyways, so maybe it can check the power at that point and post a notification back to AudioOutputController when needed?",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "62d07834_1958f3a3",
        "filename": "content/browser/renderer_host/media/audio_output_delegate_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-26T03:12:57Z",
      "side": 1,
      "message": "There were a few reasons for the polling. OTOH (recalling from years ago):\n\n1. To reduce the rate of updates. If AudioOutputController posts a notification after every buffer, it would be posting tasks every 1-2ms. That\u0027s a lot.\n\n2. Lockless code on the real-time audio thread. Although these days, it seems the RT audio thread (AOC::OnMoreData()) has had a lot of things that acquire locks added to it, so maybe this is a moot point?",
      "parentUuid": "08172f76_beeb05ff",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "30fe0554_9234842c",
        "filename": "content/browser/renderer_host/media/audio_output_delegate_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "I will try removing the polling in a follow-up CL after this one has had some bake time on Canary.\nIt seems to me that such a change might significantly affect performance in an unknown manner, so I prefer to take a more incremental approach.",
      "parentUuid": "62d07834_1958f3a3",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2736498_bfacd952",
        "filename": "content/browser/renderer_host/media/audio_output_delegate_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 229,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T15:42:03Z",
      "side": 1,
      "message": "This is already an int.",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8fd428fb_f72a91ef",
        "filename": "content/browser/renderer_host/media/audio_output_delegate_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 229,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f2736498_bfacd952",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f31cfcb3_3b2cbde0",
        "filename": "content/browser/renderer_host/media/audio_output_stream_observer_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T14:01:36Z",
      "side": 1,
      "message": "There\u0027s no reason for this class to be IO thread only, I think. How about using a sequence checker instead?",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f64d02ff_d77b3a0a",
        "filename": "content/browser/renderer_host/media/audio_output_stream_observer_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f31cfcb3_3b2cbde0",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "080a1862_302d2ff4",
        "filename": "content/browser/renderer_host/media/audio_renderer_host.cc",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T14:01:36Z",
      "side": 1,
      "message": "If you instead put the Observer in a strong binding (https://cs.chromium.org/chromium/src/mojo/public/cpp/bindings/strong_binding.h), it would be owned by the InterfacePtr in the delegate, which seems simpler. You could do this for the ARH case without changing the code for the mojo case.",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ebb30b8b_717cfe31",
        "filename": "content/browser/renderer_host/media/audio_renderer_host.cc",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "080a1862_302d2ff4",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a58fba0d_09e2a872",
        "filename": "content/browser/renderer_host/media/audio_renderer_host.h",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1201454
      },
      "writtenOn": "2017-10-25T14:01:36Z",
      "side": 1,
      "message": "Is this used here?",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6362b4e7_603d097c",
        "filename": "content/browser/renderer_host/media/audio_renderer_host.h",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "Removed",
      "parentUuid": "a58fba0d_09e2a872",
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fe1b8b53_191fb83f",
        "filename": "media/mojo/interfaces/audio_output_stream.mojom",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-26T03:12:57Z",
      "side": 1,
      "message": "IMHO, this should be \"float power_dbfs\" instead of a boolean. Two reasons:\n\n1. The threshold that determines whether audio is loud enough to turn the UI indicator on/off should live in content (or chrome) code, not in media code.\n\n2. There are actually other use cases where it will be good to know the power level. My team, for Cast Mirroring, has an open item to add logging of this information to user feedback reports; so that we can determine where break-down in the system is occurring.",
      "range": {
        "startLine": 49,
        "startChar": 24,
        "endLine": 49,
        "endChar": 39
      },
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b3ce30e0_1da849f4",
        "filename": "media/mojo/interfaces/audio_output_stream.mojom",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-10-27T12:07:05Z",
      "side": 1,
      "message": "The argument for passing a bool only when the stream becomes audible/not audible is to avoid sending a stream of power-level updates at high frequency via Mojo IPC from the audio process to the browser, as this is understood to be significantly more expensive than just invoking a callback in the same process, as is currently done.\n\nWhen the time comes to support your new feature we can modify the Observer interface so that it reports power level separately when that feature is in use. WDYT?",
      "parentUuid": "fe1b8b53_191fb83f",
      "range": {
        "startLine": 49,
        "startChar": 24,
        "endLine": 49,
        "endChar": 39
      },
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c9364a9_5ae675b7",
        "filename": "media/mojo/interfaces/audio_output_stream.mojom",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-10-27T12:25:34Z",
      "side": 1,
      "message": "Some more details, since the previous message was sent before I could complete it.\n\n1. When the audio stack moves to a separate process, a continuous stream of power-level updates for WebContentsImpl will be a lot more expensive since they will be IPC calls instead of local callback invocations. WCI only needs to know if audio becomes audible or not audible, so reducing notifications to only these events is very important for performance. I don\u0027t see any particular reason why the constant with the silence threshold cannot be defined and used in media/. It can also be used in content and chrome for future features.\n\n2. Nothing prevents us from reporting power-level info from the audio process to the browser process in the future so that the feature you mention can be developed. We just have to be careful about performance. Perhaps the requirements for the feature can be fulfilled without all active audio streams sending 15 IPC calls per second to the browser. Let\u0027s discuss more about it offline.",
      "parentUuid": "b3ce30e0_1da849f4",
      "range": {
        "startLine": 49,
        "startChar": 24,
        "endLine": 49,
        "endChar": 39
      },
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8ead9191_0c50f3d6",
        "filename": "media/mojo/interfaces/audio_output_stream.mojom",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-10-26T03:12:57Z",
      "side": 1,
      "message": "IMHO, remove this. How will sound ever be audible the instant audio starts playing?",
      "range": {
        "startLine": 50,
        "startChar": 18,
        "endLine": 50,
        "endChar": 33
      },
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cdee5fc5_2669aa44",
        "filename": "media/mojo/interfaces/audio_output_stream.mojom",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-10-27T12:25:34Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8ead9191_0c50f3d6",
      "range": {
        "startLine": 50,
        "startChar": 18,
        "endLine": 50,
        "endChar": 33
      },
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f6a38861_a17ab4f3",
        "filename": "media/mojo/interfaces/audio_output_stream.mojom",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1143639
      },
      "writtenOn": "2017-11-15T12:50:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cdee5fc5_2669aa44",
      "range": {
        "startLine": 50,
        "startChar": 18,
        "endLine": 50,
        "endChar": 33
      },
      "revId": "9a50a179aad24f82284be05f08f44bf569447fc3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}