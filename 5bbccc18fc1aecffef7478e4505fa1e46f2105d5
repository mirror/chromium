{
  "comments": [
    {
      "key": {
        "uuid": "888d763a_41e9be86",
        "filename": "chromeos/network/network_configuration_handler_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2017-11-10T19:07:49Z",
      "side": 1,
      "message": "Hmm. I\u0027m scanning through FakeShillServiceClient and it looks like calling this at line 291 should be sufficient. Can you clarify why this is necessary?",
      "revId": "5bbccc18fc1aecffef7478e4505fa1e46f2105d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75ef3b89_243ca968",
        "filename": "chromeos/network/network_configuration_handler_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-10T19:49:53Z",
      "side": 1,
      "message": "NetworkConfigurationHandler looks at NetworkState\u0027s profile_path,\nhttps://cs.chromium.org/chromium/src/chromeos/network/network_configuration_handler.cc?l\u003d386\n\nThis is set via ShillService\u0027s GetProperties.\nhttps://cs.chromium.org/chromium/src/chromeos/network/network_state.cc?l\u003d140\n\nIn FakeShillServiceClient implementation, the property is set via SetServiceProperties.\nhttps://cs.chromium.org/chromium/src/chromeos/dbus/fake_shill_service_client.cc?l\u003d342\nThis is called from AddService called L271-L276,\n\nAt that timing, ShillProfileClient needs to return profile paths tied to the service.\nSetting here is to satisfy the condition, and L291 is too late.\nBTW, it looks kind of circular deps. L291 depends on properties, obtained from L281, which is created by AddService at L274. So, anyway it looks to need call AddEntry twice.\n\nPlease let me know, if we should fix fake side, instead.",
      "parentUuid": "888d763a_41e9be86",
      "revId": "5bbccc18fc1aecffef7478e4505fa1e46f2105d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e4ff3f4_898b49ee",
        "filename": "chromeos/network/network_configuration_handler_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2017-11-10T20:28:31Z",
      "side": 1,
      "message": "Ah, I didn\u0027t notice the profile lookup in SetServiceProperties).\n\nIt sounds like ProfileClient::AddEntry should *probably* also set kProfileProperty in |properties|, but it is possible that will break something else. An alternative would be to add a test interface method \u0027AddServiceToProfile\u0027.\n\nIf fixing that is straightforward and works, great. If not, just clarify the comment a bit, thanks!",
      "parentUuid": "75ef3b89_243ca968",
      "revId": "5bbccc18fc1aecffef7478e4505fa1e46f2105d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b64665d6_4109ae2b",
        "filename": "chromeos/network/network_configuration_handler_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-13T07:31:15Z",
      "side": 1,
      "message": "Thank you for explanation!\n\nI\u0027ve re-read the code, and found that FakeShillProfileClient::AddService() may be the one we need?\nHowever, it prohibits to add one service to multiple profiles:\nhttps://cs.chromium.org/chromium/src/chromeos/dbus/fake_shill_profile_client.cc?sq\u003dpackage:chromium\u0026l\u003d211\n\nAnd then I\u0027m slightly confused, so I need more your advice.\n\nQuestion: what is the expected relationship between shill profile and service, in real implementation?\nCan a service have relationship to multiple profiles at once?\n- If so, should we make some change for FakeShillProfileClient::AddService and its deferred methods?\n- If not, what\u0027s the goal of RemoveConfiguration, which removes the specified service from \"all\" profiles, but conceptually it should be tied to at most one profile?\n\nNote that, technically we can workaround by the combination of AddEntry and AddService, but I think it\u0027s better if we can make \"fake\" situation closer to the real one.",
      "parentUuid": "2e4ff3f4_898b49ee",
      "revId": "5bbccc18fc1aecffef7478e4505fa1e46f2105d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92ff234a_0cc3ccb8",
        "filename": "chromeos/network/network_configuration_handler_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2017-11-13T20:30:20Z",
      "side": 1,
      "message": "Yeah, it\u0027s.. .complicated.\n\n* A service may not exist in any profile (e.g. a \"visible\" i.e. nearby WiFi network)\n* A service exits in a profile if it is \"remembered\" (aka a \"favorite\")\n* A service may exist in multiple profiles (i.e. a device configuration + a user configuration). This is unusual but possible.\n* \u0027AddService\u0027 by default should not add an entry to a profile, but it would make sense to have an AddServiceToProfile helper in the test API that creates a service and adds it to a specified profile.\n* RemoveConfiguration always removes a service from all active profiles (for both simplicity and security). e.g. if a service was configured in the login screen (device profile), then changed by the user (saved in user profile, device profile entry still exists), if the user \"forgets\" the network we remove it from both to avoid unexpected behavior. (Any normal user is allowed to remove a service from the device profile).\n\nSo, again, if you want to make and test the changes to support AddServiceToProfile that would be great. I would suggest something like:\n\na) Create AddServiceToProfile to wrap AddService and properly add a service to an existing specified profile path.\nb) Remove properties-\u003eSetKey(shill::kProfileProperty,...) from FakeShillServiceClient::SetServiceProperties. This may break some tests but those can be fixed using AddServiceToProfile instead.\nc) Remove the properties-\u003eGetStringWithoutPathExpansion(shill::kProfileProperty...) {} code in AddServiceWithIPConfig which will become pointles after (b) and call that explicitly in AddServiceToProfile().\n\nIf that makes sense and you want to make and test the changes, grea! If not I completely understand and the code as-is with an updated comment is fine too :)",
      "parentUuid": "b64665d6_4109ae2b",
      "revId": "5bbccc18fc1aecffef7478e4505fa1e46f2105d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f765e93b_2dd81915",
        "filename": "chromeos/network/network_configuration_handler_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-14T05:20:45Z",
      "side": 1,
      "message": "Thank you very much for detailed explanation.\n\nSo, I\u0027m happy to take a look into it. However, because the work sounds like a bit more wider change which looks conceptually isolated from this change, I\u0027d like to split it from this CL.\nAs you said you\u0027re ok with updating comments, please let me land this so, first.\n\nI\u0027ll give it a try to make another CL for AddServiceToProfile().",
      "parentUuid": "92ff234a_0cc3ccb8",
      "revId": "5bbccc18fc1aecffef7478e4505fa1e46f2105d5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}