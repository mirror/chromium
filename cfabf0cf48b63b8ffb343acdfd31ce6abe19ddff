{
  "comments": [
    {
      "key": {
        "uuid": "ea8c3aa4_75fc7c53",
        "filename": "/COMMIT_MSG",
        "patchSetId": 10
      },
      "lineNbr": 31,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-09-15T09:28:51Z",
      "side": 1,
      "message": "Great!",
      "range": {
        "startLine": 30,
        "startChar": 39,
        "endLine": 31,
        "endChar": 10
      },
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6e3f4955_d14db751",
        "filename": "/COMMIT_MSG",
        "patchSetId": 10
      },
      "lineNbr": 37,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-15T10:54:35Z",
      "side": 1,
      "message": "This issue description is super informative!",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1ae3f875_1fe1de7a",
        "filename": "content/browser/shared_worker/shared_worker_service_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 166,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-15T10:54:35Z",
      "side": 1,
      "message": "Ah... I know this is not from your code but this hurts readability. I think we can probably mock this with MockRenderProcessHost and its OverridingBinderForTesting, could we try that or have a TODO for that? (Feel free to add my ldap there for the latter)",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a877197_ab7ed781",
        "filename": "content/browser/shared_worker/shared_worker_service_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 166,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "This isn\u0027t just about supporting testing. This code needs to run on the UI thread. We also need to avoid creating the factory if we aren\u0027t creating a new shared worker instance -- i.e., we are just attaching a new client to an existing worker. I don\u0027t know why this code wants to increment refcounts in that case. It seems like we should just keep the renderer alive if it has a shared worker regardless of the number of clients.\n\nAnyways, I plan to clean all of this up in a subsequent CL when I move shared worker service to the UI thread. This will get rid of all of these annoying thread hops, but also I will simplify the increment / decrement refcount logic.",
      "parentUuid": "1ae3f875_1fe1de7a",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3772860_79110c86",
        "filename": "content/browser/shared_worker/shared_worker_service_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 166,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-18T15:45:51Z",
      "side": 1,
      "message": "Yep I\u0027m aware that this part needs to run on UI thread (we have similar code for SW). I was talking about how the try-reserve logic is given and overridden for tests, which seems to add a little more awkwardness. If I\u0027m not mistaken... it looks we can directly call what we do in TryReserveWorker here, and it\u0027s probably mockable with the more standard, readable way... but it \u0027ll need more changes in the test code.  If we\u0027re cleaning up all this messy race case handling code in a follow-up I\u0027ll be just happy with that.\n\n\u003e I don\u0027t know why this code wants to increment refcounts in that case. It seems like we should just keep the renderer alive if it has a shared worker regardless of the number of clients.\n\nSince we look for an available worker host on IO thread there could be a race where the # of clients could reach 0 and the renderer may shut down on UI thread while we\u0027re trying to attach the worker to the existing one on IO thread?",
      "parentUuid": "5a877197_ab7ed781",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0a6d8d2_a80b0e3f",
        "filename": "content/browser/shared_worker/shared_worker_service_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 166,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-18T16:22:12Z",
      "side": 1,
      "message": "One thing that confused me about your original comment is that you refer to OverridingBinderForTesting, but that function doesn\u0027t exist on the MockRenderProcessHost defined in shared_worker_service_impl_unittest.cc. Perhaps I could migrate to the standard MockRenderProcessHost, but I was also thinking that I could rid the unit test of a dependency on RenderProcessHost and that might be overall better.\n\nI will definitely be cleaning up all of this mess in a follow-up CL. It is the next one I have planned to write after this one. I just didn\u0027t want to include it as part of this CL.\n\nThanks for explaining the ref count business. Ugh, I look forward to getting rid of the thread hopping!",
      "parentUuid": "a3772860_79110c86",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9f26168_e506c284",
        "filename": "content/browser/shared_worker/shared_worker_service_impl_unittest.cc",
        "patchSetId": 10
      },
      "lineNbr": 169,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-09-15T09:28:51Z",
      "side": 1,
      "message": "Why don\u0027t we use NOTREACHED()?",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87cd5b34_66bc95a1",
        "filename": "content/browser/shared_worker/shared_worker_service_impl_unittest.cc",
        "patchSetId": 10
      },
      "lineNbr": 169,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Because NOTREACHED is compiled out of release builds. This is a unit test, so I wanted the error to be caught in release builds as well.",
      "parentUuid": "f9f26168_e506c284",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f844040a_2beb330d",
        "filename": "content/browser/shared_worker/shared_worker_service_impl_unittest.cc",
        "patchSetId": 10
      },
      "lineNbr": 179,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-09-15T09:28:51Z",
      "side": 1,
      "message": "ditto.",
      "range": {
        "startLine": 179,
        "startChar": 4,
        "endLine": 179,
        "endChar": 9
      },
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b256a3f5_0b760ada",
        "filename": "content/common/shared_worker/shared_worker_host.mojom",
        "patchSetId": 10
      },
      "lineNbr": 9,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-15T10:54:35Z",
      "side": 1,
      "message": "I\u0027d like to add \u0027in the browser process\u0027 after \u0027corresponding host\u0027",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "787f4dbb_333cd11f",
        "filename": "content/common/shared_worker/shared_worker_host.mojom",
        "patchSetId": 10
      },
      "lineNbr": 9,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "OK, I worry a bit about comments like this going stale. What if in the future we decide that shared worker hosts should run in a different process (e.g., the network process). Not saying that should happen but it might. No idea if that will be true or not. Clients of this interface shouldn\u0027t need to care what process the host runs in.",
      "parentUuid": "b256a3f5_0b760ada",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af0f7e0a_e925d490",
        "filename": "content/common/shared_worker/shared_worker_host.mojom",
        "patchSetId": 10
      },
      "lineNbr": 9,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-18T15:45:51Z",
      "side": 1,
      "message": "Fair enough, I think I have made similar comments before in some other reviews... for reasonably well maintained interface we should keep updating such comments but I can see reasons we don\u0027t want to make interfaces speak about some particular implementations.",
      "parentUuid": "787f4dbb_333cd11f",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2100cb0_5457d8c3",
        "filename": "content/common/shared_worker/shared_worker_info.mojom",
        "patchSetId": 10
      },
      "lineNbr": 12,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-15T10:54:35Z",
      "side": 1,
      "message": "While we\u0027re here can we add a short comment for this?  Something like... \u0027A set of meta data that is necessary to create a new shared worker context. Populated when a new SharedWorker object is created in the parent context (e.g. Document), and passed onto the destination child process where the shared worker runs.\u0027",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15e97cd7_eefcbbef",
        "filename": "content/common/shared_worker/shared_worker_info.mojom",
        "patchSetId": 10
      },
      "lineNbr": 12,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Will do.",
      "parentUuid": "b2100cb0_5457d8c3",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f37cb2f_66880698",
        "filename": "content/renderer/render_thread_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 756,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-09-15T09:28:51Z",
      "side": 1,
      "message": "Can you indent this line?",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "25f4be00_7e432604",
        "filename": "content/renderer/render_thread_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 756,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Will do. Odd that \"git cl format\" didn\u0027t catch that.",
      "parentUuid": "2f37cb2f_66880698",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22254811_1b057b65",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.cc",
        "patchSetId": 10
      },
      "lineNbr": 301,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-15T10:54:35Z",
      "side": 1,
      "message": "nit: trigging -\u003e triggering",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d6d3853_d1ee0125",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.cc",
        "patchSetId": 10
      },
      "lineNbr": 301,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "22254811_1b057b65",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f1435bc_63af39f7",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.cc",
        "patchSetId": 10
      },
      "lineNbr": 321,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-09-15T10:54:35Z",
      "side": 1,
      "message": "WorkerMsg_Connect -\u003e mojom::SharedWorker::Connect()",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7cc7aa52_bde5e0a5",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.cc",
        "patchSetId": 10
      },
      "lineNbr": 321,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0f1435bc_63af39f7",
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cd221868_3da76a5c",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.h",
        "patchSetId": 10
      },
      "lineNbr": 103,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-09-15T09:28:51Z",
      "side": 1,
      "message": "const?",
      "range": {
        "startLine": 102,
        "startChar": 0,
        "endLine": 103,
        "endChar": 20
      },
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf57a2cf_b1ad6f3c",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.h",
        "patchSetId": 10
      },
      "lineNbr": 103,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cd221868_3da76a5c",
      "range": {
        "startLine": 102,
        "startChar": 0,
        "endLine": 103,
        "endChar": 20
      },
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26a81310_61288f56",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.h",
        "patchSetId": 10
      },
      "lineNbr": 105,
      "author": {
        "id": 1115976
      },
      "writtenOn": "2017-09-15T09:28:51Z",
      "side": 1,
      "message": "const?",
      "range": {
        "startLine": 105,
        "startChar": 12,
        "endLine": 105,
        "endChar": 0
      },
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7072d7cb_4a9a5c93",
        "filename": "content/renderer/shared_worker/embedded_shared_worker_stub.h",
        "patchSetId": 10
      },
      "lineNbr": 105,
      "author": {
        "id": 1115891
      },
      "writtenOn": "2017-09-15T17:36:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "26a81310_61288f56",
      "range": {
        "startLine": 105,
        "startChar": 12,
        "endLine": 105,
        "endChar": 0
      },
      "revId": "cfabf0cf48b63b8ffb343acdfd31ce6abe19ddff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}