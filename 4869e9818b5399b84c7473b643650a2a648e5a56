{
  "comments": [
    {
      "key": {
        "uuid": "53f01999_674d8781",
        "filename": "components/signin/ios/browser/account_consistency_service.mm",
        "patchSetId": 5
      },
      "lineNbr": 83,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2017-10-16T12:33:48Z",
      "side": 1,
      "message": "|delegate_| is no longer guaranteed to be non-null, for example for prerendered tabs.",
      "range": {
        "startLine": 83,
        "startChar": 2,
        "endLine": 83,
        "endChar": 11
      },
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d5d35800_b3963b15",
        "filename": "components/signin/ios/browser/account_consistency_service.mm",
        "patchSetId": 5
      },
      "lineNbr": 83,
      "author": {
        "id": 1163361
      },
      "writtenOn": "2017-10-17T15:23:37Z",
      "side": 1,
      "message": "Prerendered tabs should not have a ManageAccountsDelegate since it is only available in response to a user interaction. I am investigating whether we can delay the creation of the AccountConsistencyHandler to the point at which we have the delegate, so that it will not be invalid.",
      "parentUuid": "53f01999_674d8781",
      "range": {
        "startLine": 83,
        "startChar": 2,
        "endLine": 83,
        "endChar": 11
      },
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d914754_cff9729f",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2017-10-16T12:33:48Z",
      "side": 1,
      "message": "This conditional will never be true -- prerendered tabs are not added to the TabModel until they are promoted to real tabs.\n\nThis also means that prerendered tabs won\u0027t have a ManageAccountsDelegate at all, which might be a showstopper?",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2fa82fc3_6a451d18",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1163361
      },
      "writtenOn": "2017-10-17T15:23:37Z",
      "side": 1,
      "message": "You\u0027re right. As a result, this code should be removed (I\u0027ll update it). It\u0027s completely fine that prerendered tabs won\u0027t have a ManageAccountsDelegate, since the Manage Accounts callbacks can only happen in response to user interaction with a real tab. So this is working as intended.",
      "parentUuid": "5d914754_cff9729f",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a1ac05ab_67708837",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2017-10-18T13:12:36Z",
      "side": 1,
      "message": "Mihai, can you confirm that none of the ManageAccounts methods can be triggered without user action?\n\nWe had code in place to specially handle this case before, so I don\u0027t want to remove it without being very confident that it was never used.",
      "parentUuid": "2fa82fc3_6a451d18",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a163bdba_b00248ee",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1115972
      },
      "writtenOn": "2017-10-18T13:18:46Z",
      "side": 1,
      "message": "I think it is hard to be sure about this - we receive ManageAccounts responses whenever the server decides to send it (the common case is when the user taps on Manage Accounts button or go incognito, but I do not know all the cases).\n\nSo, today the decision to send ManageAccounts responses is controlled by the server and I think it would be good not to make any assumptions on the client.",
      "parentUuid": "a1ac05ab_67708837",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e326e268_4b167a3e",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2017-10-18T16:36:21Z",
      "side": 1,
      "message": "Ok, thanks!\n\nHow about we create a prerender-specific delegate and set that in PreloadController.  That way there\u0027s always a non-null delegate, and the prerender version can implement every method to cancel the prerender.  Ed, does this sound like it would work?",
      "parentUuid": "a163bdba_b00248ee",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6dbc218d_2f8cb5e6",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-10-18T16:44:00Z",
      "side": 1,
      "message": "This is exactly what I wanted to suggest. Note that this will not work for pre-rendered tabs used by ContextualSearch. But apart from that, I think this is the correct way to do it.",
      "parentUuid": "e326e268_4b167a3e",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6d011c13_ee3edbcc",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 5242,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-10-20T11:47:53Z",
      "side": 1,
      "message": "Contextual Search shouldn\u0027t be a factor. Any other barriers to this moving forward?",
      "parentUuid": "6dbc218d_2f8cb5e6",
      "revId": "4869e9818b5399b84c7473b643650a2a648e5a56",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}