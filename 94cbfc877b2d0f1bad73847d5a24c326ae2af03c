{
  "comments": [
    {
      "key": {
        "uuid": "ac37d6e4_1ec6305b",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1229947
      },
      "writtenOn": "2017-08-07T18:29:35Z",
      "side": 1,
      "message": "Emily, Mustafa and I had been operating off of the assumption that we could check the certificate\u0027s issuer\u0027s common name in order to determine whether or not it was a MITM software certificate. Mustafa mentioned today thought that common names are actually being deprecated in favor of subject alternate names. I put a to-do here so that I could swap out common names for subject alternate names one we review more MITM software certificates and come up with patterns to check against in the subject alternate name field.\n\nWhat is your opinion on this? Do you think subject alternate names are the way to go?",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb931071_e81e1ba6",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1126726
      },
      "writtenOn": "2017-08-07T18:37:36Z",
      "side": 1,
      "message": "Hmmm... I think we should look at both common name and SANs. Chrome no longer looks at CNs at all for the purpose of validating certificates, but I think for this feature we should still look at both CNs and SANs, because I bet there are a bunch of old MITMs out there that still use CNs only. There are a few possible situations:\n1.) MITM uses CNs only in its certificates, and the client has the root cert properly installed. This situation would generate an ERR_CERT_COMMON_NAME_INVALID error. I think we should expand this feature to catch this case (e.g. we should look for ERR_CERT_COMMON_NAME_INVALID errors in addition to ERR_CERT_AUTHORITY_INVALID errors to trigger this feature), but that doesn\u0027t have to happen right now.\n2.) MITM uses both CNs and SANs, or only SANs, in its certificates, and the client is missing the root cert. We\u0027d cover these situations by looking at SANs.\n3.) MITM uses CNs only in its certificates, and the client is missing the root cert. To catch this situation and trigger this feature, we\u0027d need to look at CNs.\n\nSo to cover situations #2 and #3, we need to look at both CNs and SANs. And then we can later look at ERR_CERT_COMMON_NAME_INVALID errors as well to catch situation #1.",
      "parentUuid": "ac37d6e4_1ec6305b",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0d9eefe1_4d56a386",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1121739
      },
      "writtenOn": "2017-08-07T18:41:23Z",
      "side": 1,
      "message": "We\u0027re looking at strings like \"ScanCorp Antivirus\", right?\nWhen I checked with Mustafa, and I believe we concluded that these strings were consistently in the common name field of the issuer listed in the leaf.\n\n(The fact that the common name field was abused as a deprecated place to list domain names is incidental.)",
      "parentUuid": "fb931071_e81e1ba6",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c668779_020d1f3f",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1126726
      },
      "writtenOn": "2017-08-07T18:44:46Z",
      "side": 1,
      "message": "Are only looking at the issuer of the leaf? If so, there\u0027s no SAN in the picture. I thought we were going to look at the issuer of the leaf + subject/issuer of all certificates in the chain.",
      "parentUuid": "0d9eefe1_4d56a386",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc3837db_9ff5baba",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1126726
      },
      "writtenOn": "2017-08-07T18:48:14Z",
      "side": 1,
      "message": "Oh, or is your point that intermediates and roots don\u0027t have SANs, or at least most don\u0027t based on manual inspection? If so, that makes sense.",
      "parentUuid": "3c668779_020d1f3f",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "060bdc5d_46f1f513",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1121739
      },
      "writtenOn": "2017-08-07T19:55:02Z",
      "side": 1,
      "message": "\u003e Are only looking at the issuer of the leaf?\n\nYes, that. There is a sufficiently specific value in the common name field of the issuer in the leaf, in every case we have so far (except one for Fortinet): https://docs.google.com/spreadsheets/d/1FFUtSrmHfCNGpAQhoO0TH6xe9_pxL0HY-YhZ2BnYoBI/edit\n\nmeacer@ and I sanity checked against Dremel last week, which backs up the choice of looking just at that field (at least, for this project).",
      "parentUuid": "dc3837db_9ff5baba",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "37a758dd_7e1934ee",
        "filename": "chrome/browser/ssl/ssl_error_handler.cc",
        "patchSetId": 14
      },
      "lineNbr": 412,
      "author": {
        "id": 1002611
      },
      "writtenOn": "2017-08-07T20:04:35Z",
      "side": 1,
      "message": "The reason I mentioned this to Sasha was that I thought our backend parsing code added SANs to the common name field, so we wouldn\u0027t be able to tell if issuer.common_name contains SAN or not. \n\nBut it seems that\u0027s not what the parsing code is doing, and issuer.common_name only has issuer\u0027s common names and there is no SANs involved.",
      "parentUuid": "060bdc5d_46f1f513",
      "revId": "94cbfc877b2d0f1bad73847d5a24c326ae2af03c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}