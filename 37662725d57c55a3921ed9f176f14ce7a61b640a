{
  "comments": [
    {
      "key": {
        "uuid": "fc0dc0e9_3d7f891e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1186534
      },
      "writtenOn": "2017-12-04T03:51:55Z",
      "side": 1,
      "message": "Perhaps:\n\nLog the source when installing a PWA on desktop",
      "range": {
        "startLine": 7,
        "startChar": 4,
        "endLine": 7,
        "endChar": 11
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8933dda_5bfbe48f",
        "filename": "chrome/browser/extensions/tab_helper.cc",
        "patchSetId": 3
      },
      "lineNbr": 372,
      "author": {
        "id": 1186534
      },
      "writtenOn": "2017-12-04T03:51:55Z",
      "side": 1,
      "message": "We don\u0027t actually know at this point if the page is a PWA. BookmarkAppHelper has to work that out, so this will overcount.\n\nAlso, there is an additional confirmation dialog before the installation starts, whereas on Android we only record this metric when an install has actually started. This will also (slightly) overcount.\n\nWDYT about passing the source to BookmarkAppHelper as an argument, and logging it inside BookmarkAppHelper::OnBubbleCompleted if installable_ is INSTALLABLE_YES? Then you can remove the other changes in this CL since BookmarkAppHelper will handle the metric update.",
      "range": {
        "startLine": 372,
        "startChar": 5,
        "endLine": 372,
        "endChar": 72
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e1068dbe_e6200ab0",
        "filename": "chrome/browser/extensions/tab_helper.cc",
        "patchSetId": 3
      },
      "lineNbr": 372,
      "author": {
        "id": 1174915
      },
      "writtenOn": "2017-12-04T04:09:09Z",
      "side": 1,
      "message": "OK. BookmarkAppHelper is also used from here --\n\n https://cs.chromium.org/chromium/src/chrome/browser/extensions/api/management/chrome_management_api_delegate.cc?rcl\u003d259450762b26c56504650f27f06405507d33e7bf\u0026l\u003d153\n\n-- which I\u0027m not familiar with. Could a PWA be installed via the management API? If so, we should probably have another InstallSource enum entry. If not, we still need some way of specifying a null InstallSource parameter in the relevant BookmarkAppHelper call.",
      "parentUuid": "a8933dda_5bfbe48f",
      "range": {
        "startLine": 372,
        "startChar": 5,
        "endLine": 372,
        "endChar": 72
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8458a76_44830350",
        "filename": "chrome/browser/extensions/tab_helper.cc",
        "patchSetId": 3
      },
      "lineNbr": 372,
      "author": {
        "id": 1186534
      },
      "writtenOn": "2017-12-04T04:24:32Z",
      "side": 1,
      "message": "Good catch. Looks like that is called via the extensions management API - https://developer.chrome.com/extensions/management#method-generateAppForLink.\n\nHowever, it\u0027s always called with a null |web_contents| parameter so it won\u0027t fetch a manifest and hence will never be able to install a PWA (see the BookmarkAppHelper constructor). Possibly you could DCHECK(source \u003d\u003d MAX \u0026\u0026 web_contents \u003d\u003d nullptr) as a way of specifying a null InstallSource parameter? I don\u0027t think we should pollute the metric with a bucket that will never be used. WDYT?",
      "parentUuid": "e1068dbe_e6200ab0",
      "range": {
        "startLine": 372,
        "startChar": 5,
        "endLine": 372,
        "endChar": 72
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c88973b0_cd5412a1",
        "filename": "chrome/browser/extensions/tab_helper.cc",
        "patchSetId": 3
      },
      "lineNbr": 372,
      "author": {
        "id": 1174915
      },
      "writtenOn": "2017-12-04T04:52:53Z",
      "side": 1,
      "message": "What about adding SetInstallSource method to BookmarkAppHelper, which can be used to optionally configure the install source before calling Create? Then there is no need to document that MAX should be passed as a psuedo-null value.",
      "parentUuid": "f8458a76_44830350",
      "range": {
        "startLine": 372,
        "startChar": 5,
        "endLine": 372,
        "endChar": 72
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bbabb85a_4151205a",
        "filename": "chrome/browser/extensions/tab_helper.cc",
        "patchSetId": 3
      },
      "lineNbr": 372,
      "author": {
        "id": 1186534
      },
      "writtenOn": "2017-12-04T05:39:51Z",
      "side": 1,
      "message": "Hmm, I worry that allows an easy way to not record metrics properly. It would also be a little strange that you construct the object, and then pass it a new parameter separately right after construction. I\u0027d prefer a new enum value over that.\n\nThat being said, I don\u0027t own BookmarkAppHelper, so if benwells/calamity have a different opinion I\u0027ll defer to their ownership. :)",
      "parentUuid": "c88973b0_cd5412a1",
      "range": {
        "startLine": 372,
        "startChar": 5,
        "endLine": 372,
        "endChar": 72
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "30e6a1d0_05738962",
        "filename": "chrome/browser/extensions/tab_helper.cc",
        "patchSetId": 3
      },
      "lineNbr": 372,
      "author": {
        "id": 1174915
      },
      "writtenOn": "2017-12-06T02:20:29Z",
      "side": 1,
      "message": "What do you think about using a pointer which can be null, instead of MAX (see latest patchset)?",
      "parentUuid": "bbabb85a_4151205a",
      "range": {
        "startLine": 372,
        "startChar": 5,
        "endLine": 372,
        "endChar": 72
      },
      "revId": "37662725d57c55a3921ed9f176f14ce7a61b640a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}