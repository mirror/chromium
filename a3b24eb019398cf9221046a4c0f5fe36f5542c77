{
  "comments": [
    {
      "key": {
        "uuid": "47cf7fde_561d6bf9",
        "filename": "third_party/WebKit/Source/core/layout/LayoutText.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1176,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-11-24T18:33:00Z",
      "side": 1,
      "message": "It\u0027s confusing that \"bool LayoutText::ContainsOnlyWhitespace(unsigned from, unsigned len)\" returns true if the string contains only spaces, newlines, and tabs, but \"OnlyWhitespace LayoutText::ContainsOnlyWhitespace()\" returns kYes if the string contains only spaces, newlines, tabs, and kNoBreakSpaceCharacter. Is it necessary to include kNoBreakSpaceCharacter?",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c279d87_ed8dde34",
        "filename": "third_party/WebKit/Source/core/layout/LayoutText.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1176,
      "author": {
        "id": 1162220
      },
      "writtenOn": "2017-11-24T19:03:36Z",
      "side": 1,
      "message": "I noticed that, but I do think we don\u0027t want to fire FirstContentfulPaint on something like\n\u003cdiv\u003e\u0026nbsp\u003c/div\u003e so we do need to check for that. I realized this when I added the unittest. I\u0027m not quite sure what\u0027s the best way to avoid more confusion. The ContainsOnlyWhitespace implementations here are also different to the one in WTF::StringImpl.",
      "parentUuid": "47cf7fde_561d6bf9",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0149dff0_ea1b27b9",
        "filename": "third_party/WebKit/Source/core/layout/LayoutText.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1176,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-11-25T16:51:37Z",
      "side": 1,
      "message": "Yeah this is unfortunate :/\n\nWDYT of adding comments above the contains_only_whitespace_ declaration, and maybe LayoutText::ContainsOnlyWhitespace too?\n\nWDYT of renaming contains_only_whitespace_ to contains_only_whitespace_or_nbsp_, and similarly, ContainsOnlyWhitespace() to ContainsOnlyWhitespaceOrNbsp()?",
      "parentUuid": "6c279d87_ed8dde34",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bcd681dd_54cfcda3",
        "filename": "third_party/WebKit/Source/core/layout/LayoutText.cpp",
        "patchSetId": 10
      },
      "lineNbr": 1176,
      "author": {
        "id": 1162220
      },
      "writtenOn": "2017-11-27T17:30:48Z",
      "side": 1,
      "message": "I think it makes sense to rename the methods so it\u0027s clear that they are not equivalent. Done",
      "parentUuid": "0149dff0_ea1b27b9",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cff73818_d8f59870",
        "filename": "third_party/WebKit/Source/platform/fonts/Font.cpp",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-11-24T18:33:00Z",
      "side": 1,
      "message": "WYDT of calling \"paint_controller_.SetTextPainted();\" in \"InlineTextBoxPainter::Paint\" right above the call to \"text_painter.Paint()\"? This would save having to plumb the whitespace bit through TextRun. I think it would also let you make it a bool instead of a tri-state since text has to be laid out before painting.",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "150e963b_57000ab5",
        "filename": "third_party/WebKit/Source/platform/fonts/Font.cpp",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1162220
      },
      "writtenOn": "2017-11-24T19:03:36Z",
      "side": 1,
      "message": "The problem with that is: what happens with all other codepaths to GraphicsContext::DrawTextInternal? If we stop calling SetTextPainted() in that method, then FCP will not trigger on any of those codepaths (which also render text). If we keep calling SetTextPainted(), then we somehow need to make sure that, when the caller is from InlineTextBoxPainter::Paint then it does not fire FCP under certain circumstances. The only reasonable places to have that bit of information are TextRunPaintInfo or PaintFlags.\n\nTo give a concrete example, I think this would no longer SetTextPainted:\nhttps://cs.chromium.org/chromium/src/third_party/WebKit/Source/platform/exported/WebFont.cpp?dr\u003dSs\u0026l\u003d98",
      "parentUuid": "cff73818_d8f59870",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c202b75e_b91bf316",
        "filename": "third_party/WebKit/Source/platform/fonts/Font.cpp",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-11-25T16:51:37Z",
      "side": 1,
      "message": "Doesn\u0027t your new code already fail for the WebFont.cpp case because the whitespace bit is not set on the TextRun in that codepath? It also doesn\u0027t look like there\u0027s a real PaintController. I tried making a test it\u0027s a challenge to get that code to run. I think the trusted webfont codepath is used for PPAPI plugins to draw text into temp buffers.\n\nI see what you mean about putting this bit in the most central code that paints text to ensure we don\u0027t miss any cases, but the existence of the kUnknown tri-state means we are already missing cases. I think it would be cleaner to be exact in the cases we are sure about (i.e., painting laid-out inline text runs) and add a heuristic for the others (e.g., maybe just optimistically call SetTextPainted() from SVGInlineTextBoxPainter::PaintText).",
      "parentUuid": "150e963b_57000ab5",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "691ae573_cf6b8d8a",
        "filename": "third_party/WebKit/Source/platform/fonts/Font.cpp",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1162220
      },
      "writtenOn": "2017-11-27T17:30:48Z",
      "side": 1,
      "message": "Ok, I\u0027ve removed the bit from TextRun. But I still don\u0027t think we can have a bool instead of tristate yet, I added a DCHECK to test that.",
      "parentUuid": "c202b75e_b91bf316",
      "revId": "a3b24eb019398cf9221046a4c0f5fe36f5542c77",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}