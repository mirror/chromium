--- a\CpuArch.c	2015-03-25 08:17:41.042711000 -0400
+++ lzma_sdk\CpuArch.c	2016-02-12 16:32:45.484718900 -0500
@@ -45,7 +45,8 @@
     "push %%EDX\n\t"
     "popf\n\t"
     "andl %%EAX, %0\n\t":
-    "=c" (flag) : "c" (flag));
+    "=c" (flag) : "c" (flag):
+    "%eax", "%edx" );
   #endif
   return flag;
 }
@@ -79,7 +80,13 @@
   #else
 
   __asm__ __volatile__ (
-  #if defined(MY_CPU_X86) && defined(__PIC__)
+  #if defined(MY_CPU_AMD64)
+    "mov %%rbx, %%rdi\n"
+    "cpuid\n"
+    "xchg %%rdi, %%rbx\n"
+    : "=a" (*a) ,
+      "=D" (*b) ,
+  #elif defined(MY_CPU_X86) && defined(__PIC__)
     "mov %%ebx, %%edi;"
     "cpuid;"
     "xchgl %%ebx, %%edi;"
