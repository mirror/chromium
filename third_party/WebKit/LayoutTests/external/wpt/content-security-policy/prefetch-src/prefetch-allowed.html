<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Security-Policy" content="prefetch-src 'self'">
  <script src='/resources/testharness.js'></script>
  <script src='/resources/testharnessreport.js'></script>

  <script>
    let prefetching = false;
    try {
      prefetching = document.createElement('link').relList.supports('prefetch');
    } catch(e) {
    }

    async_test(t => {;
      if (!prefetching) {
        t.done();
        return;
      }
      window.addEventListener('securitypolicyviolation', t.unreached_func('No securitypolicyviolation event fired.'));
      let link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = '/content-security-policy/support/pass.png';
      link.onerror = t.unreached_func('onerror should not fire.');
      link.onload = t.step_func_done();
      document.head.appendChild(link);
    }, 'Prefetch succeeds when allowed by prefetch-src');
  </script>
</head>
<body>
</body>
</html>
