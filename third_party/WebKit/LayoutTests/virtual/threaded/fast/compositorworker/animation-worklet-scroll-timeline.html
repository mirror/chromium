<!DOCTYPE html>
<style>
#box {
  width: 100px;
  height: 100px;
  background-color: #00ff00;
  /*
  * Force compositing.
  * TODO(majidvp): Should not be needed when http://crbug.com/776533 is fixed.
  */
  will-change: transform;
}

#covered {
  width: 100px;
  height: 100px;
  background-color: #ff8080;
}

#scroller {
  overflow: auto;
  height: 100px;
  width: 100px;
  /*
  * Force compositing.
  * TODO(smcgruer): Shouldn't be needed.
  */
  will-change: transform;
}

#contents {
  height: 1000px;
  width: 100%;
}
</style>

<div id="scroller">
  <div id="contents"></div>
</div>
<div id="box"></div>
<div id="covered"></div>

<script id="visual_update"  type="text/worklet">
registerAnimator("test_animator", class {
  animate(currentTime, effect) {
    effect.localTime = currentTime / 100;
  }
});
</script>

<script src="resources/animation-worklet-tests.js"></script>
<script>
//if (window.testRunner) {
//  testRunner.waitUntilDone();
//}

runInAnimationWorklet(
  document.getElementById('visual_update').textContent
).then(()=>{
  const box = document.getElementById('box');
  const effect = new KeyframeEffect(box,
    [
     { /*transform: 'translateY(0)',*/ opacity: 1},
     { /*transform: 'translateY(200px)',*/ opacity: 0}
    ], {
      duration: 1000,
      iterations: Infinity /* To get around the bug where WAs are made to finish() after duration */
    }
  );

  const scroller = document.getElementById('scroller');
  const timeline = new ScrollTimeline({ scrollSource: scroller, timeRange: 100, orientation: 'block' });
  const animation = new WorkletAnimation('test_animator', [effect], timeline, {});
  animation.play();

  //if (window.testRunner) {
  //  waitTwoAnimationFrames(_ => {
  //    testRunner.notifyDone();
  //  });
  //}
});
</script>
