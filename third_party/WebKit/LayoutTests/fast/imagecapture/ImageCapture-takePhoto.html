<!DOCTYPE html>
<script src=../../resources/testharness.js></script>
<script src=../../resources/testharnessreport.js></script>
<body>
<canvas id='canvas0' width=10 height=10/>
</body>
<script>

// This test verifies ImageCapture's takePhoto().

var test = async_test(function() {
  var canvas0 = document.getElementById('canvas0');
  var context0 = canvas0.getContext("2d");
  context0.fillStyle = "red";
  context0.fillRect(0, 0, 10, 10);

  var stream = canvas0.captureStream();

  var capturer = new ImageCapture(stream.getVideoTracks()[0]);

  capturer.takePhoto()
    .then(blob => {
      assert_unreached('takePhoto() should not have been resolved');
    })
    .catch(error => {
      // LayoutTests do not have a real or a fake camera whatsoever, so content
      // will not find a matching device for the Track's source id, and the
      // promise will be rejected.
      // TODO(mcasas): Revisit all this when https://crbug.com/610333 is solved.
      this.done();
    });
}, 'exercises the ImageCapture API takePhoto().');

</script>
