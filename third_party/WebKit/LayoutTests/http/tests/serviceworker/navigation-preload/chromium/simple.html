<!DOCTYPE html>
<meta charset="utf-8">
<!-- This test requires internals because it tests Chromium's
     internal UseCounter. -->
<title>Navigation Preload use counter</title>
<script src="../../../resources/testharness.js"></script>
<script src="../../../resources/testharnessreport.js"></script>
<script src="../../resources/test-helpers.js"></script>
<script>
promise_test(t => {
  var script = 'resources/worker.js';
  var scope = 'resources/slow.php';
  return service_worker_unregister_and_register(t, script, scope)
    .then(registration => {
      add_completion_callback(_ => registration.unregister());
      var worker = registration.installing;
      return wait_for_state(t, worker, 'activated');
    })
    .then(() => with_iframe(scope));
}, 'Navigation Preload is used.');
</script>
