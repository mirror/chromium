<html>
<body>
<script src="../../../resources/testharness.js"></script>
<script src="../../../resources/testharnessreport.js"></script>
<script>
var t = async_test("Test the http status and Blob.size of response blob " +
                   "received for XMLHttpRequest");
t.step(function() {
    var req = new XMLHttpRequest;
    var i = 0;
    // Run the test multiple times using the same XMLHttpRequest instance to
    // check if all states are cleared correctly.
    var doRequest = function() {
        req.open('GET', '../resources/test.ogv', true);
        req.responseType = 'blob';
        req.onreadystatechange = t.step_func(function() {
            if (req.readyState != req.OPENED)
              assert_equals(req.status, 200, "Status");
            
            if (req.readyState == req.DONE) {
                assert_equals(req.response.size, 103746, "Size");
                if (++i < 4)
                    doRequest();
                else
                    t.done();
            }
        });
        req.onerror = t.unreached_func("no errors!");
        req.send(null);
    };
    doRequest();
});
</script>
</body>
