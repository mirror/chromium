<!DOCTYPE HTML>
<meta charset=utf-8>
<title>Custom User Timing: measure</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="performanceobservers.js"></script>
<h1>Custom User Timing: measure</h1>
<p>
Custom User Timing: measure
</p>
<div id="log"></div>
<script>
  async_test(function (t) {
    var mark_entries = [];
    var timeStamp1 = self.performance.now();
    var timeStamp2 = 1234.5;
    var timeStamp3 = 66.6;
    var timeStamp4 = 5566;
    var observer = new PerformanceObserver(
        t.step_func(function (entryList, obs) {
          mark_entries =
            mark_entries.concat(entryList.getEntries());
          if (mark_entries.length >= 13) {
            checkEntries(mark_entries,
              [{ entryType: "measure", name: "measure1", detail: null},
              { entryType: "measure", name: "measure2", detail: null},
              { entryType: "measure", name: "measure3", detail: null},
              { entryType: "measure", name: "measure4", detail: null},
              { entryType: "measure", name: "measure5", detail: null},
              { entryType: "measure", name: "measure6", detail: null},
              { entryType: "measure", name: "measure7", detail: null},
              { entryType: "measure", name: "measure8", detail: null},
              { entryType: "measure", name: "measure9", detail: null, duration: timeStamp3 - timeStamp2},
              { entryType: "measure", name: "measure10", detail: null, duration: timeStamp1 - timeStamp2},
              { entryType: "measure", name: "measure11", detail: null},
              { entryType: "measure", name: "measure12", detail: null, duration: timeStamp3 - timeStamp1},
              { entryType: "measure", name: "measure13", detail: null, duration: timeStamp2 - timeStamp1},
              ]);
            observer.disconnect();
            t.done();
          }
        })
      );
    self.performance.clearMarks();
    self.performance.clearMeasures();
    observer.observe({entryTypes: ["measure"]});
    self.performance.mark("mark1", {detail: {randomInfo: 3}, startTime: timeStamp1});
    self.performance.mark("mark2", timeStamp2);

    self.performance.measure("measure1");
    self.performance.measure("measure2", undefined);
    self.performance.measure("measure3", null);
    self.performance.measure("measure4", timeStamp1);
    self.performance.measure("measure5", 'mark1');
    self.performance.measure("measure6", undefined, timeStamp1);
    self.performance.measure("measure7", null, 'mark1');
    self.performance.measure("measure8", timeStamp2, undefined);
    self.performance.measure("measure9", timeStamp2, timeStamp3);
    self.performance.measure("measure10", timeStamp2, 'mark1');
    self.performance.measure("measure11", 'mark1', undefined);
    self.performance.measure("measure12", 'mark1', timeStamp3);
    self.performance.measure("measure13", 'mark1', 'mark2');
  }, "marked entries' detail and startTime are customizable");
</script>
