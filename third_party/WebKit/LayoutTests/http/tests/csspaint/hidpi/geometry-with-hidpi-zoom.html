<!DOCTYPE html>
<html>
<script src="../../resources/run-after-layout-and-paint.js"></script>
<script src="../resources/test-runner-paint-worklet.js"></script>
<style>
html, body { margin: 0; padding: 0; }
.container {
  width: 187px;
  height: 187px;
}

#canvas-geometry {
  background-image: paint(geometry);
}
</style>
<body>
<div id="canvas-geometry" class="container"></div>

<script id="code" type="text/worklet">
registerPaint('geometry', class {
    paint(ctx, geom) {
        // Apparently on Mac and Android, we do not use zoom-for-devicescale. That is, we apply
        // the device scale factor to the layout zoom on other platforms but not Mac and Android.
        // So when we call the CSSPaintDefinition::Paint(), the tile size we got doesn't
        // have the device scale factor applied. When we retrieve the zoom for the layout
        // object, there is no device scale factor applied. This is why we need a special
        // size for mac and android.
        var expected_size = Math.round(187 * 0.33 * devicePixelRatio) / (0.33 * devicePixelRatio);
        var expected_size_mac_android = Math.round(187 * 0.33) / 0.33;
        if ((Math.abs(geom.width - expected_size) < 0.001 && Math.abs(geom.height - expected_size) < 0.001) ||
            (Math.abs(geom.width - expected_size_mac_android) < 0.001 && Math.abs(geom.height - expected_size_mac_android) < 0.001))
            ctx.fillStyle = 'green';
        else
            ctx.fillStyle = 'red';
        ctx.fillRect(0, 0, geom.width, geom.height);
    }
});
</script>

<script>
    document.body.style.zoom = "33%";
    importPaintWorkletAndTerminateTestAfterAsyncPaint(document.getElementById('code').textContent);
</script>
</body>
</html>
