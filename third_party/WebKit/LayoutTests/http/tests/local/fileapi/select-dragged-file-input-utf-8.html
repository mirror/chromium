<!DOCTYPE html>
<meta charset="utf-8">
<title>Select UTF-8-named files in a file input</title>
<link rel="help"
      href="https://html.spec.whatwg.org/multipage/input.html#file-upload-state-(type=file)">
<link rel="author" title="Benjamin C. Wiley Sittler"
      href="mailto:bsittler@chromium.org">
<script src="../../../../resources/testharness.js"></script>
<script src="../../../../resources/testharnessreport.js"></script>
<script src="resources/select-dragged-file-input-helper.js"></script>
<!--

 NOTE: Blink renderer crashes are expected on non-Windows hosts using
 filenames containing characters from outside ASCII. Use a UTF-8
 locale to prevent this, e.g. with:

 bash$ export LC_ALL=en_US.UTF-8 LC_CTYPE=en_US.UTF-8 LANG=en_US.UTF-8

 Any other locale should work too provided it uses UTF-8 character
 encoding.

 Test failures are expected on Windows when using any system "ANSI"
 codepage other than windows-1252. To fix this, upgrade your system's
 Win32.pm Perl module to the latest version.

  -->
<script>
'use strict';

fileInputTest({
  fileNameSource: 'ASCII',
  fileBaseName: 'file-for-drag-to-send3.txt',
});

fileInputTest({
  fileNameSource: 'x-user-defined',
  fileBaseName: 'file-for-drag-to-send3-\uF7F0\uF793\uF783\uF7A0.txt',
});

fileInputTest({
  fileNameSource: 'windows-1252',
  fileBaseName: 'file-for-drag-to-send3-Ã¢ËœÂºÃ°Å¸Ëœâ€š.txt',
});

fileInputTest({
  fileNameSource: 'JIS X 0201 and JIS X 0208',
  fileBaseName: 'file-for-drag-to-send3-â˜…æ˜Ÿâ˜….txt',
});

fileInputTest({
  fileNameSource: 'Unicode',
  fileBaseName: 'file-for-drag-to-send3-â˜ºðŸ˜‚.txt',
});

// Rationale for this particular test character sequence, which is
// used in filenames and also in file contents:
//
// - ABC~ ensures the string starts with something we can read to
//   ensure it is from the correct source; ~ is used because even
//   some 1-byte otherwise-ASCII-like parts of ISO-2022-JP
//   interpret it differently.
// - â€¾Â¥ are inside a single-byte range of ISO-2022-JP and help
//   diagnose problems due to filesystem encoding or locale
// - â‰ˆ is inside IBM437 and helps diagnose problems due to filesystem
//   encoding or locale
// - Â¤ is inside Latin-1 and helps diagnose problems due to
//   filesystem encoding or locale; it is also the "simplest" case
//   needing substitution in ISO-2022-JP
// - ï½¥ is inside a single-byte range of ISO-2022-JP in some variants
//   and helps diagnose problems due to filesystem encoding or locale;
//   on the web it is distinct when decoding but unified when encoding
// - ãƒ» is inside a double-byte range of ISO-2022-JP and helps
//   diagnose problems due to filesystem encoding or locale
// - â€¢ is inside Windows-1252 and helps diagnose problems due to
//   filesystem encoding or locale and also ensures these aren't
//   accidentally turned into e.g. control codes
// - âˆ™ is inside IBM437 and helps diagnose problems due to filesystem
//   encoding or locale
// - Â· is inside Latin-1 and helps diagnose problems due to
//   filesystem encoding or locale
// - â˜¼ is inside IBM437 shadowing C0 and helps diagnose problems due to
//   filesystem encoding or locale and also ensures these aren't
//   accidentally turned into e.g. control codes
// - â˜… is inside ISO-2022-JP on a non-Kanji page and makes correct
//   output easier to spot
// - æ˜Ÿ is inside ISO-2022-JP on a Kanji page and makes correct
//   output easier to spot
// - ðŸŒŸ is outside the BMP and makes incorrect surrogate pair
//   substitution detectable and ensures substitutions work
//   correctly immediately after Kanji 2-byte ISO-2022-JP
// - æ˜Ÿ repeated here ensures the correct codec state is used
//   after a non-BMP substitution
// - â˜… repeated here also makes correct output easier to spot
// - â˜¼ is inside IBM437 shadowing C0 and helps diagnose problems due to
//   filesystem encoding or locale and also ensures these aren't
//   accidentally turned into e.g. control codes and also ensures
//   substitutions work correctly immediately after non-Kanji
//   2-byte ISO-2022-JP
// - Â· is inside Latin-1 and helps diagnose problems due to
//   filesystem encoding or locale
// - âˆ™ is inside IBM437 and helps diagnose problems due to filesystem
//   encoding or locale
// - â€¢ is inside Windows-1252 and again helps diagnose problems
//   due to filesystem encoding or locale
// - ãƒ» is inside a double-byte range of ISO-2022-JP and helps
//   diagnose problems due to filesystem encoding or locale
// - ï½¥ is inside a single-byte range of ISO-2022-JP in some variants
//   and helps diagnose problems due to filesystem encoding or locale;
//   on the web it is distinct when decoding but unified when encoding
// - Â¤ is inside Latin-1 and helps diagnose problems due to
//   filesystem encoding or locale; again it is a "simple"
//   substitution case and also ensures
// - â‰ˆ is inside IBM437 and helps diagnose problems due to filesystem
//   encoding or locale
// - Â¥â€¾ are inside a single-byte range of ISO-2022-JP and help
//   diagnose problems due to filesystem encoding or locale
// - ~XYZ ensures earlier errors don't lead to misencoding of
//   simple ASCII
//
// Overall the near-symmetry makes common I18N mistakes like
// off-by-1-after-non-BMP easier to spot. All the characters
// are also allowed in Windows Unicode filenames.
const kTestChars = 'ABC~â€¾Â¥â‰ˆÂ¤ï½¥ãƒ»â€¢âˆ™Â·â˜¼â˜…æ˜ŸðŸŒŸæ˜Ÿâ˜…â˜¼Â·âˆ™â€¢ãƒ»ï½¥Â¤â‰ˆÂ¥â€¾~XYZ';

fileInputTest({
  fileNameSource: 'Unicode',
  fileBaseName: `file-for-drag-to-send3-${kTestChars}.txt`,
});

</script>
