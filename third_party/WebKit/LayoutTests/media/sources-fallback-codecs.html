<!DOCTYPE html>
<title>Test that fallback among codecs is done correctly regardless of their order.</title>
<script src="../resources/testharness.js"></script>
<script src="../resources/testharnessreport.js"></script>
<script>

function makeSupportedSource() {
    var supportedSource = document.createElement("source");
    supportedSource.type = "video/webm";
    supportedSource.src = "content/test-vp9-opus.webm";
    return supportedSource;
}

function makeUnsupportedSource() {
    let unsupportedSource = document.createElement("source");
    unsupportedSource.type = "video/foo";
    unsupportedSource.src = "content/unsupported_track.mov";
    return unsupportedSource;
}

async_test(function(t) {
    let media = document.createElement("video");

    media.appendChild(makeUnsupportedSource());
    media.appendChild(makeSupportedSource());

    media.oncanplaythrough = t.step_func_done();
}, "Test that canplaythrough is reached with unsupported source first");

async_test(function(t) {
    let media = document.createElement("video");

    media.appendChild(makeSupportedSource());
    media.appendChild(makeUnsupportedSource());

    media.oncanplaythrough = t.step_func_done();
}, "Test that canplaythrough is reached with unsupported source last");
</script>