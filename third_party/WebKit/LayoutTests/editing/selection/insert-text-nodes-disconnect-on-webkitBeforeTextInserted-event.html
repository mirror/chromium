<!DOCTYPE html>
<script src="../../resources/testharness.js"></script>
<script src="../../resources/testharnessreport.js"></script>
<script src="../assert_selection.js"></script>
<script>
selection_test(
    '<div id="sample" contenteditable="true">foo<br>bar<div id="end">baz</div></div>',
    selection => {
        const document = selection.document;
        const sample = document.getElementById("sample");
        selection.collapse(sample, 2);
        selection.extend(document.getElementById("end"), 0);
        sample.addEventListener('webkitBeforeTextInserted', () => {
            // disconnect the node here
            const focusNode =  selection.focusNode;
            focusNode.parentNode.removeChild(focusNode);
        });
        document.execCommand('insertText', false, 'x');
    },
    '<div contenteditable="true" id="sample">foo<br>x|</div>',
    'Inserttext frame invalidation scenario with webkitBeforeTextInserted event');
</script>
