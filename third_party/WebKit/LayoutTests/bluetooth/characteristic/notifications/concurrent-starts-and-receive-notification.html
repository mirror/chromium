<!DOCTYPE html>
<script src="../../../resources/testharness.js"></script>
<script src="../../../resources/testharnessreport.js"></script>
<script src="../../../resources/bluetooth/bluetooth-helpers.js"></script>
<script src="../../../resources/bluetooth/web-bluetooth-test.js"></script>
<script src="../../../resources/mojo-helpers.js"></script>
<script>
'use strict';
promise_test(() => {
  return getMeasurementIntervalCharacteristic()
    .then(({characteristic, fake_characteristic}) => {
      return fake_characteristic.setNextSubscribeToNotificationsResponse(
          GATT_SUCCESS)
        .then(() => Promise.all([
          characteristic.startNotifications(),
          characteristic.startNotifications()
        ]))
        .then(() => Promise.all([
          eventPromise(characteristic, 'characteristicvaluechanged'),
          fake_characteristic.simulateNotification({value: []})
        ]))
        .then(() =>
          fake_characteristic.setNextUnsubscribeFromNotificationsResponse(
            GATT_SUCCESS));
    });
}, 'Starting notification concurrently still can receive notification.');
</script>
