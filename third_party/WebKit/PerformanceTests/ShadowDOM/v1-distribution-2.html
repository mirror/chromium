<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="../resources/runner.js"></script>
</head>
<body>
  <div id="app"></div>
<script>

function createNestedComponent(nest) {
  const x = document.createElement('div');
  x.appendChild(document.createElement('slot'));
  x.appendChild(document.createElement('p'));
  const sr = x.attachShadow({ mode: 'open' });
  if (nest > 0) {
    sr.appendChild(createNestedComponent(nest - 1));
  } else {
    sr.appendChild(document.createElement('slot'));
  }
  return x;
}

const app = document.querySelector('#app');
const children = 10;

function setup() {
  const nest = 200;
  for (let i = 0; i < children; ++i) {
    app.appendChild(createNestedComponent(nest));
  }
}

function run() {
  for (let i = 0; i < children; ++i) {
    const firstChild = app.firstChild;
    firstChild.remove();
    app.appendChild(firstChild);
    firstChild.shadowRoot.firstChild.firstChild.assignedNodes();
  }
}

setup();
document.body.offsetLeft;

PerfTestRunner.measureRunsPerSecond({
  description: "Measure ",
  run: run,
  done: () => {
    app.innerHTML = '';
  }
});
</script>
</body>
</html>
