{
  "comments": [
    {
      "key": {
        "uuid": "7f38ea0a_fd7f23ac",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-10T23:28:16Z",
      "side": 1,
      "message": "Sorry, I still don\u0027t understand the intended behavior here and how this interacts with the change to ShouldPaint... Can someone help me understand this part of the change or help clarify the comment? My primary concern is that immersive/fullscreen browser/popup windows used to pass this conditional in overview mode, but now they might unintentionally fail the conditional.\n\nWould it make sense to add something above the !ShouldPaint check like:\n  // Return a \u003cblah\u003e inset for V1 app windows in overview mode because \u003cblah\u003e.\n  if (in_overview_mode_ \u0026\u0026 browser_view()-\u003ebrowser()-\u003eis_app()) {\n    \u003creturn some value, maybe based on fullscreen/immersize/revealed/overview/etc.\u003e\n  }",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "845c132e_e943c84a",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-11T02:08:50Z",
      "side": 1,
      "message": "oshima@, please verify if I missed anything:\nChanged the code and comment a bit. The code was wrong when immersive not revealed and should be fixed in next patch.\n\n1. The main change in this cl is that: in overview mode, do not pain the header, but do not change the top view inset value. So in the if(!ShouldPaint()) branch, we cannot early out by return 0.\n\n2. overview mode use the top view inset to determine if we should clip the header and align with the fake header. Although we remove the code of clipping the header by hiding the header in this cl, the top view inset area is transparent now and we still need the inset value to align the fake header, so the inset cannot be 0.\n\n3. The only change in ShouldPaint() is that, when non-fullscreen V1 app is in overview mode, we will hide the header. So here I need to exclude this case when (!ShouldPaint() \u0026\u0026 V1 \u0026\u0026 in_overview_mode_) to calculate the V1 app inset in the branch of if (!browser_view()-\u003eIsTabStripVisible()) below. The previous falling through was still correct. But I refactor it a bit to make it more clear.",
      "parentUuid": "7f38ea0a_fd7f23ac",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c4ee30e_eeab1428",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-13T23:34:46Z",
      "side": 1,
      "message": "This explanation is quite helpful, thank you. I guess I\u0027m still ignorant about why the overview mode can\u0027t just actually clip the top header height given this inset value; ie. why must this code (1) not paint the header and (2) still supply the header\u0027s height to be \u0027clipped\u0027? I\u0027m guessing that nothing is actually clipped, but the header size needs to be retained but left unpainted to appear \u0027clipped\u0027. That\u0027s unfortunate, but it seems like the bug discussed a number of options and this came out on top.",
      "parentUuid": "845c132e_e943c84a",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4d37660_52483ef9",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-14T00:21:08Z",
      "side": 1,
      "message": "Currently we use alpha filter to clip the window header in overview mode. Alpha filter is slow (what we believe so, do we have UMA?) and does not work with the optimization of tri-linear filter implemented by reveman@. So we plant to achieve the same effect, but not using alpha filter or mask layer.\n\nAs described in crbug.com/775627#c17, this cl is the fifth method we tried so far and was originally proposed by oshima@. It is exact as you can imagine, the header size needs to be retained but left unpainted to appear \"clipped\". In this way, we can avoid re-layout the windows to make it more efficient. Otherwise, what we can do is really expensive that to do the real clip, re-layout view/contents, and then transform the client-view back to the old position to make animation smooth. In this way, we hope the re-layout will not cause any visual movement of the webcontents or UI components.\n\nWith this cl, it looks work pretty well but definitely requires some polish later. E.g. due to the deferring painting applied in overview mode animation, the hide/show headers is deferred to update on the end of the animation. In the follow up cls, we need to wait the finishes of draw/swap events of hide/show header and then start the animation.",
      "parentUuid": "6c4ee30e_eeab1428",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55ca9d32_76930128",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-14T00:59:03Z",
      "side": 1,
      "message": "I don\u0027t know this area well, but I\u0027ll readily believe that if the window doesn\u0027t have a top-level ui::Layer, that \u0027clipping\u0027 is only achievable via some expensive alpha blending or similar, and there\u0027s no cheap way to actually clip the window. So, I\u0027ll go along with this approach, feel free to reply to my other comments and we can nail this CL down. Thanks for your patience.",
      "parentUuid": "e4d37660_52483ef9",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f4e4d655_5b32c8e6",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 381,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-10T23:28:16Z",
      "side": 1,
      "message": "nit: \"Schedule a paint to hide the header.\"",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b894b48_99e702a4",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 381,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-11T02:08:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f4e4d655_5b32c8e6",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "13e899e5_59819f6d",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 388,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-10T23:28:16Z",
      "side": 1,
      "message": "nit: \"Schedule a paint to show the header.\"",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "90bac906_2541d11b",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 388,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-11T02:08:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "13e899e5_59819f6d",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4dd72028_9f9c5053",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 514,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-10T23:28:16Z",
      "side": 1,
      "message": "nit: \"Do not paint for V1 apps in overview mode.\"",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "167c8974_9718b941",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 514,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-11T02:08:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4dd72028_9f9c5053",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8626408a_4ef79e8c",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 515,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-10T23:28:16Z",
      "side": 1,
      "message": "Does this also change the behavior of popup windows? Is that intentional?\nTest with: javascript:window.open(\"about:blank\", \"_blank\", \"width\u003d300,height\u003d200\")\nShould this statement be changed to the following (as you mentioned earlier?):\n  return !browser_view()-\u003ebrowser()-\u003eis_app() || !in_overview_mode_;",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "deebaa64_fa08934c",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc",
        "patchSetId": 6
      },
      "lineNbr": 515,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-11T02:08:50Z",
      "side": 1,
      "message": "Thanks to point this out.\nMy impression was that V1 apps include hosted apps/popup windows. From the code here [1,2], let me guess any apps without tab strip, we should hide the header?\n\"Settings\" is a popup windows, we should not show the header in overview mode as well. So I think the old code was correct browser_view()-\u003eIsBrowserTypeNormal() \u003d\u003d browser_view()-\u003ebrowser()-\u003eis_type_tabbed().\nI might need to change this cl\u0027s description if I was wrong about the V1 app and popup windows.\n\nBut now there is new case when testing your popup windows: the icon is not hide. I will fix it in the next patch. Thank you!\n\n1. where we set the kTopViewInset: https://cs.chromium.org/chromium/src/chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.cc?l\u003d329\u0026rcl\u003dfa39c3323b4cf29ce81ff0b91618e200abd50614\n2. where we get the kTopViewInset in overview mode. If the inset \u003e 0, then clip the header:\nhttps://cs.chromium.org/chromium/src/ash/wm/overview/scoped_transform_overview_window.cc?l\u003d418\u0026rcl\u003dda2acb8c30a722b25ee5266f40ad70f1a098bd52",
      "parentUuid": "8626408a_4ef79e8c",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc5287c4_51485790",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.h",
        "patchSetId": 6
      },
      "lineNbr": 129,
      "author": {
        "id": 1001118
      },
      "writtenOn": "2017-11-10T23:28:16Z",
      "side": 1,
      "message": "nit: \"Indicates whether overview mode is active. Hide the header for V1 apps...\"",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e7d6e61_856f6237",
        "filename": "chrome/browser/ui/views/frame/browser_non_client_frame_view_ash.h",
        "patchSetId": 6
      },
      "lineNbr": 129,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-11-11T02:08:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bc5287c4_51485790",
      "revId": "a481b4f08acb2fa89cd6aeb43c493e6c7070428f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}