{
  "comments": [
    {
      "key": {
        "uuid": "8703792a_273f0019",
        "filename": "media/filters/decoder_stream.cc",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-06-06T06:07:10Z",
      "side": 1,
      "message": "When we \"should find another decoder\", we\u0027ll blacklist the current decoder, which would work in most cases, but seems wrong and could cause more failures in some case. For example, we use sw decoder first, then get a higher res video, so SFAD() returns true, and we blacklist the sw decoder. Then hw decoder init failed, and playback will fail. In this case, what we really want is to use ALLOW_ALL_DECODERS here, and after we generate the list of decoders in DecoderSelector (using the callback), we sort the decoders based on the config, e.g. for high res video, we put the hw decoder first, and for low res video, we put the sw decoder first. That actually seems the right thing to do even for the initial decoder selection...",
      "revId": "3562fab9554c4ee0b8ca9eccf2acb059f4766021",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "40c0094d_4274a0d3",
        "filename": "media/filters/decoder_stream.cc",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1001250
      },
      "writtenOn": "2017-06-07T00:09:02Z",
      "side": 1,
      "message": "Yes, whoops, this is a bug. It should be ALLOW_ALL_DECODERS.",
      "parentUuid": "8703792a_273f0019",
      "revId": "3562fab9554c4ee0b8ca9eccf2acb059f4766021",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aac95bc8_3129d379",
        "filename": "media/filters/decoder_stream.cc",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1002182
      },
      "writtenOn": "2017-06-07T04:46:40Z",
      "side": 1,
      "message": "I see. \n\nThis is good. But does it still make sense to adjust the order of decoders based on some criteria, instead of hard coding some restrictions? The nicer part of that is that if one decoder fails for unexpected reason, we will still be able to choose another decoder. For example, for this CL, if the video res changes to 240p, and software decoder actually fails, we\u0027ll fail playback. But if we put the hw decoder after the sw decoder and doesn\u0027t specify a hard constraint, we\u0027ll still be able to use the hw decoder. (Well, after writing this, I feel this is probably a very rare case. But I wonder whether it makes more sense when we have more rules in the future.)\n\nIf it still makes any sense to you, to adjust order of decoders, we could add something like\n\nint VideoDecoder::ComfortableLevel(video_decoder_config)\n\nwhere the return value could be in the range of [0, 10], where 0 means \"not supported\", and 10 means \"I am the best decoder for this config\".\n\nFor now, this is probably overkill. But if we ever need more complicated logic, this might make sense.",
      "parentUuid": "40c0094d_4274a0d3",
      "revId": "3562fab9554c4ee0b8ca9eccf2acb059f4766021",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}