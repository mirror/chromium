{
  "comments": [
    {
      "key": {
        "uuid": "207920f7_f191914d",
        "filename": "components/arc/connection_holder.h",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1003166
      },
      "writtenOn": "2017-11-29T22:09:24Z",
      "side": 0,
      "message": "Expanding a bit on the rationale behind removing this DCHECK: since we currently only support one Instance being alive at the same time, if we ever have more than one, we want to disconnect one. Since that scenario _can_ legally happen, instead of stating it as a precondition / crash, we need to arbitrarily choose one of the two to become the canonical instance, and I chose the most recent one to be that (in case the previous instance is still alive for some reason and wedged).",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 134,
        "endChar": 0
      },
      "revId": "875cf13e107f44d264b24b579fba5abeb51d4c99",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dbacf72d_65461051",
        "filename": "components/arc/connection_holder.h",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-30T07:30:19Z",
      "side": 0,
      "message": "\u003e Since that scenario _can_ legally happen,\n\nWhat is the expected scenario do you think?\nIt reminds me crbug.com/782895. In this bug case, connection / closed event order is swapped.\nAs a result, SetInstace(other_instance, ...) is called before SetInstace(nullptr);\nIndeed, removing DCHECK and allowing the reversed order would help to avoid crashing,\nbut practically, because SetInstance(nullptr) is called just after, it will trigger closing event to ArcService, so from users\u0027 perspective, it is still unusable...?\n\nWDYT?",
      "parentUuid": "207920f7_f191914d",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 134,
        "endChar": 0
      },
      "revId": "875cf13e107f44d264b24b579fba5abeb51d4c99",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bbc80153_7a32a867",
        "filename": "components/arc/connection_holder.h",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1003166
      },
      "writtenOn": "2017-11-30T16:12:53Z",
      "side": 0,
      "message": "Ah actually now that I think about it, this _might_ be exactly it! Let\u0027s say there\u0027s a Java service that wants to reconnect to the host. Since Java objects are not guaranteed to be destroyed (and due to https://crbug.com/725661 the object might linger a bit after it\u0027s stopped being used), the closing might happen later than the connection.\n\nIn other news, I totally messed up the clearing of |instance_|. You\u0027re right, I shouldn\u0027t have cleared it. I think I\u0027ll just keep it alive for the time being and rely on instance() returning nullptr when it\u0027s not connected. Doing that in another change.",
      "parentUuid": "dbacf72d_65461051",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 134,
        "endChar": 0
      },
      "revId": "875cf13e107f44d264b24b579fba5abeb51d4c99",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}