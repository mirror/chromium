{
  "comments": [
    {
      "key": {
        "uuid": "1cb13a58_3ea5d2c9",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/ntp/cards/SuggestionsSectionTest.java",
        "patchSetId": 5
      },
      "lineNbr": 72,
      "author": {
        "id": 1122966
      },
      "writtenOn": "2017-09-19T18:28:59Z",
      "side": 1,
      "message": "bauerb@ - what needs to be done to get these tests working with modern? It looks like these tests are failing:\n\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testAddSuggestionsNotification\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testRemoveSuggestionNotificationWithButton\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testGetDismissalGroupWithoutAction\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testGetDismissalGroupActionAndHeader\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testRemoveSuggestionNotification\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testDismissSibling\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testGetItemDismissalGroupWithActionItem\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testGetDismissalGroupWithoutHeader\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testGetItemDismissalGroupWithoutActionItem\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testSetStatusNotification\norg.chromium.chrome.browser.ntp.cards.SuggestionsSectionTest#testDismissSection\n\n\n\nI tried running these locally and I\u0027m getting NPE exceptions on all of them when checking if Chrome Home, so I must be doing something wrong. Have you run into this?",
      "range": {
        "startLine": 72,
        "startChar": 0,
        "endLine": 72,
        "endChar": 58
      },
      "revId": "d3a51c213e8ae13b7d29b4aaa367761e46566f62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bbf04986_5575e5b9",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/ntp/cards/SuggestionsSectionTest.java",
        "patchSetId": 5
      },
      "lineNbr": 72,
      "author": {
        "id": 1001606
      },
      "writtenOn": "2017-09-20T11:12:35Z",
      "side": 1,
      "message": "Yes, you shouldn\u0027t remove the @Features annotations completely. In local JUnit tests, each feature that is tested must be explicitly enabled or disabled, because there is no native side from which to get the default state. When I changed this to disable Chrome Home, the tests pass for me.",
      "parentUuid": "1cb13a58_3ea5d2c9",
      "range": {
        "startLine": 72,
        "startChar": 0,
        "endLine": 72,
        "endChar": 58
      },
      "revId": "d3a51c213e8ae13b7d29b4aaa367761e46566f62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f976c58a_6a9bc970",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/ntp/cards/SuggestionsSectionTest.java",
        "patchSetId": 5
      },
      "lineNbr": 72,
      "author": {
        "id": 1122966
      },
      "writtenOn": "2017-09-21T00:03:34Z",
      "side": 1,
      "message": "The same tests were still failing for me on the trybots :( They all pass locally when I disable Chrome Home. When I enabled Chrome Home locally, the tests fail in the same way there were previously failing on the bots, so I suspect there\u0027s some issue with the static sIsChromeHomeEnabled saved in FeatureUtilities.\n\nI added a call to FeatureUtilities.resetChromeHomeEnabledForTests(); in this class\u0027s #setUp() and the bots are happy now. Does that seem like a reasonable fix?",
      "parentUuid": "bbf04986_5575e5b9",
      "range": {
        "startLine": 72,
        "startChar": 0,
        "endLine": 72,
        "endChar": 58
      },
      "revId": "d3a51c213e8ae13b7d29b4aaa367761e46566f62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4f9c2cb_f1bb2d43",
        "filename": "chrome/android/junit/src/org/chromium/chrome/browser/ntp/cards/SuggestionsSectionTest.java",
        "patchSetId": 5
      },
      "lineNbr": 72,
      "author": {
        "id": 1001606
      },
      "writtenOn": "2017-09-21T09:18:22Z",
      "side": 1,
      "message": "\u003e The same tests were still failing for me on the trybots :( They all pass locally when I disable Chrome Home. When I enabled Chrome Home locally, the tests fail in the same way there were previously failing on the bots, so I suspect there\u0027s some issue with the static sIsChromeHomeEnabled saved in FeatureUtilities.\n\nRight, local JUnit tests run multiple tests in a single VM instance, so |sIsChromeHomeEnabled| could carry state over between test runs.\n\n\u003e I added a call to FeatureUtilities.resetChromeHomeEnabledForTests(); in this class\u0027s #setUp() and the bots are happy now. Does that seem like a reasonable fix?\n\nCould you also reset the cached value in tearDown()? Ideally we\u0027d get to a state where each test would do that, so we wouldn\u0027t have to do it in setUp anymore.\n\n(Nicolas, maybe we should add that to the ChromeHome.Processor rule? Does it work with local JUnit tests?)",
      "parentUuid": "f976c58a_6a9bc970",
      "range": {
        "startLine": 72,
        "startChar": 0,
        "endLine": 72,
        "endChar": 58
      },
      "revId": "d3a51c213e8ae13b7d29b4aaa367761e46566f62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}