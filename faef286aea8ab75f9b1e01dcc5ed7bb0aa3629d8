{
  "comments": [
    {
      "key": {
        "uuid": "88e564ab_a3d61403",
        "filename": "ash/shutdown_controller.h",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "i think you can probably forward-declare ShutdownReason in headers since it\u0027s an enum class, right?",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b002ed81_55825574",
        "filename": "ash/shutdown_controller.h",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "88e564ab_a3d61403",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5f2d9ee4_5d48256b",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "nit: maybe LOGIN_SHUT_DOWN_BUTTON? i think we call it the login screen more often than we call it the signin screen (but maybe i\u0027m wrong), and we also use \"Shut down\" (the verb) instead of \"Shutdown\" (the noun) on both the login/lock screen button and the system tray tooltip.\n\nthis can also probably be from either the login screen or the lock screen; i think we use mostly the same code for both. do we want to distinguish between the two?",
      "range": {
        "startLine": 13,
        "startChar": 2,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d6fe776_f2a49808",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "re: signin vs login: see the last file in this change: login/signin_screen_handler.cc\n\nSo...both?",
      "parentUuid": "5f2d9ee4_5d48256b",
      "range": {
        "startLine": 13,
        "startChar": 2,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e443f44_8d86c578",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T23:02:10Z",
      "side": 1,
      "message": "is it possible to differentiate between the two and have e.g. LOGIN_SHUT_DOWN_BUTTON and LOCK_SHUT_DOWN_BUTTON?",
      "parentUuid": "8d6fe776_f2a49808",
      "range": {
        "startLine": 13,
        "startChar": 2,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a007cc7a_cacb43b0",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-22T16:31:23Z",
      "side": 1,
      "message": "Probably, but I haven\u0027t figured out how yet. If it seems like a useful distinction I can take a closer look.",
      "parentUuid": "2e443f44_8d86c578",
      "range": {
        "startLine": 13,
        "startChar": 2,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "67d697ef_37ea4ee2",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-22T16:46:20Z",
      "side": 1,
      "message": "doesn\u0027t seem really necessary to me, as long as the action name and/or description makes it clear that it represents requests from both sources.",
      "parentUuid": "a007cc7a_cacb43b0",
      "range": {
        "startLine": 13,
        "startChar": 2,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c72e2ad9_f3d0e095",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-22T17:11:21Z",
      "side": 1,
      "message": "FYI, it looks like \"login\" is used to refer to the generic lock/account picker UI.",
      "parentUuid": "67d697ef_37ea4ee2",
      "range": {
        "startLine": 13,
        "startChar": 2,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d4fe017_c39371c2",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "nit: TRAY_SHUT_DOWN, or maybe TRAY_SHUT_DOWN_BUTTON (see below)?",
      "range": {
        "startLine": 14,
        "startChar": 2,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed865948_43e865a0",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3d4fe017_c39371c2",
      "range": {
        "startLine": 14,
        "startChar": 2,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e1ffbb7_2daf94da",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "you probably also need an entry for the \"Update to restart\" button in the system tray. looking at the code, i think it\u0027s ash/system/update/tray_update.cc, and it goes through Shell::Get()-\u003esystem_tray_controller()-\u003eRequestRestartForUpdate().",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c96a717_294e06c6",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "That restart path doesn\u0027t pass through here. I just traced it to platform2/power_manager and found another ShutdownReason: https://cs.corp.google.com/chromeos_public/src/platform2/power_manager/common/power_constants.h?rcl\u003d7a87834574153f6563c922f38527641eb3daf3f5\u0026l\u003d284\n\nWould it make more sense to expand the \"Power.ShutdownReason\" UMA enum defined in power_manager?",
      "parentUuid": "4e1ffbb7_2daf94da",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b06121b6_5a3f1cc1",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:44:36Z",
      "side": 1,
      "message": "Power.ShutdownReason\u0027s metric owner is...derat.",
      "parentUuid": "4c96a717_294e06c6",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3435b675_cdc60b4d",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T23:02:10Z",
      "side": 1,
      "message": "yes, i\u0027m quite aware of that. :-)\n\ni\u0027m pretty convinced that we shouldn\u0027t pass ui-related metrics through to powerd. also note that the system can shut down for lots of different reasons that don\u0027t have anything to do with the ui.\n\npowerd generates a histogram of shutdown reasons, while these chrome metrics are reported as user actions (typically used to compare the popularity of different accelerators or buttons in the ui).\n\nif \"Update to restart\" doesn\u0027t pass through here, that\u0027s fine. i\u0027d recommend reporting a separate action in the handler for that button if we don\u0027t do so already.",
      "parentUuid": "b06121b6_5a3f1cc1",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b9126af2_93df79ba",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-22T16:31:23Z",
      "side": 1,
      "message": "Got it. To clarify, you are suggesting adding a \"user explicitly chose to restart to update\" event?",
      "parentUuid": "3435b675_cdc60b4d",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc3ad3cb_a05643a8",
        "filename": "ash/shutdown_reason.h",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-22T16:46:20Z",
      "side": 1,
      "message": "it\u0027s something i\u0027d expect us to report, although it\u0027s hard to predict when/if a particular metric is needed to make a UX decision. i\u0027m fine with punting on it for now if we don\u0027t have something like that already.\n\nmy reason for filing the bug was that i actually needed to look at user behavior regarding power buttons for a UX discussion, and then discovered after looking at the code that we\u0027re misreporting various things. :-/",
      "parentUuid": "b9126af2_93df79ba",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc6b3965_46ff56ac",
        "filename": "ash/wm/lock_state_controller.h",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "nit that isn\u0027t your fault and probably shouldn\u0027t be part of this change: this arg should\u0027ve been named \"shut_down_after_lock\" :-/",
      "range": {
        "startLine": 61,
        "startChar": 6,
        "endLine": 61,
        "endChar": 25
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc9672ff_cff1e40a",
        "filename": "ash/wm/lock_state_controller.h",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "fc6b3965_46ff56ac",
      "range": {
        "startLine": 61,
        "startChar": 6,
        "endLine": 61,
        "endChar": 25
      },
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c32f4460_55e7f476",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "it seems weird to be attaching a shutdown reason to a lock request. is StartLockAnimationAndLockImmediately also called through another path that can shut down later without getting a chance to send a reason then?\n\nalso, should this be POWER_BUTTON instead of UNKNOWN?",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "68aeb1b7_700ea780",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "StartLockAnimationAndLockImmediately shuts down (eventually) if passed true, but not false. I agree it is awkward. Maybe would be better to split that boolean functionality into 2 methods anyway.",
      "parentUuid": "c32f4460_55e7f476",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70a195c0_d7615947",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:54:39Z",
      "side": 1,
      "message": "Actually, do you understand what is happening here? https://cs.chromium.org/chromium/src/ash/wm/power_button_controller.cc?l\u003d119\n\nIt looks like it is supposed to lock and then (if you keep holding the power button?) shut down, but I\u0027m having trouble reproducing on an actual device.",
      "parentUuid": "68aeb1b7_700ea780",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "045c3c94_77fdd201",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T23:07:53Z",
      "side": 1,
      "message": "this is the \"legacy power button\" path. it\u0027s only used for systems that have regular ACPI power buttons that don\u0027t report button-down and button-up separately -- instead, both events come in simultaneously. for the most part, i think that it only applies to chromeboxes (e.g. stumpy, panther). i\u0027m not sure about chromebases. i think you can pass --aura-legacy-power-button to chrome (see /etc/chrome_dev.conf) to force it on a chromebook, though.\n\noh, and to answer your specific question, the intended user experience is that the first button-down event locks the screen and a second event while locked shuts the system down. at the login screen or in guest mode, where locking isn\u0027t possible, the first event shuts down instead. we ignore legacy button-up events since they\u0027re meaningless.",
      "parentUuid": "70a195c0_d7615947",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "50cf64af_00d55146",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-22T16:31:23Z",
      "side": 1,
      "message": "I get the legacy path but I\u0027m looking at the line `lock_state_controller_-\u003eStartLockAnimation(true);` in the `!has_legacy_power_button_` clause. That should be the path for chromebooks, right? I am not seeing any way to lock the screen with the power button on the two devices on my desk. This is the only place that \"lock then shutdown\" path is used, so if it isn\u0027t actually needed we could tear out a bit of confusing code.",
      "parentUuid": "045c3c94_77fdd201",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2b15fc2_1542306b",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 122,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-22T16:46:20Z",
      "side": 1,
      "message": "(continuing discussion from above)\n\nLockStateController::PostLockAnimationFinished checks shutdown_after_lock_ (the \"true\" in this call) and calls StartLockToShutdownTimer, which waits 150 ms and calls StartCancellableShutdownAnimation, which starts the shutdown animation, etc.\n\ndoes that answer the question?",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f99711d5_43e172ea",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 122,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-22T16:54:27Z",
      "side": 1,
      "message": "But there isn\u0027t any \"lock animation\" that I can see when I try to trigger this path (and I\u0027m pretty sure I\u0027m triggering this path?). What is the difference between this and the StartShutdownAnimation immediately below?",
      "parentUuid": "e2b15fc2_1542306b",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c629e045_d467b713",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 122,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-22T16:58:40Z",
      "side": 1,
      "message": "ah, i just realized that you\u0027re probably testing with a convertible chromebook with a side power button. those are handled by ash/system/power/tablet_power_button_controller.h, and the behavior is different (tapping the button turns the screen off and possibly locks; holding it shuts down).\n\ntry using a non-convertible chromebook to exercise this code.",
      "parentUuid": "f99711d5_43e172ea",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7720644a_d1449c1b",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 122,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-22T17:11:21Z",
      "side": 1,
      "message": "Ah, that explains it. I do think it will be less confusing if there is a separate method for the StartLockAnimation(true) behavior rather than using that boolean; maybe `StartLockThenShutdownAnimation`.",
      "parentUuid": "c629e045_d467b713",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72e81a70_28469caa",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 155,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "same comment as above",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3bc8667_3e3bca31",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 155,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2017-06-21T22:03:39Z",
      "side": 1,
      "message": "same comment as above",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a2c78e9f_7b0230d3",
        "filename": "ash/wm/power_button_controller.cc",
        "patchSetId": 1
      },
      "lineNbr": 155,
      "author": {
        "id": 1210164
      },
      "writtenOn": "2017-06-21T22:26:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d3bc8667_3e3bca31",
      "revId": "faef286aea8ab75f9b1e01dcc5ed7bb0aa3629d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}