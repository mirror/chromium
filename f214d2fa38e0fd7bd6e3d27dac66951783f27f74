{
  "comments": [
    {
      "key": {
        "uuid": "ba322f7b_2b3ce1c5",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified.cc",
        "patchSetId": 2
      },
      "lineNbr": 237,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2018-02-01T03:00:20Z",
      "side": 1,
      "message": "I think this is going to clear storage too much. It will be highly polished, essentially.\nIndeed, lets say user opens DH, clicks on page (it opens), clicks on Back (when it works), opens another page etc. With just an interval in a minute we\u0027ll run several more fetches from database (it\u0027s not memory-backed anymore), and then pretty massive file operations. This trigger happens when some UI is being opened. We do care about smoothness and speed of this operation. Populating UI, especially on slow devices, may become junky if we schedule/run all those tasks.\n\nWould it be sufficient to only run on this trigger once per Chrome session and also delay tasks say 10 seconds or so to allow the whatever caused GetAllItems to fully show up?",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9288dfe3_54e23958",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified.cc",
        "patchSetId": 2
      },
      "lineNbr": 237,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2018-02-06T23:18:23Z",
      "side": 1,
      "message": "As discussed offline the behavior is very similar to what it used to be before: 3 tasks run only once per session and 1 runs at most as often as dictated by `kClearStorageInterval`.\n\nIRT adding a delay between scheduling and execution: as that will add some complexity (even if little) shouldn\u0027t we base this off actual detected regressions? WDYT?",
      "parentUuid": "ba322f7b_2b3ce1c5",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "37970c9e_c102e0bf",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified.cc",
        "patchSetId": 2
      },
      "lineNbr": 419,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2018-02-01T03:00:20Z",
      "side": 1,
      "message": "Do we really need to run all cleanup tasks at this point, for example consistency checks? Or every time? Perhaps only ClearStorageTask needs to run, and maybe only once per Chrome session? Not sure what is optimal here, but I\u0027m trying to avoid doing heavy ops while lets say OPC page is saved (on every tab switch/going to background).",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "11a09452_89948029",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified.cc",
        "patchSetId": 2
      },
      "lineNbr": 419,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2018-02-06T23:18:23Z",
      "side": 1,
      "message": "Explained in the other comment.",
      "parentUuid": "37970c9e_c102e0bf",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c7da1467_84599438",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified.cc",
        "patchSetId": 2
      },
      "lineNbr": 478,
      "author": {
        "id": 1184710
      },
      "writtenOn": "2018-01-31T23:18:43Z",
      "side": 1,
      "message": "will it make more sense if this is moved into OnClearCachedPagesDone?",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d70fdd23_a85542f6",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified.cc",
        "patchSetId": 2
      },
      "lineNbr": 478,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2018-02-06T23:18:23Z",
      "side": 1,
      "message": "I moved this here to avoid the possibility of double-scheduling this task. That was possible if some AddPage or GetAllPages tasks were scheduled in sequence and this method method was called more than once before OnClearCachedPagesDone was called. This change avoids that.\n\nAlso, there\u0027s not practical difference between tracking the scheduling time versus the conclusion time and the former makes the code slightly simpler as this variable is only accessed by this single method.",
      "parentUuid": "c7da1467_84599438",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e28f38ae_f14b9844",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 1296,
      "author": {
        "id": 1184710
      },
      "writtenOn": "2018-01-31T23:18:43Z",
      "side": 1,
      "message": "following the previous comment. It seems it\u0027s not enough to confirm if the ClearPageTask has been scheduled by only checking this value if the last_clear_page_time_ is updated outside of callback?",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c544edf_639eb3d9",
        "filename": "components/offline_pages/core/model/offline_page_model_taskified_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 1296,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2018-02-06T23:18:23Z",
      "side": 1,
      "message": "Right! I was finally only checking that the task was scheduled and not executed. I do check for execution now based on the UMA data. Good catch.",
      "parentUuid": "e28f38ae_f14b9844",
      "revId": "f214d2fa38e0fd7bd6e3d27dac66951783f27f74",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}