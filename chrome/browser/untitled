// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

#ifndef CHROME_BROWSER_METRICS_UPGRADE_METRICS_PROVIDER_H_
#define CHROME_BROWSER_METRICS_UPGRADE_METRICS_PROVIDER_H_

#include <stdint.h>

#include <memory>
#include <string>

#include "base/macros.h"
#include "components/metrics/metrics_provider.h"

class Profile;

namespace extensions {
class ExtensionSet;
}

namespace metrics {
class MetricsStateManager;
class SystemProfileProto;
}

// UpgradeMetricsProvider groups various constants and functions used for
// reporting extension IDs with UMA reports (after hashing the extension IDs
// for privacy).
class UpgradeMetricsProvider : public metrics::MetricsProvider {
 public:
  // Holds on to |metrics_state_manager|, which must outlive this object, as a
  // weak pointer.
  explicit UpgradeMetricsProvider(
      metrics::MetricsStateManager* metrics_state_manager);
  ~UpgradeMetricsProvider() override;

  // metrics::MetricsProvider:
  void ProvideCurrentSessionData(ChromeUserMetricsExtension* uma_proto)
      override;

 private:
  // Returns the profile for which extensions will be gathered.  Once a
  // suitable profile has been found, future calls will continue to return the
  // same value so that reported extensions are consistent.
  Profile* GetMetricsProfile();


  DISALLOW_COPY_AND_ASSIGN(UpgradeMetricsProvider);
};

#endif  // CHROME_BROWSER_METRICS_UPGRADE_METRICS_PROVIDER_H_
