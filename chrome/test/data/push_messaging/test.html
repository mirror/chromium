<!DOCTYPE html>
<html>
 <head>
  <title>Push API Test</title>
  <link rel="manifest" href="manifest.json">
  <script>
    function sendResultToTest(result) {
      console.log(result);
      if (window.domAutomationController) {
        domAutomationController.send('' + result);
      }
    }

    function sendErrorToTest(error) {
      sendResultToTest(error.name + ' - ' + error.message);
    }

    function registerServiceWorker() {
      navigator.serviceWorker.register('service_worker.js', {scope: './'}).then(function(swRegistration) {
        console.log(swRegistration);
        sendResultToTest('ok');
      }, sendErrorToTest);
    }

    function registerPush() {
      navigator.serviceWorker.ready.then(function() {
        // TODO(peter): Remove the argument once Blink no longer requires it.
        navigator.push.register('DEPRECATED').then(function(pushRegistration) {
          sendResultToTest(pushRegistration.pushEndpoint + ' - ' + pushRegistration.pushRegistrationId);
        }, sendErrorToTest);
      }, sendErrorToTest);
    }
  </script>
 </head>
 <body>Push API Test</body>
</html>
