<html>
  <head>
    <!--stylesheet-->
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>

  <body>
    <iframe src="subframe.html"></iframe>

  <script type="text/javascript">
      function testWebSocket(url) {
        var ws = new WebSocket(url);
        var message = "hello world";
        ws.onmessage = (event) => {
          window.domAutomationController.send(message == event.data);
        }
        ws.onerror = () => {
          window.domAutomationController.send(false);
        }
        ws.onopen = () => {
          console.log("on open");
          ws.send(message);
        }
      }

      function testImage() {
        var img = document.createElement('img');
        img.addEventListener('load', () => {
          window.domAutomationController.send(true);
        });
        img.addEventListener('error', () => {
          window.domAutomationController.send(false);
        });
        img.src = "extension_types.png";
        document.body.appendChild(img);
      }

      function testXHR() {
        var xhr = new XMLHttpRequest();
        xhr.responseType = "text";
        xhr.addEventListener("load", () => {
          console.log(xhr.responseText);
          window.domAutomationController.send(xhr.status == 200 && xhr.responseText == "Hello World\n");
        });
        xhr.addEventListener("error", () => {
          window.domAutomationController.send(false);
        });
        xhr.open("GET", "xhr_target.txt");
        xhr.send();
      }

      function testScript() {
          var script = document.createElement('script');
          script.addEventListener('load', () => {
            window.domAutomationController.send(true);
          });
          script.addEventListener('error', () => {
            window.domAutomationController.send(false);
          });
          script.src = "dir1/included_script.js";
          document.body.appendChild(script);
      }

      function testMedia() {
        var audio = document.createElement('audio');
        audio.addEventListener('loadeddata', () => {
          window.domAutomationController.send(true);
        });
        audio.addEventListener('error', () => {
          window.domAutomationController.send(false);
        });
        audio.src = "ping.mp3";
        document.body.appendChild(audio);
      }

      function testStylesheet() {
        var link = document.createElement('link');
        link.addEventListener('load', () => {
          window.domAutomationController.send(window.getComputedStyle(document.body).getPropertyValue("background-color") == "rgb(0, 0, 255)");
        });
        link.addEventListener('error', () => {
          window.domAutomationController.send(false);
        });
        link.rel = "stylesheet";
        link.href = "style.css";
        document.getElementsByTagName('head')[0].appendChild(link)
      }
  </script>

  </body>
  </html>
