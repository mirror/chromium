{
  "comments": [
    {
      "key": {
        "uuid": "1a50961a_16e72c71",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 805,
      "author": {
        "id": 1127744
      },
      "writtenOn": "2017-11-22T22:53:02Z",
      "side": 1,
      "message": "nit: Very likely this method will grow in size. Suggest moving this to a separate method.",
      "range": {
        "startLine": 805,
        "startChar": 5,
        "endLine": 805,
        "endChar": 11
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2116d3d8_192299e8",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 805,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-22T22:54:58Z",
      "side": 1,
      "message": "You should not plan to build too much on the current infrastructure - this class, and the ability to retrieve callbacks in the middle of network requests, is going away.",
      "parentUuid": "1a50961a_16e72c71",
      "range": {
        "startLine": 805,
        "startChar": 5,
        "endLine": 805,
        "endChar": 11
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32fe1391_1a2e3323",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 805,
      "author": {
        "id": 1147716
      },
      "writtenOn": "2017-11-27T17:06:43Z",
      "side": 1,
      "message": "Tarun, yes, I expect to do that in a follow up CL per the below TODO. I think I will also want to rename the existing DeterminePreviewsState to something like DetermineEnabledPreviewsState and then add something like DetermineCommittedPreviewsState. \n\nMatt, is there anything concrete you can point me too on the \"new\" way vs. this to-be-deprecated delegate?",
      "parentUuid": "2116d3d8_192299e8",
      "range": {
        "startLine": 805,
        "startChar": 5,
        "endLine": 805,
        "endChar": 11
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22e0bffd_5e190630",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 805,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-27T17:38:56Z",
      "side": 1,
      "message": "This code doesn\u0027t seem to match any common pattern, and does a lot of different things.\n\nFor this Javascript-disabling-specific logic, it seems like all the logic could be done in the render, as it has access to the URL and the previews flags.\n\nLofi-mode itself, which I think only sends magic headers to requests sent to the DRP, on the other hand, I\u0027m not sure about.  If we wanted to make it a web-exposed header (Maybe a client hint or something?), that would be trivial to just attach in the renderer, too, though that would require standardization.",
      "parentUuid": "32fe1391_1a2e3323",
      "range": {
        "startLine": 805,
        "startChar": 5,
        "endLine": 805,
        "endChar": 11
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0313586_13a29141",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 805,
      "author": {
        "id": 1147716
      },
      "writtenOn": "2017-11-27T17:57:52Z",
      "side": 1,
      "message": "The general problem is that we need to make a \"final\" previews decision upon receiving the main frame headers (since it could contain flywheel preview determination). We have 3 places currently using that decision: UMA in I/O; PreviewsInfoBar in UI; and doing the intervention in the renderer (if LoFi or NoScript). Currently the response headers are [re]checked in all 3 places. This isn\u0027t scaling well especially wrt handling redirects between HTTP and HTTPS - to try to correctly repeat the decision in 3 places. That is the motivation for trying to do it in I/O thread before response sent to renderer (with the result).\n\nWe certainly could repeat the decision for NoScript for now in renderer and PreviewsInfoBarTabHelper - but the fragility concerns me.",
      "parentUuid": "22e0bffd_5e190630",
      "range": {
        "startLine": 805,
        "startChar": 5,
        "endLine": 805,
        "endChar": 11
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "473c8ef9_53c86777",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 805,
      "author": {
        "id": 1115968
      },
      "writtenOn": "2017-11-27T18:00:12Z",
      "side": 1,
      "message": "As this is only for main frames, it could be based on the navigation logic.\n\nNo idea about metrics - eventually, there won\u0027t be an IOThread (Well, there will be a thread we do IPC on, but no network stuff will live there, and we won\u0027t be able to do DRP metrics in the network process).",
      "parentUuid": "d0313586_13a29141",
      "range": {
        "startLine": 805,
        "startChar": 5,
        "endLine": 805,
        "endChar": 11
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aac2addb_7baf42a0",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 810,
      "author": {
        "id": 1127744
      },
      "writtenOn": "2017-11-22T22:53:02Z",
      "side": 1,
      "message": "Should this method also handle the case where the original URL was http, the preview state was LITE_PAGES, and then the page redirects to an https:// webpage. In that case, we need to clear the preview state?",
      "range": {
        "startLine": 810,
        "startChar": 40,
        "endLine": 810,
        "endChar": 52
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b6bc3a5_b1a76dba",
        "filename": "chrome/browser/loader/chrome_resource_dispatcher_host_delegate.cc",
        "patchSetId": 6
      },
      "lineNbr": 810,
      "author": {
        "id": 1147716
      },
      "writtenOn": "2017-11-27T17:06:43Z",
      "side": 1,
      "message": "Right, I mean to do that for the TODO bug 782922 - move the proxy header check decision here. But I would rather do that change after the branch and just tackle this narrower fix before branch.",
      "parentUuid": "aac2addb_7baf42a0",
      "range": {
        "startLine": 810,
        "startChar": 40,
        "endLine": 810,
        "endChar": 52
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1959e5ee_19d6b64d",
        "filename": "components/previews/content/previews_content_util.cc",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1127744
      },
      "writtenOn": "2017-11-22T22:53:02Z",
      "side": 1,
      "message": "nit:\nconsider returning immediately after setting previews_state, and changing the \"else if\" below to an \"if\".\nMakes it slightly easier to read.",
      "range": {
        "startLine": 28,
        "startChar": 31,
        "endLine": 28,
        "endChar": 42
      },
      "revId": "14a3c93c51365f9db02f6724a3a815d1ebb316ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}