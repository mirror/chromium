{
  "comments": [
    {
      "key": {
        "uuid": "40401e1f_2fc222fa",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-11-10T06:07:23Z",
      "side": 1,
      "message": "Why do you need to check this when IsOffline() is checked in GetCurrentAcceptedPriority()?\nAlso this change makes the comment below irrelevant.",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "033d5385_e7aab324",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1249643
      },
      "writtenOn": "2017-11-10T07:29:31Z",
      "side": 1,
      "message": "I got a feedback from Paul Jenson like this â†“\n\"I don\u0027t think it will run when disconnected; I think that is prevented by the IsOffline() check in GetCurrentAcceptedPriority().  I think it will run when OnNetworkChange() receives the CONNECTION_NONE signal which is sent immediately prior to all online signals, but is meant to trigger \"destructive\" actions like flushing caches and pools and jobs.\"\n\nSo I thought it would be terminated when offline before it goes to for loop.",
      "parentUuid": "40401e1f_2fc222fa",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b79951ff_92131adc",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1002888
      },
      "writtenOn": "2017-11-10T14:04:35Z",
      "side": 1,
      "message": "From the OnNetworkChanged documentation:\nhttps://cs.chromium.org/chromium/src/net/base/network_change_notifier.h?rcl\u003de99515dd2ad918eb2b6ae93488d3aff6832b6945\u0026l\u003d173\n\"Observers performing \"constructive\" activities like trying to establish a connection to a server should only do so when |type !\u003d CONNECTION_NONE|.\"\n\"OnNetworkChanged will always be called with CONNECTION_NONE immediately prior to being called with an online state; this is done to make sure that destructive actions take place prior to constructive actions.\"\nThe IsOffline() check won\u0027t catch when OnNetworkChanged is called with CONNECTION_NONE.",
      "parentUuid": "033d5385_e7aab324",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f12395d_04c1dff3",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-11-13T03:30:59Z",
      "side": 1,
      "message": "I\u0027m still confused by the difference between \"constructive\" and \"destructive\".\nDoJobLoop() may start and abort jobs at the same time.\nWhat should we do for this code with the new API?\n\nAlso, IsOffline() and GetConnectionType() being inconsistent with the connection type value here is surprising.\nIt\u0027d be helpful if you could note this in the comment for NetworkChangeObserver, hopefully with diagrams which describe how the values returned by IsOffline(), GetConnectionType(), and NetworkChangeObserver will change in each step in various scenarios (e.g. the device being online/offline, the device switching from ethernet to wifi, the device switching from ethernet to wifi but suddenly being offline before being completely online, etc.).",
      "parentUuid": "b79951ff_92131adc",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "73b490be_ebf75827",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1002888
      },
      "writtenOn": "2017-11-14T13:29:49Z",
      "side": 1,
      "message": "\u003e I\u0027m still confused by the difference between \"constructive\" and \"destructive\".\n\n\"constructive\" refers to observers that attempt to do something constructive, like making forward progress, like attempting to communicate/sync with a server.\n\"destructive\" refers to observers that attempt to flush stale state (DNS cache, idle socket pools etc).\n\n\u003e DoJobLoop() may start and abort jobs at the same time.\n\u003e What should we do for this code with the new API?\n\nIf DoJobLoop() is intended to cancel jobs when the device goes offline (a \"destructive\" action) as well as initiate jobs when the device goes online (a \"constructive\" action) perhaps we should just ignore the CONNECTION_NONE signal that is sent out immediately prior to online signals, perhaps by changing this if statement condition to \"type \u003d\u003d net::NetworkChangeNotifier::CONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline()\"?\n\n\u003e Also, IsOffline() and GetConnectionType() being inconsistent with the connection type value here is surprising.\n\u003e It\u0027d be helpful if you could note this in the comment for NetworkChangeObserver, hopefully with diagrams which describe how the values returned by IsOffline(), GetConnectionType(), and NetworkChangeObserver will change in each step in various scenarios (e.g. the device being online/offline, the device switching from ethernet to wifi, the device switching from ethernet to wifi but suddenly being offline before being completely online, etc.).\n\nI filed crbug.com/784832 for this.",
      "parentUuid": "0f12395d_04c1dff3",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "25c530bc_b7c72d45",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-11-16T04:43:00Z",
      "side": 1,
      "message": "\u003e \u003e I\u0027m still confused by the difference between \"constructive\" and \"destructive\".\n\u003e \n\u003e \"constructive\" refers to observers that attempt to do something constructive, like making forward progress, like attempting to communicate/sync with a server.\n\u003e \"destructive\" refers to observers that attempt to flush stale state (DNS cache, idle socket pools etc).\n\u003e \n\u003e \u003e DoJobLoop() may start and abort jobs at the same time.\n\u003e \u003e What should we do for this code with the new API?\n\u003e \n\u003e If DoJobLoop() is intended to cancel jobs when the device goes offline (a \"destructive\" action) as well as initiate jobs when the device goes online (a \"constructive\" action) perhaps we should just ignore the CONNECTION_NONE signal that is sent out immediately prior to online signals, perhaps by changing this if statement condition to \"type \u003d\u003d net::NetworkChangeNotifier::CONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline()\"?\n\nDoJobLoop() is also intended to cancel some jobs when the device switches to a cellular connection from wifi.\n\nCan we assume type\u003d\u003dCONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline() iff the device is switching from one connection to another? (e.g. switching from ethernet to wifi but suddenly signal lost doesn\u0027t result in CONNECTION_ETHERNET/Online -\u003e CONNECTION_NONE/Online -\u003e CONNECTION_NONE/Offline, possibly the last CONNECTION_NONE not notified to the observers)?\n\nIf the assumption holds, sgtm.\nPlease update the comment below too (\"we don\u0027t need to check ...\").\n\n\n\u003e \n\u003e \u003e Also, IsOffline() and GetConnectionType() being inconsistent with the connection type value here is surprising.\n\u003e \u003e It\u0027d be helpful if you could note this in the comment for NetworkChangeObserver, hopefully with diagrams which describe how the values returned by IsOffline(), GetConnectionType(), and NetworkChangeObserver will change in each step in various scenarios (e.g. the device being online/offline, the device switching from ethernet to wifi, the device switching from ethernet to wifi but suddenly being offline before being completely online, etc.).\n\u003e \n\u003e I filed crbug.com/784832 for this.\n\nThank you for doing this!",
      "parentUuid": "73b490be_ebf75827",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f89fc442_7fbe9ba6",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1002888
      },
      "writtenOn": "2017-11-16T14:48:34Z",
      "side": 1,
      "message": "\u003e Can we assume type\u003d\u003dCONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline() iff the device is switching from one connection to another?\n\nNo, type\u003d\u003dCONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline() is also sent when an offline device goes online.\n\n\u003e (e.g. switching from ethernet to wifi but suddenly signal lost doesn\u0027t result in CONNECTION_ETHERNET/Online -\u003e CONNECTION_NONE/Online -\u003e CONNECTION_NONE/Offline, possibly the last CONNECTION_NONE not notified to the observers)?\n\nSwitching from Ethernet to WiFi will always mean CONNECTION_NONE is sent out followed immediately by CONNECTION_WIFI.",
      "parentUuid": "25c530bc_b7c72d45",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f0b20afc_f5e9ebda",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-11-20T04:06:39Z",
      "side": 1,
      "message": "Sorry for being unclear, what I wanted to know is if ignoring notifications when type \u003d\u003d net::NetworkChangeNotifier::CONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline() results in any behavior changes or not.\nEspecially if it results in dismissing real type\u003d\u003dCONNECTION_NONE events from any states (e.g. the device going totally offline from an intermediate offline state while switching from ethernet to wifi).",
      "parentUuid": "f89fc442_7fbe9ba6",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff85cd7d_4d71e104",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1002888
      },
      "writtenOn": "2017-11-20T14:32:34Z",
      "side": 1,
      "message": "Ignoring notifications when \"type \u003d\u003d net::NetworkChangeNotifier::CONNECTION_NONE \u0026\u0026 !net::NetworkChangeNotifier::IsOffline()\" should generally leave the behavior the same as the prior OnConnectionTypeChanged() behavior.",
      "parentUuid": "f0b20afc_f5e9ebda",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16aff5ca_a2c7a28c",
        "filename": "components/drive/job_scheduler.cc",
        "patchSetId": 1
      },
      "lineNbr": 1150,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-11-22T08:46:05Z",
      "side": 1,
      "message": "Thanks, then sgtm.\nPlease leave a comment to describe why it\u0027s needed, and don\u0027t forget to update the comment below.",
      "parentUuid": "ff85cd7d_4d71e104",
      "revId": "b39a7926a836c242be334bbd35b8fdc5e2457b39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}