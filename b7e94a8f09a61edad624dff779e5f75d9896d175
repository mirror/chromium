{
  "comments": [
    {
      "key": {
        "uuid": "89c03ba1_2c6401a4",
        "filename": "chrome/browser/ui/views/frame/desktop_linux_browser_frame_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1115904
      },
      "writtenOn": "2017-12-05T18:35:58Z",
      "side": 1,
      "message": "If the user sets right click to anything other than menu, doesn\u0027t this mean they\u0027ll lose access to the \"Use system title bars and borders\" option?\n\nThis probably isn\u0027t a big deal, as while it\u0027s the only place where it is exposed as a menu item, it\u0027s also exposed in the settings page...",
      "range": {
        "startLine": 37,
        "startChar": 24,
        "endLine": 37,
        "endChar": 62
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "911ba553_13789ba9",
        "filename": "chrome/browser/ui/views/frame/desktop_linux_browser_frame_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1166470
      },
      "writtenOn": "2017-12-05T20:32:25Z",
      "side": 1,
      "message": "\u003e If the user sets right click to anything other than menu, doesn\u0027t this mean they\u0027ll lose access to the \"Use system title bars and borders\" option?\n\nYes, if all of {double,middle,right}-click are set to something other than menu.\n\n\u003e This probably isn\u0027t a big deal, as while it\u0027s the only place where it is exposed as a menu item, it\u0027s also exposed in the settings page...",
      "parentUuid": "89c03ba1_2c6401a4",
      "range": {
        "startLine": 37,
        "startChar": 24,
        "endLine": 37,
        "endChar": 62
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90fa89b2_7db91c2e",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1166470
      },
      "writtenOn": "2017-12-05T03:13:29Z",
      "side": 1,
      "message": "This caused menus not to show up when I have the double-click setting set to menu (so it gets handled by DesktopLinuxBrowserFrameView).  sky@ what is the right fix for this?",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "468002bc_5889d13d",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-12-07T20:27:21Z",
      "side": 1,
      "message": "I don\u0027t have enough context to answer that. What does \u0027double-click setting set to menu\u0027 mean? Might it that the menu is showing up but immediately closing?",
      "parentUuid": "90fa89b2_7db91c2e",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c009d62_66e0ab3c",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1166470
      },
      "writtenOn": "2017-12-07T20:34:23Z",
      "side": 1,
      "message": "I mean when I set the GTK setting for double-click to \"menu\" instead of \"toggle-maximize\" or similar.\n\nWhen DesktopLinuxBrowserFrameView gets the MouseEvent, it doesn\u0027t have EF_IS_DOUBLE_CLICK even though it is a double click, because of this code.",
      "parentUuid": "468002bc_5889d13d",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4875b210_e7f9071d",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-12-07T22:57:44Z",
      "side": 1,
      "message": "Thanks for the explanation. What is last_pressed_handler_ in this case? I can\u0027t quite tell from this patch. How are you routing events to DesktopLinuxBrowserFrameView::OnMouseEvent ? Are you calling it via an EventHandler, or is it called by virtue of being a View?",
      "parentUuid": "9c009d62_66e0ab3c",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dec908f2_8c8f9f36",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1166470
      },
      "writtenOn": "2017-12-08T00:39:46Z",
      "side": 1,
      "message": "\u003e What is last_pressed_handler_ in this case?\n\nlast_click_handler_ is null.  That explains it.  It\u0027s because DesktopLinuxBrowserFrameView::OnMouseEvent wasn\u0027t setting single-click events as handled.  Handling single-clicks partially fixes the issue.  Now double clicking fails to open a menu.  Then succeeds.  Then fails.  Then succeeds...\n\nThis is because the first click is handled here:\nhttps://cs.chromium.org/chromium/src/ui/views/widget/desktop_aura/window_event_filter.cc?rcl\u003d74bb7a6a374cd4cbc666ec6f34fd3cc3e10c782e\u0026l\u003d101\nThen the double-click sets last_click_handler_, priming the next double-click.\n\nI made a change that removes the StopPropagation() from X11WindowEventFilter and this seems to fix the issue, but I\u0027m not sure if this is the right solution either.",
      "parentUuid": "4875b210_e7f9071d",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32ce9c41_da6a11d6",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-12-08T16:46:59Z",
      "side": 1,
      "message": "I\u0027m not familiar with X11WindowEventFilter. I would expect double click handling and menu handling to be handled by a View, not an EventHandler. Elliot, do you happen to know why these gestures are handled an EventHandler and not a View subclass?",
      "parentUuid": "dec908f2_8c8f9f36",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89b3041d_a97708f6",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1115904
      },
      "writtenOn": "2017-12-08T19:10:31Z",
      "side": 1,
      "message": "My vague recollection is because of dragging windows.\n\nOn linux, you have a subclass of WindowEventFilter which reacts to the drag by turning around and sending a raw X11 event to the window manager which tells it to treat the current mouse down operation as a drag. (The mus dragging is loosely based on this.)\n\nI don\u0027t remember why it had to be this way. I want to say that this was the cleanest way to plumb in a dependency on X11, but it\u0027s been so long since I wrote this that I have fairly low confidence that that isn\u0027t a rationalization.",
      "parentUuid": "32ce9c41_da6a11d6",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26de63cd_8b1b1238",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1166470
      },
      "writtenOn": "2017-12-09T00:32:26Z",
      "side": 1,
      "message": "Are there any other types of windows besides browser windows that need the drag handler?  If not, I think moving the drag code into DesktopLinuxBrowserFrameView makes sense.\n\nIf there are, could make X11WindowEventFilter early-return if the window is a browser window and handle the drag in DesktopLinuxBrowserFrameView anyway?",
      "parentUuid": "89b3041d_a97708f6",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3842e189_fd2851b3",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1115904
      },
      "writtenOn": "2017-12-09T00:43:13Z",
      "side": 1,
      "message": "Any window that doesn\u0027t use system titlebars needs this to work through their own window movement/resizing. The only non-browser window I can think of is the task manager, and that doesn\u0027t use system titlebars. If you can\u0027t think of any other counterexamples, go for it.",
      "parentUuid": "26de63cd_8b1b1238",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ae126ad6_dada57d1",
        "filename": "ui/views/widget/root_view.cc",
        "patchSetId": 5
      },
      "lineNbr": 374,
      "author": {
        "id": 1166470
      },
      "writtenOn": "2017-12-09T01:03:15Z",
      "side": 1,
      "message": "\u003e Any window that doesn\u0027t use system titlebars needs this to work through their own window movement/resizing. The only non-browser window I can think of is the task manager, and that doesn\u0027t use system titlebars. If you can\u0027t think of any other counterexamples, go for it.\n\nAh, extension windows (tested with CRD window).  They fail to resize/move/lower/etc when I removed the code from WindowEventFilter.",
      "parentUuid": "3842e189_fd2851b3",
      "range": {
        "startLine": 373,
        "startChar": 0,
        "endLine": 374,
        "endChar": 80
      },
      "revId": "b7e94a8f09a61edad624dff779e5f75d9896d175",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}