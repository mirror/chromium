// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/* DO NOT EDIT. Generated from {{module.path}} */

{%- if variant -%}
{%-   set variant_path = "%s-%s"|format(module.path, variant) -%}
{%- else -%}
{%-   set variant_path = module.path -%}
{%- endif %}

{%- import "module_macros.tmpl" as module_macros %}

#include "{{variant_path}}_impl_interface.h"

#include "base/logging.h"

{#--- Interface Stubs -#}
{%  for interface in interfaces %}

// C functions of {{interface.name}} that forward calls to C++ implementation.
void {{interface.name}}_Destroy({{interface.name}}Ptr self) {
  DCHECK(self);
  return delete self;
}

{{interface.name}}Context {{interface.name}}_GetContext({{interface.name}}Ptr self) {
  DCHECK(self);
  return self->GetContext();
}

{% for method in interface.methods %}
{%-  if method.response_parameters and method.sync %}
{%-   for param in method.response_parameters %}
{{param.kind|c_wrapper_type}}
{%-   endfor -%}
{%-  else %}
void
{%- endif %}
 {{interface.name}}_{{method.name}}({{interface.name}}Ptr self
{%-   if method.parameters %}, {{module_macros.declare_c_params("", method.parameters)}}
{%-   endif %}) {
  DCHECK(self);
{%-  if method.response_parameters and method.sync %}
  return
{%- endif %}
  self->{{method.name}}({{module_macros.forward_c_params("", method.parameters)}});
}

{% endfor %}
// Implementation of {{interface.name}} that forwards calls to C functions implemented by the app.
class {{interface.name}}Stub : public {{interface.name}} {
 public:
  {{interface.name}}Stub({{interface.name}}Context context,
{%- for method in interface.methods -%}
  {{interface.name}}_{{method.name}}Func {{method.name}}Func
{%- if not loop.last %}, {% endif %}
{%-   endfor %}) : context_(context),
{%- for method in interface.methods -%}
  {{method.name}}Func_({{method.name}}Func)
{%- if not loop.last %}, {% endif %}
{%-   endfor %} {}

  ~{{interface.name}}Stub() override {}

  {{interface.name}}Context GetContext() override {
    return context_;
  }
 protected:
{% for method in interface.methods %}
  {{module_macros.declare_c_return(method)}}
  {{method.name}}({{module_macros.declare_c_params("", method.parameters)}}) override {
{%-  if method.response_parameters and method.sync %}
  return
{%- endif %}
    {{method.name}}Func_(this
{%-   if method.parameters %}, {{module_macros.forward_c_params("", method.parameters)}}
{%-   endif %});
  }
{%- endfor %}
 private:
  {{interface.name}}Context context_;
{%- for method in interface.methods -%}
  {{interface.name}}_{{method.name}}Func {{method.name}}Func_;
{%-   endfor %}

  DISALLOW_COPY_AND_ASSIGN({{interface.name}}Stub);
};

{{interface.name}}Ptr {{interface.name}}_CreateStub({{interface.name}}Context context,
{%- for method in interface.methods -%}
  {{interface.name}}_{{method.name}}Func {{method.name}}Func
{%- if not loop.last %}, {% endif %}
{%-   endfor %}
  ) {
  return new {{interface.name}}Stub(context,
{%- for method in interface.methods -%}
  {{method.name}}Func
{%- if not loop.last %}, {% endif %}
{%-   endfor %}
  );
}

{% endfor %}

