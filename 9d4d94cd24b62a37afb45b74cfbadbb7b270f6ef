{
  "comments": [
    {
      "key": {
        "uuid": "c8c268ce_e163f53b",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 2300,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-10-23T23:30:10Z",
      "side": 1,
      "message": "The -tabLoadComplete:withSuccess: is invoked only from -pageLoadCompleted: which is attached to kTabModelTabDidFinishLoadingNotification notification. The notification itself is send from Tab -webState:didLoadPageWithSuccess: which is a method from CRWWebStateObserver.\n\nSo, IMO, putting the call here is incorrect. Instead the tab helper should be a WebStateObserver, listen to that method (well WebStateObserver::PageLoaded).\n\nIn general, tab helper should listen to the events they are interested directly instead of relying on other objects to invoke them (otherwise you still have a god class that call to all the tab helpers).",
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e21bd48e_dd4757db",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 2300,
      "author": {
        "id": 1190590
      },
      "writtenOn": "2017-10-24T00:01:05Z",
      "side": 1,
      "message": "The reason why it is put here is because I want to measure the user-perceived load time with prerender (i.e. from time they tap in omnibar to page load). WebStateObserver callbacks can only measure real page load so won\u0027t report prerender time correctly.\n\nHere\u0027s my understanding of the sequencing of events seen by a prerender tab:\n1. WebStateObserver::DidStartNavigation\n2. WebStateObserver::PageLoaded\n3. PreloadController -releasePrerenderContents\n4. BVC -tabLoadComplete:withSuccess\n\nI can move the DidPromotePrerenderTab() call below that you called out to PreloadController. Is there a better way for TabHelper to hook into point 4?\n\nThanks for pointers!",
      "parentUuid": "c8c268ce_e163f53b",
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "426d8dd0_b84aeada",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 3901,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-10-23T23:30:10Z",
      "side": 1,
      "message": "This should go into PreloadController -releasePrerenderContents.",
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "980189ae_28bd7e2e",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 3925,
      "author": {
        "id": 1123009
      },
      "writtenOn": "2017-10-23T18:57:05Z",
      "side": 1,
      "message": "If you move |DidInitiatePageLoad| call to the top of this method, there will be no need for |DidPromotePrerenderTab|. ReportLoadTime will record 0 for prerender and normal load time for non-prerender cases.",
      "range": {
        "startLine": 3925,
        "startChar": 6,
        "endLine": 3925,
        "endChar": 30
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c93b63d_de94032e",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 3925,
      "author": {
        "id": 1190590
      },
      "writtenOn": "2017-10-23T23:09:08Z",
      "side": 1,
      "message": "I\u0027m OK with replacing DidPromotePrerenderTab() on line 3902 with DidInitiatePageLoad() (and this is done), but we won\u0027t be able to combine that with this line (3926) because they are operating on two different tab objects.",
      "parentUuid": "980189ae_28bd7e2e",
      "range": {
        "startLine": 3925,
        "startChar": 6,
        "endLine": 3925,
        "endChar": 30
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4855e6ca_981bb38d",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 5
      },
      "lineNbr": 3927,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-10-23T23:30:10Z",
      "side": 1,
      "message": "Same here, this should go to a WebStateObserver method implemented by LoadTimingTabHelper.",
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1af20125_d8b6d77b",
        "filename": "ios/chrome/browser/web/load_timing_tab_helper.mm",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1123009
      },
      "writtenOn": "2017-10-23T18:57:05Z",
      "side": 1,
      "message": "Is this also called for the failed navigation? Should we reset load_start_time_ in DidFinishNavigation if NavigationContext::GetError has a non null error?",
      "range": {
        "startLine": 36,
        "startChar": 26,
        "endLine": 36,
        "endChar": 40
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d30d8ebb_ade3eb4c",
        "filename": "ios/chrome/browser/web/load_timing_tab_helper.mm",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1190590
      },
      "writtenOn": "2017-10-23T23:09:08Z",
      "side": 1,
      "message": "Yes. If we want to filter out failed navigations, I think it\u0027s cleaner to add a checkto BVC\u0027s |-tabLoadComplete:withSuccess|.",
      "parentUuid": "1af20125_d8b6d77b",
      "range": {
        "startLine": 36,
        "startChar": 26,
        "endLine": 36,
        "endChar": 40
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a00d28ad_146a3536",
        "filename": "ios/chrome/browser/web/load_timing_tab_helper_unittest.mm",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1123009
      },
      "writtenOn": "2017-10-23T18:57:05Z",
      "side": 1,
      "message": "Do you think this will not be flaky?",
      "range": {
        "startLine": 36,
        "startChar": 36,
        "endLine": 36,
        "endChar": 45
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce4a4b1b_5f22e373",
        "filename": "ios/chrome/browser/web/load_timing_tab_helper_unittest.mm",
        "patchSetId": 5
      },
      "lineNbr": 36,
      "author": {
        "id": 1190590
      },
      "writtenOn": "2017-10-23T23:09:08Z",
      "side": 1,
      "message": "I think it should be OK because we just need the wait time to be non-zero so we can differentiate the prerender case. It\u0027s not important anymore since the prerender case is merged into DidInitiatePageLoad().",
      "parentUuid": "a00d28ad_146a3536",
      "range": {
        "startLine": 36,
        "startChar": 36,
        "endLine": 36,
        "endChar": 45
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "98388e2d_ec8c9cb6",
        "filename": "tools/metrics/histograms/histograms.xml",
        "patchSetId": 5
      },
      "lineNbr": 29738,
      "author": {
        "id": 1123009
      },
      "writtenOn": "2017-10-23T18:57:05Z",
      "side": 1,
      "message": "Document that metric is reported only for GENERATE and TYPED navigations?",
      "range": {
        "startLine": 29738,
        "startChar": 20,
        "endLine": 29738,
        "endChar": 0
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab70f8be_9ca12846",
        "filename": "tools/metrics/histograms/histograms.xml",
        "patchSetId": 5
      },
      "lineNbr": 29738,
      "author": {
        "id": 1190590
      },
      "writtenOn": "2017-10-23T23:09:08Z",
      "side": 1,
      "message": "Done. I didn\u0027t refer to the types verbatim because none of the other metric descriptions refer to enum names. Instead I tried to document the scenarios.",
      "parentUuid": "98388e2d_ec8c9cb6",
      "range": {
        "startLine": 29738,
        "startChar": 20,
        "endLine": 29738,
        "endChar": 0
      },
      "revId": "9d4d94cd24b62a37afb45b74cfbadbb7b270f6ef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}