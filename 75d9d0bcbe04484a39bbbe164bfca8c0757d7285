{
  "comments": [
    {
      "key": {
        "uuid": "de17ab61_77811305",
        "filename": "cc/trees/layer_tree_frame_sink.cc",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1148065
      },
      "writtenOn": "2017-11-30T23:40:53Z",
      "side": 1,
      "message": "Could this write race with the read in OnContextLost()?  Do we need to reset it at all?",
      "revId": "75d9d0bcbe04484a39bbbe164bfca8c0757d7285",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efb9ff4c_ee9a05d6",
        "filename": "cc/trees/layer_tree_frame_sink.cc",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1128437
      },
      "writtenOn": "2017-12-01T02:31:42Z",
      "side": 1,
      "message": "No, because we invalidate weak ptrs above. I don\u0027t mind not resetting it, but even if the callback were posted, client_ would be null which we don\u0027t check in OnContextLost.",
      "parentUuid": "de17ab61_77811305",
      "revId": "75d9d0bcbe04484a39bbbe164bfca8c0757d7285",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e5f5ddb_568de4a2",
        "filename": "cc/trees/layer_tree_frame_sink.cc",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1148065
      },
      "writtenOn": "2017-12-01T22:05:41Z",
      "side": 1,
      "message": "The weak ptrs don\u0027t apply to OnContextLost though.\n\nThe data race I\u0027m thinking of is:\n- compositor thread runs DetachFromClient(), writes to |task_runner_|\n- main thread runs OnContextLost(), reads |task_runner_|\n\nCan that happen?",
      "parentUuid": "efb9ff4c_ee9a05d6",
      "revId": "75d9d0bcbe04484a39bbbe164bfca8c0757d7285",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c1f0d9a0_11c02fff",
        "filename": "cc/trees/layer_tree_frame_sink.cc",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1128437
      },
      "writtenOn": "2017-12-01T22:12:53Z",
      "side": 1,
      "message": "We call RemoveObserver with the worker context provider\u0027s lock before clearing |task_runner_|. And the worker context provider takes the lock before calling OnContextLost on its ,observers. So we won\u0027t call OnContextLost in your example.",
      "parentUuid": "8e5f5ddb_568de4a2",
      "revId": "75d9d0bcbe04484a39bbbe164bfca8c0757d7285",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}