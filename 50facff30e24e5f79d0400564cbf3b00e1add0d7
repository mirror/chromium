{
  "comments": [
    {
      "key": {
        "uuid": "5e6d4879_fe599bbd",
        "filename": "media/blink/webmediaplayer_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1875,
      "author": {
        "id": 1129179
      },
      "writtenOn": "2017-12-13T21:55:36Z",
      "side": 1,
      "message": "weird that we do it at the caller instead of callee? i would expect the callee\u0027s contract should be to call callbacks on the same thread they came in on.",
      "range": {
        "startLine": 1875,
        "startChar": 23,
        "endLine": 1875,
        "endChar": 40
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5033da42_68f15d44",
        "filename": "media/blink/webmediaplayer_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1875,
      "author": {
        "id": 1001250
      },
      "writtenOn": "2017-12-13T23:31:49Z",
      "side": 1,
      "message": "Callee is a posted task, so it couldn\u0027t enforce that contract...",
      "parentUuid": "5e6d4879_fe599bbd",
      "range": {
        "startLine": 1875,
        "startChar": 23,
        "endLine": 1875,
        "endChar": 40
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7e1e871c_a32b6e04",
        "filename": "media/blink/webmediaplayer_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 2938,
      "author": {
        "id": 1129179
      },
      "writtenOn": "2017-12-13T21:55:36Z",
      "side": 1,
      "message": "would this measurement be more meaningful if instead of basing from load_start_time_ you based from play() start time? Or maybe even from first buffering state has_enough? As is, your probably mostly measuring network stuff (on top of any deferred loading time from my other comment).",
      "range": {
        "startLine": 2938,
        "startChar": 47,
        "endLine": 2938,
        "endChar": 63
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cced98e3_7637401f",
        "filename": "media/blink/webmediaplayer_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 2938,
      "author": {
        "id": 1001250
      },
      "writtenOn": "2017-12-13T23:31:49Z",
      "side": 1,
      "message": "We always render the first frame regardless of playing, so that wouldn\u0027t make sense. Also (as noted in description) this is impossible since Blink doesn\u0027t tell when play() truly happens currently.",
      "parentUuid": "7e1e871c_a32b6e04",
      "range": {
        "startLine": 2938,
        "startChar": 47,
        "endLine": 2938,
        "endChar": 63
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0c70acbb_a941a4b2",
        "filename": "media/blink/webmediaplayer_impl.h",
        "patchSetId": 4
      },
      "lineNbr": 755,
      "author": {
        "id": 1129179
      },
      "writtenOn": "2017-12-13T21:55:36Z",
      "side": 1,
      "message": "Looking at the paths from HTMLme, it looks like this can be executed both in response to setting a \u003csource\u003e as well as things like playing. And then there are cases where the load is deferred. Basically, are you confident that you\u0027re measuring what you think you\u0027re measuring? Do you want to add bits to take into account the path to load (e.g. was deferred? was triggered by play()?)? \n\nAlso, for MSE, it looks like this will fire as soon as they set a blob URL which may be distant from the time they start appending media.",
      "range": {
        "startLine": 755,
        "startChar": 23,
        "endLine": 755,
        "endChar": 29
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f563eaae_b4b5e039",
        "filename": "media/blink/webmediaplayer_impl.h",
        "patchSetId": 4
      },
      "lineNbr": 755,
      "author": {
        "id": 1001250
      },
      "writtenOn": "2017-12-13T23:31:49Z",
      "side": 1,
      "message": "100% confident I\u0027m measuring what I think I\u0027m measuring, 50% confident on whether I\u0027ve explained that well :) I don\u0027t want to add anything else here, nor do I think we should. We really don\u0027t care how long the load was deferred for. It might be 0 or it might be forever when opened in a background tab and chrome is closed before using./\n\nAs written it\u0027s 100% true that this is when DoLoad() is executed, why it\u0027s executed I don\u0027t care in the context of this CL. I\u0027ve been careful to signal that this is not going to measure \"time-to-play\" but only time until ready for playback. \n\nNo event is logged for the time at which DoLoad() is executed, we just use this time as a baseline for the metrics actually recorded in this CL.",
      "parentUuid": "0c70acbb_a941a4b2",
      "range": {
        "startLine": 755,
        "startChar": 23,
        "endLine": 755,
        "endChar": 29
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "426012aa_6f9cde58",
        "filename": "media/blink/webmediaplayer_impl.h",
        "patchSetId": 4
      },
      "lineNbr": 755,
      "author": {
        "id": 1129179
      },
      "writtenOn": "2017-12-14T00:53:48Z",
      "side": 1,
      "message": "From CL desc.\n\u003e ... to determine how various sites are performing with their networking as well as for regressions in our metadata and decode speed processing\n\nSeems like our metadata and decode processing will be such a small fraction (compared to network) that it will be very hard to observe a regression. \n\nAlso, I think that DoLoad is totally separate from even the network parts for MSE. Not clear what you can infer from this. \n\n\u003e we just use this time as a baseline for the metrics actually recorded in this CL.\n\nThe use as a baseline is what I\u0027m worried about.",
      "parentUuid": "f563eaae_b4b5e039",
      "range": {
        "startLine": 755,
        "startChar": 23,
        "endLine": 755,
        "endChar": 29
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b157edf_0a68d5e2",
        "filename": "media/blink/webmediaplayer_impl.h",
        "patchSetId": 4
      },
      "lineNbr": 755,
      "author": {
        "id": 1001250
      },
      "writtenOn": "2017-12-14T01:22:51Z",
      "side": 1,
      "message": "UMA ends up acting like a random sampling, so you\u0027re right that the absolute values won\u0027t be all that meaningful in UMA, but relative changes in those values will be useful. So even small constant increases in metadata or decode stages (contention, etc) will show up here. For UKM we\u0027ll be able to isolate each value independently (by subtracting successive values) if we like.\n\nFor UMA one alternative would be to pre-subtract these values so that we measure load -\u003e metadata, metadata -\u003e first frame, metadata -\u003e have_enough. Presubtracting may yield negative values though because all of the above operations happen on the render thread while the generated events happen on the media, compositor threads. Hence why I set the frame processing CB before we even start the pipeline.\n\nAnother option would be recording the time at which we attempt pipeline start and using that as the baseline for first frame, have_enough. But  this will also be dominated by network time / JS time since we\u0027re waiting for packets to be appended off the network.\n\nI\u0027m open to changing to this if you feel strongly, but AFAIK there\u0027s no way to avoid network influence regardless of the approach we take. The best we could do would be to isolate each stage from the other for UMA specifically (since UKM would already have this ability).",
      "parentUuid": "426012aa_6f9cde58",
      "range": {
        "startLine": 755,
        "startChar": 23,
        "endLine": 755,
        "endChar": 29
      },
      "revId": "50facff30e24e5f79d0400564cbf3b00e1add0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}