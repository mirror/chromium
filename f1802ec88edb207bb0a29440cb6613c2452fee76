{
  "comments": [
    {
      "key": {
        "uuid": "935604a8_ccea506a",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.cpp",
        "patchSetId": 5
      },
      "lineNbr": 233,
      "author": {
        "id": 1115924
      },
      "writtenOn": "2017-10-17T03:09:39Z",
      "side": 1,
      "message": "This CL doesn\u0027t hold a reference to ScriptResource, just like the previous code doesn\u0027t hold a reference to the newly created ScriptLoader in FetchBlockedDocWriteScript() in HTMLParserScriptRunner. Resource loading is kept alive because no one cancels it, right?",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cf2d7a9_7b149f1b",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.cpp",
        "patchSetId": 5
      },
      "lineNbr": 233,
      "author": {
        "id": 1115949
      },
      "writtenOn": "2017-10-17T03:56:44Z",
      "side": 1,
      "message": "If the intention is only to send GET, Can we avoid full ScriptResource::Fetch?\n(If so, please just leave a comment)",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef7c1be9_6ed50b60",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.cpp",
        "patchSetId": 5
      },
      "lineNbr": 233,
      "author": {
        "id": 1115924
      },
      "writtenOn": "2017-10-17T20:35:42Z",
      "side": 1,
      "message": "Then, what should we use instead of ScriptResource::Fetch()?\n\nIIUC the intention is only to send GET and fill a disk cache entry.\n(According to the original implementation this does NOT intend to fill a MemoryCache entry)",
      "parentUuid": "0cf2d7a9_7b149f1b",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7abba427_3870acdb",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.cpp",
        "patchSetId": 5
      },
      "lineNbr": 233,
      "author": {
        "id": 1115949
      },
      "writtenOn": "2017-10-19T16:29:13Z",
      "side": 1,
      "message": "IIUC, the intention is to send GET to notify the page authors.\nIdeally we don\u0027t even want to fill disk cache.\n\nI was wondering if we could move this to use RawResource::Fetch or PingLoader or some other generic \"report-only\" fetch.",
      "parentUuid": "ef7c1be9_6ed50b60",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b535499_c1196960",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.cpp",
        "patchSetId": 5
      },
      "lineNbr": 233,
      "author": {
        "id": 1172224
      },
      "writtenOn": "2017-10-19T17:57:41Z",
      "side": 1,
      "message": "The original intent was to serve two purposes:\n- Notify the page authors\n- Fill in the disk cache for a future use. Even if the resource is already in the cache, it might be a stale version and this helps in refreshing it otherwise the older version will continue to be served for whenever this intervention is taking place.",
      "parentUuid": "7abba427_3870acdb",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8c12fa1_0f66e58a",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.cpp",
        "patchSetId": 5
      },
      "lineNbr": 233,
      "author": {
        "id": 1115924
      },
      "writtenOn": "2017-10-23T20:17:28Z",
      "side": 1,
      "message": "Thanks for clarification! I added some of Shivani\u0027s comment to DocumentWriteIntervention.h.\n\nI slightly prefer ScriptResource::Fetch() for now, because:\n- As Shivani noted, this is also to fill in the disk cache and thus not a pure \"report-only\" fetch.\n- This CL tries to keep the existing behavior of \"resend the same request as much as possible\", which was the reason for re-using ScriptLoader entirely, IIUC.\n- The requested URL is semantically still a script (not \"raw\" something), even though it is not executed directly.\n\nIt might be an option to migrate this from ScriptResource to e.g. RawResource/PingLoader-ish things (especially when we refactor ScriptResource for better ES6 module support etc.), but I\u0027d like to do it separately.",
      "parentUuid": "5b535499_c1196960",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a28d9aba_01896ee0",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.h",
        "patchSetId": 5
      },
      "lineNbr": 52,
      "author": {
        "id": 1114080
      },
      "writtenOn": "2017-10-18T10:33:36Z",
      "side": 1,
      "message": "Is just returning ScriptOwner\u003cScriptResource\u003e enough?",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "94af2ee8_49fdd506",
        "filename": "third_party/WebKit/Source/core/dom/DocumentWriteIntervention.h",
        "patchSetId": 5
      },
      "lineNbr": 52,
      "author": {
        "id": 1115924
      },
      "writtenOn": "2017-10-23T20:17:28Z",
      "side": 1,
      "message": "This was because ResourceOwner::SetResource() is protected.\n\nAlso, in the latest patchset FetchBlockedDocWriteScriptClient wants to set SelfKeepAlive in SetResource() and thus returning ResourceOwner is not sufficient.",
      "parentUuid": "a28d9aba_01896ee0",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e9e9e5c_8492dcd4",
        "filename": "third_party/WebKit/Source/core/dom/ScriptLoader.cpp",
        "patchSetId": 5
      },
      "lineNbr": 742,
      "author": {
        "id": 1114080
      },
      "writtenOn": "2017-10-18T10:33:36Z",
      "side": 1,
      "message": "client_for_intervention is not strongly referenced by anyone, so it will be collected, right?",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "71e5aa96_b9e17ff6",
        "filename": "third_party/WebKit/Source/core/dom/ScriptLoader.cpp",
        "patchSetId": 5
      },
      "lineNbr": 742,
      "author": {
        "id": 1115924
      },
      "writtenOn": "2017-10-23T20:17:28Z",
      "side": 1,
      "message": "Oh, right. I added SelfKeepAlive to the client in the latest patchset to keep-alive the client.\n\nAnother option would be to add a reference from ScriptLoader to the client, and clear the reference when NotifyFinished(). This would add a little more dependencies between ScriptLoader and doc.write() intervention, but might be safer in terms of preventing memory leaks.",
      "parentUuid": "8e9e9e5c_8492dcd4",
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c0a9a7b2_4b28d393",
        "filename": "third_party/WebKit/Source/core/html/parser/PreloadRequest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 114,
      "author": {
        "id": 1115949
      },
      "writtenOn": "2017-10-17T03:56:44Z",
      "side": 1,
      "message": "Why is this code (L113-117) needed?",
      "range": {
        "startLine": 114,
        "startChar": 48,
        "endLine": 114,
        "endChar": 49
      },
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "348be46c_8387c650",
        "filename": "third_party/WebKit/Source/core/html/parser/PreloadRequest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 114,
      "author": {
        "id": 1115924
      },
      "writtenOn": "2017-10-17T20:35:42Z",
      "side": 1,
      "message": "This is to intervene preloading request as well (|params| is modified).",
      "parentUuid": "c0a9a7b2_4b28d393",
      "range": {
        "startLine": 114,
        "startChar": 48,
        "endLine": 114,
        "endChar": 49
      },
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c231006_462e931a",
        "filename": "third_party/WebKit/Source/core/html/parser/PreloadRequest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 114,
      "author": {
        "id": 1115949
      },
      "writtenOn": "2017-10-19T16:29:13Z",
      "side": 1,
      "message": "Thanks for clarifying.\nCodesearched and now I understand. We run HTMLPreloadScanner for document.write contents, and this block forbids preloading script from that.",
      "parentUuid": "348be46c_8387c650",
      "range": {
        "startLine": 114,
        "startChar": 48,
        "endLine": 114,
        "endChar": 49
      },
      "revId": "f1802ec88edb207bb0a29440cb6613c2452fee76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}