{
  "comments": [
    {
      "key": {
        "uuid": "f4db0863_564ff0f1",
        "filename": "chrome/browser/android/vr_shell/vr_shell.h",
        "patchSetId": 6
      },
      "lineNbr": 245,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-06-28T14:15:03Z",
      "side": 1,
      "message": "nit: s/provide/provide a/",
      "range": {
        "startLine": 245,
        "startChar": 63,
        "endLine": 245,
        "endChar": 70
      },
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "768b1836_ad2bb729",
        "filename": "chrome/browser/android/vr_shell/vr_shell.h",
        "patchSetId": 6
      },
      "lineNbr": 245,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-06-29T04:51:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f4db0863_564ff0f1",
      "range": {
        "startLine": 245,
        "startChar": 63,
        "endLine": 245,
        "endChar": 70
      },
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c0dd8a9_bf5319d0",
        "filename": "chrome/browser/android/vr_shell/vr_shell.h",
        "patchSetId": 6
      },
      "lineNbr": 247,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-06-28T14:15:03Z",
      "side": 1,
      "message": "\"through its lifetime\" is confusing. Maybe replace with \"(and detached on teardown)\"",
      "range": {
        "startLine": 247,
        "startChar": 5,
        "endLine": 247,
        "endChar": 12
      },
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3f8285a6_7296c579",
        "filename": "chrome/browser/android/vr_shell/vr_shell.h",
        "patchSetId": 6
      },
      "lineNbr": 247,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-06-29T04:51:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6c0dd8a9_bf5319d0",
      "range": {
        "startLine": 247,
        "startChar": 5,
        "endLine": 247,
        "endChar": 12
      },
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b0f4327a_560add3f",
        "filename": "content/browser/android/motion_event_synthesizer_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 21,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-06-28T21:47:05Z",
      "side": 1,
      "message": "can you just pass the scale down? it looks kinda dangerous passing a raw pointer without ownership implications, even though this thing doesn\u0027t keep a reference to it",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26869248_e3341286",
        "filename": "content/browser/android/motion_event_synthesizer_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 21,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-06-29T04:51:07Z",
      "side": 1,
      "message": "That will work, but your concern applies to |view-\u003eGetContainerView()| below too, and it\u0027s not clear if it can be replaced with something else. As you said this class doesn\u0027t keep a reference to it, so there won\u0027t be a side effect on who owns who. Added a comment here on the caution to use. Please see if it helps address your concern.",
      "parentUuid": "b0f4327a_560add3f",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe61e84c_4de7967d",
        "filename": "content/browser/android/motion_event_synthesizer_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 33,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-06-28T21:47:05Z",
      "side": 1,
      "message": "this is a problem. afaict, nothing has a strong ref to the java object, so it could get gc-ed at any point\n\nI don\u0027t really know what the right fix is, because I don\u0027t know what this is used for. So what is this used for? By devtools sending events? What does VR use this for?",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f950e022_6b58f5ca",
        "filename": "content/browser/android/motion_event_synthesizer_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 33,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-06-29T04:51:07Z",
      "side": 1,
      "message": "mthiesse@ will know better but scaning through the code tells me it is used to transform VR user actions to various input events and inject them.\n\nIf it is not used by webview (looks like it isn\u0027t. vrshell is not webview - does devtools get activated on webview?), maybe we could hold a strong reference.",
      "parentUuid": "fe61e84c_4de7967d",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93a4cd05_aa50745d",
        "filename": "content/browser/android/motion_event_synthesizer_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 33,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-06-29T22:10:45Z",
      "side": 1,
      "message": "It\u0027s used for benchmarking. Yes, that does need to work in webview as well. Java side is holding the container view, so using a strong ref here will lead to leaks in webview.\n\nSo the ideal solution is to have a java object like WebContentsImpl, then native side has to ask webcontents for it every time.",
      "parentUuid": "f950e022_6b58f5ca",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85c4ab61_f6e589b0",
        "filename": "content/browser/android/motion_event_synthesizer_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 33,
      "author": {
        "id": 1002411
      },
      "writtenOn": "2017-06-30T03:22:01Z",
      "side": 1,
      "message": "VR uses MotionEventSynthesizer to transform native VR controller events into java events, and inject them into native java UI, like the New Tab Page.",
      "parentUuid": "93a4cd05_aa50745d",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d87bdce3_e1a92427",
        "filename": "content/browser/android/motion_event_synthesizer_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 33,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-06-30T12:13:06Z",
      "side": 1,
      "message": "Thanks for the suggestion. Updated the patch so WebContentsImpl holds the reference of MotionEventSynthesizer. Two things I had in mind in the way the change is made:\n\n- In content/, MotionEventSynthesizer is created by RWHVA via SyntheticGestureTarget. I don\u0027t want WebContentsImpl to appear there, which would be layering violation. \n- Since we have an embedder that uses MES, we need an API to have WebContensImpl get involved. But I want to keep the interface to be in native only, and do not want any java stuff to appear in the signature. \n\nMy approach is to create a simple helper interface inside MES(MotionEventSynthesizer::Helper) through which you can get WebContents. Then how to get java WebContentsImpl to set and get MES java object can remain as internal detail. RWHVA is providing it by way of RenderWidgetHostConnector-inheriting class which owns itself, while VrShell implements the interface directly. So the helper is not owned by MES native.\n\n....now that I see it again, std::function + lambda capturing WebContents instance (rather than defining a helper interface) may be simpler. I can rewrite them if you see it is better and idiomatic.",
      "parentUuid": "85c4ab61_f6e589b0",
      "revId": "77fa3b2f0c4dbea7e01d07822b3437d2bdb861b0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}