{
  "comments": [
    {
      "key": {
        "uuid": "25c6ac39_91b2bcf6",
        "filename": "components/offline_pages/core/prefetch/store/delete_prefetch_items_command_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 73,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-06-15T00:51:54Z",
      "side": 1,
      "message": "I think there was the idea of not having the multi-thread code in the command to ease testing SQL executing in the very test thread. Can we replace the runner with a test one that executes in the same test thread?",
      "range": {
        "startLine": 73,
        "startChar": 2,
        "endLine": 73,
        "endChar": 29
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cdd371b9_ab8aed37",
        "filename": "components/offline_pages/core/prefetch/store/delete_prefetch_items_command_sql.h",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-06-15T00:51:54Z",
      "side": 1,
      "message": "Because StoreCommand is named like that it seems more natural to name this DeletePrefetchItemsSqlCommand.",
      "range": {
        "startLine": 22,
        "startChar": 6,
        "endLine": 22,
        "endChar": 35
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "326e2906_ba5bc8e9",
        "filename": "components/offline_pages/core/prefetch/store/delete_prefetch_items_command_sql.h",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-06-15T00:51:54Z",
      "side": 1,
      "message": "The constructor should not receive parameters to allow the factory to build \"empty\" commands that will only later receive the parameters they need to be executed. They should on the other hand receive the store pointer here so that tasks could execute them without depending on the specific store in use.",
      "range": {
        "startLine": 25,
        "startChar": 34,
        "endLine": 25,
        "endChar": 45
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2146d649_5fc6c3cc",
        "filename": "components/offline_pages/core/prefetch/store/delete_prefetch_items_command_sql.h",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-06-15T22:44:34Z",
      "side": 1,
      "message": "yes, you are right, I noticed that when working on second command.",
      "parentUuid": "326e2906_ba5bc8e9",
      "range": {
        "startLine": 25,
        "startChar": 34,
        "endLine": 25,
        "endChar": 45
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ed9c381_92a35d9a",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 158,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:01:24Z",
      "side": 1,
      "message": "If we ever want to retry opening, this probably is a good place to PostDelayedTask?",
      "range": {
        "startLine": 158,
        "startChar": 2,
        "endLine": 158,
        "endChar": 8
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "deed8e20_1364da86",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 158,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-06-14T22:07:54Z",
      "side": 1,
      "message": "Not sure I follow. I am not trying to solve a retry problem here thou, so not sure if there is anything to do with that suggestion.",
      "parentUuid": "3ed9c381_92a35d9a",
      "range": {
        "startLine": 158,
        "startChar": 2,
        "endLine": 158,
        "endChar": 8
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d7f8822_c6229ab5",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 158,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:50:25Z",
      "side": 1,
      "message": "This was not intended for change her but if we are landing yet another impl of a database, we probably should look at newly-landed UMA in a few weeks and decide if we need retry and on which level. Feel free to ignore this note for now, I\u0027d simply do the retry here *if* we were to implement it.",
      "parentUuid": "deed8e20_1364da86",
      "range": {
        "startLine": 158,
        "startChar": 2,
        "endLine": 158,
        "endChar": 8
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "52790380_71aae9c9",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 180,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:01:24Z",
      "side": 1,
      "message": "any reason this can not be done first thing in OpenConnectionSync? Then db_ is operated on a single thread only.",
      "range": {
        "startLine": 180,
        "startChar": 6,
        "endLine": 180,
        "endChar": 11
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "13463379_4ef5fd32",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 180,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-06-14T22:07:54Z",
      "side": 1,
      "message": "good point.",
      "parentUuid": "52790380_71aae9c9",
      "range": {
        "startLine": 180,
        "startChar": 6,
        "endLine": 180,
        "endChar": 11
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "711a1943_7ed40196",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 202,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:01:24Z",
      "side": 1,
      "message": "Technically speaking this is a cross-thread check. It\u0027d be probably better to store a \u0027success\u0027 bool returned from OpenConnectionSync and check that on main thread.. Same about DCHECK(db_.get()) above.",
      "range": {
        "startLine": 202,
        "startChar": 9,
        "endLine": 202,
        "endChar": 12
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d70f32d1_6dedb06d",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 202,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-06-14T22:07:54Z",
      "side": 1,
      "message": "Yes, as you probably noticed this is a copy of other stores we have and I didn\u0027t yet try to solve that issue. But I think the suggestion to do everything on background thread actually is the way to go here.",
      "parentUuid": "711a1943_7ed40196",
      "range": {
        "startLine": 202,
        "startChar": 9,
        "endLine": 202,
        "endChar": 12
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e8fc2311_66f23689",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.cc",
        "patchSetId": 1
      },
      "lineNbr": 202,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:50:25Z",
      "side": 1,
      "message": "Oh, I realize it\u0027s what we do in other places and it\u0027s probably ok. But, sqlite makes me paranoid lately :) So if this transforms to a landing CL, we might as well start from the right approach while it\u0027s still simple.",
      "parentUuid": "d70f32d1_6dedb06d",
      "range": {
        "startLine": 202,
        "startChar": 9,
        "endLine": 202,
        "endChar": 12
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92d75c45_dc9bb366",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.h",
        "patchSetId": 1
      },
      "lineNbr": 60,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-06-15T00:51:54Z",
      "side": 1,
      "message": "PrefetchSQLStore maybe?",
      "range": {
        "startLine": 60,
        "startChar": 2,
        "endLine": 60,
        "endChar": 18
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1fc385fe_63fc5baa",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store_sql.h",
        "patchSetId": 1
      },
      "lineNbr": 67,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-06-15T00:51:54Z",
      "side": 1,
      "message": "Not yet being called from anywhere.",
      "range": {
        "startLine": 67,
        "startChar": 7,
        "endLine": 67,
        "endChar": 17
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f556a6c9_afc3027e",
        "filename": "components/offline_pages/core/prefetch/store/store_command.h",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:01:24Z",
      "side": 1,
      "message": "It would be nice to enforce the rule that Execute() may be run more than once if the DB can not commit the transaction. We might just postulate this as a requirement?",
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b4e80137_7b7ac0eb",
        "filename": "components/offline_pages/core/prefetch/store/store_command.h",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-06-14T22:07:54Z",
      "side": 1,
      "message": "Good point. This should probably go on StoreCommand interface.",
      "parentUuid": "f556a6c9_afc3027e",
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1984c76f_8e301f33",
        "filename": "components/offline_pages/core/prefetch/store/store_command.h",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1115887
      },
      "writtenOn": "2017-06-14T22:50:25Z",
      "side": 1,
      "message": "Indeed, perhaps like a comment here and then codereview practice. Executor may retry N times and UMA results... We can also have a test for commands that applies them more tan once with rollback in between...",
      "parentUuid": "b4e80137_7b7ac0eb",
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72ebedb6_f24b0a0c",
        "filename": "components/offline_pages/core/prefetch/store/store_command.h",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-06-15T00:51:54Z",
      "side": 1,
      "message": "As this depends on Sql it should already be a SqlCommand or SqlStoreCommand.",
      "range": {
        "startLine": 25,
        "startChar": 6,
        "endLine": 25,
        "endChar": 9
      },
      "revId": "1a831cbbfccc795712f9f2c1de3fca75cb9087ba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}