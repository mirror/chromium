{
  "comments": [
    {
      "key": {
        "uuid": "0f9c0b59_ebf57dbe",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "Could you comment out this line to prevent accidental use?",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "14f5f3ac_3a19a1cb",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "I\u0027ll add DEPRECATED_ prefix. Note that we should avoid removing fields so that ID conflicts are detected on build time.",
      "parentUuid": "0f9c0b59_ebf57dbe",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d44d528f_3c7fd2bc",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-30T08:10:50Z",
      "side": 1,
      "message": "Could you just leave a comment like the ones in FileSpecificInfo about previously used IDs?",
      "parentUuid": "14f5f3ac_3a19a1cb",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "64a4e5c0_1e62633c",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-30T09:08:50Z",
      "side": 1,
      "message": "As an engineer who was in a team where protocol buffers are far more extensively used than Chrome, I *STRONGLY* recommend to avoid removing a field.\n\nSince reusing the same tag number causes severe issues, we rename a field rather than removing/commenting-out it. That\u0027s a known best practice. If you don\u0027t believe, try internal code search with \"file:proto DEPRECATED_\".",
      "parentUuid": "d44d528f_3c7fd2bc",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ab18941f_58c85ee9",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-30T09:32:44Z",
      "side": 1,
      "message": "BTW I found Chrome\u0027s current protoc is new enough to support \"reserved\" keyword:\n\nhttps://cs.chromium.org/chromium/src/google_apis/gcm/protocol/mcs.proto?type\u003dcs\u0026q\u003dfile:proto+reserved\u0026sq\u003dpackage:chromium\u0026l\u003d97\n\nI\u0027m also fine with this.",
      "parentUuid": "64a4e5c0_1e62633c",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e57c8b0f_c3d6f0f9",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-09-01T09:46:35Z",
      "side": 1,
      "message": "Please do whatever as long as it doesn\u0027t result in redundant fields in the generated C++ code.",
      "parentUuid": "ab18941f_58c85ee9",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "38b4d3f9_79a619f9",
        "filename": "components/drive/drive.proto",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-09-04T05:25:19Z",
      "side": 1,
      "message": "OK, then let\u0027s use reserved.",
      "parentUuid": "e57c8b0f_c3d6f0f9",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "51198aa1_b3a8e720",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 194,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "Could you use plain English to make this more readable?",
      "range": {
        "startLine": 194,
        "startChar": 30,
        "endLine": 194,
        "endChar": 34
      },
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15158e7a_3d688ede",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 194,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "51198aa1_b3a8e720",
      "range": {
        "startLine": 194,
        "startChar": 30,
        "endLine": 194,
        "endChar": 34
      },
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "01c8f5d9_60198e90",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 196,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "I don\u0027t think this note is needed when this function is clearly supposed to migrate old DBs to V13.\nEspecially when what \"the usual migration convention\" means is unclear.",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3f614144_33260048",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 196,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "01c8f5d9_60198e90",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0c32203c_8a111b0b",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 198,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "I understand why you are tempted to use the word \"legacy\" here, but I don\u0027t expect future readers except me and you to understand what \"legacy\" here means.\nYou can just say UpgradeDBToV13 or something to make it cleaner.",
      "range": {
        "startLine": 198,
        "startChar": 5,
        "endLine": 198,
        "endChar": 29
      },
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4a84879c_69a53244",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 198,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0c32203c_8a111b0b",
      "range": {
        "startLine": 198,
        "startChar": 5,
        "endLine": 198,
        "endChar": 29
      },
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "77404cb8_5e84449f",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 394,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "Instead of having NOTREACHED here, you can convert the last \"else if\" to \"else\", probably while having a DCHECK_LE(version, 13) at the top of this function.",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ceaa6b6d_453751ce",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 394,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "77404cb8_5e84449f",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c3c487f0_6636e463",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 398,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "I don\u0027t understand why you are splitting only this part into a separate function, to make the migration 2-pass for old versions.\nCould you keep the current structure at least for v14?\n\nThe proposed code structure can be beneficial if we are going to do a major DB restructuring in future, but I\u0027m not sure if just clearing the changestamp does count as such a change.",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1f630b52_6b31eef0",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 398,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "Chatted offline and agreed to minimize the diff.",
      "parentUuid": "c3c487f0_6636e463",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8d9fc8ce_ec03239b",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 404,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "I don\u0027t think || is needed here.",
      "range": {
        "startLine": 404,
        "startChar": 15,
        "endLine": 404,
        "endChar": 38
      },
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31749796_0f611304",
        "filename": "components/drive/resource_metadata_storage.cc",
        "patchSetId": 1
      },
      "lineNbr": 404,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8d9fc8ce_ec03239b",
      "range": {
        "startLine": 404,
        "startChar": 15,
        "endLine": 404,
        "endChar": 38
      },
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d0349ae8_2449189c",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-29T09:28:09Z",
      "side": 1,
      "message": "Why are you changing this?",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "077e702d_5e3e7d51",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-29T10:43:47Z",
      "side": 1,
      "message": "I don\u0027t think naming test cases with milestone is a good idea because which milestone a change lands can differ after it lands on ToT, and also two DB schema changes can happen in one milestone. IIUC there is no reason to avoid rename existing tests.",
      "parentUuid": "d0349ae8_2449189c",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2dd1d77a_4465743b",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-08-30T08:10:50Z",
      "side": 1,
      "message": "\u003e which milestone a change lands can differ after it lands on ToT\n\nSorry, I cannot understand what this sentence means.\n\n\u003e two DB schema changes can happen in one milestone\n\nOur release is based on milestones, not on DB versions. Without cherry-picks, a beta/stable (which we provide QA) device never gets updates from the development branch.\n\nThis is totally unrelated to what you are doing and I still find it difficult to understand your motivation.\nCould you just focus on what you need to do?",
      "parentUuid": "077e702d_5e3e7d51",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92f09b2c_55775f71",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-08-30T09:08:50Z",
      "side": 1,
      "message": "\u003e\u003e which milestone a change lands can differ after it lands on ToT\n\u003e Sorry, I cannot understand what this sentence means.\n\nFor example:\n\nI\u0027m soon making a change to DB (CL:641735). I\u0027m not sure if I can commit the change before M62 branch cut end of this week, so let\u0027s assume I can not. Then I need to name the corresponding test case IncompatibleDB_M63.\n\nHowever I\u0027m currently talking with PM if we can cherry-pick the change to M62 release branch because the issue is high priority, though we\u0027re not 100% decided yet. If we decide to cherry-pick, then the test name would be wrong.\n\nThat\u0027s a fragile point of naming tests with milestones.\n\n\n\u003e\u003e two DB schema changes can happen in one milestone\n\u003e Our release is based on milestones, not on DB versions. Without cherry-picks, a beta/stable (which we provide QA) device never gets updates from the development branch.\n\nYou know, cherry-picks are not very rare today. And it is likely I\u0027ll do it soon.\n\n\n\u003e This is totally unrelated to what you are doing and I still find it difficult to understand your motivation. Could you just focus on what you need to do?\n\nI\u0027m focusing on what I need to do.\n\nMy motivation is: I wanted to at least rename DeleteUnusedIDEntries test below because it\u0027s essentially different test now -- it used to test the case where the DB version is kDBVersion (current version) while it now tests the upgrade behavior from V13 to V14. Now that the test is testing upgrade, I thought it\u0027s better to name it IncompatibleDB_*. However I\u0027m not sure how to name the test with IncompatibleDB_Mxx notion due to the same reason I described above.\n\n\n\n\nThat said, I\u0027m totally fine with keeping those test names as-is, but please suggest names for following two tests:\n\n1. DeleteUnusedIDEntries test we have today\n2. A new test for v14-\u003ev15 upgrade in CL:641735.",
      "parentUuid": "2dd1d77a_4465743b",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44c9ddb3_3425baf5",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-09-01T09:46:35Z",
      "side": 1,
      "message": "Regarding cherry-pick: I really feel hesitant about cherry-picking CLs like this. Messing up a user\u0027s persistent state results in having ugly cleanup logic like the one for crbug.com/374648. It\u0027s better to test the new code only on Dev channel as long as possible. Can\u0027t you add that feature to M62 without coverage on Drive?\n\nDeleteUnusedIDEntries is test against M37 DB.\nIIUC there is no need to add a test for v14-\u003ev15 because all beta/stable devices directly update from 13 to 15 when they receive M63 update.",
      "parentUuid": "92f09b2c_55775f71",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48281689_88caccc6",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-09-04T05:25:19Z",
      "side": 1,
      "message": "\u003e Regarding cherry-pick: I really feel hesitant about cherry-picking CLs like this. Messing up a user\u0027s persistent state results in having ugly cleanup logic like the one for crbug.com/374648. It\u0027s better to test the new code only on Dev channel as long as possible.\n\nYour concern about cherry-picking patches changing DB definitely makes sense. Given that we already passed M62 cut point, it might be better to consider other options. Let\u0027s talk offline later.\n\n\n\u003e Can\u0027t you add that feature to M62 without coverage on Drive?\n\nUnfortunately no -- Drive is the only source (among Drive, Downloads and ARC media) where \"last modified by me\" fix is needed.\n\n\n\u003e DeleteUnusedIDEntries is test against M37 DB.\n\u003e IIUC there is no need to add a test for v14-\u003ev15 because all beta/stable devices directly update from 13 to 15 when they receive M63 update.\n\nYour answer was not very clear to me, but I assume you meant (1) I can keep the name of DeleteUnusedIDEntries as-is and (2) I don\u0027t need to add an unit test case for the next change CL:641735. If I\u0027m wrong please let me know.",
      "parentUuid": "44c9ddb3_3425baf5",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b403698c_b0f8486a",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1000169
      },
      "writtenOn": "2017-09-04T09:10:02Z",
      "side": 1,
      "message": "Sorry for being unclear, what I meant was DeleteUnusedIDEntries should be renamed to IncompatibleDB_M37.\n\nBTW, I realized that only writing the milestone from which the tested DB version is used is not helpful enough.\nCould you put a comment like \"13 is the DB version which was used from M37 to M61\" somewhere in the test?",
      "parentUuid": "48281689_88caccc6",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4c89c565_b43dfd14",
        "filename": "components/drive/resource_metadata_storage_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2017-09-04T11:01:43Z",
      "side": 1,
      "message": "Thanks for clarification, done.",
      "parentUuid": "b403698c_b0f8486a",
      "revId": "a5fbeaa9462859352a98eb7b7d5785f9a4a448c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}