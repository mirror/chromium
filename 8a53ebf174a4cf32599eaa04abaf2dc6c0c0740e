{
  "comments": [
    {
      "key": {
        "uuid": "ac274064_13e47329",
        "filename": "components/viz/service/hit_test/hit_test_aggregator_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 384,
      "author": {
        "id": 1146978
      },
      "writtenOn": "2018-02-01T15:33:02Z",
      "side": 1,
      "message": "1. Why change to through CFSS::SubmitCompositorFrame()?\n2. Why immediately evict the surface each time?",
      "revId": "8a53ebf174a4cf32599eaa04abaf2dc6c0c0740e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d16660ca_4adf4431",
        "filename": "components/viz/service/hit_test/hit_test_aggregator_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 384,
      "author": {
        "id": 1211635
      },
      "writtenOn": "2018-02-01T16:54:38Z",
      "side": 1,
      "message": "1. Previous tests overrided FrameSinkManagerImpl::GetActiveFrameIndex to always use 0 as the frame_index, which we can\u0027t do anymore. In this CL, when we try to find the real active frame_index from Surface [1] in tests, it would fail because we didn\u0027t create a Surface in the first place. CFSS::SubmitCompositorFrame() can cover all that (creating a Surface, calling QueueFrame() so we have a valid active_frame_index and submitting hit-test region list), WDYT?\n\n2. In CFSS::SubmitCompositorFrame(), we check the new local_surface_id against the previous submitted ones [2]. There are some tests that are not submitting hit-test region list in order so that check was failing. Since we only care about checking hit-test region list in these unittests, I thought I would just evict the surface immediately after to avoid dealing with this. It is also required for tests where we submit multiple compositor frames so that we add each one into the destroy surface list and garbage collect all of them during TearDown().\n\n[1] https://cs.chromium.org/chromium/src/components/viz/service/frame_sinks/frame_sink_manager_impl.cc?type\u003dcs\u0026q\u003dframe_sink_manager_impl.cc\u0026l\u003d440\n[2] https://cs.chromium.org/chromium/src/components/viz/service/frame_sinks/compositor_frame_sink_support.cc?type\u003dcs\u0026l\u003d224",
      "parentUuid": "ac274064_13e47329",
      "revId": "8a53ebf174a4cf32599eaa04abaf2dc6c0c0740e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5979a42_9b199ae4",
        "filename": "components/viz/service/hit_test/hit_test_aggregator_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 384,
      "author": {
        "id": 1146978
      },
      "writtenOn": "2018-02-01T18:18:51Z",
      "side": 1,
      "message": "1. Makes sense. It might make sense to submits CFs that have a size which corresponds to the HitTestRegionList data too? Not sure if that will be ever be important.\n2. I see. We don\u0027t want to call EvictSurface() to get around those checks. Can you fix the test logic so the LocalSurfaceIds are ordered correctly? Also EvictSurface() is going away soon so this won\u0027t work long term.",
      "parentUuid": "d16660ca_4adf4431",
      "revId": "8a53ebf174a4cf32599eaa04abaf2dc6c0c0740e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e8e2aca_4bc3c8e8",
        "filename": "components/viz/service/hit_test/hit_test_aggregator_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 384,
      "author": {
        "id": 1211635
      },
      "writtenOn": "2018-02-02T20:56:27Z",
      "side": 1,
      "message": "1. The size in CFs shouldn\u0027t matter cuz HitTestRegionList data is not related to CFs after submission.\n2. As discussed offline, changed all surfaces to have different FSID and submit HTRL to its own CFSS. Thanks for the help!",
      "parentUuid": "b5979a42_9b199ae4",
      "revId": "8a53ebf174a4cf32599eaa04abaf2dc6c0c0740e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}