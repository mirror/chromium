{
  "comments": [
    {
      "key": {
        "uuid": "7a31b9aa_113f2ad2",
        "filename": "third_party/WebKit/Source/modules/crypto/SubtleCrypto.cpp",
        "patchSetId": 4
      },
      "lineNbr": 239,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "I suggest extracting this to a helper function (say, GetTaskRunner(script_state)).\n\nThen we can write GetTaskRunner(script_state) directly in the call to Decrypt() below (and for all the other functions).",
      "range": {
        "startLine": 237,
        "startChar": 2,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75668e52_422f3132",
        "filename": "third_party/WebKit/Source/modules/crypto/SubtleCrypto.cpp",
        "patchSetId": 4
      },
      "lineNbr": 239,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2018-01-10T07:03:43Z",
      "side": 1,
      "message": "Actually there were similar functions in a removed class called TaskRunnerHelper, and I removed this before to reduce glue codes (e.g. https://chromium-review.googlesource.com/c/chromium/src/+/758379). I\u0027d want to keep this as it is at least in this CL.",
      "parentUuid": "7a31b9aa_113f2ad2",
      "range": {
        "startLine": 237,
        "startChar": 2,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a662e5ec_7c3af3c9",
        "filename": "third_party/WebKit/Source/modules/crypto/SubtleCrypto.cpp",
        "patchSetId": 4
      },
      "lineNbr": 239,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2018-01-10T13:43:42Z",
      "side": 1,
      "message": "ScriptState is a tricky one. We generally prefer GetTaskRunner member functions, but it\u0027s not quite possible due to layering: in order to get a correct task runner you need to go through WebFrameScheduler (platform-level concept) and ScriptState (platform-level concept) does not have a reference to a WebFrameScheduler, you need to go though ExecutionContext (core/-level concept).\n\nI think that we could introduce a helper function limited to this specific file. Are you okay with it?",
      "parentUuid": "75668e52_422f3132",
      "range": {
        "startLine": 237,
        "startChar": 2,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "009ea6e8_361044ab",
        "filename": "third_party/WebKit/Source/modules/crypto/SubtleCrypto.cpp",
        "patchSetId": 4
      },
      "lineNbr": 242,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "See comment above.\nIf we don\u0027t extract to a helper function, then should probably change this to std::move(task_runner)",
      "range": {
        "startLine": 242,
        "startChar": 41,
        "endLine": 242,
        "endChar": 52
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a524314f_9a52a0c7",
        "filename": "third_party/WebKit/Source/modules/crypto/SubtleCrypto.cpp",
        "patchSetId": 4
      },
      "lineNbr": 242,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2018-01-10T07:03:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "009ea6e8_361044ab",
      "range": {
        "startLine": 242,
        "startChar": 41,
        "endLine": 242,
        "endChar": 52
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "77c44edd_0f1819ee",
        "filename": "third_party/WebKit/Source/platform/scheduler/renderer/web_frame_scheduler_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 264,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2018-01-10T13:45:26Z",
      "side": 1,
      "message": "Given that InternalWebCrypto is supposed to run javascript, let\u0027s move it to DeferrableTaskQueue .",
      "range": {
        "startLine": 264,
        "startChar": 4,
        "endLine": 264,
        "endChar": 37
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "895fe7bb_d162edf0",
        "filename": "third_party/WebKit/public/platform/TaskType.h",
        "patchSetId": 4
      },
      "lineNbr": 140,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "In terms of documentation, can we clarify that this isn\u0027t the task runner that actually performs the WebCrypto work - it is merely a task runner for posting results back from the WebCrtypo task runner to the Blink thread that initiated the call and holds the Promise?",
      "range": {
        "startLine": 139,
        "startChar": 5,
        "endLine": 140,
        "endChar": 15
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a36b351b_5b92935c",
        "filename": "third_party/WebKit/public/platform/TaskType.h",
        "patchSetId": 4
      },
      "lineNbr": 140,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2018-01-10T13:43:42Z",
      "side": 1,
      "message": "Could you please clarify this for me -- am I right that this task type (as implemented in this patchset) is used to run javascript callbacks? If so, does the spec specify task source for these tasks? (If no, it probably should. Meanwhile we should introduce a non-internal task source for this).\n\nEric, could you also tell me which task runner is actually performing WebCrypto work?",
      "parentUuid": "895fe7bb_d162edf0",
      "range": {
        "startLine": 139,
        "startChar": 5,
        "endLine": 140,
        "endChar": 15
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75e296cb_c052c1d8",
        "filename": "third_party/WebKit/public/platform/TaskType.h",
        "patchSetId": 4
      },
      "lineNbr": 140,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2018-01-10T20:00:34Z",
      "side": 1,
      "message": "Web Crypto\u0027s methods are all Promise based (https://www.w3.org/TR/WebCryptoAPI/).\n\nFor instance, crypto.subtle.encrypt() takes the inputs to encryption, and returns a Promise that will be fulfilled with the ciphertext. The spec says nothing about task runners or threads.\n\nOur implementation of the cryptographic operations live outside of Blink, in components/webcrypto/webcrypto_impl.cc. This component dispatches the cryptographic work to a threadpool (whose details are changing). Once the work is done, we need a way to complete the Promise that requested it.\n\nAt this point we are on some non-blink task runner. In order to resolve the Promise, we need to bounce back to the correct Blink thread, and then call into the v8 ScriptPromiseResolver stuff.\n\nThat is what the task runner in question is about. It is a TaskRunner for the Chromium code to bounce back to the Blink side to complete the Promise. This mechanism is quite subtle, since the blink thread may not even still exist (for instance web workers may have been killed, or the page may have been torn down). A lot of effort went into trying to share the right pointers and not extended lifetimes in a weird way.\n\nI would love if there were an easier way to do this, as the current mechanism is quite ugly and subtle. But hopefully that gives some context on what code is being talked about here.\n\nCheers.",
      "parentUuid": "a36b351b_5b92935c",
      "range": {
        "startLine": 139,
        "startChar": 5,
        "endLine": 140,
        "endChar": 15
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "087550fc_e169c4ce",
        "filename": "third_party/WebKit/public/platform/TaskType.h",
        "patchSetId": 4
      },
      "lineNbr": 142,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "It seems a bit odd to have a new enum just for these tasks.\nI don\u0027t know much about TaskType, so will defer to its OWNERs.\n(I would have expected re-use of an existing value).",
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "28fc92a0_3fcbec76",
        "filename": "third_party/WebKit/public/platform/TaskType.h",
        "patchSetId": 4
      },
      "lineNbr": 142,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2018-01-10T07:03:43Z",
      "side": 1,
      "message": "Good point. In the first place, these task types are needed to analyze what kind of task execution consumes how much time, but now I\u0027m not sure if the current task-type policies goes along with our purpose. altimin@, what do you think?",
      "parentUuid": "087550fc_e169c4ce",
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4cbd4559_00fa929d",
        "filename": "third_party/WebKit/public/platform/TaskType.h",
        "patchSetId": 4
      },
      "lineNbr": 142,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2018-01-10T13:43:42Z",
      "side": 1,
      "message": "We don\u0027t have a task type for anything which is crypto-related and I believe that WebCrypto warrants a special task type to describe it. See the comment about about whether it should be an internal one or not.",
      "parentUuid": "28fc92a0_3fcbec76",
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "344b1aaf_cff4b83b",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 154,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "Please update this to read:\n\n\"from the |result_task_runner| TaskRunner.\"",
      "range": {
        "startLine": 153,
        "startChar": 67,
        "endLine": 154,
        "endChar": 42
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1afe02b4_7aba322c",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 154,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2018-01-10T07:03:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "344b1aaf_cff4b83b",
      "range": {
        "startLine": 153,
        "startChar": 67,
        "endLine": 154,
        "endChar": 42
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "37a9e8ed_f3a0338b",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 164,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "Please update this to read:\n\n\"same thread (result_task_runner)\"",
      "range": {
        "startLine": 164,
        "startChar": 66,
        "endLine": 164,
        "endChar": 77
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5049521b_1282bcab",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 164,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2018-01-10T07:03:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "37a9e8ed_f3a0338b",
      "range": {
        "startLine": 164,
        "startChar": 66,
        "endLine": 164,
        "endChar": 77
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "60f6a582_1b9a0ac3",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 170,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "Please update this to read:\n\n\"thread (result_task_runner).\"",
      "range": {
        "startLine": 170,
        "startChar": 15,
        "endLine": 170,
        "endChar": 22
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1295594e_45575147",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 170,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2018-01-10T07:03:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "60f6a582_1b9a0ac3",
      "range": {
        "startLine": 170,
        "startChar": 15,
        "endLine": 170,
        "endChar": 22
      },
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e8a7b79a_51adf160",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 211,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "Can you change this type to scoped_refptr\u003cbase::TaskRunner\u003e (here and throughout), since from the perspective of this code it doesn\u0027t matter that it is a single thread task runner?",
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "633dac66_24f8ddf0",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 219,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "Can we rename |task_runner| to |result_task_runner|, or alternately |origin_task_runner|? (here and throughout)\n\n(With the name |task_runner| sounds like it would be the task runner that performs the actual cryptographic operation, however that is not the case).",
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "06693016_3738f214",
        "filename": "third_party/WebKit/public/platform/WebCrypto.h",
        "patchSetId": 4
      },
      "lineNbr": 249,
      "author": {
        "id": 1001766
      },
      "writtenOn": "2017-12-26T21:39:12Z",
      "side": 1,
      "message": "A different design would be to internalize the TaskRunner as a part of WebCryptoResult.\n\nIn other words, leave the API as it was (no new TaskRunner parameter), but add a TaskRunner parameter into WebCryptoResult. That seems like a good place to put it, since the threading dependency is only for calling WebCryptoResult. It would also make it clear that this is not a TaskRunner for doing the cryptography.\n\nWhat do you think?\n\nI am OK wth either approach, but interested what your thoughts are on this.\nThanks!",
      "revId": "8e1c622d4d77224e4a9cc0e95120aed8385093d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}