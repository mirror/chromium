{
  "comments": [
    {
      "key": {
        "uuid": "d5d4bd30_7f4b0fab",
        "filename": "ash/system/web_notification/inactive_user_notification_blocker.cc",
        "patchSetId": 4
      },
      "lineNbr": 23,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2017-09-27T00:03:54Z",
      "side": 1,
      "message": "Evan, what do you think about changing this to check if there\u0027s more than one user currently logged in? Or checking to see that the session is active?\n\nIn the code before your CL https://chromium-review.googlesource.com/646373 the MultiUserNotificationBlocker was only created when there was a MultiUserManagerChromeOS, which was only created after login and only when the device had multiple accounts.\n\n(I had a lot of trouble with this CL with ash unittests failing because this class is always created in any AshTestBase test, and it often was blocking notifications.)",
      "revId": "63f7fb22d851fdb02263f19e0331cda873f182f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c061f0a4_372fe487",
        "filename": "ash/system/web_notification/inactive_user_notification_blocker.cc",
        "patchSetId": 4
      },
      "lineNbr": 23,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-09-27T00:17:07Z",
      "side": 1,
      "message": "\u003e Evan, what do you think about changing this to check if there\u0027s more than one user currently logged in?\n\nseems fine to me\n\n\u003e Or checking to see that the session is active?\n\nnot sure what this means (what is \"the session\" in this case?)",
      "parentUuid": "d5d4bd30_7f4b0fab",
      "revId": "63f7fb22d851fdb02263f19e0331cda873f182f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "085abf2b_fed54ae6",
        "filename": "ash/system/web_notification/inactive_user_notification_blocker.cc",
        "patchSetId": 4
      },
      "lineNbr": 23,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2017-09-27T02:10:58Z",
      "side": 1,
      "message": "Sorry, by \"the session\" I mean \"after login is complete and there\u0027s at least one active user session\".\n\nI\u0027m tempted to check for both \u003e 1 user and session-state \u003d\u003d active. WDYT?",
      "parentUuid": "c061f0a4_372fe487",
      "revId": "63f7fb22d851fdb02263f19e0331cda873f182f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f33759ab_ffebe0f1",
        "filename": "ash/system/web_notification/inactive_user_notification_blocker.cc",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2017-09-27T00:03:54Z",
      "side": 1,
      "message": "Evan, do you know if profile_id is guaranteed to be set? I cannot assure myself that that is true from reading the code. If it\u0027s not true, then any code that fails to set profile_id will have its notification blocked, but only if multiprofile is not available (like there\u0027s only one account on device).\n\nThere seems to be lots of code in ash that uses system_notifier::CreateSystemNotification() but doesn\u0027t set a profile_id.\n\nThis might also be fixed if we only used this class when there actually were multiple user sessions.",
      "revId": "63f7fb22d851fdb02263f19e0331cda873f182f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "565d1550_edc16727",
        "filename": "ash/system/web_notification/inactive_user_notification_blocker.cc",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-09-27T00:17:07Z",
      "side": 1,
      "message": "\u003e Evan, do you know if profile_id is guaranteed to be set? I cannot assure myself that that is true from reading the code. If it\u0027s not true, then any code that fails to set profile_id will have its notification blocked, but only if multiprofile is not available (like there\u0027s only one account on device).\n\u003e \n\u003e There seems to be lots of code in ash that uses system_notifier::CreateSystemNotification() but doesn\u0027t set a profile_id.\n\u003e \n\nI think you might be right, that it is not always set, but the check on L26 allows system notifications to show anyway.\n\nIf there is some notification that is a SYSTEM_COMPONENT type and isn\u0027t on that list in notifier_settings.cc, then this might behave strangely for it. Thus it might be a good idea to return false for empty profile_id.\n\n\u003e This might also be fixed if we only used this class when there actually were multiple user sessions.\n\nwouldn\u0027t it still be broken for the multi user case then?",
      "parentUuid": "f33759ab_ffebe0f1",
      "revId": "63f7fb22d851fdb02263f19e0331cda873f182f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cbd04a6e_9134b3a3",
        "filename": "ash/system/web_notification/inactive_user_notification_blocker.cc",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2017-09-27T02:10:58Z",
      "side": 1,
      "message": "Re: empty profile_id, do you think it\u0027s better to err on the side of showing or on the side of hiding? I\u0027m tempted to show, since if we accidentally forget to set profile_id then it\u0027s a more visible bug.\n\nAlso, if we early-exited at the top of the function when there was only one user then I wouldn\u0027t be as worried about notifications with no profile_id.\n\nWDYT?",
      "parentUuid": "565d1550_edc16727",
      "revId": "63f7fb22d851fdb02263f19e0331cda873f182f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}