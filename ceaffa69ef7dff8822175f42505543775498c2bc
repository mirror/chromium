{
  "comments": [
    {
      "key": {
        "uuid": "1bc524d4_52cb4132",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1369,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-06-23T15:24:03Z",
      "side": 1,
      "message": "I would put \"testonly \u003d true\" here to ensure that all those targets are marked as testonly.",
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2c8eb53_942a6404",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1369,
      "author": {
        "id": 1164104
      },
      "writtenOn": "2017-06-23T18:25:43Z",
      "side": 1,
      "message": "Hmm, looks like setting \"testonly \u003d true\" here won\u0027t be inherited by the targets below. Since this is not very critical, I\u0027ll land this CL for now and send out a separate email thread to discuss this issue.",
      "parentUuid": "1bc524d4_52cb4132",
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c95d35a8_96325cb0",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1369,
      "author": {
        "id": 1164104
      },
      "writtenOn": "2017-06-23T21:45:43Z",
      "side": 1,
      "message": "Sorry for the confusion, I though you already lg\u0027ed. Guess I\u0027ll just ask the question here:\n\n1. I\u0027m getting quite confused about how testonly works because it seems that not all targets honor this variable. For example,\n  \n  source_set(_arch_loadable_module_source) {\n    forward_variables_from(invoker, [ \"deps\" ])\n    visibility \u003d [ \":$_arch_loadable_module_target\" ]\n  }\n\n  loadable_module(_arch_loadable_module_target) {\n    testonly \u003d true\n    deps \u003d [\n      \":$_arch_loadable_module_source\",\n    ]\n  }\n\nthe loadable module is testonly, and it depending on not testonly _arch_loadable_module_source, however, the code still compiles.\n\n2. According to the definition of forward_variables_from:\n\n  As a special case, if the variable_list is a string with the value of \"*\",\n  all variables from the given scope will be copied. \"*\" only copies variables\n  set directly on the from_scope, not enclosing ones. Otherwise it would\n  duplicate all global variables.\n\nSo, setting testonly \u003d true inside a template won\u0027t be passed along when calling other targets or templates. So, I\u0027m not sure if there is a way to apply testonly \u003d true to all the targets in the template.",
      "parentUuid": "f2c8eb53_942a6404",
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc97c2e7_fbe0fcbb",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1369,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-06-25T21:11:11Z",
      "side": 1,
      "message": "Setting \"testonly \u003d true\" in the template body will pass it to all templates and targets. It is possible that some of the template do not honor it (but then it is a defect of the template). I think however that the value will still be used.\n\nYou do not have to do the change in this CL if this require too many changes, but I think it would be best if the targets created by this template all had the \"testonly \u003d true\" flag so this should probably be done in a followup CL at least.",
      "parentUuid": "c95d35a8_96325cb0",
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b056d4b3_78a1efba",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1369,
      "author": {
        "id": 1164104
      },
      "writtenOn": "2017-06-26T18:18:43Z",
      "side": 1,
      "message": "I see, thanks for explaining! I\u0027ll add them in a separate CL just to make what I landed is close to the version you lg\u0027ed.",
      "parentUuid": "bc97c2e7_fbe0fcbb",
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f5b9a5c_12e4bfd1",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1511,
      "author": {
        "id": 1116027
      },
      "writtenOn": "2017-06-23T15:24:03Z",
      "side": 1,
      "message": "I think this should be default_shared_library_configs (since this target creates a loadable_module and not an executable).",
      "range": {
        "startLine": 1511,
        "startChar": 12,
        "endLine": 1511,
        "endChar": 38
      },
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44e8e89d_2ba55f05",
        "filename": "build/config/ios/rules.gni",
        "patchSetId": 2
      },
      "lineNbr": 1511,
      "author": {
        "id": 1164104
      },
      "writtenOn": "2017-06-23T18:25:43Z",
      "side": 1,
      "message": "Yes, thanks for pointing me to this config, the comment says clearly:\n\n# Shared library and loadable module defaults (also for components in component\n# mode).\ndefault_shared_library_configs",
      "parentUuid": "4f5b9a5c_12e4bfd1",
      "range": {
        "startLine": 1511,
        "startChar": 12,
        "endLine": 1511,
        "endChar": 38
      },
      "revId": "ceaffa69ef7dff8822175f42505543775498c2bc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}