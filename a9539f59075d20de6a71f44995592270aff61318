{
  "comments": [
    {
      "key": {
        "uuid": "d5d98af8_6566126a",
        "filename": "services/shape_detection/face_detection_provider_win.cc",
        "patchSetId": 11
      },
      "lineNbr": 71,
      "author": {
        "id": 1113896
      },
      "writtenOn": "2017-11-13T22:31:15Z",
      "side": 1,
      "message": "Is there a reason to prevent more than one IFaceDetector from being initialized simultaneously? If so please document it here.\n\nIt\u0027s important to note that by pausing method call processing if the pipe attached to |binding_| is closed before OnFaceDetectorCreated() is called that event won\u0027t be handled until method call processing is resumed so this will not allow us to cancel the operation early (not that AsyncOperation appears to support canceling the operation destruction anyways) if the result is not needed.\n\nAlternatively, given how this interface is used by actual clients, it is reasonable to simply fail any FaceDetectionRequest if the creation of an instance is in progress. In geolocation we actually treat this as a violation of the Mojo interface contract since there\u0027s no good reason for a renderer to do it.",
      "revId": "a9539f59075d20de6a71f44995592270aff61318",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8d55f90_583e91d5",
        "filename": "services/shape_detection/face_detection_provider_win.cc",
        "patchSetId": 11
      },
      "lineNbr": 71,
      "author": {
        "id": 1114999
      },
      "writtenOn": "2017-11-14T07:13:06Z",
      "side": 1,
      "message": "\u003e Is there a reason to prevent more than one IFaceDetector from being initialized \n\u003e simultaneously? If so please document it here.\n\nDone, because IFaceDetector initialization can take a long time.\n\n\u003e It\u0027s important to note that by pausing method call processing if the pipe attached to \n\u003e |binding_| is closed before OnFaceDetectorCreated() is called that event won\u0027t be handled \n\u003e until method call processing is resumed so this will not allow us to cancel the operation\n\u003e early (not that AsyncOperation appears to support canceling the operation destruction \n\u003e anyways) if the result is not needed.\n\nDo you mean we should set a connector error handler to |binding_| and resume call processing in the callback if the pipe attached to |binding_| is closed before OnFaceDetectorCreated() is called?\n\n\u003e Alternatively, given how this interface is used by actual clients, it is reasonable to simply \u003e fail any FaceDetectionRequest if the creation of an instance is in progress. In geolocation we \u003e actually treat this as a violation of the Mojo interface contract since there\u0027s no good reason \u003e for a renderer to do it.\n\nI don\u0027t get it. It\u0027s basic usage in here[1], do we need comment something?\nauto request \u003d mojo::MakeRequest(\u0026provider);\nprovider-\u003eCreateFaceDetection(mojo::MakeRequest(\u0026face_service_),\n                                std::move(face_detector_options));\n\n[1] https://cs.chromium.org/chromium/src/third_party/WebKit/Source/modules/shapedetection/FaceDetector.cpp?type\u003dcs\u0026l\u003d36",
      "parentUuid": "d5d98af8_6566126a",
      "revId": "a9539f59075d20de6a71f44995592270aff61318",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a55eb18_57c8130b",
        "filename": "services/shape_detection/face_detection_provider_win.cc",
        "patchSetId": 11
      },
      "lineNbr": 71,
      "author": {
        "id": 1113896
      },
      "writtenOn": "2017-11-14T19:05:38Z",
      "side": 1,
      "message": "\u003e Done, because IFaceDetector initialization can take a long time.\n\nThis will just make IFaceDetector initialization take longer since it becomes serialized so I\u0027m unsure of the benefit unless you also think that it is resource intensive and so we should avoid doing it multiple times. If the latter is true then we should do something to try to reuse the IFaceDetector interface between multiple clients but we can save that for a later patch.\n\n\u003e Do you mean we should set a connector error handler to |binding_| and resume call processing in the callback if the pipe attached to |binding_| is closed before OnFaceDetectorCreated() is called?\n\nMy point was that we won\u0027t get the pipe close notification if call processing is paused. There\u0027s nothing you can do about that if you want to use this mechanism to queue requests.\n\n\u003e I don\u0027t get it. It\u0027s basic usage in here[1], do we need comment something?\n\nIn [1] we only ever create a single FaceDetection instance from a FaceDetectionProvider so we don\u0027t need to handle the case where there are multiple simultaneous requests, or even any follow-up requests. At the top of this function we can just say:\n\nif (async_create_detector_ops_) {\n  mojo::ReportBadMessage(\"FaceDetectionProvider client may only create one FaceDetection at a time.\");\n  return;\n}",
      "parentUuid": "d8d55f90_583e91d5",
      "revId": "a9539f59075d20de6a71f44995592270aff61318",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ad872a62_c9b755b1",
        "filename": "services/shape_detection/face_detection_provider_win.cc",
        "patchSetId": 11
      },
      "lineNbr": 71,
      "author": {
        "id": 1114999
      },
      "writtenOn": "2017-11-16T01:52:27Z",
      "side": 1,
      "message": "\u003e This will just make IFaceDetector initialization take longer since it becomes serialized so I\u0027m unsure of the benefit unless you also think that it is resource intensive and so we should avoid doing it multiple times. If the latter is true then we should do something to try to reuse the IFaceDetector interface between multiple clients but we can save that for a later patch.\n\nWhen |provider|[1] goes out of scope it will immediately closes its end of the message pipe, then |async_create_detector_ops_| will be deleted and the callback OnFaceDetectorCreated will be not called, the PauseIncomingMethodCallProcessing prevent |binding_| from closing which isn\u0027t use for preventing more than one IFaceDetector from being initialized simultaneously, because we only create a single FaceDetection instance from a FaceDetectionProvider in[1], so i think it\u0027s not necessary to reuse the IFaceDetector interface between multiple clients. \n\n\u003e In [1] we only ever create a single FaceDetection instance from a FaceDetectionProvider so we don\u0027t need to handle the case where there are multiple simultaneous requests, or even any follow-up requests. At the top of this function we can just say:\n\nDone, thanks.",
      "parentUuid": "9a55eb18_57c8130b",
      "revId": "a9539f59075d20de6a71f44995592270aff61318",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}