{
  "comments": [
    {
      "key": {
        "uuid": "8789245e_6df34717",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2018-01-16T19:27:20Z",
      "side": 1,
      "message": "If I understand this correctly you are creating 4*numThreads at normal priority that all call CompleteConstructionNow, which unblocks the BACKGROUND priority thread while simultaneously stealing all CPU time.\n\nI worry that this is slightly racy, because until all of the threads have spun up there is a window of opportunity where there may be \u003cnumThreads normal-priority threads running but one of them may have already called CompleteConstructionNow.\n\nWhat I was expecting was that the main thread would create all of these worker threads and then the main thread would call CompleteConstructionNow(). That ensures that CompleteConstructionNow() isn\u0027t called too early.",
      "revId": "624a108d54d1e2136f80af8e6daedc72d683d0f8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e67093a8_1a2afdf9",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-01-16T19:34:10Z",
      "side": 1,
      "message": "What you want *is* what is happening.\n\nBarrierClosure is a closure which executes the Closure it was given after being called \u0027n\u0027 times. In this case it binds BlockingConstructor::CompleteConstructionNow() to run after being invoked kNumForegroundThreads, once by each thread :).",
      "parentUuid": "8789245e_6df34717",
      "revId": "624a108d54d1e2136f80af8e6daedc72d683d0f8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc82805c_b12f589d",
        "filename": "base/lazy_instance_unittest.cc",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2018-01-16T20:02:59Z",
      "side": 1,
      "message": "Gotcha.",
      "parentUuid": "e67093a8_1a2afdf9",
      "revId": "624a108d54d1e2136f80af8e6daedc72d683d0f8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}