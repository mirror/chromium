{
  "comments": [
    {
      "key": {
        "uuid": "6a7a4b49_c0fd5a0d",
        "filename": "components/drive/service/drive_api_service.cc",
        "patchSetId": 1
      },
      "lineNbr": 816,
      "author": {
        "id": 1001934
      },
      "writtenOn": "2017-11-22T22:24:14Z",
      "side": 1,
      "message": "What do you think of this?",
      "revId": "2a1e5b30b6573fb7e7015195e395c3278cda8bec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d16301c5_4c984fc3",
        "filename": "components/drive/service/drive_api_service.cc",
        "patchSetId": 1
      },
      "lineNbr": 816,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-11-24T01:15:32Z",
      "side": 1,
      "message": "Honestly I\u0027m not a big fan of it. We have now |request| and |file_request| and two callbacks |callback| and |authorize_callback| which do not IMHO improve readability here, as the code logic is simple. As for naming, |authorize_callback| is called even for a function which doesn\u0027t do authorization (FilesGetRequest). IMHO the original code was simple.\n\nIf you feel very strong about the refactoring, I won\u0027t block. But let\u0027s do some minor tweaks to make it simpler, eg. can we remove |file_request| and write directly to request? And a better name for |authorize_callback|?",
      "parentUuid": "6a7a4b49_c0fd5a0d",
      "revId": "2a1e5b30b6573fb7e7015195e395c3278cda8bec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7de2e493_9d28e029",
        "filename": "components/drive/service/drive_api_service.cc",
        "patchSetId": 1
      },
      "lineNbr": 816,
      "author": {
        "id": 1001934
      },
      "writtenOn": "2017-11-28T19:41:12Z",
      "side": 1,
      "message": "I put it back, except for the auto + std::make_unique() bit, and the fact that IsGoogleChromeAPIKeyUsed() will obviously return false in the else case.\n\nIt\u0027s your code, so if you are pushing back, I\u0027m not going to commit code that you don\u0027t line. It\u0027s not a big deal. I\u0027m just offering suggestions to see what sticks.\n\nDo you have any suggestions on a better name than |authorize_callback|? I was just making something up.\n\nFor |request| vs |file_request|, the request classes in the if/else blocks have a common AuthenticatedRequestInterface ancestor, but AuthenticatedRequestInterface doesn\u0027t have any of the setters. If you look in google_apis/drive/drive_api_requests.h, you can see 5 separate set_file_id() methods for the different classes. Maybe some refactoring there can help, but as is, there\u0027s no way to combine into a single return without the use of 2 unique_ptrs, or 1 unique_ptr, and a raw pointer cast.",
      "parentUuid": "d16301c5_4c984fc3",
      "revId": "2a1e5b30b6573fb7e7015195e395c3278cda8bec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2253fc76_4cd5729a",
        "filename": "components/drive/service/drive_api_service.cc",
        "patchSetId": 1
      },
      "lineNbr": 816,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-11-29T01:21:23Z",
      "side": 1,
      "message": "\u003e For |request| vs |file_request|, the request classes in the if/else\n \u003e blocks have a common AuthenticatedRequestInterface ancestor, but\n \u003e AuthenticatedRequestInterface doesn\u0027t have any of the setters. If\n \u003e you look in google_apis/drive/drive_api_requests.h, you can see 5\n \u003e separate set_file_id() methods for the different classes. Maybe\n \u003e some refactoring there can help, but as is, there\u0027s no way to\n \u003e combine into a single return without the use of 2 unique_ptrs, or 1\n \u003e unique_ptr, and a raw pointer cast.\n\nGot it. I missed it. One idea I have in mind could be request + authorize_request + get_request. WDYT?\n\nSo it would be:\n\nstd::unique\u003c...\u003e request;\nif (A) {\n  authorize_request \u003d ...\n  request \u003d file_request;\n} else {\n  get_request \u003d ...\n  request \u003d get_request;\n}\n\nreturn ...(request);\n\nActually with this naming, we could call the intermediate callback \"request_callback\", as it\u0027s a callback for |request|. WDYT?",
      "parentUuid": "7de2e493_9d28e029",
      "revId": "2a1e5b30b6573fb7e7015195e395c3278cda8bec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}