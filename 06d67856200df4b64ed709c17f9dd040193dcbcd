{
  "comments": [
    {
      "key": {
        "uuid": "10428c91_c98306cb",
        "filename": "components/ukm/ukm_recorder_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1136769
      },
      "writtenOn": "2017-11-25T16:51:37Z",
      "side": 1,
      "message": "only potential issue here is that it\u0027s possible for sources and entries to be serialized into different records, and we do want to retain the sources in that case. consider:\n\nsource a is created, with id 1\na UKM record is cut and serialized\nentry b is created referencing source id 1\n\nin this case, the source a would look like it didn\u0027t have any entries, when in fact they just hadn\u0027t been recorded yet. we do need to retain source a in this case since entry b will depend on its being recorded.\n\ngiven this i\u0027m disinclined to do this kind of filtering. wdyt?",
      "revId": "06d67856200df4b64ed709c17f9dd040193dcbcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "612d48cd_6e658a07",
        "filename": "components/ukm/ukm_recorder_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1103654
      },
      "writtenOn": "2017-11-25T18:01:43Z",
      "side": 1,
      "message": "In such a scenario, perhaps we can defer sending those sources until their associated entries are sent?\n\nThis would mean changing the logic to keep sources around that haven\u0027t been sent (and some logic to ensure we don\u0027t accumulate an infinite amount of them).\n\nThe only consequence of this is that sources will no longer appear \"in order\" server-side as some may get sent in later records instead. But I\u0027m not sure we have anything that depends on that.\n\nWDYT?",
      "parentUuid": "10428c91_c98306cb",
      "revId": "06d67856200df4b64ed709c17f9dd040193dcbcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "531828fe_222a726f",
        "filename": "components/ukm/ukm_recorder_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1136769
      },
      "writtenOn": "2017-11-26T00:05:16Z",
      "side": 1,
      "message": "Yeah, I think deferring those sources makes sense. The only reason I can think of not to do that is if an event is logged before its source - in that case, we might never send the source. But I don\u0027t think recording an event before its source is necessarily supported/intended, so this buffering scheme seems reasonable to me.\n\nIdeally, we\u0027d somehow figure out that very old sources that never saw an event can be discarded, however I don\u0027t think that\u0027s really something we can do - it\u0027s possible that a source is created early and its event logged much much later - for example, if a source is created at the beginning of a page load and an event is recorded only when the page is ended (for a very long lived gmail tab, for instance, this could be a very long time).\n\nSteven, how does this buffering prposal sound to you?",
      "parentUuid": "612d48cd_6e658a07",
      "revId": "06d67856200df4b64ed709c17f9dd040193dcbcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44425bab_23cb49e3",
        "filename": "components/ukm/ukm_recorder_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1136769
      },
      "writtenOn": "2017-11-27T15:12:21Z",
      "side": 1,
      "message": "There\u0027s a proposal in https://docs.google.com/document/d/1TnDvvcemJml2Y06fV73H9PCgxlSVuQcGzIvGielZpiw/edit that could potentially require sending sources even if they have no events. Let\u0027s wait for discussion on that doc to settle \u0026 then we can figure out how to proceed with this change.",
      "parentUuid": "531828fe_222a726f",
      "revId": "06d67856200df4b64ed709c17f9dd040193dcbcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c1b4c39_cc1f15ed",
        "filename": "components/ukm/ukm_recorder_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1103654
      },
      "writtenOn": "2017-11-27T16:41:11Z",
      "side": 1,
      "message": "I don\u0027t think we should block fixing the whitelist mechanism on the proposal.\n\nI propose we go with this for now and separately discuss the path forward for that proposal. We can add a first-class mechanism for associating multiple sources - or require them to log a metric with their sources to mark them as referenced.\n\nI\u0027ve added the logic to persistent unsent sources, with a parameter for max to keep. I\u0027ll work on adding tests.",
      "parentUuid": "44425bab_23cb49e3",
      "revId": "06d67856200df4b64ed709c17f9dd040193dcbcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "944f3bcf_a585aecf",
        "filename": "components/ukm/ukm_recorder_impl.cc",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1136769
      },
      "writtenOn": "2017-11-27T16:53:05Z",
      "side": 1,
      "message": "Sorry, I didn\u0027t mean to block progress on this change for very long. I was hoping we could drive high level clarity on the discussion in that doc in the next few days. I\u0027ll start a thread. If there\u0027s quick resolution then that can help us to know how to proceed here; otherwise I agree we should not block long term on that discussion.",
      "parentUuid": "9c1b4c39_cc1f15ed",
      "revId": "06d67856200df4b64ed709c17f9dd040193dcbcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}