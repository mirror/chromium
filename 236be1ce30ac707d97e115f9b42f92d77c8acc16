{
  "comments": [
    {
      "key": {
        "uuid": "85c47ea7_e6a4716d",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1456,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-26T08:05:05Z",
      "side": 1,
      "message": "How about add !HasOffscreenRect(container).\nAnd I think it will be better if we use container\u0027s virtual \u0026 visual rect with intersection of focused element.\nFor example, if we hit down key, starting rect will be\n(max(focused_element.left, virtual\u0026visual(container).left),  // \u003d\u003e A\n virtual\u0026visual(container).top,\n min(focused_element.(left + width), virtual\u0026visual(container).(left + width)) - A,\n 0)",
      "range": {
        "startLine": 1455,
        "startChar": 0,
        "endLine": 1456,
        "endChar": 73
      },
      "revId": "236be1ce30ac707d97e115f9b42f92d77c8acc16",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4582c96e_b96559b7",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1456,
      "author": {
        "id": 1245462
      },
      "writtenOn": "2018-01-26T09:54:25Z",
      "side": 1,
      "message": "I don\u0027t understand what you mean with:\n\n  virtual \u0026 visual\n\nCould you draw a picture of the overlapping rectangles? :)\n\n\u003e How about add !HasOffscreenRect(container).\n\nHow about this:\n\n  if focused element is not visible at all AND the container is (partially) visible:\n    use container\u0027s visible rect as starting_rect\n  else:\n    use the frame\u0027s visual viewport as starting_rect\n\n?",
      "parentUuid": "85c47ea7_e6a4716d",
      "range": {
        "startLine": 1455,
        "startChar": 0,
        "endLine": 1456,
        "endChar": 73
      },
      "revId": "236be1ce30ac707d97e115f9b42f92d77c8acc16",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22f1e2de_fd5e3bd6",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1456,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-26T10:28:53Z",
      "side": 1,
      "message": "\u003e Could you draw a picture of the overlapping rectangles? :)\n\nPlease refer to:\nhttps://docs.google.com/document/d/e/2PACX-1vSrEh7UVEabgv8ra7VEXp1_eb9x8gVwpYNe52_8jaKsSBB2Anu7MgejqwSTfkAyQGsTvz8hz3cse_28/pub\n\n\u003e How about this:\n\nDo you mean:\nif focused element is visible:\n  use focused element\u0027s visible rect\nelse if focused element is not visible AND the container is visible:\n  use container\u0027s visible rect [A]\nelse // focused element is not visible AND the container is not visible:\n  use frame\u0027s visual viewport\n?\n\nI agree. Just I want to use that I suggested in condition [A] :)",
      "parentUuid": "4582c96e_b96559b7",
      "range": {
        "startLine": 1455,
        "startChar": 0,
        "endLine": 1456,
        "endChar": 73
      },
      "revId": "236be1ce30ac707d97e115f9b42f92d77c8acc16",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab373ba5_abc8e1a4",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1456,
      "author": {
        "id": 1245462
      },
      "writtenOn": "2018-01-26T13:29:44Z",
      "side": 1,
      "message": "I thought:\n\n  container-\u003eGetLayoutObject()-\u003eAbsoluteVisualRect() \u003d\u003d container\u0027s visible rect\n\n\u003e Please refer to:\n\u003ehttps://docs.google.com/document/d/e/2PACX-1vSrEh7UVEabgv8ra7VEXp1_eb9x8gVwpYNe52_8jaKsSBB2Anu7MgejqwSTfkAyQGsTvz8hz3cse_28/pub\n\nI see in the picture that you\u0027ve projected the focused element onto the container\u0027s edge line?\n\nThat does make sense. But I wonder if we need such accuracy? :P We would then need logic to do projections in all 4 directions? Maybe this is enough:\n\n  if focused element is visible:\n    use focused element\u0027s AbsoluteVisualRect\n  else if focused element is not visible AND the container is visible:\n    use container\u0027s AbsoluteVisualRect\n  else // focused element is not visible AND the container is not visible:\n    use FindSearchStartPoint(frame)",
      "parentUuid": "22f1e2de_fd5e3bd6",
      "range": {
        "startLine": 1455,
        "startChar": 0,
        "endLine": 1456,
        "endChar": 73
      },
      "revId": "236be1ce30ac707d97e115f9b42f92d77c8acc16",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3bb8f121_aabb19c4",
        "filename": "third_party/WebKit/Source/core/page/FocusController.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1456,
      "author": {
        "id": 1243466
      },
      "writtenOn": "2018-01-29T05:17:11Z",
      "side": 1,
      "message": "\u003e But I wonder if we need such accuracy?\n\nI\u0027ll have more investigation about that. Please give the work to me :)\n\nAt least, I think we should use VirtualRectForDirection for second case.\n  if focused element is visible:\n    use focused element\u0027s AbsoluteVisualRect\n  else if focused element is not visible AND the container is visible:\n    use VirtualRectForDirection(container\u0027s AbsoluteVisualRect)\n  else // focused element is not visible AND the container is not visible:\n    use FindSearchStartPoint(frame)",
      "parentUuid": "ab373ba5_abc8e1a4",
      "range": {
        "startLine": 1455,
        "startChar": 0,
        "endLine": 1456,
        "endChar": 73
      },
      "revId": "236be1ce30ac707d97e115f9b42f92d77c8acc16",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}