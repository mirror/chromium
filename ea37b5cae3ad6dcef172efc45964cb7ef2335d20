{
  "comments": [
    {
      "key": {
        "uuid": "44d2ae16_4b862051",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "Add a NOTREACHED() inside this if-block.",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 58,
        "endChar": 13
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "592a9df4_fa49a865",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Actually the result is wrong here.\nThis can be false, if we have a SQL error, in which case I am returning max, to not start a new download and abort transaction.",
      "parentUuid": "44d2ae16_4b862051",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 58,
        "endChar": 13
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c3f747c9_f27d6e4e",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T20:44:02Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "592a9df4_fa49a865",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 58,
        "endChar": 13
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1283d2a4_d93b02f5",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 94,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "nit: could check this first and return early in case it\u0027s already at the maximum.",
      "range": {
        "startLine": 94,
        "startChar": 29,
        "endLine": 94,
        "endChar": 53
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19d46999_26fb3a78",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 94,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1283d2a4_d93b02f5",
      "range": {
        "startLine": 94,
        "startChar": 29,
        "endLine": 94,
        "endChar": 53
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f7595f0_b173b304",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "nit: add a comment somewhere stating this is a greedy approach for selecting files to download.",
      "range": {
        "startLine": 109,
        "startChar": 6,
        "endLine": 109,
        "endChar": 14
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "164473cb_54090e4d",
        "filename": "components/offline_pages/core/prefetch/download_archives_task.cc",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0f7595f0_b173b304",
      "range": {
        "startLine": 109,
        "startChar": 6,
        "endLine": 109,
        "endChar": 14
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0272494e_78f15a80",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "Add TODO to make this value Finch controlled.",
      "range": {
        "startLine": 14,
        "startChar": 14,
        "endLine": 14,
        "endChar": 25
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "76e455f4_55497995",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "I don\u0027t think such TODO would be useful:\n* We have not done it anywhere.\n* It will not be a simple bug fix, but rather a feature size work of its own.\n* We don\u0027t need a TODO to be reminded about that.",
      "parentUuid": "0272494e_78f15a80",
      "range": {
        "startLine": 14,
        "startChar": 14,
        "endLine": 14,
        "endChar": 25
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "17515419_5a06fc98",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T20:44:02Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "76e455f4_55497995",
      "range": {
        "startLine": 14,
        "startChar": 14,
        "endLine": 14,
        "endChar": 25
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b5972b37_dbab770e",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "This seems to be yet a 3rd solution from the options we discussed, making this table specific to the quota problem.\n\nIIRC we discussed this should be part of the solution for \"generic persisted values\" that would be either:\n* A key-value table with many rows (seemed to be the preferred approach by the majority).\n* A table with as many columns as persisted values are needed and a single row (which is exactly this approach but for the table and id column names; my personal preference too).",
      "range": {
        "startLine": 21,
        "startChar": 48,
        "endLine": 21,
        "endChar": 73
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "900a4149_cd710e0a",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "We discussed that further yesterday and got to the following conclusion:\n* key-value is bad because it is vague and it is easy to abuse it\n* we had no good name for table tracking the \"things\", therefore we went with something something more specific. As soon as we have more things, we can actually migrate to reasonably named table tracking them.\n\nOne more argument for having a dedicated table for quota tracking: when we have more namespaces we could have different quota for those, and that would be much more useful to have in a separate table.",
      "parentUuid": "b5972b37_dbab770e",
      "range": {
        "startLine": 21,
        "startChar": 48,
        "endLine": 21,
        "endChar": 73
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4df25b7f_1c281f08",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T20:44:02Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "900a4149_cd710e0a",
      "range": {
        "startLine": 21,
        "startChar": 48,
        "endLine": 21,
        "endChar": 73
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "52f8631a_27a3419d",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 40,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "* Not having Now() mock-able might make it harder to test this.\n* Adjustments to the device time could make the time subtraction result in a negative value what could lead to very surprising results. In that case we should return something reasonable, maybe the current |available_quota| value.\n* There is an integer by integer division here that make me worried. It would make it safer if the whole numerator was enclosed in parenthesis to guarantee the division would be the very last operation to be executed.",
      "range": {
        "startLine": 39,
        "startChar": 6,
        "endLine": 40,
        "endChar": 62
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2cba700_934a8f5a",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 40,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "1. Done.\n2. This will make the quota quota fluctuate by \u003c +/-1MB, which is survivable. I added normalization to make sure that we cap the quota (and impact of error) to [0, max daily].\n3. Done.",
      "parentUuid": "52f8631a_27a3419d",
      "range": {
        "startLine": 39,
        "startChar": 6,
        "endLine": 40,
        "endChar": 62
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a7db4f25_cf574573",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 40,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T20:44:02Z",
      "side": 1,
      "message": "2. We still need to be resilient to extreme cases (aka clock is reset and kept in the 1970s). Current code would indefinitely return 0 and stop any downloads from happening.\n3. The added parenthesis need to encompass kMaxDailyQuota too.",
      "parentUuid": "e2cba700_934a8f5a",
      "range": {
        "startLine": 39,
        "startChar": 6,
        "endLine": 40,
        "endChar": 62
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f5f50afb_8a5c6832",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "Make this safe against negative quota values.",
      "range": {
        "startLine": 47,
        "startChar": 56,
        "endLine": 47,
        "endChar": 61
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0deb3270_e05ef679",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.cc",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f5f50afb_8a5c6832",
      "range": {
        "startLine": 47,
        "startChar": 56,
        "endLine": 47,
        "endChar": 61
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d393bb7f_c8dce3ca",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.h",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "I don\u0027t think this class should be a utils-like class. As it manages the quota it could be instantiated with the |Connection| pointer and then make those methods non-static, removing the |db| parameter.",
      "range": {
        "startLine": 18,
        "startChar": 6,
        "endLine": 18,
        "endChar": 29
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f331c02f_ec291a16",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.h",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "nit: why not PrefetchDownloadQuota?",
      "range": {
        "startLine": 18,
        "startChar": 6,
        "endLine": 18,
        "endChar": 29
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ec142806_611795bf",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.h",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Done to the first.\nAs for the name, I think we control the quota of prefetch downloader class, don\u0027t we? That is why I called it that.",
      "parentUuid": "f331c02f_ec291a16",
      "range": {
        "startLine": 18,
        "startChar": 6,
        "endLine": 18,
        "endChar": 29
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5e326e34_1eec2e50",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.h",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T20:44:02Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ec142806_611795bf",
      "range": {
        "startLine": 18,
        "startChar": 6,
        "endLine": 18,
        "endChar": 29
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "deb89f31_cf6b0e75",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.h",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "If you choose not to make this a contruct-able class, then this should be removed.",
      "range": {
        "startLine": 24,
        "startChar": 2,
        "endLine": 24,
        "endChar": 26
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed2107c9_f8d86326",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_downloader_quota.h",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "deb89f31_cf6b0e75",
      "range": {
        "startLine": 24,
        "startChar": 2,
        "endLine": 24,
        "endChar": 26
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0429a940_5f249ee9",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store.cc",
        "patchSetId": 1
      },
      "lineNbr": 80,
      "author": {
        "id": 1134722
      },
      "writtenOn": "2017-08-18T01:50:21Z",
      "side": 1,
      "message": "nit: could set default to 1 to make it clearer that is a special key value.",
      "range": {
        "startLine": 80,
        "startChar": 45,
        "endLine": 80,
        "endChar": 46
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "06b6a0d3_29ae1c12",
        "filename": "components/offline_pages/core/prefetch/store/prefetch_store.cc",
        "patchSetId": 1
      },
      "lineNbr": 80,
      "author": {
        "id": 1002911
      },
      "writtenOn": "2017-08-18T18:36:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0429a940_5f249ee9",
      "range": {
        "startLine": 80,
        "startChar": 45,
        "endLine": 80,
        "endChar": 46
      },
      "revId": "ea37b5cae3ad6dcef172efc45964cb7ef2335d20",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}