{
  "comments": [
    {
      "key": {
        "uuid": "1fc046e0_328cd319",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-28T17:21:04Z",
      "side": 1,
      "message": "Should be replaced with IsArcPlayStoreAvailable() check?\nEven if ShouldArcAlwaysStart() returns true, if PlayStore is available, it is necessary to show OOBE or ArcSupport UI must be shown, I think.\n\n(off topic): BTW, is there a bit more reliable way to check?\nSpecifically, is it possible to see if the wizard is shown or not directly?\nMaintaining similar logic here and there looks difficult to me.",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8914f91d_af7b15dd",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-28T17:31:57Z",
      "side": 1,
      "message": "So this check to match the logic.\nhttps://cs.chromium.org/chromium/src/chrome/browser/chromeos/arc/arc_session_manager.cc?l\u003d594\n\nI can add ShouldArcAlwaysStart() || !IsArcPlayStoreAvailable() to make it more clear\nIsArcPlayStoreAvailable is included into ShouldArcAlwaysSta",
      "parentUuid": "1fc046e0_328cd319",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc4e3dff_b025f90d",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2017-11-29T22:14:12Z",
      "side": 1,
      "message": "\u003e (off topic): BTW, is there a bit more reliable way to check?\n\nL420-428 checks the login screen is showing ARC ToS screen. Should we always use that?",
      "parentUuid": "8914f91d_af7b15dd",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83a5a54d_0df535bf",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-29T22:17:16Z",
      "side": 1,
      "message": "Probably. it was long history changing this logic. Will trace history to see if we can use it.",
      "parentUuid": "cc4e3dff_b025f90d",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e33831a_5c10d559",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-29T22:43:46Z",
      "side": 1,
      "message": "It won\u0027t work in all cases. Here is the race condition for different mode.\nIn case of non-managed ARC this checks works fine because\n\n1. We start ARC OOBE Screen\n2. Set arc.enabled true\n3. This triggers ArcSessionManager that accesses this function and everything is correct.\n\nHowever for managed case we have different order.\n\n1. arc.enabled is already true\n2. ArcSessionManager accesses this function but we may not show OOBE page yet and ArcSessionManager thinks this is not OOBE case which is wrong.\n3. Only now ARC OOBE Screen is shown.\n\nSo. It is not very readable :( but we cannot rely only for L420-428",
      "parentUuid": "83a5a54d_0df535bf",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b1387d4_06f4ddf9",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-30T13:13:26Z",
      "side": 1,
      "message": "\u003e So this check to match the logic.\nhttps://cs.chromium.org/chromium/src/chrome/browser/chromeos/arc/arc_session_manager.cc?l\u003d594\n\nThen, we may be revisit the condition?\n\nOr, we need to have another condition which is;\n\n- PlayStore will never be launched with the current container being started\n\nE.g., ArcSessionManager::IsArcPlayStoreLaunchable() \u003d\u003d false etc? Maybe better if the method is tied to current container status, and explicitly to document that, if the condition is changed, ToS may need to be displayed somehow.\n\nIsArcPlayStoreAvailable() should be a subset of the new condition.\nShouldArcAlwaysStart() sounds like an independent concept.\n\nAlthough it may be just naming issue, but because we have lots of complex conditions there,\nit looks better to have clear naming and documentation to avoid accidents.\n\nWDYT?",
      "parentUuid": "9e33831a_5c10d559",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0897dc13_984b4b4b",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-30T17:20:30Z",
      "side": 1,
      "message": "Thank you for your comments.\n\nEvery point makes sense.\n\nLet use ShouldArcAlwaysStart to start ARC (as it is currently implemented) and IsPlayStoreAvailable to decide either ToS needs to be shown or not.\n\nI agree that ShouldArcAlwaysStart sounds not clear for ToS. In fact, ShouldArcAlwaysStart is equivalent to !IsPlayStoreAvailable due pARC was deprecated. I think in session manager, here and wizard controller we may use !IsPlayStoreAvailable for clean logic. ShouldArcAlwaysStart need to be refactored and pARC also needs to be cleaned out but this is big task and out of scope of this CL.\n\nWDYT about just using !IsPlayStoreAvailable to solve ambiguity?",
      "parentUuid": "7b1387d4_06f4ddf9",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7eb96501_04a135f3",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-30T17:43:00Z",
      "side": 1,
      "message": "SGTM! Could you add TODO, or file a tracking issue to clean up pARC?",
      "parentUuid": "0897dc13_984b4b4b",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efb8df5d_bc9f2cbd",
        "filename": "chrome/browser/chromeos/arc/arc_util.cc",
        "patchSetId": 2
      },
      "lineNbr": 441,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-30T17:57:57Z",
      "side": 1,
      "message": "Done as b/69960761",
      "parentUuid": "7eb96501_04a135f3",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c22776b2_060473d0",
        "filename": "chrome/browser/chromeos/login/wizard_controller.cc",
        "patchSetId": 2
      },
      "lineNbr": 1630,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-28T17:21:04Z",
      "side": 1,
      "message": "IIUC, we don\u0027t show ToS, if and only if PlayStore is not available.\nEven if ShouldArcAlwaysStart returns true, if PlayStore is available, logically OOBE needs to be shown, right?\nThen, could you remove this? Practically your focused case is covered by above, I think.",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f96fd202_83a5f7e7",
        "filename": "chrome/browser/chromeos/login/wizard_controller.cc",
        "patchSetId": 2
      },
      "lineNbr": 1630,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-28T17:31:57Z",
      "side": 1,
      "message": "We should have the same behavior as for legacy OptIn ToS.\n\nPlease see https://cs.chromium.org/chromium/src/chrome/browser/chromeos/arc/arc_session_manager.cc?l\u003d594\nwhere we don\u0027t show the ToS.",
      "parentUuid": "c22776b2_060473d0",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "94c17f76_7fb67170",
        "filename": "chrome/browser/chromeos/login/wizard_controller.cc",
        "patchSetId": 2
      },
      "lineNbr": 1630,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-28T17:36:24Z",
      "side": 1,
      "message": "Probably it makes sense to remove L1624-28 to match the logic for all cases.",
      "parentUuid": "f96fd202_83a5f7e7",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db0dc0fd_da8e83ba",
        "filename": "chrome/browser/chromeos/login/wizard_controller.cc",
        "patchSetId": 2
      },
      "lineNbr": 1630,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-11-30T13:13:26Z",
      "side": 1,
      "message": "Thank you for explanation.\nI understand your concept, but I still worried about keeping ShouldArcAlwaysStart() here.\nCould you refer my another comments for more details?",
      "parentUuid": "94c17f76_7fb67170",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64eadd33_f846410f",
        "filename": "chrome/browser/chromeos/login/wizard_controller.cc",
        "patchSetId": 2
      },
      "lineNbr": 1630,
      "author": {
        "id": 1136695
      },
      "writtenOn": "2017-11-30T17:20:30Z",
      "side": 1,
      "message": "Answered there.",
      "parentUuid": "db0dc0fd_da8e83ba",
      "revId": "743ca4c52e700ea83b75bf21646b3e8e5f571734",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}