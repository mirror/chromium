{
  "comments": [
    {
      "key": {
        "uuid": "cb7c7f4a_3610f249",
        "filename": "third_party/WebKit/Source/core/page/Page.cpp",
        "patchSetId": 3
      },
      "lineNbr": 573,
      "author": {
        "id": 1002854
      },
      "writtenOn": "2017-06-23T15:01:42Z",
      "side": 1,
      "message": "I\u0027m a little concerned about the process of running the observers invalidating iterators into |plugins_changed_observers_| (either by modifying the collection, or by causing an Oilpan GC which collects a weakly held observer).\n\nA pattern for handling this (inline capacity optional, but reasonable if you\u0027re concerned about allocating another collection backing buffer):\n\nHeapVector\u003cMember\u003cPluginsChangedObserver\u003e, 32\u003e observers;\nCopyToVector(plugins_changed_observers_, observers);\nfor (PluginsChangedObserver* observer : observers)\n  observer-\u003ePluginsChanged();\n\nSomething fancier could be done if we wanted to allow observers to remove other observers and have them not be notified, but this is simpler and at least safe.",
      "revId": "c48741ce5fddc581ff4d91dd8b364def70684cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64a54cb6_2a788f53",
        "filename": "third_party/WebKit/Source/core/page/Page.cpp",
        "patchSetId": 3
      },
      "lineNbr": 573,
      "author": {
        "id": 1115916
      },
      "writtenOn": "2017-06-23T16:27:45Z",
      "side": 1,
      "message": "Just to clarify, that is not a problem in terms of Oilpan\u0027s GC. Oilpan\u0027s GC strongly traces weak collections that are referenced from the machine stack. So observers should not be collected during the loop.\n\nHowever, if PluginsChanged() has a code path to remove some observers, that causes the problem.\n\nIn conclusion, the pattern Jeremy proposed looks good.",
      "parentUuid": "cb7c7f4a_3610f249",
      "revId": "c48741ce5fddc581ff4d91dd8b364def70684cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd70354c_abe359d4",
        "filename": "third_party/WebKit/Source/core/page/Page.cpp",
        "patchSetId": 3
      },
      "lineNbr": 573,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-06-23T18:17:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "64a54cb6_2a788f53",
      "revId": "c48741ce5fddc581ff4d91dd8b364def70684cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "11bbd0b5_385c6425",
        "filename": "third_party/WebKit/Source/core/page/Page.cpp",
        "patchSetId": 3
      },
      "lineNbr": 575,
      "author": {
        "id": 1002854
      },
      "writtenOn": "2017-06-23T15:01:42Z",
      "side": 1,
      "message": "nit: put the break inside the braces",
      "revId": "c48741ce5fddc581ff4d91dd8b364def70684cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "63ac5a1b_b420dc0a",
        "filename": "third_party/WebKit/Source/core/page/Page.cpp",
        "patchSetId": 3
      },
      "lineNbr": 575,
      "author": {
        "id": 1211699
      },
      "writtenOn": "2017-06-23T18:17:36Z",
      "side": 1,
      "message": "Done. I\u0027ve also fixed the two occurrences above for consistency.",
      "parentUuid": "11bbd0b5_385c6425",
      "revId": "c48741ce5fddc581ff4d91dd8b364def70684cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}