<html>
<script>

  function success() {
    domAutomationController.send(true);
  }

  function failure() {
    domAutomationController.send(false);
  }

  function setCookie() {
    document.cookie = 'foo=bar';
    success();
  }

  function hasCookie() {
    domAutomationController.send(document.cookie == 'foo=bar');
  }

  function setLocalStorage() {
    localStorage.setItem('foo', 'bar');
    success();
  }

  function hasLocalStorage() {
    domAutomationController.send(localStorage.getItem('foo') == 'bar');
  }

  function setSessionStorage() {
    sessionStorage.setItem('foo', 'bar');
    success();
  }

  function hasSessionStorage() {
    domAutomationController.send(sessionStorage.getItem('foo') == 'bar');
  }

  function setServiceWorker() {
    navigator.serviceWorker.register('empty_worker.js').then(success);
  }

  function hasServiceWorker() {
    navigator.serviceWorker.getRegistrations().then(function (registrations) {
      domAutomationController.send(registrations.length > 0);
    });
  }

  function openFile_(name, options, callback, error) {
    window.webkitRequestFileSystem(TEMPORARY, 1024, function (fs) {
      fs.root.getFile(name, options, callback, error);
    });
  }

  function setFileSystem() {
    openFile_('foo.txt', { create: true, exclusive: true }, success, failure);
  }

  function hasFileSystem() {
    openFile_('foo.txt', { create: false }, success, failure);
  }

  function setWebSql() {
    var db = openDatabase('testdb', '1.0', 'a test db', 1024);
    db.transaction(function (tx) {
      tx.executeSql('CREATE TABLE IF NOT EXISTS foo (text)');
      tx.executeSql('INSERT INTO foo (text) VALUES ("bar")');
    }, failure, success);
  }

  function hasWebSql() {
    var db = openDatabase('testdb', '1.0', 'a test db', 1024);
    db.transaction(function (tx) {
      tx.executeSql('CREATE TABLE IF NOT EXISTS foo (text)');
      tx.executeSql('SELECT * FROM foo', [], function (tx, results) {
        domAutomationController.send(results.rows.length > 0);
      });
    });
  }
</script>

<body>
  This page is used to test creation and deletion of various site data types.
</body>

</html>