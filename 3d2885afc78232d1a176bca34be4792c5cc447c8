{
  "comments": [
    {
      "key": {
        "uuid": "4767e502_d57bf20a",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2017-09-11T15:44:24Z",
      "side": 1,
      "message": "I don\u0027t think this is a good idea.\n\nCan you instead introduce a virtual LayerOwner::OnLayerCreated(), which gets called from LayerOwner::RecreateLayer() instead? It is possible to install a different LayerOwnerDelegate from outside, and even when that happens, we would want to re-allocate the local-surface-id as appropriate. So doing this through the delegate interface can break and go undetected. Doing this through LayerOwner api is safer.",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c3a1a49_7ccf97d4",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-09-12T01:44:56Z",
      "side": 1,
      "message": "We\u0027ll have two ways for doing the same thing - OnLayerCreated and OnLayerRecreated in the delegate. I don\u0027t think it\u0027s right.\n\n\nIf you\u0027re concerned about the delegate being reassigned, how about passing the delegate in LayerOwner constructor? It\u0027ll make it immutable.\n\n\nWDYT?",
      "parentUuid": "4767e502_d57bf20a",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "74948282_f912c102",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-09-12T02:08:02Z",
      "side": 1,
      "message": "LayerOwnerDelegate is used in ContentsWebView for a thing which is not delegating. ContentsWebView is simply performing some extra logic, which is related to some web view specific animations. It\u0027s not delegation. It\u0027s an observer pattern.\n\nHowever, resetting local surface id *is* a delegation, as it\u0027s required to make LayerOwner::RecreateLayer work properly.\n\nSo, ideally we should have both - an observer and a delegate, though it would be an overkill. So, I\u0027d suggest to simply change the delegate into an observer. WDYT?",
      "parentUuid": "6c3a1a49_7ccf97d4",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "62c04b3f_1c6ee2e8",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2017-09-13T15:55:10Z",
      "side": 1,
      "message": "ContentsWebView is-a LayerOwner, as is Window here. I would just remove the delegate altogether, and do this through LayerOwner::OnLayerCreated()",
      "parentUuid": "74948282_f912c102",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2ccb8e98_3142b6ee",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-09-14T00:39:36Z",
      "side": 1,
      "message": "That\u0027s IMHO even more bug prone. We\u0027d need to call super in each OnLayerCreated, and it\u0027s easy to forget. Eg. if we don\u0027t call the base class OnLayerCreated from ContentsWebView::OnLayerCreated, and then add some logic in View::OnLayerCreated, then it will never be executed.\n\n\nIf your concern is the delegate being overriden, how about adding a DCHECK so it\u0027s only set once?",
      "parentUuid": "62c04b3f_1c6ee2e8",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b217e710_e55aac7d",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2017-09-18T22:51:41Z",
      "side": 1,
      "message": "Can you clarify why we\u0027d need to call super in each OnLayerCreated()?",
      "parentUuid": "2ccb8e98_3142b6ee",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8430795_b7a0e9b3",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-09-19T06:28:26Z",
      "side": 1,
      "message": "If we don\u0027t call the parent method, then we\u0027d have:\n\nContentsWebView::OnLayerCreated() {\n   // Logic (A)\n}\n\nIt\u0027s good until someone adds in the future:\n\nView::OnLayerCreated() {\n   // Logic (B)\n}\n\nThen the logic (B) will execute for other views, but not for ContentsWebView.\n\nBy the way, this review takes way more time than it should. We really need this to be fixed for ARC. I\u0027m happy to do follow ups if you want to clean up this code further.",
      "parentUuid": "b217e710_e55aac7d",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af309603_8842d077",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1000111
      },
      "writtenOn": "2017-09-20T21:40:11Z",
      "side": 1,
      "message": "views::View and aura::Window are LayerOwners, and having these be their own delegate seems unnecessary. Having both delegate and observer seems overkill. Having a list of observers also seem unnecessary.\n\nI prefer doing this in LayerOwner itself, but a DCHECK() when setting the delegate to make sure it is set only once would also work. (the concern about chaining applies too all non-final overrides/non-empty virtual functions in views::View and many other places though, right?)",
      "parentUuid": "a8430795_b7a0e9b3",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f2b8fc9_b1b52828",
        "filename": "ui/aura/window.cc",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002249
      },
      "writtenOn": "2017-09-22T02:19:49Z",
      "side": 1,
      "message": "OK, I removed the delegate, and changed it to overriding the existing LayerOwner::RecreateLayer, as we were doing that already in view.cc. PTAL.",
      "parentUuid": "af309603_8842d077",
      "revId": "3d2885afc78232d1a176bca34be4792c5cc447c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}