{
  "comments": [
    {
      "key": {
        "uuid": "c9c40382_c46e5370",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-08-07T21:44:33Z",
      "side": 1,
      "message": "The thing I\u0027m worried about here is removing a !safe_for_autoreplace URL.  That would be a true-manual-addition type thing and I kinda wouldn\u0027t want to blow that away.  Maybe in that case it\u0027s OK not to touch this or update its timestamp, and have it get filtered out, because the user has explicitly looked at this engine in the search engine edit dialog before, and if they wanted it as default, they could have done so then?\n\nI suspect this would be rare; most !prepopulated entries would still be safe_for_autoreplace due to auto-addition on visits.",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2088e75d_a5b4eda2",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-07T21:54:19Z",
      "side": 1,
      "message": "For this case, we need all of these search engines to be added.  If removing it ever isn\u0027t ok, then we\u0027re in a bad way.  We\u0027d either way to ensure they\u0027re visible by updating the timestamp, or it will crash as we are in an unsupported situation.\n\nAs this is very much a special case, removing it and adding it back is \"OK\".  The other option would be to clear all search engines and force them to be shown for a different locale as if you started fresh.  If this is unlikely, then it is just and edge case of this needing to be supported.",
      "parentUuid": "c9c40382_c46e5370",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5affa593_e2d4e2cd",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-08-07T22:15:06Z",
      "side": 1,
      "message": "I don\u0027t think you can safely remove a non-safe_for_autoreplace engine.  That\u0027s going to mean dataloss.\n\nIn that case we\u0027d probably want to instead modify the existing entry to just add a prepopulate ID.",
      "parentUuid": "2088e75d_a5b4eda2",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c53b70a5_d36abf59",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-07T22:17:31Z",
      "side": 1,
      "message": "Alas, updating isn\u0027t possible, so I\u0027m going to revert back to the timestamp one.  That seems to be the least terrible option at this point.",
      "parentUuid": "5affa593_e2d4e2cd",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "351af8f0_3725f8fe",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-08-07T22:20:40Z",
      "side": 1,
      "message": "Let\u0027s just make sure we understand the long term plan, and also if there\u0027s a way we can avoid getting into this kind of last-minute scenario in the future (maybe there isn\u0027t).",
      "parentUuid": "c53b70a5_d36abf59",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6daecce3_05842726",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-07T22:26:54Z",
      "side": 1,
      "message": "The only option I see at this point would be to expose Update that allows updating the prepopulate id w/o remove and add.\n\nThe gotcha there is when the existing one doesn\u0027t actually conceptually match the prepopulated one.  That is something that I\u0027m not sure how we should handle it.  I don\u0027t know the template url logic well enough to know whether mutating one or the other to avoid conflicts is OK (and which one should be mutated).\n\nAs search engines are not historically synced nor can you manually add them on mobile, so the points you raised likely don\u0027t exist on mobile and probably shouldn\u0027t affect this.",
      "parentUuid": "351af8f0_3725f8fe",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d08fe4a_b4bf0a63",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 95,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-08-07T22:40:16Z",
      "side": 1,
      "message": "Either expose Update(), or maybe we build this \"special locale\" functionality into TemplateUrlService somehow.  Those seem like the right route to me.\n\nIf things don\u0027t conceptually match, then really all the choices here that try to have one entry are wrong.  We\u0027d want two entries.  To determine what to do, we\u0027d need to define \"conceptually match\" better, so we could write code to detect it.\n\nSince engines aren\u0027t currently synced/manually-addable, it seems like the remove-and-add route might just Be OK for now?  We should assume that at some point in the future either of those factors may change though.",
      "parentUuid": "6daecce3_05842726",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb217439_5c0a7c67",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 104,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-08-07T22:15:06Z",
      "side": 1,
      "message": "I don\u0027t think this is right.  Even if this existed, if the old URL was safe_for_autoreplace, the new one should be too.  Otherwise these won\u0027t get updated correctly.",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "33cb2ddb_47b308d1",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 109,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-08-07T21:44:33Z",
      "side": 1,
      "message": "This conditional seems incorrect.\n\nFirst, the DCHECK can never fail, because we\u0027re inside a conditional for (added_turl).  Second, I don\u0027t think you meant to return false if we succeeded in adding the URL.  And it doesn\u0027t make sense to handle DCHECK failure anyway (per our style guide).\n\nSo I think probably leaving the old code as is was is more what you want?",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57921c9d_b1985219",
        "filename": "chrome/browser/android/locale/special_locale_handler.cc",
        "patchSetId": 3
      },
      "lineNbr": 109,
      "author": {
        "id": 1116043
      },
      "writtenOn": "2017-08-07T21:54:19Z",
      "side": 1,
      "message": "You are 100% correct.  This logic should have been in an else, which I updated.",
      "parentUuid": "33cb2ddb_47b308d1",
      "revId": "a2bcbfa333adc17d90f671b31cfc3fbec900cf6f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}