{
  "comments": [
    {
      "key": {
        "uuid": "ca8062db_0cea2ea3",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-08-21T02:02:59Z",
      "side": 1,
      "message": "I feel making this handled by the consumer (ResourceDispatcher or URLLoaderClientImpl) rather than by ThrottlingURLLoader might be slightly cleaner, wdyt?",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e97cc377_91e17bbf",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1104639
      },
      "writtenOn": "2017-08-21T16:34:48Z",
      "side": 1,
      "message": "+1 for letting the consumer either configure the behavior or handle it directly.",
      "parentUuid": "ca8062db_0cea2ea3",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b3191aa_96276b85",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1113896
      },
      "writtenOn": "2017-08-21T22:44:30Z",
      "side": 1,
      "message": "I don\u0027t see why this error should be reported to the client differently than other errors, which is to call forwarding_client_-\u003eOnComplete() with an error the way CancelWithError() does.\n\nI\u0027ve added logic to OnClientConnectionError() to make it clearer than failing with net::ERR_FAILED (or some other new error code we may want to add) is the right way to handle this case but that that is currently disabled for asynchronous requests without PlzNavigate.",
      "parentUuid": "e97cc377_91e17bbf",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4886153f_b218be09",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-08-22T01:53:52Z",
      "side": 1,
      "message": "My mental view is as following:\n\nThrottle implementers can choose to call CancelWithError if it thinks it should do that, because that\u0027s a part of the logic each throttle implements (but not the part of ThrottlingURLLoader itself).\n\nWhereas, connection error over mojo pipe is usually handled by the consumers, and your issue description also says that this change mirrors how ResourceDispatcher was doing, which seems to imply that the logic belongs to the consumer.  If we change where we hook ThrottlingURLLoader in the loading pipeline we\u0027ll easily forget that the connection error was being handled by ThrottlingURLLoader and we\u0027ll introduce the same error... which feels error prone.  So I prefer having it handled by the consumer.  Would it make sense?",
      "parentUuid": "6b3191aa_96276b85",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f4a135af_54eb7bc1",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1113896
      },
      "writtenOn": "2017-08-22T04:35:55Z",
      "side": 1,
      "message": "ThrottlingURLLoader is the consumer of the Mojo interface. The interface provided to consumers of ThrottlingURLLoader shouldn\u0027t leak unnecessary details about Mojo. A Mojo pipe connection error should be just like any other net error code, not a special signal that they may forget to implement properly. If the Mojo pipe closes unexpectedly then that load has failed. There isn\u0027t another option for how to respond to that failure.\n\nThe logic in ResourceDispatcher I am copying is in StartSync() where if the legacy sync IPC call fails net::ERR_FAILED is returned. In that case ResourceDispatcher is the direct consumer of the legacy IPC channel and hides the IPC failure from WebURLLoaderImpl, its client.\n\nmmenke@ has the same logic in his SimpleURLLoader:\n\nhttps://chromium-review.googlesource.com/c/chromium/src/+/600630/29/content/public/common/simple_url_loader.cc#451",
      "parentUuid": "4886153f_b218be09",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb08c74a_2f94d40d",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-08-22T04:57:18Z",
      "side": 1,
      "message": "SimpleURLLoader is meant to be a helper utility that simplifies the URLLoader usage, so it hides those details totally makes sense to me.  On the other hand to me ThrottlingURLLoader appears to be a wrapper layer that is inserted between the consumer and the mojo layer (and that\u0027s actually what the header comment of ThrottlingURLLoader says), and if no throttles are inserted I\u0027d expect it just works as a transparent forwarding layer. The final consumers may also want to add their own connection error handling in addition to detach the clients, and the current code doesn\u0027t provide the ability.\n\nI strongly think that at least the behavior should be clearly documented in ThrottlingURLLoader, it differs from what I\u0027d expect from the current ThrottlingURLLoader\u0027s API contract.",
      "parentUuid": "f4a135af_54eb7bc1",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "894a7331_d667df92",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1113896
      },
      "writtenOn": "2017-08-22T22:27:11Z",
      "side": 1,
      "message": "I\u0027ve added a comment to ThrottlingURLLoader. I experimented with passing along the connection error to |forwarding_client_| however this turned out to be much more complex as there is no (and I cannot add) a method in the mojom::URLLoaderClient interface for reporting a connection error.",
      "parentUuid": "eb08c74a_2f94d40d",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "764cdf3f_871f53c4",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 176,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-08-22T23:18:18Z",
      "side": 1,
      "message": "The comment works for me, thanks!",
      "parentUuid": "894a7331_d667df92",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8df06717_45139f31",
        "filename": "content/common/throttling_url_loader.cc",
        "patchSetId": 4
      },
      "lineNbr": 297,
      "author": {
        "id": 1001472
      },
      "writtenOn": "2017-08-21T02:02:59Z",
      "side": 1,
      "message": "Should this rather be called by the consumer?",
      "revId": "060a56075006c33adf57a329ebffd084ec044f44",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}