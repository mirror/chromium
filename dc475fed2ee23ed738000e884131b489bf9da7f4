{
  "comments": [
    {
      "key": {
        "uuid": "6aa7565c_1d47d708",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.cc",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-11T20:19:49Z",
      "side": 1,
      "message": "DCHECK that the runner is null?",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72efad7e_9daa5c42",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.cc",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "No, that\u0027s not necessarily true — when TaskQueueManager gets deleted first, TaskQueueImpl becomes unregistered even with shutdown task runner.",
      "parentUuid": "6aa7565c_1d47d708",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e48e7289_11aeb598",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.cc",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2017-10-12T04:04:27Z",
      "side": 1,
      "message": "As the default value is nullptr, can\u0027t |shutdown_task_runner_| be null?",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66750e65_591791ee",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.cc",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "Added a comment.\n\nIf |shutdown_task_runner_| is not provided, TaskQueue should be unregistered manually.",
      "parentUuid": "e48e7289_11aeb598",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32a37f47_c95b298f",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.h",
        "patchSetId": 1
      },
      "lineNbr": 101,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-11T20:19:49Z",
      "side": 1,
      "message": "Could we put the shutdown task runner here instead? It feels like a configuration option and I think it would read better at the call site.",
      "range": {
        "startLine": 101,
        "startChar": 4,
        "endLine": 101,
        "endChar": 12
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "71585f7b_aea8a7d2",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.h",
        "patchSetId": 1
      },
      "lineNbr": 101,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "32a37f47_c95b298f",
      "range": {
        "startLine": 101,
        "startChar": 4,
        "endLine": 101,
        "endChar": 12
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6b39d507_5dd6cd0e",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.h",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1119250
      },
      "writtenOn": "2017-10-12T09:52:44Z",
      "side": 1,
      "message": "I wonder if this should still be explicit now?  Not actually sure.",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 10
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9912254_43fcd408",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue.h",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "6b39d507_5dd6cd0e",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 10
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da652602_8a7bf24c",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-11T20:19:49Z",
      "side": 1,
      "message": "DCHECK that the queues are empty? Otherwise it\u0027s not a very graceful shutdown.",
      "range": {
        "startLine": 83,
        "startChar": 14,
        "endLine": 83,
        "endChar": 27
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95e10458_7e9e3828",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "When TaskQueueManager is going away, we have to delete everything, so no guarantees here.",
      "parentUuid": "da652602_8a7bf24c",
      "range": {
        "startLine": 83,
        "startChar": 14,
        "endLine": 83,
        "endChar": 27
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "36f5bb80_53e85fa9",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 156,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-11T20:19:49Z",
      "side": 1,
      "message": "DCHECK that the queue was actually there.",
      "range": {
        "startLine": 156,
        "startChar": 2,
        "endLine": 156,
        "endChar": 16
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4438f51c_6808eabe",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 156,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "36f5bb80_53e85fa9",
      "range": {
        "startLine": 156,
        "startChar": 2,
        "endLine": 156,
        "endChar": 16
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "83aa2b9e_e3f0c0a6",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 156,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-13T17:04:47Z",
      "side": 1,
      "message": "Missed this?",
      "parentUuid": "4438f51c_6808eabe",
      "range": {
        "startLine": 156,
        "startChar": 2,
        "endLine": 156,
        "endChar": 16
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "120355f7_d4c7f0c9",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 156,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-13T18:09:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "83aa2b9e_e3f0c0a6",
      "range": {
        "startLine": 156,
        "startChar": 2,
        "endLine": 156,
        "endChar": 16
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c817652_258d90c8",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 744,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2017-10-13T06:19:11Z",
      "side": 1,
      "message": "Just out of curiosity: why didn\u0027t you write like (...; ...; ++it) ?",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9827ecaa_a6f51112",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.cc",
        "patchSetId": 1
      },
      "lineNbr": 744,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-13T14:22:39Z",
      "side": 1,
      "message": "It doesn\u0027t quite work if we delete objects from the set while iterating.",
      "parentUuid": "5c817652_258d90c8",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ad0f7759_bddad663",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-11T20:19:49Z",
      "side": 1,
      "message": "How does this relate to UnregisterTaskQueue and why do we have both?",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f3b27a8_39e6e6bd",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "UnregisterTaskQueue stops running all tasks (deletes task queue from selector etc), GracefullyShutdown just transfers ownership to TaskQueueManager and UnregisterTaskQueue will be called for this task queue when it becomes empty.",
      "parentUuid": "ad0f7759_bddad663",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "090bc2c1_34a76632",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2017-10-13T06:19:11Z",
      "side": 1,
      "message": "Do you have a plan that all tasks will be gracefully shutdown?",
      "parentUuid": "4f3b27a8_39e6e6bd",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9495c243_31e33b43",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-13T14:22:39Z",
      "side": 1,
      "message": "All per-frame task queues will support graceful shutdown. Per-renderer task queues (especially control one) won\u0027t.",
      "parentUuid": "090bc2c1_34a76632",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cd8b693a_f91463a1",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1116032
      },
      "writtenOn": "2017-10-13T17:04:47Z",
      "side": 1,
      "message": "Could we instead make UnregisterTaskQueue do the right thing based on how the task queue is configured? It feels weird having two different ways to unregister.",
      "parentUuid": "9495c243_31e33b43",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "75eeb82e_ff01ff69",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-13T18:09:30Z",
      "side": 1,
      "message": "I don\u0027t think that we should mix these things. All TaskQueueImpls must be unregistered (UnregisterTaskQueueImpl should be called before deletion, we have a DCHECK for this). \"Unregistered\" has a very clear definition here — TaskQueueImpl can be deleted.\n\nGraceful shutdown is a different concept, it is about transferring ownership of TaskQueueImpl from TaskQueue to TaskQueueManager.",
      "parentUuid": "cd8b693a_f91463a1",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "692c5df7_01149b15",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 166,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-13T20:30:04Z",
      "side": 1,
      "message": "Update: I renamed TaskQueue::UnregisterTaskQueue into TaskQueue::ShutdownTaskQueue. Not having two different UnregisterTaskQueue methods should help with clarity.",
      "parentUuid": "75eeb82e_ff01ff69",
      "range": {
        "startLine": 166,
        "startChar": 7,
        "endLine": 166,
        "endChar": 34
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b1ca3f54_f17947b9",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1115913
      },
      "writtenOn": "2017-10-12T04:04:27Z",
      "side": 1,
      "message": "Can we keep these variables private and add protected functions for tests?",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "97058fc1_3bfeb150",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager.h",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "Great idea, thanks.",
      "parentUuid": "b1ca3f54_f17947b9",
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7677c556_d900cfa6",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 3182,
      "author": {
        "id": 1119250
      },
      "writtenOn": "2017-10-12T09:52:44Z",
      "side": 1,
      "message": "This test is failing\n\n RUN      ] TaskQueueManagerTest.GracefulShutdown_ManagerDeletedInFlight\n[19219:19219:1011/093151.200026:7414898558:FATAL:task_queue_impl.cc(66)] Check failed: any_thread().task_queue_manager \u003d\u003d nullptr. UnregisterTaskQueue must be called first!",
      "range": {
        "startLine": 3182,
        "startChar": 29,
        "endLine": 3182,
        "endChar": 68
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1fe8bb30_8bd93de5",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 3182,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T15:06:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7677c556_d900cfa6",
      "range": {
        "startLine": 3182,
        "startChar": 29,
        "endLine": 3182,
        "endChar": 68
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "224486a0_8feef314",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 3182,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-12T17:22:55Z",
      "side": 1,
      "message": "Test is still failing due to use-after-free access. The fix is easy (instead of two passes in ~TaskQueueManager do one and split active_queues into two sets) and I\u0027ll do it first thing tomorrow morning. Please take a look at the rest of the code in the meantime.",
      "parentUuid": "1fe8bb30_8bd93de5",
      "range": {
        "startLine": 3182,
        "startChar": 29,
        "endLine": 3182,
        "endChar": 68
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dee5b851_2cbfa07b",
        "filename": "third_party/WebKit/Source/platform/scheduler/base/task_queue_manager_unittest.cc",
        "patchSetId": 1
      },
      "lineNbr": 3182,
      "author": {
        "id": 1150969
      },
      "writtenOn": "2017-10-13T18:09:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "224486a0_8feef314",
      "range": {
        "startLine": 3182,
        "startChar": 29,
        "endLine": 3182,
        "endChar": 68
      },
      "revId": "dc475fed2ee23ed738000e884131b489bf9da7f4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}