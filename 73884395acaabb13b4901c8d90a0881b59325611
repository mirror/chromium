{
  "comments": [
    {
      "key": {
        "uuid": "da475416_011dc5b0",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1000539
      },
      "writtenOn": "2017-09-27T16:43:11Z",
      "side": 1,
      "message": "should we call RemoveDeferredPaintRequestRecursive(layer_) here in case child layers are not also being destroyed?\n\nbtw, what happens if a child layer is re-parented during animation? or a new child layer is added?",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c4a9ea1_685c3c4f",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-09-27T17:00:34Z",
      "side": 1,
      "message": "All are very good points.\n\nTo resolve the problems, we might need to have a vector of layers what we add deferred paint request. And later in dtor, we need to remove deferred paint request on those layers.\n\nWe kind ignore newly added child layer.\n\nBut one problem for this, what if a child layer is destroyed. We cannot call function on it.",
      "parentUuid": "da475416_011dc5b0",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c12c888_0924704a",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1000539
      },
      "writtenOn": "2017-09-27T17:16:47Z",
      "side": 1,
      "message": "this might be a good argument for handling recursive behavior at the ui::Layer level. then we can simply reset the flag to the parents flag when it\u0027s added to the layer tree.",
      "parentUuid": "3c4a9ea1_685c3c4f",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1aecd067_637bab0e",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-09-27T17:19:38Z",
      "side": 1,
      "message": "Or we can add one DeferredPaintObserver for each of the layer and child layers?",
      "parentUuid": "3c4a9ea1_685c3c4f",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b18c894_14abcbc8",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1000539
      },
      "writtenOn": "2017-09-27T17:37:03Z",
      "side": 1,
      "message": "Yes, that should work too. child layer being added can simply be ignored I think. we just need to make sure we don\u0027t remove a defer paint request without having added one.",
      "parentUuid": "1aecd067_637bab0e",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "96b736ed_53c2c4f3",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1228419
      },
      "writtenOn": "2017-09-27T18:02:30Z",
      "side": 1,
      "message": "About the idea to handle recursive at the ui::Layer and reset flag when adding to the layer tree. It seems we need to stop all animations when we remove from the layer tree? (currently we only stop BOUNDS animation? [1]), otherwise, if the animating layer is reparent to a non-deferred-paint layer, the deferred_paint_requests_ will be set to 0. But when animation finishes, the observer will decrease the counter (to -1) and cause DCHECK error.\n\n[1] https://cs.chromium.org/chromium/src/ui/compositor/layer.cc?l\u003d281\u0026rcl\u003df37c197117dac5e465250f159e1969da26f37ed4",
      "parentUuid": "0b18c894_14abcbc8",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8920a13b_269c22e0",
        "filename": "ui/compositor/scoped_layer_animation_settings.cc",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1000539
      },
      "writtenOn": "2017-09-27T18:16:59Z",
      "side": 1,
      "message": "multiple observers might be easier for that reason. and just ignore new child layers added during animation as I suggested in previous comment",
      "parentUuid": "96b736ed_53c2c4f3",
      "revId": "73884395acaabb13b4901c8d90a0881b59325611",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}