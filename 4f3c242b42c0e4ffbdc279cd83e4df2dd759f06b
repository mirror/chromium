{
  "comments": [
    {
      "key": {
        "uuid": "4103a616_78e3c15a",
        "filename": "content/browser/android/gesture_listener_manager_android.cc",
        "patchSetId": 10
      },
      "lineNbr": 104,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "Could you add a comment about ownership here?",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c7baabc_5f188d1c",
        "filename": "content/public/android/java/src/org/chromium/content/browser/GestureListenerManagerImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 21,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "Could you add a comment about ownership here?",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f781da46_794314f4",
        "filename": "content/public/android/java/src/org/chromium/content/browser/GestureListenerManagerImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 21,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3c7baabc_5f188d1c",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cc935c60_024457f1",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/UserDataMap.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "It doesn\u0027t look like this class ended up being used?",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "97dffcb4_d1ba2f7f",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/UserDataMap.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Ah should have been deleted already.",
      "parentUuid": "cc935c60_024457f1",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "98c348e6_36cce012",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 753,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "Nit: Why the if-construct? You seem to only want to assert in the other case, so just do the assert here?",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db757ea3_a59d67d0",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 753,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Removed the assert and just made it return here.",
      "parentUuid": "98c348e6_36cce012",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3938ae9c_2c5a9e22",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 757,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-12-05T22:35:10Z",
      "side": 1,
      "message": "can\u0027t really ensure this never happen here. it depends on how mInternalsHolder is implemented..",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9030c1d6_18cf171f",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 757,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "True. What should we do in that case? Log an error?",
      "parentUuid": "3938ae9c_2c5a9e22",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "10209dcc_b9177ec7",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 757,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Not sure what needs to be done. Logging is the least I can do. Done.",
      "parentUuid": "9030c1d6_18cf171f",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19ed158a_53d6798e",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 763,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "This is the same as getUserDataMap() below, so unnecessary.",
      "range": {
        "startLine": 762,
        "startChar": 0,
        "endLine": 763,
        "endChar": 42
      },
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fa4f04d8_acc1f2bb",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 763,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Yes meant to replace it. Done.",
      "parentUuid": "19ed158a_53d6798e",
      "range": {
        "startLine": 762,
        "startChar": 0,
        "endLine": 763,
        "endChar": 42
      },
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af9f0331_4dbcd2f1",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 769,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "Optional: Would this be easier to read if we just did something like:\n\n  if (userDataMap \u003d\u003d null) return null;\n  return (T) userDataMap.get(key);",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1769414a_f5494a25",
        "filename": "content/public/android/java/src/org/chromium/content/browser/webcontents/WebContentsImpl.java",
        "patchSetId": 10
      },
      "lineNbr": 769,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "It was mainly to attach the annotation at this assignment. Can make it easier to read now that the annotation is moved elsewhere. Done.",
      "parentUuid": "af9f0331_4dbcd2f1",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e0e4af27_0be05baa",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/GestureListenerManager.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-12-05T22:35:10Z",
      "side": 1,
      "message": "this should be on the impl type? makes it impossible for embedder to accidentally insert the interface type into webcontents",
      "range": {
        "startLine": 14,
        "startChar": 40,
        "endLine": 14,
        "endChar": 67
      },
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d97f87e_8c9df306",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/GestureListenerManager.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "As suggested, inheritance was now replaced with composition.",
      "parentUuid": "e0e4af27_0be05baa",
      "range": {
        "startLine": 14,
        "startChar": 40,
        "endLine": 14,
        "endChar": 67
      },
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "88b7a1b8_5540e265",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/GestureListenerManager.java",
        "patchSetId": 10
      },
      "lineNbr": 21,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "@SuppressWarning for this cast and a comment as to why it\u0027s guaranteed to be safe?",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f0b0850_35fd3234",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/GestureListenerManager.java",
        "patchSetId": 10
      },
      "lineNbr": 21,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Moved the code to WebContentsUserData and added the annotation/comment. I can\u0027t see the warning though. The annotation there is mostly for casting from Object to T.",
      "parentUuid": "88b7a1b8_5540e265",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f6b85bd_90c51905",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 5,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-12-05T22:35:10Z",
      "side": 1,
      "message": "visibility of this class should be the same as the get/set methods on WebContents. either expose both, or hide both. right now embedder can inherit this, but can\u0027t use it for anything, which is just super odd",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "34197d32_77081948",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 5,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Right it doesn\u0027t have to be public. Move to internal package org.chromium.content.browser.webcontents.",
      "parentUuid": "7f6b85bd_90c51905",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a8e8569_84fb7c6e",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 9,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "I don\u0027t think this refers to the right class.",
      "range": {
        "startLine": 9,
        "startChar": 54,
        "endLine": 9,
        "endChar": 65
      },
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af5baaf2_11905ed6",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 9,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-07T01:59:19Z",
      "side": 1,
      "message": "Updated the comment.",
      "parentUuid": "6a8e8569_84fb7c6e",
      "range": {
        "startLine": 9,
        "startChar": 54,
        "endLine": 9,
        "endChar": 65
      },
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "939778ba_26166c8b",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-12-05T22:35:10Z",
      "side": 1,
      "message": "\u003e So WebContentsUserData saves from WebContentsUserData-inherited classes from having to define their own |CreateForWebContents|, |FromWebContents| by handling them in itself via templated static methods talking to WebContents\u0027 |Get/SetUserData|. \n\u003e \n\u003e I don\u0027t think it is possible in Java because generic type T is not usable in non-static context. Static helper methods like |GestureListenerManager.fromWebContents| can\u0027t benefit from generic.  For now, only WebContentsImpl (not WebContents) has get/set, which is not too bad.\n\nSo according to this: https://stackoverflow.com/questions/4409100/how-to-make-a-java-generic-method-static It is possible to make static method generic, it just doesn\u0027t necessarily match the generic type of the class.\n\nSo.. we can still have generic fromWebContents(Impl?). And we want\n1) only the subclass to call this method, with its own class. We don\u0027t want external other classes to call this method. Looks like default methods on interfaces can\u0027t be protected in java 8. We can sort of fix this with composition instead of using inheritance (so GestureListenerManager has a UserData, not inherits from UserData)\n2) subclass to only pass in its own class. Can\u0027t be enforced at all. Just document this well I guess..\n\nAlso we\u0027ll have to figure out a way actually pass in a thing that creates an instance of the subclass if there isn\u0027t one already, which is a lot of bloat.\n\nMeh, maybe this is ok.",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fad5409c_aa8e0345",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-05T23:53:34Z",
      "side": 1,
      "message": "\u003e So according to this: https://stackoverflow.com/questions/4409100/how-to-make-a-java-generic-method-static It is possible to make static method generic, it just doesn\u0027t necessarily match the generic type of the class.\n\nThanks for helping out! In fact I faced another issue even if generic static methods worked - how to create an instance of a class type T - which is what |CreateForWebContents| should do. Assuming its constructor always has one parameter |webContents|, I need to do something like below:\n\n        try {\n            Class[] args \u003d new Class[1];\n            args[0] \u003d WebContents.class;\n            T data \u003d clazz.getDeclaredConstructor(args).newInstance(webContents);\n            ((WebContentsImpl) webContents).setUserData(clazz, data);\n        } catch (Exception  e) { \n             // InvocationTargetException, NoSuchMethodException, InstantiationException, \n             // IllegalAccessException,\n            ...\n        }\n\nFor this to work, we need to pass |Class\u003cT\u003e clazz| to |createForWebContents| as well.\n\nI see a few cases in Clank code doing this. So far I\u0027ve tried to avoid creating this situation, not sure if this looks okay. But I doubt there\u0027s any other way.",
      "parentUuid": "939778ba_26166c8b",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59cbfa41_2fc7a134",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1002237
      },
      "writtenOn": "2017-12-06T00:07:43Z",
      "side": 1,
      "message": "I was thinking we could do use a constructor reference, where you\u0027d pass YourClass::new as the factory.\nThe constructor reference can match any interface with a single method where the single method\u0027s signature matches the constructor signature.\n\nWe would have to decide on a particular factory interface, but it could be something like: interface UserDataFactory\u003cT\u003e { T create(...); }, and then pass in the YourClass::new as the factory implementation.\n\nTo ensure we don\u0027t always create a new anonymous inner class instance when we invoke the method though, we might want to do something like:\n\n    private static final class UserDataFactoryLazyHolder {\n        private static final UserDataFactory INSTANCE \u003d YourClass::new;\n    }\n\nand then pass in the INSTANCE when we need it?\n\nThere\u0027s more information about constructor references here:\nhttps://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html",
      "parentUuid": "fad5409c_aa8e0345",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a3a4863_ac59647b",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-06T00:51:14Z",
      "side": 1,
      "message": "Thanks Tommy! A quick test shows constructor method ref works nice. Got to familiarize myself with 8 more..",
      "parentUuid": "59cbfa41_2fc7a134",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c3da167_b0569087",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2017-12-06T00:55:37Z",
      "side": 1,
      "message": "\u003e Thanks Tommy! A quick test shows constructor method ref works nice. Got to familiarize myself with 8 more..\n\nFwiw, method reference is (we think) only syntax sugar for creating lambdas. The important part in tommy\u0027s suggestion is saving it in a static variable to avoid gc churn.",
      "parentUuid": "7a3a4863_ac59647b",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d829789d_53d2541c",
        "filename": "content/public/android/java/src/org/chromium/content_public/browser/WebContentsUserData.java",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1149077
      },
      "writtenOn": "2017-12-06T01:26:41Z",
      "side": 1,
      "message": "Well but I find \u0027constructor\u0027 part is what effectively replaced the instantiation through complicated reflection (newInstance), and that helps in this case.",
      "parentUuid": "9c3da167_b0569087",
      "revId": "4f3c242b42c0e4ffbdc279cd83e4df2dd759f06b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}