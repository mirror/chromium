{
  "comments": [
    {
      "key": {
        "uuid": "4f613db0_f8522530",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 129,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-25T05:28:41Z",
      "side": 1,
      "message": "nit: Move to ASR?",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2657394a_eb1c794a",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 129,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-25T15:16:55Z",
      "side": 1,
      "message": "Sorry, my bad. I seemed to look at older PS. Please ignore this.",
      "parentUuid": "4f613db0_f8522530",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f67c187_067abfd1",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 257,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-25T05:28:41Z",
      "side": 1,
      "message": "No longer needed?",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1660de2d_243e23c8",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 257,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-25T15:16:55Z",
      "side": 1,
      "message": "Ditto.",
      "parentUuid": "7f67c187_067abfd1",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "71207b30_d5b3ee4a",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 291,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-20T06:02:29Z",
      "side": 1,
      "message": "How about simplify the transition by changing this to, something like |start_requested_|.\nAt initialization, start_requested_ is false. If Start() is called externally, it is set to true, and never set back to false.\n\nYou do not need to keep \"is_instance_for_login_screen\", then.\nInstead, you can look at the value in ;\n1) OnSocketCreated() to switch D-Bus message.\n2) OnInstanceStarted() to see whether D-Bus signal is needed to be re-sent or accept(2) for ABS.\n\nWDYT?",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fbf1377c_d809d1e4",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 291,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2017-06-23T07:26:36Z",
      "side": 1,
      "message": "Sorry in advance if I\u0027m missing something but is that possible? OnInstanceStarted() has to handle the following 3 cases:\n\n1. OnSocketCreated() sends the D-Bus message for login screen, the user doesn\u0027t call Start(), then OnInstanceStarted() is called.\n2. The user calls Start(), OnSocketCreated() sends the D-Bus message for full instance, then OnInstanceStarted() is called.\n3. OnSocketCreated() sends the D-Bus message for login screen, the user calls Start() before OnInstanceStart() is called, then OnInstanceStarted() is called.\n\nCan we distinguish 2 and 3 without |is_instance_for_login_screen|? 2 does not require re-sending a D-Bus message but 3 does, but both are in the same \"OnInstanceStarted() is called with start_requested_ \u003d\u003d true\" state.\n\nI\u0027m okay with renaming |login_screen_instance_requested_| to |start_requested_| but not really sure if NOT setting it to true in StartForLoginScreen(), which also says \"Start\", is any easier to read.\n\nAnother way to eliminate |is_instance_for_login_screen| parameter is to duplicate state (ie adding CREATING_SOCKET_FOR_LOGIN_SCREEN and STARTING_INSTANCE_FOR_LOGIN_SCREEN) but increasing the number of state tends to make the code larger and I\u0027m a bit reluctant to do so until we get an ability to unit-test this file.",
      "parentUuid": "71207b30_d5b3ee4a",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89698e29_036ec23f",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 291,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-25T05:28:41Z",
      "side": 1,
      "message": "Oh, sorry I was misunderstanding that we can distinguish 2 and 3 by whether returned container id is empty, but actually both have a value.\n\nI was confused when I read this first, because login_screen_instance_requested_ is set *back* to false in Start(), but the request itself is not cancelled (or sometimes on going actually).\nSo, if we see of login instance is requested or not by the flag, it wouldn\u0027t be a correct way although the name implies it is true, so I\u0027d like to avoid that situation.\n\nFor short-term, I\u0027m ok to move forward with this structure as it works, but I\u0027d like to clean up sometime later soon, at least before some people other than you, Luis and I, need to touch this class.\n\nOr, alternatively, you can either;\n1) Switch the callback based on |start_requested_| flag in SendStartArcInstanceDBusMessage(). Or\n2) bind the value to the callback so that, in OnInstanceStarted(), it can figure out if the current call is for 2 or 3.\n\nFor long term, I\u0027d move socket creation to session_manager,\nand let it return the fd as a part of StartArcInstance\u0027s result,\nthen, will introduce STARTING_INSTANCE_FOR_LOGIN_SCREEN, as you said.\nMoving the socket creation was a plan, but no merit there, so we didn\u0027t.\n(Also, IIRC there was *some* trap. Let me revisit here on Monday with Luis, who pointed it).\n\n\u003e unittest.\n\nYes, I totally agreed. I\u0027d love to have it.",
      "parentUuid": "fbf1377c_d809d1e4",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b7ed6d7_63a4a0e0",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 291,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2017-06-26T12:27:10Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "89698e29_036ec23f",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3addba52_955f6f18",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 818,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-20T06:02:29Z",
      "side": 1,
      "message": "Because, by design, ArcSession instance is tied to one container instance run, and I\u0027d like keep the concept as is for this change, so I\u0027d like to avoid reusing the instance.\nHow about pulling EmitLoginPromptVisibleCalled and this into one-layer or two-layer above (ArcSessionRunner, ASM),\nso that ArcSession instance can be created / deleted properly?\n\nWDYT?",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "98a55d3c_4ca94646",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 818,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2017-06-23T07:26:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3addba52_955f6f18",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b58e106f_c352e3e9",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 818,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2017-06-25T05:28:41Z",
      "side": 1,
      "message": "Looks not yet done?\nEven if container running for login_screen is stopped, this object looks to be kept alive and held by ArcSessionRunner, which I\u0027d like to avoid.\n\nWhat I\u0027d expect is; if a container is running, an instance is alive and held by ArcSessionRunner. If it is stopped, it is deleted rather than resetting its internal state.\nNote that, it would be necessary to track the state in ArcSessionRunner, but IMHO it is ok, because it actually changes its behavior for the regular booting and for the login_screen\u0027s.\n\nWDYT?",
      "parentUuid": "98a55d3c_4ca94646",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f0631f3_b9c15678",
        "filename": "components/arc/arc_session.cc",
        "patchSetId": 8
      },
      "lineNbr": 818,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2017-06-26T12:27:10Z",
      "side": 1,
      "message": "Ok, done.\n\nRemoved ResetLoginScreenSession() and instead added a new state to ASR as you suggested. I still think existence of the mini instance shouldn\u0027t be visible to c/b/c/arc/arc_session_manager.cc, but handling it at ASR layer seems okay (and better :-)",
      "parentUuid": "b58e106f_c352e3e9",
      "revId": "96291d8a05c1f2ec2167a47f050dc80e25a93e41",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}