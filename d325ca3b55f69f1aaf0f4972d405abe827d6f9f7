{
  "comments": [
    {
      "key": {
        "uuid": "323e8230_0ef51a6d",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 5016,
      "author": {
        "id": 1115881
      },
      "writtenOn": "2018-01-29T16:15:35Z",
      "side": 1,
      "message": "Sanity check: if the navigation fails for whatever reason, the tab will no longer be marked as having been discarded. When a second navigation comes in and succeeds (making it the first successful navigation in the tab), it will not be marked as having taken place in a discarded tab. Is that WAI?\n\nAlso I\u0027m concerned that we migh not be marking the tab as no longer discarded correctly if we do two navigation in a row. E.g. we restore a page, and before the restore is done, we start a new navigation. We will not get a DidStopLoading in that case until the second navigation is finished, so the second navigation will likely commit with was_discarded set to true.",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a803ffc1_899f26de",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 5016,
      "author": {
        "id": 1175814
      },
      "writtenOn": "2018-01-29T18:04:19Z",
      "side": 1,
      "message": "\u003c\u003cWhen a second navigation comes in and succeeds (making it the first successful navigation in the tab), it will not be marked as having taken place in a discarded tab. Is that WAI?\nThe second navigation could be something else right? the only case where we should set was_discarded is the user revisiting a discarded tab for the first time (so app can restore state).\n\n\u003c\u003cwe might not be marking the tab as no longer discarded correctly if we do two navigation in a row. \nThis seems problematic.\nIf the user issues navigates to a discarded tab and then does a second quick navigation -- we should not set was_discarded for the second one.\nWhere else should we reset was_discarded state on WebContents for this case?\n(I\u0027ll test this out bit more when I get into the office)",
      "parentUuid": "323e8230_0ef51a6d",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "506c071c_46c1dc65",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 5016,
      "author": {
        "id": 1175814
      },
      "writtenOn": "2018-01-29T22:03:48Z",
      "side": 1,
      "message": "I\u0027ve manually tested the case of user issues navigates to a discarded tab and then does a second quick navigation. It is behaving correctly.\nLet me know if there\u0027s any specific test cases I should try to address your concern.",
      "parentUuid": "a803ffc1_899f26de",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db5ffc6a_24dec79d",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 5016,
      "author": {
        "id": 1115881
      },
      "writtenOn": "2018-01-30T12:59:22Z",
      "side": 1,
      "message": "Did you also test for when the second navigation comes before the first one commits or while a renderer is trying to commit the first one? For how to simulate this kind of situation in browser tests, you can have a look at the RenderFrameHostManagerTests ResetVisibleURLOnCrossProcessNavigationInterrupted and DeleteSpeculativeRFHPendingCommitOfPendingEntryOnInterrupted*. In general, using a combination of TestNavigationManager + ControllableHTTPResponse should put you in the right race conditions reliably.",
      "parentUuid": "506c071c_46c1dc65",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31ed71ab_27659322",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 10
      },
      "lineNbr": 5016,
      "author": {
        "id": 1175814
      },
      "writtenOn": "2018-02-02T01:02:13Z",
      "side": 1,
      "message": "I added a test in RenderFrameHostManagerTest - it likely has some rough edges (and superfluous bits), I\u0027m not super familiar with this test rig. \nSuggestions welcome. PTAL.",
      "parentUuid": "db5ffc6a_24dec79d",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6d20e603_c1ee5a1a",
        "filename": "content/common/navigation_params.h",
        "patchSetId": 10
      },
      "lineNbr": 268,
      "author": {
        "id": 1115881
      },
      "writtenOn": "2018-01-29T16:15:35Z",
      "side": 1,
      "message": "Could you add a comment explaining what this parameter is.",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f84d042_60df14a1",
        "filename": "content/common/navigation_params.h",
        "patchSetId": 10
      },
      "lineNbr": 268,
      "author": {
        "id": 1175814
      },
      "writtenOn": "2018-01-29T22:03:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6d20e603_c1ee5a1a",
      "revId": "d325ca3b55f69f1aaf0f4972d405abe827d6f9f7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}