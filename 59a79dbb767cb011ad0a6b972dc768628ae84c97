{
  "comments": [
    {
      "key": {
        "uuid": "cd3346cc_efa7243a",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4417,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-11-27T12:57:11Z",
      "side": 1,
      "message": "The BVC\u0027s lifetime is functionally that of the app itself, so there\u0027s no real benefit to weak/strong, is there?",
      "range": {
        "startLine": 4417,
        "startChar": 32,
        "endLine": 4417,
        "endChar": 40
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "046a6e1d_37050bc2",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4417,
      "author": {
        "id": 1134915
      },
      "writtenOn": "2017-11-29T02:01:26Z",
      "side": 1,
      "message": "Do we want to take this shortcut? What if we refactor this part to be in another object? What about testing?\n\nI\u0027d rather be locally correct, without considerations for the environment.",
      "parentUuid": "cd3346cc_efa7243a",
      "range": {
        "startLine": 4417,
        "startChar": 32,
        "endLine": 4417,
        "endChar": 40
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e231fd0_f8bb736b",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4417,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-11-29T14:42:35Z",
      "side": 1,
      "message": "But this is only correct in some environments; in others it\u0027s just unnecessary. Here we expect the completion to be run after the new tab animation (if any) completes -- that part of the API of -addSelectedTabWithURL:atIndex:transition:completion:. If we were to move this call elsewhere, and pass in some other omnibox focuser, that other caller would need to decide if weakification was needed (it probably wouldn\u0027t be).\n\n(For slightly larger context, I see a lot of non-Chrome code that does weak/strong around every block by default, when it is often not needed).",
      "parentUuid": "046a6e1d_37050bc2",
      "range": {
        "startLine": 4417,
        "startChar": 32,
        "endLine": 4417,
        "endChar": 40
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3e8c10b_8d257175",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4417,
      "author": {
        "id": 1134915
      },
      "writtenOn": "2017-11-30T00:28:27Z",
      "side": 1,
      "message": "I see.\nI was concerned about the cycle at https://cs.chromium.org/chromium/src/ios/chrome/browser/ui/browser_view_controller.mm?type\u003dcs\u0026q\u003df:browser_view_controller.mm\u0026sq\u003dpackage:chromium\u0026l\u003d2416\nIf we think it\u0027s not an issue, I remove the weak then.\nThanks for the context!\n\nEDIT: to address gambard@ comment below, I move the focusing to foregroundTabWasAddedCompletionBlock. There it\u0027s more obvious we should use weakSelf, as the cycle is apparent. WDYT?",
      "parentUuid": "0e231fd0_f8bb736b",
      "range": {
        "startLine": 4417,
        "startChar": 32,
        "endLine": 4417,
        "endChar": 40
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ed5b586_ba040b30",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4418,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-11-27T12:57:11Z",
      "side": 1,
      "message": "Can you add a comment explaining why this call is needed for this case? It seems like it (or some other) tabSelected.. call must be made somewhere already.",
      "range": {
        "startLine": 4418,
        "startChar": 8,
        "endLine": 4418,
        "endChar": 34
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f73c52c6_8c66123b",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4418,
      "author": {
        "id": 1134915
      },
      "writtenOn": "2017-11-29T02:01:26Z",
      "side": 1,
      "message": "I\u0027m not sure I understand the question. I replaced a call to -addSelectedTabWithURL:transition: with a call to -addSelectedTabWithURL:atIndex:transition:tabAddedCompletion:.",
      "parentUuid": "5ed5b586_ba040b30",
      "range": {
        "startLine": 4418,
        "startChar": 8,
        "endLine": 4418,
        "endChar": 34
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce0df4e5_fb2c9e54",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4418,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-11-29T14:42:35Z",
      "side": 1,
      "message": "Yeah, this was me misunderstanding the diff. Sorry.",
      "parentUuid": "f73c52c6_8c66123b",
      "range": {
        "startLine": 4418,
        "startChar": 8,
        "endLine": 4418,
        "endChar": 34
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "86e85916_1ee5f2e7",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4422,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-11-27T12:57:11Z",
      "side": 1,
      "message": "Prefer to hoist conditionals that don\u0027t depend on the block\u0027s params out of the block, so:\n\nProceduralBlock completion \u003d nil;\nif (command.shouldFocusOmnibox) {\n  completion \u003d ^{[self focusOmnibox]}\n}\n\n...\n\n[self addSelectedTabWithURL: ... tabAddedCompletion:completion];",
      "range": {
        "startLine": 4422,
        "startChar": 17,
        "endLine": 4422,
        "endChar": 24
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ed5d7a5_3b1acf23",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4422,
      "author": {
        "id": 1134915
      },
      "writtenOn": "2017-11-29T02:01:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "86e85916_1ee5f2e7",
      "range": {
        "startLine": 4422,
        "startChar": 17,
        "endLine": 4422,
        "endChar": 24
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "67d15a48_1c5fbd94",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4424,
      "author": {
        "id": 1180589
      },
      "writtenOn": "2017-11-27T08:22:32Z",
      "side": 1,
      "message": "I think you can add this block to |self.foregroundTabWasAddedCompletionBlock|, it should be the same.",
      "range": {
        "startLine": 4421,
        "startChar": 30,
        "endLine": 4424,
        "endChar": 14
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d9752c9_458a36c9",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4424,
      "author": {
        "id": 1134915
      },
      "writtenOn": "2017-11-29T02:01:26Z",
      "side": 1,
      "message": "This looks scary, as it could then be reused for consequent tabs opened through other means, no?",
      "parentUuid": "67d15a48_1c5fbd94",
      "range": {
        "startLine": 4421,
        "startChar": 30,
        "endLine": 4424,
        "endChar": 14
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cf4ef7c_3dabe690",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4424,
      "author": {
        "id": 1180589
      },
      "writtenOn": "2017-11-29T08:33:45Z",
      "side": 1,
      "message": "If you look at the code, the first thing addSelectedTabWithURL:...tabAddedCompletion: is doing is to add the completion block to self.foregroundTabWasAddedCompletionBlock. So...",
      "parentUuid": "5d9752c9_458a36c9",
      "range": {
        "startLine": 4421,
        "startChar": 30,
        "endLine": 4424,
        "endChar": 14
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f104c374_7f179486",
        "filename": "ios/chrome/browser/ui/browser_view_controller.mm",
        "patchSetId": 3
      },
      "lineNbr": 4424,
      "author": {
        "id": 1134915
      },
      "writtenOn": "2017-11-30T00:28:27Z",
      "side": 1,
      "message": "Ok. Both options seem awful anyway :)\n\nSo I move it in the completion, but there it\u0027s way clearer that we should use weakSelf.",
      "parentUuid": "0cf4ef7c_3dabe690",
      "range": {
        "startLine": 4421,
        "startChar": 30,
        "endLine": 4424,
        "endChar": 14
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "34aef091_34d864c0",
        "filename": "ios/chrome/browser/ui/key_commands_provider.mm",
        "patchSetId": 3
      },
      "lineNbr": 70,
      "author": {
        "id": 1115958
      },
      "writtenOn": "2017-11-27T12:57:11Z",
      "side": 1,
      "message": "nit: ProceduralBlock?",
      "range": {
        "startLine": 70,
        "startChar": 2,
        "endLine": 70,
        "endChar": 6
      },
      "revId": "59a79dbb767cb011ad0a6b972dc768628ae84c97",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}