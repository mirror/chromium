{
  "comments": [
    {
      "key": {
        "uuid": "20f56f50_a3c43836",
        "filename": "media/formats/mp4/track_run_iterator.cc",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 1002455
      },
      "writtenOn": "2017-08-29T21:48:19Z",
      "side": 1,
      "message": "Is is possible though for a bad file to have a desc_idx that is \u003e stsd.audio_entries.size() and hit the bug?",
      "range": {
        "startLine": 331,
        "startChar": 12,
        "endLine": 331,
        "endChar": 20
      },
      "revId": "ca48465be6a3a23b299c449f7aff8e22d42fc129",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a647080_7fe1b9c9",
        "filename": "media/formats/mp4/track_run_iterator.cc",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 1209910
      },
      "writtenOn": "2017-08-29T22:40:25Z",
      "side": 1,
      "message": "That is why we have the piece of code here. We assume the sample description for that \"bad\" index is the same as the first sample description, which is possible. If it is really the case, we will be able to playback the file successfully. If it is not, the content may fail to be decrypted / decoded, but in any case, the code won\u0027t crash.\n\nWe can also just reject this bad content, i.e. replace it with a RCHECK here. I can change the code to do that if you prefer.",
      "parentUuid": "20f56f50_a3c43836",
      "range": {
        "startLine": 331,
        "startChar": 12,
        "endLine": 331,
        "endChar": 20
      },
      "revId": "ca48465be6a3a23b299c449f7aff8e22d42fc129",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "218728db_cd6729fb",
        "filename": "media/formats/mp4/track_run_iterator.cc",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 1002455
      },
      "writtenOn": "2017-08-29T22:48:15Z",
      "side": 1,
      "message": "I\u0027m a little confused. At least adding RCHECK seems like a good idea.\nBefore this change what values of desc_idx and stsd.{audio,video}_entries.size() led to the problem? If changing desc_idx to be \"0\" triggered the problem, then I don\u0027t see how the new code fixes the issue. Does the issue no longer repro locally with this change?",
      "parentUuid": "0a647080_7fe1b9c9",
      "range": {
        "startLine": 331,
        "startChar": 12,
        "endLine": 331,
        "endChar": 20
      },
      "revId": "ca48465be6a3a23b299c449f7aff8e22d42fc129",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d929b72c_2d3c2200",
        "filename": "media/formats/mp4/track_run_iterator.cc",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 1209910
      },
      "writtenOn": "2017-08-29T22:57:01Z",
      "side": 1,
      "message": "The problem happens when desc_idx \u003d\u003d stsd.audio_entries.size().\n\nSee line 333: tri.audio_description \u003d \u0026stsd.audio_entries[desc_idx];\n\nstsd.audio_entries[desc_idx] has array index out of bounds, which points to an unknown memory.\n\nBy replacing \"\u003e\" with \"\u003e\u003d\", the desc_idx is set to 0, which points to the first sample description, which will likely work. This allows more robust handling of bad contents.",
      "parentUuid": "218728db_cd6729fb",
      "range": {
        "startLine": 331,
        "startChar": 12,
        "endLine": 331,
        "endChar": 20
      },
      "revId": "ca48465be6a3a23b299c449f7aff8e22d42fc129",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26eeb059_8f1efda1",
        "filename": "media/formats/mp4/track_run_iterator.cc",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 1002455
      },
      "writtenOn": "2017-08-29T23:01:35Z",
      "side": 1,
      "message": "Oh. Hah. I was misreading this code multiple times. That makes sense. Thanks. Let\u0027s add the RCHECK later only if it looks like it\u0027s needed.",
      "parentUuid": "d929b72c_2d3c2200",
      "range": {
        "startLine": 331,
        "startChar": 12,
        "endLine": 331,
        "endChar": 20
      },
      "revId": "ca48465be6a3a23b299c449f7aff8e22d42fc129",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e17c4f87_5c586403",
        "filename": "media/formats/mp4/track_run_iterator.cc",
        "patchSetId": 1
      },
      "lineNbr": 337,
      "author": {
        "id": 1002455
      },
      "writtenOn": "2017-08-29T21:48:19Z",
      "side": 1,
      "message": "ditto",
      "range": {
        "startLine": 337,
        "startChar": 12,
        "endLine": 337,
        "endChar": 20
      },
      "revId": "ca48465be6a3a23b299c449f7aff8e22d42fc129",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}