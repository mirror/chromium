{
  "comments": [
    {
      "key": {
        "uuid": "c6be84ea_a0f30353",
        "filename": "content/browser/service_worker/service_worker_provider_host_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 399,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-06T07:30:27Z",
      "side": 1,
      "message": "I just deleted the IPC message check because I think the remaining check is enough. Or is there any better way to for mojo?",
      "range": {
        "startLine": 399,
        "startChar": 29,
        "endLine": 399,
        "endChar": 0
      },
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e83b8222_2721d37a",
        "filename": "content/browser/service_worker/service_worker_provider_host_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 399,
      "author": {
        "id": 1125915
      },
      "writtenOn": "2017-09-12T07:23:12Z",
      "side": 1,
      "message": "Instead of just ignoring SetController message, I think you can implement a mock Mojo\u0027s impl class to catch the message. |remove_endpoints_| has an isolated InterfaceRequest for that purpose.\nCould you check if SetController is called?",
      "parentUuid": "c6be84ea_a0f30353",
      "range": {
        "startLine": 399,
        "startChar": 29,
        "endLine": 399,
        "endChar": 0
      },
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dec059bb_f32a4a80",
        "filename": "content/browser/service_worker/service_worker_provider_host_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 399,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-12T08:49:34Z",
      "side": 1,
      "message": "Thanks Shimazu, could you point out some reference code? I didn\u0027t find it.",
      "parentUuid": "e83b8222_2721d37a",
      "range": {
        "startLine": 399,
        "startChar": 29,
        "endLine": 399,
        "endChar": 0
      },
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3e5c2d2_60b35af4",
        "filename": "content/browser/service_worker/service_worker_provider_host_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 399,
      "author": {
        "id": 1125915
      },
      "writtenOn": "2017-09-12T09:12:32Z",
      "side": 1,
      "message": "Ah, actually I think this is the first place to use |remote_endpoints_|.\n\n1: Add a MockServiceWorkerContainer.\nYou can refer to ServiceWorkerInstalledScriptsSenderTest. That test creates MockSWInstalledScriptsManager which is mocking a renderer-side class.\nhttps://cs.chromium.org/chromium/src/content/browser/service_worker/service_worker_installed_scripts_sender_unittest.cc?type\u003dcs\u0026q\u003dMockServiceWorkerInstalledScriptsManager\u0026sq\u003dpackage:chromium\u0026l\u003d183\n\n2: Bind the instance with remote_endpoints_.client_request().\n3: Check if the method is actually called. You might need to call base::RunLoop().RunUntilIdle().",
      "parentUuid": "dec059bb_f32a4a80",
      "range": {
        "startLine": 399,
        "startChar": 29,
        "endLine": 399,
        "endChar": 0
      },
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4526a3e1_2a8cdc63",
        "filename": "content/browser/service_worker/service_worker_provider_host_unittest.cc",
        "patchSetId": 3
      },
      "lineNbr": 438,
      "author": {
        "id": 1125915
      },
      "writtenOn": "2017-09-12T07:23:12Z",
      "side": 1,
      "message": "ditto except for the opposite condition",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a454a201_40a12b20",
        "filename": "content/child/service_worker/service_worker_dispatcher.h",
        "patchSetId": 3
      },
      "lineNbr": 174,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-06T07:30:27Z",
      "side": 1,
      "message": "One Adopt() was called in ServiceWorkerProviderContext::SetController, is it proper move both of them into public?",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08a4ef07_490d2b96",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 172,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-06T07:59:00Z",
      "side": 1,
      "message": "do we need features_temp? can it just be\n\nused_features \u003d std::set\u003cuint32_t\u003e(begin(), end())?",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc30e127_ef06e283",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 172,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "Done, thanks for pointing out that.",
      "parentUuid": "08a4ef07_490d2b96",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a54e7328_1c0ec64f",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-06T07:59:00Z",
      "side": 1,
      "message": "do you know when we not have a |provider_client_|? seems like a bug to get a SetController() IPC before there is a ServiceWorkerContainer#controller to set.",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "74c4fc87_7cbbedd2",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "Done.\nThere was a test case in SWProviderContextTest that no WebSWProviderClient but has SWProviderContext. Delete the test case instead of adding the check now.",
      "parentUuid": "a54e7328_1c0ec64f",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2888cb17_07e0f50f",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-08T02:25:51Z",
      "side": 1,
      "message": "Can you point me to this test? It might mean that it\u0027s possible to have a null |provider_client_|.",
      "parentUuid": "74c4fc87_7cbbedd2",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "84c30f4e_7cfe7c71",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-08T06:32:17Z",
      "side": 1,
      "message": "Yeah, I find the patchset#4 trybot failures were caused by removing this check.\nThe test case is here: https://cs.chromium.org/chromium/src/content/child/service_worker/service_worker_dispatcher_unittest.cc?q\u003dservice_worker_dispatcher_unittest.cc\u0026dr\u0026l\u003d160\n\nIn this CL, I moved the test into ServiceWorkerProviderContextTest.",
      "parentUuid": "2888cb17_07e0f50f",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32f7c23e_77f12cfe",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-12T08:49:34Z",
      "side": 1,
      "message": "I investigated why we need this check.\nIn the following case:\n1. Open page1 and register a service worker.\n2. Open a new tab and open page2(the same origin with page1).\n\nDuring the step2, there are two stages:\n1. DocumentLoader::InstallNewDocument --\u003e FrameLoader::DispatchDidClearDocumentOfWindowObject --\u003e FrameLoaderStateMachine::CreatingInitialEmptyDocument --\u003e ..... --\u003e ServiceWorkerProviderHost::AssociateRegistration --\u003e .... --\u003eServiceWorkerProviderContext::SetController \n\n2. DocumentLoader::InstallNewDocument --\u003e FrameLoader::DispatchDidClearDocumentOfWindowObject --\u003e ModulesInitializer::OnClearWindowObjectInMainWorld --\u003e NavigatorServiceWorker::From --\u003e construct ServiceWorkerContainer --\u003e WebServiceWorkerProviderImpl::SetClient -- \u003e ServiceWorkerProviderContext::SetController \n\nIn the stage1, SetClient would not be called, so the provider_client_ is null when calling the SetController.\n\nI think this check is necessary, even in the original upstream code, \"if (found !\u003d provider_clients_.end())\" actually do the same thing?\n\nWDYT?",
      "parentUuid": "84c30f4e_7cfe7c71",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bbce2439_ec60d6d5",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-13T00:41:15Z",
      "side": 1,
      "message": "Sorry, lost track of the comment thread. I see, makes sense. So ServiceWorkerProviderContext::SetController() can be called before the ServiceWorkerContainer exists, and it keeps the controller around until the ServiceWorkerCotnainer is created.\n\nMakes sense to keep the check. Please add comments about why provider_client_ is nullptr (assuming we can\u0027t do the observer/callback method which seems like it\u0027d work better).",
      "parentUuid": "32f7c23e_77f12cfe",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8e1b99b5_a2fe8118",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 200,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-06T07:59:00Z",
      "side": 1,
      "message": "Hmm the lifetime model seems error-prone here. Maybe if instead of keeping |provider_client_|, the ServiceWorkerContainer/WebServiceWorkerProviderClientImpl registers a callback/listener on ProviderContext to listen for SetController messages, and it removes itself as a callback/listener when it dies?",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e826b89f_32992b6e",
        "filename": "content/child/service_worker/service_worker_provider_context.cc",
        "patchSetId": 3
      },
      "lineNbr": 200,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "Thanks, I will try it.",
      "parentUuid": "8e1b99b5_a2fe8118",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "65d9dfbe_a0494333",
        "filename": "content/child/service_worker/service_worker_provider_context.h",
        "patchSetId": 3
      },
      "lineNbr": 176,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-06T07:59:00Z",
      "side": 1,
      "message": "provider_client_ should be moved to |controllee_state_|. It\u0027s only used for providers that are controllees.\n\nAlso, I know the class name can\u0027t be changed now, but I feel naming it something like |controllee_| is more descriptive, since in production code this is a blink::ServiceWorkerContainer. The contrast of ProviderClient and ProviderContext is confusing.",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d9ccf57_b0a69ec3",
        "filename": "content/child/service_worker/service_worker_provider_context.h",
        "patchSetId": 3
      },
      "lineNbr": 176,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "Done, thanks.",
      "parentUuid": "65d9dfbe_a0494333",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e487e780_c1350f00",
        "filename": "content/child/service_worker/web_service_worker_provider_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "Do we need also change such names?\nSetClient --\u003e SetCrollee, client --\u003e controllee, RemoveProviderClient --\u003e RemoveControllee,\nAddProviderClient --\u003e AddControllee..\n\nIt seems not proper to do that because there are too many places?",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c4f4660f_66ff9b6e",
        "filename": "content/child/service_worker/web_service_worker_provider_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-08T02:25:51Z",
      "side": 1,
      "message": "Yea, it\u0027s OK for now. What I found really confusing in this case is |provider_client_| was a member of ServiceWorkerProviderContext, so it makes you think the name is saying \"client of SWProviderContext\". But it\u0027s really \"client of WebServiceWorkerProvider\".\n\nI think as Web dies, this will all eventually get a lot simpler. For now I hope we can live with good comments and names.",
      "parentUuid": "e487e780_c1350f00",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "10ef58d2_811790fa",
        "filename": "content/child/service_worker/web_service_worker_provider_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 68,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-06T07:59:00Z",
      "side": 1,
      "message": "This code looks suspiciously the same as what we have in ServiceWorkerProviderContext::SetController now. Can we factor this stuff out in a nicer way somehow?",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "28058afc_0f9f1915",
        "filename": "content/child/service_worker/web_service_worker_provider_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 68,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "Ok, I will try to do that.",
      "parentUuid": "10ef58d2_811790fa",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "070ba18b_7aaab5de",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1161621
      },
      "writtenOn": "2017-09-06T10:40:44Z",
      "side": 1,
      "message": "Seems no need to create an additional struct. Can we just remove this struct and put its members directly as parameters of SetController()?",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab2ecf11_be09d328",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-07T09:37:16Z",
      "side": 1,
      "message": "I was under the impression that falken commented before that it\u0027s better to use a struct if there are several params? @falken, WDYTï¼Ÿ",
      "parentUuid": "070ba18b_7aaab5de",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "430a3a7f_aec0d881",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-08T02:25:51Z",
      "side": 1,
      "message": "I\u0027m not sure where I said that. In this case I don\u0027t have a strong preference... four params seems reasonable as either a struct or direct params.",
      "parentUuid": "ab2ecf11_be09d328",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e878328_e6b35f25",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-08T02:25:51Z",
      "side": 1,
      "message": "would prefer |object_info| -\u003e |controller|",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ebd60c07_171e64e3",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-08T06:32:17Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "5e878328_e6b35f25",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fff07d98_2ea96e45",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-08T02:25:51Z",
      "side": 1,
      "message": "can we use blink.mojom.WebFeature feature here, then don\u0027t need the comment in line 16.",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a4db3fb7_6e31a0d4",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-08T06:32:17Z",
      "side": 1,
      "message": "Do we need use blink.mojom.WebFeature everywhere that the used_features is used or set? such as ServiceWorkerVersion, ServiceWorkerDatabase::RegistrationData, etc..\nOr just convert uint32 to enum when passing it to mojom in ServiceWorkerProviderHost? but at latest we also need change the other mojo end in ServiceWorkerProviderContext.",
      "parentUuid": "fff07d98_2ea96e45",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5181c87d_5c0330b2",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1000128
      },
      "writtenOn": "2017-09-08T07:46:47Z",
      "side": 1,
      "message": "Let\u0027s not worry about fixing it everywhere, but for new Mojo interfaces let\u0027s use it. So yea I think it means in ServiceWorkerProviderHost we would convert:\nstatic_cast\u003cblink::mojom::WebFeature\u003e(feature).",
      "parentUuid": "a4db3fb7_6e31a0d4",
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0d755e4b_6341114b",
        "filename": "content/common/service_worker/service_worker_container.mojom",
        "patchSetId": 3
      },
      "lineNbr": 56,
      "author": {
        "id": 1223459
      },
      "writtenOn": "2017-09-06T07:30:27Z",
      "side": 1,
      "message": "Move above line after SetController",
      "range": {
        "startLine": 56,
        "startChar": 10,
        "endLine": 56,
        "endChar": 18
      },
      "revId": "d7a5649d12d0f26edc2365f7f03ed5615e29f557",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}