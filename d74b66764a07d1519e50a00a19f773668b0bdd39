{
  "comments": [
    {
      "key": {
        "uuid": "dd5df954_e18fd9d5",
        "filename": "chrome/browser/ui/tabs/tab_utils.cc",
        "patchSetId": 4
      },
      "lineNbr": 342,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-11-09T04:17:56Z",
      "side": 1,
      "message": "nit: Can you move this to replace line 348 below? Meaning:\n\n  switch (GetTabAlertStateForContents(contents)) {\n    case TabAlertState::NONE:\n    case TabAlertState::AUDIO_PLAYING:\n    case TabAlertState::AUDIO_MUTING:\n      // chrome:// URLs can\u0027t be muted.\n      return !contents-\u003eGetLastCommittedURL().SchemeIs(content::kChromeUIScheme);\n    ...",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 342,
        "endChar": 17
      },
      "revId": "d74b66764a07d1519e50a00a19f773668b0bdd39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e1c0d42_5ec1755c",
        "filename": "chrome/browser/ui/tabs/tab_utils.cc",
        "patchSetId": 4
      },
      "lineNbr": 342,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-11-09T18:11:18Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dd5df954_e18fd9d5",
      "range": {
        "startLine": 340,
        "startChar": 0,
        "endLine": 342,
        "endChar": 17
      },
      "revId": "d74b66764a07d1519e50a00a19f773668b0bdd39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "63c4705c_487f21df",
        "filename": "chrome/browser/ui/tabs/tab_utils.cc",
        "patchSetId": 4
      },
      "lineNbr": 397,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-11-09T04:17:56Z",
      "side": 1,
      "message": "Hmm...It feels like all of this can be simplified to:\n\n  if (mute \u0026\u0026 !chrome::CanToggleAudioMute(contents))\n    return TabMutedResult::FAIL_TABCAPTURE;\n\n...since, if somehow something got muted that shouldn\u0027t have been, and now the caller is trying to unmute the tab, we should allow that to proceed for any reason. WDYT?",
      "range": {
        "startLine": 390,
        "startChar": 0,
        "endLine": 397,
        "endChar": 5
      },
      "revId": "d74b66764a07d1519e50a00a19f773668b0bdd39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2217f601_80dba742",
        "filename": "chrome/browser/ui/tabs/tab_utils.cc",
        "patchSetId": 4
      },
      "lineNbr": 397,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-11-09T18:11:18Z",
      "side": 1,
      "message": "That makes sense to me, though if that\u0027s the case, maybe CanToggleAudioMute should actually be called CanMuteAudio. Is it definitely the case that you can always unmute a WebContents where CanToggleAudioMute is false?",
      "parentUuid": "63c4705c_487f21df",
      "range": {
        "startLine": 390,
        "startChar": 0,
        "endLine": 397,
        "endChar": 5
      },
      "revId": "d74b66764a07d1519e50a00a19f773668b0bdd39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0db14867_e6e42d0a",
        "filename": "chrome/browser/ui/tabs/tab_utils.cc",
        "patchSetId": 4
      },
      "lineNbr": 397,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-11-09T23:19:57Z",
      "side": 1,
      "message": "Hmm...Actually, the more I think about this, I was mistaken in my original comment: For some cases, mute toggle is disabled because the muting was forced (e.g., for tab capture, the user cannot unmute).\n\nSo, to answer your question: I think CanToggleAudioMute() is properly named.\n\nThe other question is: What logic should go here? Let me refine my suggestion to:\n\n  if (!chrome::CanToggleAudioMute(contents)) {\n    if (reason !\u003d TabMutedReason::CONTENT_SETTING)\n      return TabMutedResult::FAIL_TABCAPTURE;\n\n    // If we\u0027re just unmuting a chrome:// URL tab that had been muted because...\n    if (mute)\n      return TabMutedResult::FAIL_MUTE_DISALLOWED;\n  }\n\nNote that I think you want to use |reason| (i.e., the current reason) and not |GetTabAudioMutedReason(contents)| which is the reason for the prior toggle change. Also, the FAIL_TABCAPTURE enum (a.k.a. FAIL_MUTE_FORCED) was being overloaded: It\u0027d be nice if we added a FAIL_MUTE_DISALLOWED for this new case.\n\nLet me know if I\u0027m missing something. :)",
      "parentUuid": "2217f601_80dba742",
      "range": {
        "startLine": 390,
        "startChar": 0,
        "endLine": 397,
        "endChar": 5
      },
      "revId": "d74b66764a07d1519e50a00a19f773668b0bdd39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1837830a_5777fb68",
        "filename": "chrome/browser/ui/tabs/tab_utils.cc",
        "patchSetId": 4
      },
      "lineNbr": 397,
      "author": {
        "id": 1231235
      },
      "writtenOn": "2017-11-10T00:02:35Z",
      "side": 1,
      "message": "Actually, on second thought, I think we want to check *both* reason and GetTabAudioMutedReason. I\u0027ve uploaded the fix.",
      "parentUuid": "0db14867_e6e42d0a",
      "range": {
        "startLine": 390,
        "startChar": 0,
        "endLine": 397,
        "endChar": 5
      },
      "revId": "d74b66764a07d1519e50a00a19f773668b0bdd39",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}