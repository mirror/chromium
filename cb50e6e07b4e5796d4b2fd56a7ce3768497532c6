{
  "comments": [
    {
      "key": {
        "uuid": "75ae46ff_c887629e",
        "filename": "chrome/browser/chrome_browser_main_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1178124
      },
      "writtenOn": "2017-12-04T12:57:28Z",
      "side": 1,
      "message": "there are cases where this code will run and then the browser will immediately shut down. i think it\u0027s better to post a task to the main message loop to spin up this thread. this way, it will only be created when the main message loop is entered. if it\u0027s important that it happen as early as possible on the main loop, post the task in PostMainMessageLoopStart().\n\nlikewise, i think this thread should stop servicing notifications when the browser shuts down, no? PostMainMessageLoopRun() seems like an okay place to tell the thread to stop.",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c0ac0ea_fbc58644",
        "filename": "chrome/browser/chrome_browser_main_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Now posting a task. I\u0027m not sure it is crucial that it happens as early as possible, but we can always change it, I guess.",
      "parentUuid": "75ae46ff_c887629e",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b8929f0d_5ae631dd",
        "filename": "chrome/browser/chrome_browser_main_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 557,
      "author": {
        "id": 1178124
      },
      "writtenOn": "2017-12-04T12:57:28Z",
      "side": 1,
      "message": "this thread will be stopped, joined, and destroyed on line 564 when |notification_thread| goes out of scope. don\u0027t you want it to live for the lifetime of the browser?\n\ncan you make this thread an implementation detail of NotificationPlatformBridgeWin or some other class? i imagine ChromeBrowserMainPartsWin having a member holding either an instance of this thing or a unique_ptr\u003c\u003e to one, and the impl of the task i mentioned above being something simple like:\n\nvoid ChromeBrowserMainPartsWin::StartNativeNotificationPlatformBridge() {\n  native_notification_platform_bridge_ \u003d std::make_unique\u003cNotificationPlatformBridgeWin\u003e();\n}\n\nand the ctor for that thing takes care of spinning up the thread. likewise, in shutdown:\n\nvoid ChromeBrowserMainPartsWin::PostMainMessageLoopRun() {\n...\n  // Stop processing native notifications.\n  native_notification_platform_bridge_-\u003eStop();  // (maybe this calls StopSoon on the thread, maybe it just posts a task to turn down the native notification thingie.)\n...\n}\n\ni can imagine making the bg thread non-joinable so that shutdown doesn\u0027t block on joining this thread.",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1ac2343b_3c8c2e87",
        "filename": "chrome/browser/chrome_browser_main_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 557,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "\u003e don\u0027t you want it to live for the lifetime of the browser?\n\nWow. Yes. Sorry, this was copied from the original CL and it seemed to work, so I didn\u0027t give it a second thought.\n\n\u003e can you make this thread an implementation detail of NotificationPlatformBridgeWin or \n\u003e some other class?\n\nI\u0027ve made it so. \n\n\u003e i imagine ChromeBrowserMainPartsWin having a member holding either an instance of this thing\n\nI\u0027m hesitant to change the lifetime of NativeNotificationPlatformBridge, but see if you like the current approach.",
      "parentUuid": "b8929f0d_5ae631dd",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9186d890_7239dc28",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-01T14:08:46Z",
      "side": 1,
      "message": "This would normally be done by the installer, but since we\u0027re behind a flag we\u0027re doing this manually here to enables us to get activation working and not be blocked on that CL landing (not sure what the status of that is). Once done, this whole file can be deleted.",
      "range": {
        "startLine": 21,
        "startChar": 8,
        "endLine": 21,
        "endChar": 23
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b9d9dea3_ff6ec8b3",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-04T07:51:32Z",
      "side": 1,
      "message": "I don\u0027t think you need the shortcut related code. If you wants to create a shortcut on start menu for chromium, just build a mini_installer via \"ninja mini_installer\" and then run it.",
      "parentUuid": "9186d890_7239dc28",
      "range": {
        "startLine": 21,
        "startChar": 8,
        "endLine": 21,
        "endChar": 23
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79ed287d_538061b3",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1178124
      },
      "writtenOn": "2017-12-04T12:57:28Z",
      "side": 1,
      "message": "if this is eventually going to come out from behind the feature flag, then i\u0027d rather you simply do the proper shortcut work in the installer now rather than hacking together something like this.",
      "parentUuid": "b9d9dea3_ff6ec8b3",
      "range": {
        "startLine": 21,
        "startChar": 8,
        "endLine": 21,
        "endChar": 23
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c90b641e_1280ed84",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-05T03:35:51Z",
      "side": 1,
      "message": "The shortcut work (i.e., support toast activator CLSID) has already been landed in https://chromium-review.googlesource.com/c/chromium/src/+/744296\n\nIf you install/update Chrome (chromium/canary/dev/etc), the shortcut should be taken good care of automatically. The only exception is when you build chromium locally. In this case, you need to build mini_installer and install it by running mini_installer.exe. \n\nHope this helps.",
      "parentUuid": "79ed287d_538061b3",
      "range": {
        "startLine": 21,
        "startChar": 8,
        "endLine": 21,
        "endChar": 23
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2f44e72_02165d33",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Out of curiosity... Does the mini_installer support only creating the shortcut (and not all the rest)?",
      "parentUuid": "c90b641e_1280ed84",
      "range": {
        "startLine": 21,
        "startChar": 8,
        "endLine": 21,
        "endChar": 23
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2baa886f_837ef9aa",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 81,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-04T07:51:32Z",
      "side": 1,
      "message": "And I don\u0027t think you need this method neither.",
      "range": {
        "startLine": 81,
        "startChar": 5,
        "endLine": 81,
        "endChar": 41
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2134b12_d3711f64",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 81,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2baa886f_837ef9aa",
      "range": {
        "startLine": 81,
        "startChar": 5,
        "endLine": 81,
        "endChar": 41
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1948d2d2_16684d34",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.h",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-01T14:08:46Z",
      "side": 1,
      "message": "This isn\u0027t really blocking while the feature is behind a flag, but if you have ideas on how to fix this, I\u0027m open to suggestions...",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "30c10a22_babf65df",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.h",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-04T07:51:32Z",
      "side": 1,
      "message": "I am eager to know the answer to this question too.",
      "parentUuid": "1948d2d2_16684d34",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e8d42f0_fb04e9a2",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.h",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1178124
      },
      "writtenOn": "2017-12-04T12:57:28Z",
      "side": 1,
      "message": "for starters, you will need to stop using __uuidof and instead use the runtime-provided clsid. that might be enough. i think it\u0027s worth getting this right now so that you don\u0027t end up in a hole later (or forget about it).",
      "parentUuid": "30c10a22_babf65df",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b90c9f1f_83fabf3b",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.h",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-05T03:35:51Z",
      "side": 1,
      "message": "This CLSID_KEY is needed at compile time via the code like:\n\"class DECLSPEC_UUID(CLSID_KEY) NotificationActivator: public mswr::RuntimeClass\u003cmswr::RuntimeClassFlags\u003cmswr::ClassicCom\u003e, INotificationActivationCallback\u003e\"\n\nThis means we cannot use runtime-determined clsids that I added in google_chrome_install_modes.cc and chromium_install_modes.cc. \n\nI was thinking of creating 5 NotificationActivator(s), one for each channel (chromium/canary/etc). The code won\u0027t look pretty. We may also need to redefine these 5 clsid consts here. I discussed with Bruce and we couldn\u0027t come up with better solutions.\n\nAny better ideas please, Greg?",
      "parentUuid": "1e8d42f0_fb04e9a2",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b6d95709_580a2305",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.h",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T10:35:50Z",
      "side": 1,
      "message": "I have a CL update coming which provides the CLSID at runtime. Stay tuned.",
      "parentUuid": "b90c9f1f_83fabf3b",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "783d955b_033f8d8f",
        "filename": "chrome/browser/chrome_native_notification_install_helper_win.h",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "I\u0027ve added a function that returns the uuid. I tried using the toast_clsid function in installer_static directly, but InstallDetails::Get() asserts on g_module_details not being created. Too early in the process, I guess. I\u0027m wondering how to solve that... Any pointers?",
      "parentUuid": "b6d95709_580a2305",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6dc517e_77a014c6",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-01T14:08:46Z",
      "side": 1,
      "message": "I suppose this block can be removed with a future version of module.h that supports clang (hopefully)? :)",
      "range": {
        "startLine": 48,
        "startChar": 7,
        "endLine": 48,
        "endChar": 25
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "23dfb33f_eb2c0b88",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-04T07:51:32Z",
      "side": 1,
      "message": "Agreed.",
      "parentUuid": "d6dc517e_77a014c6",
      "range": {
        "startLine": 48,
        "startChar": 7,
        "endLine": 48,
        "endChar": 25
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "474c9d30_b6cae625",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 145,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-04T07:51:32Z",
      "side": 1,
      "message": "I once added messagebox(\"...\") inside this method, and found that this API was randomly called. Did you see similar behavior?",
      "range": {
        "startLine": 145,
        "startChar": 2,
        "endLine": 145,
        "endChar": 10
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b3a1629c_6fb9601d",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 145,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "No. I had DebugBreak() in here and never saw that...",
      "parentUuid": "474c9d30_b6cae625",
      "range": {
        "startLine": 145,
        "startChar": 2,
        "endLine": 145,
        "endChar": 10
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85fcd56b_010142f6",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 180,
      "author": {
        "id": 1178124
      },
      "writtenOn": "2017-12-04T12:57:28Z",
      "side": 1,
      "message": "why is this a global? it seems cleaner for ChromeBrowserMainPartsWin to own the process\u0027s instance. or maybe BrowserProcessImpl if there\u0027s a reason to have a getter for it on g_browser_process.",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "676b9662_4b42e217",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 180,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Changed.",
      "parentUuid": "85fcd56b_010142f6",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d56eca0_86909cd5",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 553,
      "author": {
        "id": 1178124
      },
      "writtenOn": "2017-12-04T12:57:28Z",
      "side": 1,
      "message": "delete nullptr is well-defined, so you can get rid of this check and unconditionally call delete and clear the ptr.",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f806594_1cdb1f84",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 553,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Obsolete.",
      "parentUuid": "7d56eca0_86909cd5",
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "24f8fa45_eedb1b1f",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-01T14:08:46Z",
      "side": 1,
      "message": "I\u0027m a bit uncomfortable with this whole static stuff. Undecided on whether we should leak the registration, but I\u0027m sure you have good ideas on how to approach this...?",
      "range": {
        "startLine": 554,
        "startChar": 11,
        "endLine": 554,
        "endChar": 30
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c064fdd6_23770481",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "24f8fa45_eedb1b1f",
      "range": {
        "startLine": 554,
        "startChar": 11,
        "endLine": 554,
        "endChar": 30
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "024116ed_e749333d",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 570,
      "author": {
        "id": 1228990
      },
      "writtenOn": "2017-12-04T07:51:32Z",
      "side": 1,
      "message": "Again, you don\u0027t need this piece of code. mini_installer can handler it.",
      "range": {
        "startLine": 570,
        "startChar": 2,
        "endLine": 570,
        "endChar": 18
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f5631869_7326627d",
        "filename": "chrome/browser/notifications/notification_platform_bridge_win.cc",
        "patchSetId": 4
      },
      "lineNbr": 570,
      "author": {
        "id": 1002500
      },
      "writtenOn": "2017-12-05T15:01:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "024116ed_e749333d",
      "range": {
        "startLine": 570,
        "startChar": 2,
        "endLine": 570,
        "endChar": 18
      },
      "revId": "cb50e6e07b4e5796d4b2fd56a7ce3768497532c6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}