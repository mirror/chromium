{
  "comments": [
    {
      "key": {
        "uuid": "f36970ba_9b6d9931",
        "filename": "components/omnibox/browser/contextual_suggestions_service.h",
        "patchSetId": 18
      },
      "lineNbr": 69,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-07-31T22:50:23Z",
      "side": 1,
      "message": "... why?\n\n(Reading the test of this class would make one think that this is not something that needs to be exposed, as this class constructs the fetcher itself.)",
      "range": {
        "startLine": 69,
        "startChar": 25,
        "endLine": 69,
        "endChar": 0
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9a599c5_82e065e2",
        "filename": "components/omnibox/browser/contextual_suggestions_service.h",
        "patchSetId": 18
      },
      "lineNbr": 69,
      "author": {
        "id": 1145964
      },
      "writtenOn": "2017-08-01T02:14:22Z",
      "side": 1,
      "message": "I added a comment explaining what |current_url| is and the reasoning for being used by ZeroSuggestProvider.",
      "parentUuid": "f36970ba_9b6d9931",
      "range": {
        "startLine": 69,
        "startChar": 25,
        "endLine": 69,
        "endChar": 0
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "653e4bef_81750451",
        "filename": "components/omnibox/browser/omnibox_field_trial.cc",
        "patchSetId": 18
      },
      "lineNbr": 160,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-07-31T22:50:23Z",
      "side": 1,
      "message": "Usually param names in this file are defined in the .h file (for testing) and listed in a big block.  Please follow the existing (though odd) style.",
      "range": {
        "startLine": 160,
        "startChar": 11,
        "endLine": 160,
        "endChar": 56
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8fdccd20_f1dc94fb",
        "filename": "components/omnibox/browser/omnibox_field_trial.cc",
        "patchSetId": 18
      },
      "lineNbr": 160,
      "author": {
        "id": 1145964
      },
      "writtenOn": "2017-08-01T02:14:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "653e4bef_81750451",
      "range": {
        "startLine": 160,
        "startChar": 11,
        "endLine": 160,
        "endChar": 56
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e95f6e73_f367772f",
        "filename": "components/omnibox/browser/omnibox_field_trial.h",
        "patchSetId": 18
      },
      "lineNbr": 205,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-07-31T22:50:23Z",
      "side": 1,
      "message": "Please comment, especially with regard to the default value.",
      "range": {
        "startLine": 205,
        "startChar": 13,
        "endLine": 205,
        "endChar": 55
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16668cfd_d33256dd",
        "filename": "components/omnibox/browser/omnibox_field_trial.h",
        "patchSetId": 18
      },
      "lineNbr": 205,
      "author": {
        "id": 1145964
      },
      "writtenOn": "2017-08-01T02:14:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e95f6e73_f367772f",
      "range": {
        "startLine": 205,
        "startChar": 13,
        "endLine": 205,
        "endChar": 55
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e190568b_9d38c123",
        "filename": "components/omnibox/browser/zero_suggest_provider.cc",
        "patchSetId": 18
      },
      "lineNbr": 304,
      "author": {
        "id": 1145964
      },
      "writtenOn": "2017-07-31T17:24:36Z",
      "side": 1,
      "message": "Mark, FYI _sometimes_ this line is check failing in my non-prod build.\n\nIt took me a while to reproduce it, but I\u0027m quite sure it\u0027s coming from an interleaved call to Stop() while ZeroSuggestProvider runs. The Stop() method sets \"done_ \u003d true;\" and this fails. From what I understand, this CL does not change the core logic of ZeroSuggestProvider, and I _believe_ this interleaving also occurs in prod builds, but this DCHECK is removed by the compiler, hence no crashes in production.\n\nWhat do you want to do? Here are some options:\n\n1) Ignore it. It only crashes if I click the URL like crazy and it still takes me like 2 minutes to actually get it to crash. It is also only in builds that keep DCHECKs.\n\n2) Remove this DCHECK(). This is harmless is prod builds where DCHECKS are removed. The rest of the code already handles it gracefully.\n\n3) Add early returns here: \"if (done_) { ...; return; }\". Some overhead for extra safety. I\u0027m not sure if it\u0027s necessary.",
      "range": {
        "startLine": 304,
        "startChar": 17,
        "endLine": 304,
        "endChar": 0
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd2e7ae4_d38fbfc5",
        "filename": "components/omnibox/browser/zero_suggest_provider.cc",
        "patchSetId": 18
      },
      "lineNbr": 304,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-08-02T03:36:26Z",
      "side": 1,
      "message": "I\u0027ll give you a 4th option.  Fix it.  :-P\n\nIn my quick read of this code, I think this is a legitimate check.  Stop() is supposed to stop all in-progress calls and prevent future changes.  It does this by resetting the |fetcher_| and setting |done_| to true.  However, when contextual suggestions are enabled in the new flow, suppose Stop() is called while fetching an oauth token.  In that case, there is no |fetcher_| to stop.  The contextual suggestion service will then start a fetcher.  When that fetcher completes, it\u0027ll call into OnURLFetchComplete().  This function expected |done_| to be false, as there was a fetcher in progress, and that\u0027s what it\u0027s checking.\n\nYou need to cancel the context suggestion service, regardless of what state it\u0027s in during its control flow, when Stop() is called.",
      "parentUuid": "e190568b_9d38c123",
      "range": {
        "startLine": 304,
        "startChar": 17,
        "endLine": 304,
        "endChar": 0
      },
      "revId": "edffd6b33d92bb36529020357254f22adf5e7e33",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}