{
  "comments": [
    {
      "key": {
        "uuid": "72e8c538_5fbcacf9",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2017-08-04T03:41:30Z",
      "side": 1,
      "message": "IIUC from the task description\n\nissued_query.empty() can not be empty if result_title is not empty, right?\nIn this case we can drop this extra result_title.empty() and \nadd DCHECK(!issued_query.empty()) at L138",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "370df2be_ba166610",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1116056
      },
      "writtenOn": "2017-08-04T17:58:52Z",
      "side": 1,
      "message": "With the current client-side implementation, the \"opposite\" is true: result_title can not be empty if issued_query is not empty.\nI\u0027d not introduce subtle (and unneeded) dependencies between the order of parsing in ParseResponseHeaders() and this place (like, will the developer who decides to change the parsing order, also go here and revert checks?), and leave the code as is.\n\nOr if you mean the contract with the server, it\u0027s simply dangerous to have DCHECKS for data received externally. Besides, the server happened to have problems with filling headers correctly.",
      "parentUuid": "72e8c538_5fbcacf9",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a0b5e9c_0a114c0d",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2017-08-04T21:31:03Z",
      "side": 1,
      "message": "I don\u0027t see from this CL that your code actually makes this header mandatory.\n\nTo make it mandatory you need \n\nbool ParseResponseHeaders()\nif no header \n  return false;\n\nand prevent passing not-parsed information to DidFinishNavigation.\nIf you implement this DCHECK is what you need.",
      "parentUuid": "370df2be_ba166610",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "09f60b20_28ada535",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1116056
      },
      "writtenOn": "2017-08-04T22:05:32Z",
      "side": 1,
      "message": "That part is here:\nhttps://chromium-review.googlesource.com/c/601088/1/chrome/browser/ui/app_list/search/answer_card/answer_card_web_contents.cc#87\n\nAnd we want to invoke AnswerCardSearchProvider::DidFinishNavigation from that place to invoke UMAs and for the dark run case, which works even when header parsing failed.",
      "parentUuid": "5a0b5e9c_0a114c0d",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c885a3a_49ecf26c",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2017-08-04T22:12:40Z",
      "side": 1,
      "message": "I saw this code and my suggestion above was also based on this.\nI think you may do all required staff by analyzing only has_answer_card\nIIUC your code has_answer_card is only set when all required headers are parsed.\n\nSo based on this your code here should look:\n\nL133\nif (!has_answer_card) {\n  ...\n}\nL137\nDCHECK(!result_title.empty());\nDCHECK(!issued_query.empty())",
      "parentUuid": "09f60b20_28ada535",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "81b2a2d4_e4d34d3b",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1116056
      },
      "writtenOn": "2017-08-05T00:26:17Z",
      "side": 1,
      "message": "The motivation for these additional checks was that I can\u0027t find guarantees that when headers-\u003eGetNormalizedHeader returns true, the header is non-empty.\n\nSo, it looks like has_answer_card may be true, and still some of headers may be empty. I think it won\u0027t hurt to filter out responses with such headers, as an additional check against misbehaving server.",
      "parentUuid": "0c885a3a_49ecf26c",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d413a6e_d17a6a7c",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2017-08-05T06:01:32Z",
      "side": 1,
      "message": "In this case please add extra check\nif (!headers-\u003eGetNormalizedHeader(kSearchAnswerIssuedQuery, issued_query) ||\n    issued_query.empty()) {\n  ...\n}\n\nThus you keep the logic clear.",
      "parentUuid": "81b2a2d4_e4d34d3b",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87bbf145_3e67dcbd",
        "filename": "chrome/browser/ui/app_list/search/answer_card/answer_card_search_provider.cc",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1116056
      },
      "writtenOn": "2017-08-07T22:22:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9d413a6e_d17a6a7c",
      "range": {
        "startLine": 133,
        "startChar": 52,
        "endLine": 133,
        "endChar": 72
      },
      "revId": "2154785dcf4ff275574b5ac27ccf2d0b759846c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}