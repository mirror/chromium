{
  "comments": [
    {
      "key": {
        "uuid": "96bf3c61_c127b105",
        "filename": "chrome/browser/thumbnails/thumbnail_browsertest.cc",
        "patchSetId": 9
      },
      "lineNbr": 125,
      "author": {
        "id": 1116059
      },
      "writtenOn": "2017-10-30T16:23:30Z",
      "side": 1,
      "message": "On my machines, everything seems to work fine without --disable-gpu, but on the bots it mostly fails.",
      "range": {
        "startLine": 125,
        "startChar": 54,
        "endLine": 125,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dc138e51_3fbd6ca4",
        "filename": "chrome/browser/thumbnails/thumbnail_browsertest.cc",
        "patchSetId": 9
      },
      "lineNbr": 166,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-10-30T20:42:09Z",
      "side": 1,
      "message": "This all looks good but I\u0027m wondering whether it could be simplified: have you tried the simpler alternative of adding something like this in the \u003chead\u003e?\n\u003cscript src\u003d\"/slow?1\"\u003e\u003c/script\u003e\n\nThat should slow down the loading of the page by 1 second.",
      "range": {
        "startLine": 166,
        "startChar": 62,
        "endLine": 166,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "45023387_c0b18665",
        "filename": "chrome/browser/thumbnails/thumbnail_browsertest.cc",
        "patchSetId": 9
      },
      "lineNbr": 166,
      "author": {
        "id": 1116059
      },
      "writtenOn": "2017-11-02T12:42:00Z",
      "side": 1,
      "message": "I hadn\u0027t tried that because I didn\u0027t know about \"/slow\" (thanks!).\n\nI did now, and it doesn\u0027t work quite as suggested. Apparently DocumentAvailableInMainFrame can fire before that slow script finishes loading. What does seem to work is navigating to \"/slow\" directly; I\u0027ve added that as a separate test.\n\nGenerally, I find it cleaner to explicitly wait for the desired event, rather than adding some arbitrary timeout/delay, though admittedly it does make the test code a lot simpler here. OTOH it delays the test by a second, which isn\u0027t ideal.\nAnyway, I think there\u0027s some value in both variants, so how about just keeping both?",
      "parentUuid": "dc138e51_3fbd6ca4",
      "range": {
        "startLine": 166,
        "startChar": 62,
        "endLine": 166,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "694ec9a5_8b6acd4e",
        "filename": "chrome/browser/thumbnails/thumbnail_browsertest.cc",
        "patchSetId": 9
      },
      "lineNbr": 166,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-11-02T14:44:47Z",
      "side": 1,
      "message": "Agreed with what you say and keeping both seems beneficial.",
      "parentUuid": "45023387_c0b18665",
      "range": {
        "startLine": 166,
        "startChar": 62,
        "endLine": 166,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "50b98074_1d1958e4",
        "filename": "chrome/browser/thumbnails/thumbnail_browsertest.cc",
        "patchSetId": 9
      },
      "lineNbr": 210,
      "author": {
        "id": 1116059
      },
      "writtenOn": "2017-10-30T16:23:30Z",
      "side": 1,
      "message": "Unfortunately ControllableHttpResponse doesn\u0027t work with ui_test_utils::NavigateToURL, hence the custom nav_observer stuff.",
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2468f09_3dc0a2c1",
        "filename": "chrome/browser/thumbnails/thumbnail_tab_helper.cc",
        "patchSetId": 9
      },
      "lineNbr": 247,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-10-30T20:42:09Z",
      "side": 1,
      "message": "Would it work if, instead of introducing the bool, you use a CancelableCallback and cancel on those two events?",
      "range": {
        "startLine": 247,
        "startChar": 30,
        "endLine": 247,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c0f1acf0_7e5f7bbf",
        "filename": "chrome/browser/thumbnails/thumbnail_tab_helper.cc",
        "patchSetId": 9
      },
      "lineNbr": 247,
      "author": {
        "id": 1116059
      },
      "writtenOn": "2017-11-02T12:42:00Z",
      "side": 1,
      "message": "Unfortunately no: We still need to be called back in the \"canceled\" case, so that we can clean up our state (|thumbnailing_context_|). So at least it\u0027d need some more refactoring, and I\u0027m not sure if the end result would be better than what we have now (though I also don\u0027t like that bool). In any case, I\u0027d like to leave that refactoring for a possible followup. WDYT?",
      "parentUuid": "e2468f09_3dc0a2c1",
      "range": {
        "startLine": 247,
        "startChar": 30,
        "endLine": 247,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "76790431_407c04c1",
        "filename": "chrome/browser/thumbnails/thumbnail_tab_helper.cc",
        "patchSetId": 9
      },
      "lineNbr": 247,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-11-02T14:44:47Z",
      "side": 1,
      "message": "I\u0027m fine deferring refactoring work but it seems to me that calling CleanUpFromThumbnailGeneration() on the cancelling site is quite simple. I\u0027m wondering if you could even get rid of the weird codepath outside the UI thread during shutdown (how is that even possible anyway?).",
      "parentUuid": "c0f1acf0_7e5f7bbf",
      "range": {
        "startLine": 247,
        "startChar": 30,
        "endLine": 247,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "da8e41f5_c254b518",
        "filename": "chrome/browser/thumbnails/thumbnail_tab_helper.cc",
        "patchSetId": 9
      },
      "lineNbr": 247,
      "author": {
        "id": 1116059
      },
      "writtenOn": "2017-11-02T17:41:45Z",
      "side": 1,
      "message": "Right, that would work (d\u0027oh), but then there\u0027s again two pieces of state that need to be tracked: Is the cancelable callback null, and is the thumbnailing_context_ null. (We\u0027d only want to call CleanUpFromThumbnailGeneration if the callback is valid.) So I don\u0027t think this by itself is a big improvement. I\u0027ll submit this as-is for now and look into a cleanup/refactoring CL as a followup.\n\nYep, that weird non-UI-case has been bothering me too. I don\u0027t know if it can actually happen. It certainly seems that it shouldn\u0027t, but clearly it was added for a reason. I haven\u0027t gotten around to investigating yet.",
      "parentUuid": "76790431_407c04c1",
      "range": {
        "startLine": 247,
        "startChar": 30,
        "endLine": 247,
        "endChar": 0
      },
      "revId": "a8fcc7b7db8ee0ea8d4b9bc51f9308beadb8e150",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}