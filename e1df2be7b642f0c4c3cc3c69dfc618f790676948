{
  "comments": [
    {
      "key": {
        "uuid": "b568e4ea_04aaa5c3",
        "filename": "android_webview/browser/deferred_gpu_command_service.cc",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2018-02-01T22:13:40Z",
      "side": 1,
      "message": "this whole method now needs to be thread safe, so this check needs to be protected by some sort of lock as well",
      "revId": "e1df2be7b642f0c4c3cc3c69dfc618f790676948",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77250459_24d8202d",
        "filename": "android_webview/browser/deferred_gpu_command_service.cc",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1003154
      },
      "writtenOn": "2018-02-01T23:45:02Z",
      "side": 1,
      "message": "Done.\npiman: I can\u0027t think of a way to use base::NoDestructor to create a static instance to serve as a lock. If you know of a way, please share with me.",
      "parentUuid": "b568e4ea_04aaa5c3",
      "revId": "e1df2be7b642f0c4c3cc3c69dfc618f790676948",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd90b0fc_03f70771",
        "filename": "android_webview/browser/deferred_gpu_command_service.cc",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2018-02-01T23:55:54Z",
      "side": 1,
      "message": "\u003e Done.\n\u003e piman: I can\u0027t think of a way to use base::NoDestructor to create a static instance to serve as a lock. If you know of a way, please share with me.\n\nyou can define a dummy wrapper type and do all of this in the constructor. I assume NoDestructor like LazyInstance ensures the object is only constructed once?",
      "parentUuid": "77250459_24d8202d",
      "revId": "e1df2be7b642f0c4c3cc3c69dfc618f790676948",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a4d1a80_b9b0851c",
        "filename": "android_webview/browser/deferred_gpu_command_service.cc",
        "patchSetId": 3
      },
      "lineNbr": 66,
      "author": {
        "id": 1148065
      },
      "writtenOn": "2018-02-02T00:12:09Z",
      "side": 1,
      "message": "This is what I\u0027m thinking about:\n\nstatic base::NoDestructor\u003cscoped_refptr\u003cDeferredGpuCommandService\u003e\u003e instance(CreateDeferredGpuCommandService());\nreturn *instance;\n\nwith CreateDeferredGpuCommandService() doing all the code that you currently have inside the if (!g_service.Get().get()) {...}\n\nOr using a lambda instead of a named function (as suggested in base/no_desttructor.h)",
      "parentUuid": "bd90b0fc_03f70771",
      "revId": "e1df2be7b642f0c4c3cc3c69dfc618f790676948",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7b07db96_f9e6b5b1",
        "filename": "android_webview/browser/deferred_gpu_command_service.cc",
        "patchSetId": 3
      },
      "lineNbr": 89,
      "author": {
        "id": 1002725
      },
      "writtenOn": "2018-02-01T22:13:40Z",
      "side": 1,
      "message": "else crash? what used to happen..?",
      "revId": "e1df2be7b642f0c4c3cc3c69dfc618f790676948",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff4665ff_9f347c45",
        "filename": "android_webview/browser/deferred_gpu_command_service.cc",
        "patchSetId": 3
      },
      "lineNbr": 89,
      "author": {
        "id": 1003154
      },
      "writtenOn": "2018-02-01T23:45:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7b07db96_f9e6b5b1",
      "revId": "e1df2be7b642f0c4c3cc3c69dfc618f790676948",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}