{
  "comments": [
    {
      "key": {
        "uuid": "ea6a463e_b8a8fd8a",
        "filename": "chrome/browser/extensions/activity_log/activity_log.cc",
        "patchSetId": 14
      },
      "lineNbr": 787,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-01T00:12:01Z",
      "side": 1,
      "message": "There are a lot of callers to WebContents::GetTitle(), which makes me wonder how many other ones might have this same problem.  Is there a reason this is the only one that needs to change?  (For example, could the task manager end up showing the wrong title?)\n\nI worry about future code as well, since it\u0027s not obvious that callers have to wait until loading stops before they can query the title.  If we continue, we should at least update the documentation for GetTitle in web_contents.h.",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2793eba9_09ce0487",
        "filename": "chrome/browser/extensions/activity_log/activity_log.cc",
        "patchSetId": 14
      },
      "lineNbr": 787,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-01T03:33:42Z",
      "side": 1,
      "message": "\u003e could the task manager end up showing the wrong title?\n\nThe task manager would not show the \"wrong\" title, per se. It would show the same title as what you see in the tabstrip (prefixed by \"Tab: \"). This, and more generally all UI surfaces agreeing on the title for a tab, seems like a good thing.\n\n\u003e I worry about future code as well, since it\u0027s not obvious that callers have to wait until loading stops before they can query the title.\n\nThey don\u0027t have to wait until loading stops. Previously, if called before loading was finished, they might have gotten a URL or an actual title. Now, if called before loading is finished, they might get the last page\u0027s url/title, or the current page\u0027s title. Most callers should probably override TitleWasSet anyway to keep up with title changes.\n\nThe docs for GetTitle seem to have been written for some other (past?) function and not at all relevant to the current GetTitle, so I agree that should be updated.",
      "parentUuid": "ea6a463e_b8a8fd8a",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f363557f_eed8ee84",
        "filename": "chrome/browser/extensions/activity_log/activity_log.cc",
        "patchSetId": 14
      },
      "lineNbr": 787,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-02T00:12:51Z",
      "side": 1,
      "message": "\u003e \u003e could the task manager end up showing the wrong title?\n\u003e \n\u003e The task manager would not show the \"wrong\" title, per se. It would show the same title as what you see in the tabstrip (prefixed by \"Tab: \"). This, and more generally all UI surfaces agreeing on the title for a tab, seems like a good thing.\n\nHmm, I don\u0027t agree.  The task manager shows tasks in each process, which helps attribute resource usage to sites.  After a cross-process navigation, the task manager might show the old page\u0027s title next to the new process\u0027s process ID, CPU, memory, etc, despite the fact that the old page never lived in that process.\n\nIt seems like we shouldn\u0027t be describing the new process with the old page\u0027s title.\n\n\n\u003e \u003e I worry about future code as well, since it\u0027s not obvious that callers have to wait until loading stops before they can query the title.\n\u003e \n\u003e They don\u0027t have to wait until loading stops. Previously, if called before loading was finished, they might have gotten a URL or an actual title. Now, if called before loading is finished, they might get the last page\u0027s url/title, or the current page\u0027s title. Most callers should probably override TitleWasSet anyway to keep up with title changes.\n\nBut why was this change needed in ActivityLog?  Did we just notice it because a test failed?\n\n\u003e \n\u003e The docs for GetTitle seem to have been written for some other (past?) function and not at all relevant to the current GetTitle, so I agree that should be updated.\n\nThanks.",
      "parentUuid": "2793eba9_09ce0487",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed6d2cbb_503b5fea",
        "filename": "chrome/browser/extensions/activity_log/activity_log.cc",
        "patchSetId": 14
      },
      "lineNbr": 787,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-02T00:51:13Z",
      "side": 1,
      "message": "\u003e \u003e \u003e could the task manager end up showing the wrong title?\n\u003e \u003e \n\u003e \u003e The task manager would not show the \"wrong\" title, per se. It would show the same title as what you see in the tabstrip (prefixed by \"Tab: \"). This, and more generally all UI surfaces agreeing on the title for a tab, seems like a good thing.\n\u003e \n\u003e Hmm, I don\u0027t agree.  The task manager shows tasks in each process, which helps attribute resource usage to sites.  After a cross-process navigation, the task manager might show the old page\u0027s title next to the new process\u0027s process ID, CPU, memory, etc, despite the fact that the old page never lived in that process.\n\u003e \n\u003e It seems like we shouldn\u0027t be describing the new process with the old page\u0027s title.\n\nI think all UI surfaces should agree, because it would be weird trying to correlate an entry in the task manager table with a tab that has a different name (of course this usually resolves quickly even if loading everything besides the title takes a long time, so it would rarely matter --- unlike the flickering tab title, which comes up on essentially every navigation). If you feel strongly about it, we can create another function that does what the ActivityLog is doing here and use that for the task manager.\n\n\u003e \n\u003e \n\u003e \u003e \u003e I worry about future code as well, since it\u0027s not obvious that callers have to wait until loading stops before they can query the title.\n\u003e \u003e \n\u003e \u003e They don\u0027t have to wait until loading stops. Previously, if called before loading was finished, they might have gotten a URL or an actual title. Now, if called before loading is finished, they might get the last page\u0027s url/title, or the current page\u0027s title. Most callers should probably override TitleWasSet anyway to keep up with title changes.\n\u003e \n\u003e But why was this change needed in ActivityLog?  Did we just notice it because a test failed?\n\nIt\u0027s needed because it makes sense to describe the actual page that\u0027s being pre-rendered. Yes, it was noticed because of tests.\n\n\u003e \n\u003e \u003e \n\u003e \u003e The docs for GetTitle seem to have been written for some other (past?) function and not at all relevant to the current GetTitle, so I agree that should be updated.\n\u003e \n\u003e Thanks.",
      "parentUuid": "f363557f_eed8ee84",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f3deb01_49e75205",
        "filename": "chrome/browser/extensions/activity_log/activity_log.cc",
        "patchSetId": 14
      },
      "lineNbr": 787,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-02T18:09:08Z",
      "side": 1,
      "message": "\u003e \u003e \u003e \u003e could the task manager end up showing the wrong title?\n\u003e \u003e \u003e \n\u003e \u003e \u003e The task manager would not show the \"wrong\" title, per se. It would show the same title as what you see in the tabstrip (prefixed by \"Tab: \"). This, and more generally all UI surfaces agreeing on the title for a tab, seems like a good thing.\n\u003e \u003e \n\u003e \u003e Hmm, I don\u0027t agree.  The task manager shows tasks in each process, which helps attribute resource usage to sites.  After a cross-process navigation, the task manager might show the old page\u0027s title next to the new process\u0027s process ID, CPU, memory, etc, despite the fact that the old page never lived in that process.\n\u003e \u003e \n\u003e \u003e It seems like we shouldn\u0027t be describing the new process with the old page\u0027s title.\n\u003e \n\u003e I think all UI surfaces should agree, because it would be weird trying to correlate an entry in the task manager table with a tab that has a different name (of course this usually resolves quickly even if loading everything besides the title takes a long time, so it would rarely matter --- unlike the flickering tab title, which comes up on essentially every navigation). If you feel strongly about it, we can create another function that does what the ActivityLog is doing here and use that for the task manager.\n\nHmm, in my repro example, I found the task manager never actually updates the title in this case (when there\u0027s no title).  You have to close the task manager and reopen it for it to update, unlike for most navigations.\n\nIf it updated itself, I\u0027d be ok with just letting it update after the 1 second timer, but maybe we should change it to show the last committed entry like we do here.\n\n\u003e \u003e \n\u003e \u003e \n\u003e \u003e \u003e \u003e I worry about future code as well, since it\u0027s not obvious that callers have to wait until loading stops before they can query the title.\n\u003e \u003e \u003e \n\u003e \u003e \u003e They don\u0027t have to wait until loading stops. Previously, if called before loading was finished, they might have gotten a URL or an actual title. Now, if called before loading is finished, they might get the last page\u0027s url/title, or the current page\u0027s title. Most callers should probably override TitleWasSet anyway to keep up with title changes.\n\u003e \u003e \n\u003e \u003e But why was this change needed in ActivityLog?  Did we just notice it because a test failed?\n\u003e \n\u003e It\u0027s needed because it makes sense to describe the actual page that\u0027s being pre-rendered. Yes, it was noticed because of tests.\n\u003e \n\u003e \u003e \n\u003e \u003e \u003e \n\u003e \u003e \u003e The docs for GetTitle seem to have been written for some other (past?) function and not at all relevant to the current GetTitle, so I agree that should be updated.\n\u003e \u003e \n\u003e \u003e Thanks.\n\nMy point is that these are two examples of places in the code that do something wrong as a result of showing a stale title after commit.  Given that there are over 100 calls to WebContents::GetTitle(), I\u0027m concerned it may cause more than just 2 issues.\n\nWe can probably still proceed, but you may find some future title-related bugs assigned to you if they bisect to this CL.  :)",
      "parentUuid": "ed6d2cbb_503b5fea",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a6f948e_097afeb0",
        "filename": "content/browser/android/web_contents_observer_proxy.cc",
        "patchSetId": 14
      },
      "lineNbr": 247,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-01T00:12:01Z",
      "side": 1,
      "message": "What was the reason this and the TabsEventRouter change were needed?  I\u0027m wondering if we should add a comment, since it\u0027s not clear to me why it was wrong before or needed now.",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a134c945_b312476f",
        "filename": "content/browser/android/web_contents_observer_proxy.cc",
        "patchSetId": 14
      },
      "lineNbr": 247,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-01T03:33:42Z",
      "side": 1,
      "message": "If you look at how they\u0027re used, they both only seem to want to know about the title being changed explicitly via JS, and not the initial title load. It didn\u0027t come up previously because the only !explicit_set cases were for file URLs (don\u0027t really exist on Android).\n\nWe could have added a new WebContentsObserver method, e.g. OnInitialTitleLoad(), but I thought that most TitleWasSet listeners probably cared about all title updates including the first one.",
      "parentUuid": "5a6f948e_097afeb0",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8fdd4cba_a372e96b",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1266,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-01T00:12:01Z",
      "side": 1,
      "message": "Can this case come before line 1253?  It doesn\u0027t seem dependent on being in the else branch, and putting it earlier would make it easier to read and reason about.",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a8b8149_b5ea5f33",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1266,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-01T03:33:42Z",
      "side": 1,
      "message": "yes, we can because !last_page_title_.empty() and controller_.IsInitialNavigation() should be mutually exclusive. However the documentation above 1261 continues the thought from that above 1251, so it seems better not to separate them. I can get rid of the else though.",
      "parentUuid": "8fdd4cba_a372e96b",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f49b2108_8c41fafc",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1266,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-02T00:12:51Z",
      "side": 1,
      "message": "I don\u0027t think that\u0027s an improvement in readability, because you have to understand that the two cases are mutually exclusive to know that |entry| won\u0027t be the visible entry in the code below.\n\nWe should either move the new check above the IsInitialNavigation block (tweaking the comment on 1253 if you want), or leave it with the else block.  I think it\u0027s worth moving it earlier if we can.",
      "parentUuid": "8a8b8149_b5ea5f33",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07e2b7dc_57d058ee",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1266,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-02T00:51:13Z",
      "side": 1,
      "message": "ok (will do this along with other updates after other threads are resolved)",
      "parentUuid": "f49b2108_8c41fafc",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "855f0fd8_f2129fcd",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1275,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-01T00:12:01Z",
      "side": 1,
      "message": "Ah, const.  Can we make last_page_title_ mutable instead of having a const_cast?",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0065e0cc_9b475b48",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1275,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-01T03:33:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "855f0fd8_f2129fcd",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8ec016ac_9f8f05c7",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1280,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-01T00:12:01Z",
      "side": 1,
      "message": "minor nit: Rewrap.",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "749a6ed1_ebc1225f",
        "filename": "content/browser/web_contents/web_contents_impl.cc",
        "patchSetId": 14
      },
      "lineNbr": 1280,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-01T03:33:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8ec016ac_9f8f05c7",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ad7d7c11_e8588035",
        "filename": "content/browser/web_contents/web_contents_impl.h",
        "patchSetId": 14
      },
      "lineNbr": 1404,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-08-01T00:12:01Z",
      "side": 1,
      "message": "Can you update the comment to reflect that this is updated after every title change and is shown until the next page either sets a title or stops loading?",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf4f5c3f_e99bc6a8",
        "filename": "content/browser/web_contents/web_contents_impl.h",
        "patchSetId": 14
      },
      "lineNbr": 1404,
      "author": {
        "id": 1115907
      },
      "writtenOn": "2017-08-01T03:33:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ad7d7c11_e8588035",
      "revId": "43ca2da8bdd1c95a419ffb09815468ee6a439eb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}