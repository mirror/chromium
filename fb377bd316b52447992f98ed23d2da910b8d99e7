{
  "comments": [
    {
      "key": {
        "uuid": "2a3c90bd_5f41f7a8",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1147750
      },
      "writtenOn": "2017-07-10T13:11:18Z",
      "side": 1,
      "message": "This isn\u0027t perfectly reliable to get the tiles updated, if I run the test in succession. Here are some options, but I\u0027m open to other suggestions (especially if things are done differently on iOS):\n1. Create an observer like https://chromium-review.googlesource.com/c/559540\nThis will make the tests more similar.\n2. Find some user action that will 100% cause the tiles to be updated, which would be more of a user facing test.\n3. Explicitly call top_sites::SyncWithHistory. More directly does what we need, but may short-circuit what the test is verifying.",
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "76a9bc0b_145c11f4",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-07-10T13:18:10Z",
      "side": 1,
      "message": "Does chrome_test_util::OpenNewTab() below do the job?",
      "parentUuid": "2a3c90bd_5f41f7a8",
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4749c09a_7e30af69",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1147750
      },
      "writtenOn": "2017-07-10T13:39:26Z",
      "side": 1,
      "message": "No, it doesn\u0027t look to do it. It passes 100% the first time I run the test (out of 20+ runs). But it fails on the 3rd attempt (surprisingly it seems to fail on exactly the 3rd attempt each time, out of 5+ runs so not statistically significant).\n\nI also tried a different method that opens the tab via the UI (and does more synchronization and is more of a user action), and that seemed to succeed more times in a row (out of the 10 times I tested it, it always failed on the 6th or 7th attempt).\n\nI didn\u0027t run it enough to conclusively say it fails on exactly the nth run, but it does seem weird that it has never failed on the first run or made it beyond the 6th run (I\u0027m trying to run it 10 times, which never happened).\n\nI\u0027m going to debug a little and see if I can figure out what\u0027s happening.",
      "parentUuid": "76a9bc0b_145c11f4",
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "69644b96_df38e664",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1147750
      },
      "writtenOn": "2017-07-11T11:51:34Z",
      "side": 1,
      "message": "Okay, the failures was a memory problem the way I re-ran the tests. When I ran them as 100 individual tests everything was fine.\n\nRegarding opening a new tab, this doesn\u0027t look to be sufficient. When I load  a URL, then open a new tab, I don\u0027t see the tile. If I open another new tab, or simply go back before opening a new tab it works.",
      "parentUuid": "4749c09a_7e30af69",
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4dbb7bb6_d7c73fc9",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-07-11T12:52:53Z",
      "side": 1,
      "message": "This seems WAI: I forgot TopSites implements a cache that will deliver the results, even while an ongoing (second) refresh exists. Were you planning to cover a second update scenario too?",
      "parentUuid": "69644b96_df38e664",
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "871af399_6f79e8ff",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1147750
      },
      "writtenOn": "2017-07-11T13:30:42Z",
      "side": 1,
      "message": "From offline conversation, I\u0027ll leave it as is. Then will do a follow up test or two handling a Refresh(), where the observer is set only once, before the navigation.",
      "parentUuid": "4dbb7bb6_d7c73fc9",
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52853f97_5f4ad07b",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 1176649
      },
      "writtenOn": "2017-07-10T13:18:10Z",
      "side": 1,
      "message": "Optional: I think the test would be more readable with s/simple/title1/. WDYT?",
      "range": {
        "startLine": 51,
        "startChar": 79,
        "endLine": 51,
        "endChar": 0
      },
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a6a4a940_be82d2e3",
        "filename": "ios/chrome/browser/ntp_tiles/ntp_tiles_egtest.mm",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 1147750
      },
      "writtenOn": "2017-07-10T13:39:26Z",
      "side": 1,
      "message": "good idea. Done.",
      "parentUuid": "52853f97_5f4ad07b",
      "range": {
        "startLine": 51,
        "startChar": 79,
        "endLine": 51,
        "endChar": 0
      },
      "revId": "fb377bd316b52447992f98ed23d2da910b8d99e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}