{
  "comments": [
    {
      "key": {
        "uuid": "ae75c905_21a3aa22",
        "filename": "media/remoting/BUILD.gn",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1138617
      },
      "writtenOn": "2017-07-25T21:02:32Z",
      "side": 1,
      "message": "I feel like this will make it less readable since both source set have duplicated files included except for few because of different implementation.\n\nprobably the following will be ideal?\n\nsource_set(\"remoting\")  {\n  source \u003d [.....] // most of common files\n  deps \u003d [\n    \"//base\",\n    \"//media\",\n    \"//media/mojo/interfaces:remoting\",\n    \"//mojo/public/cpp/bindings\",\n    \"//ui/gfx\",\n  ]\n  \n  if (is_android) {\n    source +\u003d [\n       \"demuxer_stream_adapter_norpc.cc\",\n       \"shared_session_norpc.cc\"\n    ]\n  } else {\n    source +\u003d [\n       \"demuxer_stream_adapter.cc\",\n       \"shared_session.cc\"\n    ]\n    dep +\u003d [ :rpc ]\n  }\n}",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 14
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9bbdf9c0_8ebb88e5",
        "filename": "media/remoting/BUILD.gn",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-25T23:24:51Z",
      "side": 1,
      "message": "The main idea behind having a separate source set to be included in content/renderer was that media_remoting_tests still use the full \u0027remoting\u0027 source set on Android as those don\u0027t care about the binary size and would be good to keep running on the Android bots.",
      "parentUuid": "ae75c905_21a3aa22",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 14
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2872cdbb_302762d3",
        "filename": "media/remoting/BUILD.gn",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "9bbdf9c0_8ebb88e5",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 14
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2d8ee64e_bcf104bd",
        "filename": "media/remoting/BUILD.gn",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "I\u0027m concerned about splitting this build optimization across two BUILD.gn files (i.e., this one and content/renderer/BUILD.gn). Could we, instead, just include the sources appropriate to desktop vs. non-desktop? Also, see later comments about code duplication. I think we can just strip out all modules except renderer_controller.* and shared_session.*; and for Android, and wrap some conditional compilation macros around a few things.\n\nPutting it all together:\n\n  source_set(\"remoting\") {\n    sources \u003d [\n      renderer_controller.*, shared_session.*\n    ]\n\n    deps \u003d [\n      ...all deps except \":rpc\" and \"//media\" and \"//ui/gfx\" here...\n    ]\n\n    # For desktop, include full RPC implementation.\n    if (!is_android \u0026\u0026 !is_ios) {\n      defines +\u003d [ \"MEDIA_REMOTING_ENABLE_RPC\" ]\n      sources +\u003d [\n        ...all other files...\n      ]\n      deps +\u003d [ \":rpc:\", \"//media\", \"//ui/gfx\" ]\n    }\n  }\n\nThen, we don\u0027t need content/renderer/BUILD.gn to have knowledge about this build optimization. :)",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 32
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf990699_f071649e",
        "filename": "media/remoting/BUILD.gn",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Done. One can\u0027t really get out with just these two classes it seems though...",
      "parentUuid": "2d8ee64e_bcf104bd",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 32
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2c59465a_9ef056de",
        "filename": "media/remoting/courier_renderer_norpc.cc",
        "patchSetId": 3
      },
      "lineNbr": 1,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "I\u0027m a bit concerned about all the duplicated code.\n\nWould it be possible to instead just strip out all of media/remoting except for renderer_controller.* and shared_session.* for Android in BUILD.gn? Then, see comments below for a couple tweaks...",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 60
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "21cc8e5f_6ad6fe31",
        "filename": "media/remoting/courier_renderer_norpc.cc",
        "patchSetId": 3
      },
      "lineNbr": 1,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2c59465a_9ef056de",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 60
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a76d2267_a121f655",
        "filename": "media/remoting/demuxer_stream_adapter.h",
        "patchSetId": 3
      },
      "lineNbr": 111,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "Thanks for fixing this.",
      "range": {
        "startLine": 111,
        "startChar": 1,
        "endLine": 111,
        "endChar": 39
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1905f10a_8cbe8974",
        "filename": "media/remoting/demuxer_stream_adapter.h",
        "patchSetId": 3
      },
      "lineNbr": 111,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "I\u0027m reverting this following your suggestions.",
      "parentUuid": "a76d2267_a121f655",
      "range": {
        "startLine": 111,
        "startChar": 1,
        "endLine": 111,
        "endChar": 39
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f1b4ef7f_73dc3036",
        "filename": "media/remoting/renderer_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "Wrap this in:\n\n  #if defined(MEDIA_REMOTING_ENABLE_RPC)\n    ...\n  #endif\n\n...and declaration in header file.",
      "range": {
        "startLine": 151,
        "startChar": 0,
        "endLine": 151,
        "endChar": 67
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "244d0a64_ce9ca649",
        "filename": "media/remoting/renderer_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f1b4ef7f_73dc3036",
      "range": {
        "startLine": 151,
        "startChar": 0,
        "endLine": 151,
        "endChar": 67
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1158dce5_85d697cf",
        "filename": "media/remoting/renderer_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 378,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "Just short-circuit this:\n\n  #if defined(MEDIA_REMOTING_ENABLE_RPC)\n    const bool should_be_remoting \u003d ShouldBeRemoting();\n  #else\n    const bool should_be_remoting \u003d false;\n  #endif",
      "range": {
        "startLine": 378,
        "startChar": 0,
        "endLine": 378,
        "endChar": 47
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a29694ad_d2cfeafd",
        "filename": "media/remoting/renderer_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 378,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Don\u0027t see how this helps with minimizing the change. CanBeRemoting depends on this class and SharedSession.",
      "parentUuid": "1158dce5_85d697cf",
      "range": {
        "startLine": 378,
        "startChar": 0,
        "endLine": 378,
        "endChar": 47
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7696c7f8_bdab85a0",
        "filename": "media/remoting/shared_session.cc",
        "patchSetId": 3
      },
      "lineNbr": 21,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "SharedSession::SharedSession(...)\n#if defined(MEDIA_REMOTING_ENABLE_RPC)\n    : rpc_broker_(...),\n#else\n    :\n#endif",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 21,
        "endChar": 47
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a29aacd_1ce0510e",
        "filename": "media/remoting/shared_session.cc",
        "patchSetId": 3
      },
      "lineNbr": 21,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7696c7f8_bdab85a0",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 21,
        "endChar": 47
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "72af4aee_be531d0c",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "Remove this forward decl, and insert (above L17):\n\n  #if defined(MEDIA_REMOTING_ENABLE_RPC)\n  #include \"media/remoting/rpc_broker.h\"\n  #endif",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 16
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca7b802d_188e6947",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-25T23:24:51Z",
      "side": 1,
      "message": "I tried conditional includes in the previous patchset and gn gen --check still complained about those :( Hence I tried to avoid those in the last patchset.",
      "parentUuid": "72af4aee_be531d0c",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 16
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19b8e94a_c5e2bef1",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "thakis@ helpfully told me about // nogncheck",
      "parentUuid": "ca7b802d_188e6947",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 16
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "82f57c87_007ad00a",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 129,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "Revert back to what it was, and guard with #if defined(MEDIA_REMOTING_ENABLE_RPC)...#endif\n\n...and definition in .cc file.",
      "range": {
        "startLine": 129,
        "startChar": 0,
        "endLine": 129,
        "endChar": 42
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd909ff8_13082770",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 129,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "82f57c87_007ad00a",
      "range": {
        "startLine": 129,
        "startChar": 0,
        "endLine": 129,
        "endChar": 42
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1e491b6d_437604e1",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 143,
      "author": {
        "id": 1002076
      },
      "writtenOn": "2017-07-25T21:22:07Z",
      "side": 1,
      "message": "This too: Revert back to what it was, and guard with #if defined(MEDIA_REMOTING_ENABLE_RPC)...#endif",
      "range": {
        "startLine": 143,
        "startChar": 2,
        "endLine": 143,
        "endChar": 41
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4daca6d5_7ed3e18c",
        "filename": "media/remoting/shared_session.h",
        "patchSetId": 3
      },
      "lineNbr": 143,
      "author": {
        "id": 1000014
      },
      "writtenOn": "2017-07-28T00:11:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1e491b6d_437604e1",
      "range": {
        "startLine": 143,
        "startChar": 2,
        "endLine": 143,
        "endChar": 41
      },
      "revId": "6fc212eeb57be9b47db51ef9fb89edde7272c742",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}