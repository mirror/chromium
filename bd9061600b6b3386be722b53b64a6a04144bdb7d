{
  "comments": [
    {
      "key": {
        "uuid": "3c4e0f27_18a7799a",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-08-01T15:33:42Z",
      "side": 1,
      "message": "I think this is problematic. If contents was null previously then show_bookmark_bar would be false and we would fallthrough to set PageNavigator to the active webcontents below. That isn\u0027t the case in this patch.",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c086095_9d9d524b",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1199459
      },
      "writtenOn": "2017-08-01T17:54:42Z",
      "side": 1,
      "message": "The CL https://codereview.chromium.org/2946813002 was intended to avoid bookmark\u0027s parent being set to nullptr when |contents| is nullptr, FEATURE_BOOKMARKBAR is supported and |bookmark_bar_view_| is not empty. But it also made the code fall through L2223 when |contents| is nullptr, FEATURE_BOOKMARKBAR is supported and |bookmark_bar_view_| is empty, which is not intended. This patch modifies the if condition in L2223 to be as the same as the code before CL 2946813002, while the problem addressed in CL 2946813002 should still be solved in this patch.",
      "parentUuid": "3c4e0f27_18a7799a",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "81602bee_0a603fcf",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-08-01T19:43:06Z",
      "side": 1,
      "message": "I think you\u0027re assuming the BookmarkBar was never created. That is, bookmark_bar_view_ is null. I suspect that isn\u0027t the case. What seems more likely is that the bookmarkbar was created but there is no active web contents. Previously if this happened the bookmarkbar would not hidden, that isn\u0027t the case after your patch.\n\nAs we discussed in the previous patch, generally this only happens during shutdown, but there may be a small window of time where this can happen; when chrome is temporarily in some bad state with a window still open but no tabs.",
      "parentUuid": "7c086095_9d9d524b",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "71805d99_06e5abf8",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1199459
      },
      "writtenOn": "2017-08-01T20:43:26Z",
      "side": 1,
      "message": "In this patch, the bookmarkbar would not be hidden as well, because |show_bookmark_bar| is still decided by Browser::FEATURE_BOOKMARKBAR only in L2222. This patch only changes one path: \"there\u0027s not active web contents, bookmarkbar was not created and FEATURE_BOOKMARKBAR is enabled\". This path is blocked in L2223 in this patch.\nThe crash didn\u0027t happen before CL 2946813002, after I let the path fall through L2223, it may cause crashes after nullptr is set to bookmarkbar\u0027s navigator in L2238. So it seems the speculative fix should block the path.",
      "parentUuid": "81602bee_0a603fcf",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d84fa442_5733548d",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-08-01T23:33:59Z",
      "side": 1,
      "message": "And again, I think the more likely path we\u0027re hitting is there was a bookmark bar and the active webcontents is now null.",
      "parentUuid": "71805d99_06e5abf8",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92fab262_08e3a769",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1199459
      },
      "writtenOn": "2017-08-01T23:39:24Z",
      "side": 1,
      "message": "In that case, the crash may also occur before CL 2946813002. Should it be better to add a if condition wrap at L2238 to only set navigator when we have active web content?",
      "parentUuid": "d84fa442_5733548d",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6bd71f01_466fc39e",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1000763
      },
      "writtenOn": "2017-08-01T23:45:36Z",
      "side": 1,
      "message": "If |contents| is null active web contents should also be null. \nBefore https://codereview.chromium.org/2946813002 we would hide the bookmark bar in this case, right? So, I think the crash is new to your patch.",
      "parentUuid": "92fab262_08e3a769",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c8f86d1_09ab2c03",
        "filename": "chrome/browser/ui/views/frame/browser_view.cc",
        "patchSetId": 1
      },
      "lineNbr": 2223,
      "author": {
        "id": 1199459
      },
      "writtenOn": "2017-08-03T02:32:27Z",
      "side": 1,
      "message": "Yes, https://codereview.chromium.org/2946813002 was intended to fix the issue when |contents| is null and bookmark bar exists. But it also unintendedly changed case when when |contents| is null and bookmark bar does not exist. This patch just reverts that case. So I still think it should not break anything. And speculatively it may fix the crash.",
      "parentUuid": "6bd71f01_466fc39e",
      "range": {
        "startLine": 2223,
        "startChar": 17,
        "endLine": 2223,
        "endChar": 37
      },
      "revId": "bd9061600b6b3386be722b53b64a6a04144bdb7d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}