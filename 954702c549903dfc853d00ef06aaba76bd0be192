{
  "comments": [
    {
      "key": {
        "uuid": "08b5acf8_c8fbe1ff",
        "filename": "components/password_manager/core/browser/credential_manager_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1179305
      },
      "writtenOn": "2017-12-22T15:53:47Z",
      "side": 1,
      "message": "@Balazs: We can\u0027t use `form_manager_-\u003eFindBestSavedMatch` here since it\u0027s a private method. However, given that we know that |form| is not a new credential when we enter this branch, |form| should be the same form set which is set here: https://cs.chromium.org/chromium/src/components/password_manager/core/browser/password_form_manager.cc?l\u003d1011\u0026rcl\u003d9c0e4f94f2cfc6f7782a2cc763105fde55beb603",
      "range": {
        "startLine": 247,
        "startChar": 26,
        "endLine": 247,
        "endChar": 30
      },
      "revId": "954702c549903dfc853d00ef06aaba76bd0be192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf177973_31d2f107",
        "filename": "components/password_manager/core/browser/credential_manager_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1003152
      },
      "writtenOn": "2017-12-22T20:12:33Z",
      "side": 1,
      "message": "Can you please also add browsertests to exercise scenarios where:\n 1) the existing form in the password store has the same username, but also a non-empty |username_element|, |password_element| and/or an |origin| with a path?\n 2) the previously stored credential is a PSL match with the same username.\n\nUpdate() expects that the |form| passed in here comes from the PasswordStore, so that it can be updated based on the primary key (signon_realm, username_value, origin, username_element, password_element).\n\nIn (1), it\u0027s not entirely obvious to me whether the latter 3 attributes of the |form| will match those of stored or submitted credential (where _elements would be empty, I think). Not sure what exactly Update will result in in this scenario (duplicate credentials or failed update).\n\nIn (2), it\u0027s not obviously clear what should happen, but would be good to codify the expectations in a browser test.\n\nTL;DR: I think this will work, but it\u0027s obvious that it\u0027s correct.",
      "parentUuid": "08b5acf8_c8fbe1ff",
      "range": {
        "startLine": 247,
        "startChar": 26,
        "endLine": 247,
        "endChar": 30
      },
      "revId": "954702c549903dfc853d00ef06aaba76bd0be192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4a8818cc_cac16637",
        "filename": "components/password_manager/core/browser/credential_manager_impl.cc",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1179305
      },
      "writtenOn": "2017-12-28T13:08:06Z",
      "side": 1,
      "message": "Done, added tests and a DCHECK that confirms |form| is the best match for the current username.\n\nTo my understanding, (1) should be covered by PasswordFormManager::UpdatePendingAndGetOldKey() which PasswordFormManager::Update() calls: https://cs.chromium.org/chromium/src/components/password_manager/core/browser/password_form_manager.cc?l\u003d1557-1561\u0026rcl\u003d9db55c277b223943a012896725c4018eab9493f2\n\n(2) Here we will store an extra credentials, which happens silently if the password is the same (see e.g. CredentialManagerBrowserTest::StoreSavesPSLMatchedCredential), or requires user interaction if the password differs (test added in this CL). According to this comment in PasswordFormManager::CreatePendingCredentials() this is expected behavior: https://cs.chromium.org/chromium/src/components/password_manager/core/browser/password_form_manager.cc?l\u003d1054-1062\u0026rcl\u003d9db55c277b223943a012896725c4018eab9493f2",
      "parentUuid": "bf177973_31d2f107",
      "range": {
        "startLine": 247,
        "startChar": 26,
        "endLine": 247,
        "endChar": 30
      },
      "revId": "954702c549903dfc853d00ef06aaba76bd0be192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}