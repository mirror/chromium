{
  "comments": [
    {
      "key": {
        "uuid": "ab845f75_4b86e6d0",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositedLayerMapping.cpp",
        "patchSetId": 12
      },
      "lineNbr": 1516,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-04T23:20:49Z",
      "side": 1,
      "message": "You\u0027ll need to adjust for negative visual overflow like the code below. If you meant to position and size the child containment layer to the padding box, you can copy the code below but replace ClippingRect with PaddingBoxRect.\n\n(But ideally if we can just redefine LayoutBox::ShouldClipOverflow that would be awesome.)",
      "revId": "e096058bff321675ee067bcf2a1c42daedf68409",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "651a96b1_4deae0ec",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositedLayerMapping.cpp",
        "patchSetId": 12
      },
      "lineNbr": 1516,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-12-05T14:15:52Z",
      "side": 1,
      "message": "Just changing ShouldClipOverflow at the LayoutObject level breaks hit testing and scroll-to-focus and other things because the overflow rect for the element itself needs to include the border and shadow and other things that get painted int he foreground phase for embedded objects, yet not include any of that stuff for the clipping mask.\n\nI think we always need the layers to match exactly in location and size. Unless it\u0027s been changed in one of these rebases, the clip is pulled from LayerClipRecorder::CollectRoundedRectClips and is in the space of the Parent() layer here. So we need the containment also in that space.\n\nRegardless, if seems we need more tests.",
      "parentUuid": "ab845f75_4b86e6d0",
      "revId": "e096058bff321675ee067bcf2a1c42daedf68409",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "673ee72d_3b9e605c",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositedLayerMapping.cpp",
        "patchSetId": 12
      },
      "lineNbr": 1516,
      "author": {
        "id": 1003330
      },
      "writtenOn": "2017-12-05T22:51:16Z",
      "side": 1,
      "message": "It is okay to match the parent layer\u0027s geometry (although I still think it is more optimal to just use the padding box rect.), in that case, we still need to copy OffsetFromLayoutObject from the parent. i.e.\nchild_containment_layer_-\u003eSetOffsetFromLayoutObject(child_containment_layer_-\u003eParent()-\u003eOffsetFromLayoutObject());\n\nAs for testing, I think we can make a iframe with negative visual overflow using box shadow. Here\u0027s an example: http://jsbin.com/keyocayesa/\n\nFurther explanation: Most of the time, the main graphics layer will match the owning layout object\u0027s snapped border box space, but in the presence of negative visual overflow, the layer can be shifted. The difference between a layer\u0027s space and the snapped border box space is saved as OffsetFromLayoutObject(), and the translation is applied at the beginning of CLM::DoPaintTask() so the rest of the code don\u0027t need to ever deal with that.",
      "parentUuid": "651a96b1_4deae0ec",
      "revId": "e096058bff321675ee067bcf2a1c42daedf68409",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3e44106e_812bc7a6",
        "filename": "third_party/WebKit/Source/core/paint/compositing/CompositedLayerMapping.cpp",
        "patchSetId": 12
      },
      "lineNbr": 1516,
      "author": {
        "id": 1210854
      },
      "writtenOn": "2017-12-06T21:07:18Z",
      "side": 1,
      "message": "I can see the issue. Fixing it is a bit of work.\n\nRight now we assume that the PaintLayerCompositor for the IFrame content assumes that it\u0027s parent layer is the GraphicsLayer for the IFrame, and sets its offset accordingly. But with the child containment layer it is now parented off that, and has an incorrect position. I think the position can be fixed with some work once I manage to figure out how to detect the situation.",
      "parentUuid": "673ee72d_3b9e605c",
      "revId": "e096058bff321675ee067bcf2a1c42daedf68409",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}