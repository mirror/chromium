{
  "comments": [
    {
      "key": {
        "uuid": "bb3e45d3_28c0029e",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 617,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-11-16T18:04:27Z",
      "side": 1,
      "message": "This TODO comment isn\u0027t clear.  It makes it sounds like the whole block (including what was there before) should be removed.  There also isn\u0027t a clear connection between CanReadRawCookies and DevTools, or how it relates to this bug.  Can I suggest something like the following?\n\nFor now, DevTools needs the POST data sent to the renderer process even if it is no longer a POST after the redirect.  Detect if it is DevTools using CanReadRawCookies.\nTODO(caseq): Send the full request data to DevTools and remove the |can_read_raw_cookies| check here.\n\n\n(Related question: Is CanReadRawCookies granted to the DevTools process, or to normal web renderers that have DevTools attached?)",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "34762d04_673ed49a",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 617,
      "author": {
        "id": 1148840
      },
      "writtenOn": "2017-11-16T21:19:30Z",
      "side": 1,
      "message": "Done.\n\nCanReadRawCookies is granted from when devtools attached to a target (fame in this case). Any subframes that spawn will eventually (if not immediately) have devtools attached and granted this permission. However, for example, window.open(\u0027http://cross-site\u0027) will not have devtools attached and we should not be sending post data.",
      "parentUuid": "bb3e45d3_28c0029e",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04769369_306fa184",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 617,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-11-17T19:46:37Z",
      "side": 1,
      "message": "\u003e Done.\n\u003e \n\u003e CanReadRawCookies is granted from when devtools attached to a target (fame in this case). Any subframes that spawn will eventually (if not immediately) have devtools attached and granted this permission. However, for example, window.open(\u0027http://cross-site\u0027) will not have devtools attached and we should not be sending post data.\n\nWait, I may have approved too soon.  The check you\u0027re doing is process-wide, which means it will include the POST data for the window.open case as well (as well as any other tabs that happen to be sharing the process).  That doesn\u0027t seem ok.\n\nIsn\u0027t there a more direct way to know if a RenderFrameHost has DevTools attached?",
      "parentUuid": "34762d04_673ed49a",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b3ae30ac_09bd2b7f",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 620,
      "author": {
        "id": 1115881
      },
      "writtenOn": "2017-11-15T14:32:02Z",
      "side": 1,
      "message": "@creis: does it make sense to use the source site instance here? While it should be set for a form submit, since it is browser initiated, what about history navigations? Is it set here?\n\nAlso, since source_site_instance() can be null, you need to check for that.",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "647201ad_f5cf4a97",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 620,
      "author": {
        "id": 1115881
      },
      "writtenOn": "2017-11-15T14:32:49Z",
      "side": 1,
      "message": "I meant form submit is renderer-initiated, unlike the history navigation.",
      "parentUuid": "b3ae30ac_09bd2b7f",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "afb6221e_0f71613a",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 620,
      "author": {
        "id": 1148840
      },
      "writtenOn": "2017-11-15T19:31:22Z",
      "side": 1,
      "message": "I don\u0027t think history navigations would ever send post data because redirects don\u0027t carry post data anyway. We would also be ok having it not send post data for history navigations if I\u0027m wrong, since it\u0027s an edge case and we have plans on fixing it for all cases in the long term.",
      "parentUuid": "647201ad_f5cf4a97",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc9dbf14_f83e9861",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 620,
      "author": {
        "id": 1001216
      },
      "writtenOn": "2017-11-16T18:04:27Z",
      "side": 1,
      "message": "source_site_instance() doesn\u0027t seem like the right thing to use here, given the subtle differences in how it\u0027s defined between renderer and browser initiated navigations.\n\nCan we use frame_tree_node_-\u003ecurrent_frame_host()-\u003eGetSiteInstance() directly here?  (Or rather, frame_tree_node_-\u003ecurrent_frame_host()-\u003eGetProcess()?)  The current RFH seems to be used in many other places in NavigationRequest, and should represent the current page.\n\nNormally, I\u0027d be concerned about that being wrong for navigations that target a different frame.  Here, though, I think it might do the right thing.  Suppose frame A targets frame B with a navigation that redirects from C (POST) to D (GET).  If I understand correctly, we want to leave the post_data around if frame B has DevTools attached, since that\u0027s the DevTools instance that will be showing the network activity?\n\nIf so, that means we definitely want the current_frame_host() and not the source_site_instance() (which would be A).\n\n(Side note for Camille: Can you write a CL to update the comments for source_site_instance on NavigationRequest?  It seems to be lacking comments in some places and has incorrect comments in others, like saying it\u0027s only for browser-initiated navigations at the declaration site.)",
      "parentUuid": "afb6221e_0f71613a",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12cd863c_051efd65",
        "filename": "content/browser/frame_host/navigation_request.cc",
        "patchSetId": 2
      },
      "lineNbr": 620,
      "author": {
        "id": 1148840
      },
      "writtenOn": "2017-11-16T21:19:30Z",
      "side": 1,
      "message": "Yes I think current_frame_host() would be more appropriate.",
      "parentUuid": "cc9dbf14_f83e9861",
      "revId": "dcab2caf80f4a1964cf0609b7344196bdb6647d8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}