{
  "comments": [
    {
      "key": {
        "uuid": "99cf0619_88eac19c",
        "filename": "google_apis/gaia/gaia_auth_consumer.h",
        "patchSetId": 16
      },
      "lineNbr": 48,
      "author": {
        "id": 1003168
      },
      "writtenOn": "2017-11-24T06:27:07Z",
      "side": 1,
      "message": "This is wrong, as we definitely need to distinguish between \"id_token not received\" and \"id_token suggests that is_child_account has given value\".\n\nWe cannot \"temporarily\" make child account regular acccount, and back.\n\nCound you add unique_ptr\u003cbool\u003e for is_child_account flag (for example)?",
      "revId": "d8a93a0d1a19baba9b25fd3893840a7548bdcbe3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f7bf00d_53dd454c",
        "filename": "google_apis/gaia/gaia_auth_consumer.h",
        "patchSetId": 16
      },
      "lineNbr": 48,
      "author": {
        "id": 1246429
      },
      "writtenOn": "2017-11-24T11:09:53Z",
      "side": 1,
      "message": "I\u0027ve discussed with escordeiro@ about it and, at least for teamfood, we\u0027re assuming the account is not a child if decoding fails or id_token is not received.\n\nLet\u0027s continue discussing, though, the best way to handle this case. For now, we wouldn\u0027t change the handling if this information isn\u0027t available. Thus, I propose to add it when we start doing something different with this.\n\nBut, definitely, we should better consider this case.",
      "parentUuid": "99cf0619_88eac19c",
      "revId": "d8a93a0d1a19baba9b25fd3893840a7548bdcbe3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a568e04_1204b0f6",
        "filename": "google_apis/gaia/gaia_auth_consumer.h",
        "patchSetId": 16
      },
      "lineNbr": 48,
      "author": {
        "id": 1252989
      },
      "writtenOn": "2017-11-24T11:52:03Z",
      "side": 1,
      "message": "I think we all agree that it\u0027s undesired to \"swallow\" errors in fetching the id_token. However, IMO if we fail to get an id_token, we shouldn\u0027t let the user session resume -- we should stop it immediately. I don\u0027t think that a consumer should try to run without this information.\n\nTo address this, there\u0027s likely a bigger change to be made earlier in the flow so that this can happen. Alexander, do you think we should just return nullptr from |ExtractOAuth2TokenPairResponse| if we fail to find an id_token? That\u0027s what Luciana and I were considering before, but we decided to play it safe for now and let the session proceed as a non-child session.",
      "parentUuid": "2f7bf00d_53dd454c",
      "revId": "d8a93a0d1a19baba9b25fd3893840a7548bdcbe3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2c821d4e_308a7db8",
        "filename": "google_apis/gaia/gaia_auth_consumer.h",
        "patchSetId": 16
      },
      "lineNbr": 48,
      "author": {
        "id": 1003168
      },
      "writtenOn": "2017-11-25T03:42:38Z",
      "side": 1,
      "message": "You cannot distinguish between regular users and child accounts here.\nAnd new code should not affect existing users.\n\nTherefore we should return a value that will allow session code to decide whether to end session. I\u0027d suggest returning a pointer to decoded id_token, which can be null.\n\nIn your solution, you decode id_token to a single boolean. Ok, let\u0027s return a pointer to boolean then...",
      "parentUuid": "1a568e04_1204b0f6",
      "revId": "d8a93a0d1a19baba9b25fd3893840a7548bdcbe3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "406311e2_53ec93f3",
        "filename": "google_apis/gaia/gaia_auth_consumer.h",
        "patchSetId": 16
      },
      "lineNbr": 48,
      "author": {
        "id": 1246429
      },
      "writtenOn": "2017-11-27T12:37:05Z",
      "side": 1,
      "message": "Actually, we can\u0027t distinguish in a more specific scenario: a child account whose ID token fetch/decode failed from a regular account. \n\nMy point here is that:\n(1) We should first discuss with PMs how to deal with this situation. It\u0027s not something required for teamfood, and it should be very rare.\n(2) It does not help to know that is_child_account is missing, since we still don\u0027t know how to handle it. If we decided to do something about this case, and perform this handling in the consumers receiving this value (we could handle in the fetching/decoding process instead, which would not require such pointer), then we could make this a pointer to a boolean.\n\nIn summary, it makes much sense to raise this concern, we should definitely discuss about it. However, let\u0027s not try to solve all the problems at once without discussing the solution first. I know it\u0027s a simple change, but this is something that is *not* required right now, and it would make the API more complex unnecessarily. Do you agree on continuing discussing this?",
      "parentUuid": "2c821d4e_308a7db8",
      "revId": "d8a93a0d1a19baba9b25fd3893840a7548bdcbe3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "233bc8e4_e1cf527a",
        "filename": "google_apis/gaia/gaia_auth_consumer.h",
        "patchSetId": 16
      },
      "lineNbr": 48,
      "author": {
        "id": 1000369
      },
      "writtenOn": "2017-11-28T02:04:50Z",
      "side": 1,
      "message": "For M64, if absolutely anything goes wrong with the code to fetch or decode the ID token, we should default to it being a regular user sign-in. For M-65, let\u0027s open an issue and figure out the best way to mitigate worst case scenarios with the flow.",
      "parentUuid": "406311e2_53ec93f3",
      "revId": "d8a93a0d1a19baba9b25fd3893840a7548bdcbe3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}