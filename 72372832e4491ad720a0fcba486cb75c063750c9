{
  "comments": [
    {
      "key": {
        "uuid": "9275d3b9_77293f0b",
        "filename": "components/download/downloader/in_progress/download_entry.cc",
        "patchSetId": 4
      },
      "lineNbr": 42,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:31:42Z",
      "side": 1,
      "message": "!(*this \u003d\u003d other);",
      "range": {
        "startLine": 39,
        "startChar": 9,
        "endLine": 42,
        "endChar": 46
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52532194_bdc1ab11",
        "filename": "components/download/downloader/in_progress/download_entry.cc",
        "patchSetId": 4
      },
      "lineNbr": 42,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-18T16:38:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9275d3b9_77293f0b",
      "range": {
        "startLine": 39,
        "startChar": 9,
        "endLine": 42,
        "endChar": 46
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1eb49c88_aea267d0",
        "filename": "components/download/downloader/in_progress/download_entry.h",
        "patchSetId": 4
      },
      "lineNbr": 43,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-18T21:18:18Z",
      "side": 1,
      "message": "Can you comment on what would be a valid/invalid id?  Should we use int64 or int here?  Should it be effectively uint since rand is between 0 -\u003e max (and we can treat 0 as invalid)?",
      "range": {
        "startLine": 43,
        "startChar": 2,
        "endLine": 43,
        "endChar": 22
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39fe11de_6a02df77",
        "filename": "components/download/downloader/in_progress/download_entry.h",
        "patchSetId": 4
      },
      "lineNbr": 43,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-19T20:06:34Z",
      "side": 1,
      "message": "I\u0027m going to keep -1 as null because techinically RandUint64() returns a number [0, UINT64_MAX], so there is a possibility 0 is selected.",
      "parentUuid": "1eb49c88_aea267d0",
      "range": {
        "startLine": 43,
        "startChar": 2,
        "endLine": 43,
        "endChar": 22
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd00a0ab_6bc983f7",
        "filename": "components/download/downloader/in_progress/in_progress_cache_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:31:42Z",
      "side": 1,
      "message": "Ideally wouldn\u0027t this struct have come from the DB anyway?  If so, should the values be the same?",
      "range": {
        "startLine": 31,
        "startChar": 32,
        "endLine": 31,
        "endChar": 58
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f5ece60_b5b32b1a",
        "filename": "components/download/downloader/in_progress/in_progress_cache_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-18T16:38:30Z",
      "side": 1,
      "message": "In most implementations, this should be the same. But I\u0027m just making this method input-agnostic in case we get different cases where the entry is constructed/not coming from DB.",
      "parentUuid": "bd00a0ab_6bc983f7",
      "range": {
        "startLine": 31,
        "startChar": 32,
        "endLine": 31,
        "endChar": 58
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a56d2d9_7f94c0fa",
        "filename": "components/download/downloader/in_progress/in_progress_cache_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-18T21:18:18Z",
      "side": 1,
      "message": "That feels non-deterministic from the caller standpoint?  It\u0027s odd having some variables technically be ignored.  We shouldn\u0027t be creating new DownloadEntry values directly except when adding brand new downloads right?  We should be hitting the storage layer whenever we need to access the data.",
      "parentUuid": "2f5ece60_b5b32b1a",
      "range": {
        "startLine": 31,
        "startChar": 32,
        "endLine": 31,
        "endChar": 58
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c2a8ab82_7d1fae7b",
        "filename": "components/download/downloader/in_progress/in_progress_cache_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-19T20:06:34Z",
      "side": 1,
      "message": "Ok!",
      "parentUuid": "8a56d2d9_7f94c0fa",
      "range": {
        "startLine": 31,
        "startChar": 32,
        "endLine": 31,
        "endChar": 58
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d3e03c4d_adf7c15b",
        "filename": "components/download/downloader/in_progress/proto/download_entry.proto",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:31:42Z",
      "side": 1,
      "message": "Ah I thought from our earlier meeting we agreed not to persist the UKM ID right?  This is just a counter so we\u0027ll get duplicates with any other entries in a new session.",
      "range": {
        "startLine": 19,
        "startChar": 17,
        "endLine": 19,
        "endChar": 30
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12f3ad23_fa8a4032",
        "filename": "components/download/downloader/in_progress/proto/download_entry.proto",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:32:21Z",
      "side": 1,
      "message": "by UKM ID I mean the source id.",
      "parentUuid": "d3e03c4d_adf7c15b",
      "range": {
        "startLine": 19,
        "startChar": 17,
        "endLine": 19,
        "endChar": 30
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "383a4867_078e2a83",
        "filename": "components/download/downloader/in_progress/proto/download_entry.proto",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-18T16:38:30Z",
      "side": 1,
      "message": "The source id has to be persisted from where it\u0027s constructed with webcontents to where UKM will be taken (DownloadResourceHandler -\u003e DownloadManager -\u003e DownloadItem), so this storage of source id was more for the purpose of passing it along this way and less for future uses of the source id. Open to other suggestions!",
      "parentUuid": "12f3ad23_fa8a4032",
      "range": {
        "startLine": 19,
        "startChar": 17,
        "endLine": 19,
        "endChar": 30
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "773df27b_d70526a6",
        "filename": "components/download/downloader/in_progress/proto/download_entry.proto",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-18T21:18:18Z",
      "side": 1,
      "message": "Ah IIUC that happens through the DownloadCreateInfo struct, not the in progress cache?  We shouldn\u0027t persist it if it isn\u0027t supposed to be used after restarts right?",
      "parentUuid": "383a4867_078e2a83",
      "range": {
        "startLine": 19,
        "startChar": 17,
        "endLine": 19,
        "endChar": 30
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8385698a_df9e7961",
        "filename": "components/download/downloader/in_progress/proto/download_entry.proto",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-19T20:06:34Z",
      "side": 1,
      "message": "Ah didn\u0027t realize that the DownloadCreateInfo gets passed into DownloadItemImpl so we don\u0027t need to save it. Fixed!",
      "parentUuid": "773df27b_d70526a6",
      "range": {
        "startLine": 19,
        "startChar": 17,
        "endLine": 19,
        "endChar": 30
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c632b1b9_8f63fe65",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:31:42Z",
      "side": 1,
      "message": "Check and see if Chromium has a random number generator.",
      "range": {
        "startLine": 554,
        "startChar": 29,
        "endLine": 554,
        "endChar": 35
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1555c3d4_8c63a0cc",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-18T16:38:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c632b1b9_8f63fe65",
      "range": {
        "startLine": 554,
        "startChar": 29,
        "endLine": 554,
        "endChar": 35
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b12de189_47fabe4e",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-18T21:18:18Z",
      "side": 1,
      "message": "base/rand_util.h: RandUint64() or RandInt()?",
      "parentUuid": "1555c3d4_8c63a0cc",
      "range": {
        "startLine": 554,
        "startChar": 29,
        "endLine": 554,
        "endChar": 35
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6914d697_78aa1c6f",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 554,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-19T20:06:34Z",
      "side": 1,
      "message": "This is fine: Returns a random number in range [0, UINT64_MAX].",
      "parentUuid": "b12de189_47fabe4e",
      "range": {
        "startLine": 554,
        "startChar": 29,
        "endLine": 554,
        "endChar": 35
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3ff18a48_a1987ded",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1043,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:31:42Z",
      "side": 1,
      "message": "Do we need this?  Do we go through the codepath above?",
      "range": {
        "startLine": 1039,
        "startChar": 2,
        "endLine": 1043,
        "endChar": 3
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "28950cae_b04d2bcf",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1043,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-18T16:38:30Z",
      "side": 1,
      "message": "So this path is for the specific downloads that don\u0027t go through the above code path and we want to track the request_origin/download_source from. That being said, we probably won\u0027t hit UKM with this pathway, but I don\u0027t think it hurts to add the UKM id in case we do?",
      "parentUuid": "3ff18a48_a1987ded",
      "range": {
        "startLine": 1039,
        "startChar": 2,
        "endLine": 1043,
        "endChar": 3
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e775b46b_b689238a",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1043,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-18T21:18:18Z",
      "side": 1,
      "message": "Huh it looked like this path cascaded back through the above change when it builds the request.  I would just check and then also confirm what happens if we\u0027re offline and queue up a download.",
      "parentUuid": "28950cae_b04d2bcf",
      "range": {
        "startLine": 1039,
        "startChar": 2,
        "endLine": 1043,
        "endChar": 3
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "68fedec4_f7b5a46e",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1043,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-19T20:06:34Z",
      "side": 1,
      "message": "Roughly, bugs aside (https://paste.googleplex.com/5444689616437248): \n- In the case that we navigate straight to a link that is a download (ie. PDF), we only call StartDownloadWithId and not BeginDownloadInternal.\n- In the case that we long-press and click \"Download link\" on the context menu and it turns out to be not an offline page, we go through BeginDownloadInternal and then StartDownloadWithId.\n\nI\u0027ve added checks to only AddOrReplaceEntry at that point if there isn\u0027t already an existing entry.\n\nThe bigger problem, as I\u0027ve discussed with shaktisahu@ is that there is actually no download GUID at this point yet, only at StartDownloadWithId.",
      "parentUuid": "e775b46b_b689238a",
      "range": {
        "startLine": 1039,
        "startChar": 2,
        "endLine": 1043,
        "endChar": 3
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d2fe4d6d_69ec4158",
        "filename": "content/browser/download/download_manager_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 1043,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-19T21:03:57Z",
      "side": 1,
      "message": "I put a note in the code--this pathway needs to be removed because the GUID is null at this point for new downloads. However, more changes need to made (ie. move request_origin, download_source from DownloadUrlParameters) before this code can be removed.",
      "parentUuid": "68fedec4_f7b5a46e",
      "range": {
        "startLine": 1039,
        "startChar": 2,
        "endLine": 1043,
        "endChar": 3
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "97307f81_1c41b26e",
        "filename": "content/browser/download/download_resource_handler.cc",
        "patchSetId": 4
      },
      "lineNbr": 112,
      "author": {
        "id": 1107754
      },
      "writtenOn": "2017-12-15T22:31:42Z",
      "side": 1,
      "message": "Could we just get the source ID from the webcontents via that other method?  I don\u0027t think the UKM source id is set yet.  Tab info is uninitialized at this point IIUC.",
      "range": {
        "startLine": 111,
        "startChar": 6,
        "endLine": 112,
        "endChar": 59
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8147fef_66815cfa",
        "filename": "content/browser/download/download_resource_handler.cc",
        "patchSetId": 4
      },
      "lineNbr": 112,
      "author": {
        "id": 1226039
      },
      "writtenOn": "2017-12-18T16:38:30Z",
      "side": 1,
      "message": "So I chatted with holte@ about this offline, the other method, GetSourceIdForWebContentsDocument, can\u0027t be used from content/, so he has agreed this is a reasonable substitute. Based on print statements, this seems to work out (the lastcommittedurl is the one we want).",
      "parentUuid": "97307f81_1c41b26e",
      "range": {
        "startLine": 111,
        "startChar": 6,
        "endLine": 112,
        "endChar": 59
      },
      "revId": "72372832e4491ad720a0fcba486cb75c063750c9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}