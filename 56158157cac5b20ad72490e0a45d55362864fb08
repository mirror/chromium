{
  "comments": [
    {
      "key": {
        "uuid": "367f16de_5e74e959",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 371,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-11T22:16:22Z",
      "side": 1,
      "message": "Nit: I\u0027d leave off the last sentence; it confused me because it was vague (which heuristics?  Only the ones where you check this?) and it\u0027s redundant with the comments there anyway.",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e90d032_3798c516",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 371,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T04:52:00Z",
      "side": 1,
      "message": "Done.  (Removed.)",
      "parentUuid": "367f16de_5e74e959",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aae5c7d0_74309987",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-11T22:16:22Z",
      "side": 1,
      "message": "Implementing this this way -- instead of by bailing with \"UNKNOWN\" or the like here -- seems like it will matter if the user types \"foo bar@baz\" and hits ctrl-enter.  I think with your code, that will be URL, but maybe it should be UNKNOWN instead?  Not sure.  What do you think should happen here?  Also, we should have a testcase for this.\n\nI also worry about future maintenance.  Not bailing out here means if we add more conditions below, we may need to \"\u0026\u0026 !username_has_space\" to get them to do the right thing.",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6988e92_26c5bf73",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T04:52:00Z",
      "side": 1,
      "message": "\u003e Implementing this this way -- instead of by bailing with \"UNKNOWN\" or the like here -- seems like it will matter if the user types \"foo bar@baz\" and hits ctrl-enter.  I think with your code, that will be URL, but maybe it should be UNKNOWN instead?\n\nDesired TLD is URL-seeking; I think it\u0027s appropriate that it overrides this generally-no-space in username heuristic.\n\n\u003eWhat do you think should happen here?  Also, we should have a testcase for this.\nAdded test case.\n \n\u003e I also worry about future maintenance.  Not bailing out here means if we add more conditions below, we may need to \"\u0026\u0026 !username_has_space\" to get them to do the right thing.\n\nWe can\u0027t bail out here as unknown.  (That was my first implementation, and it\u0027s wrong.)  Below we assign QUERY to certain invalid-IP-address-like things.  Returning UNKNOWN for these known QUERY types is wrong.\n\n(That what I was alluding to when I said\n// The heuristics below avoid returning URL type for these inputs.\nbecause we still allow the heuristics to return QUERY types.)",
      "parentUuid": "aae5c7d0_74309987",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c0b193b8_03f82791",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-12T18:22:07Z",
      "side": 1,
      "message": "I guess my thought was that the presence of the username-with-space on these makes them extremely ambiguous.  Consider the input \"a b@123.45/\"\n\nCurrent behavior: URL (because of the trailing slash)\nYour change: QUERY (because of the not-likely-an-IP check)\nMy proposal: UNKNOWN (because of the \"a b@\")\n\nI\u0027m sure URL is not right, but I\u0027m not sure QUERY is better than UNKNOWN.  This seems more UNKNOWNy to me (\"likely a search, but maybe you wanted to navigate?\").  What gives you such confidence that UNKNOWN is wrong for this?",
      "parentUuid": "e6988e92_26c5bf73",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "18d07cfa_c49af3d7",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T19:12:10Z",
      "side": 1,
      "message": "\u003e I guess my thought was that the presence of the username-with-space on these makes them extremely ambiguous.  Consider the input \"a b@123.45/\"\n\u003e \n\u003e Current behavior: URL (because of the trailing slash)\n\u003e Your change: QUERY (because of the not-likely-an-IP check)\n\u003e My proposal: UNKNOWN (because of the \"a b@\")\n\u003e \n\u003e I\u0027m sure URL is not right, but I\u0027m not sure QUERY is better than UNKNOWN.  This seems more UNKNOWNy to me (\"likely a search, but maybe you wanted to navigate?\").  What gives you such confidence that UNKNOWN is wrong for this?\n\nI don\u0027t have confidence that UNKNOWN is wrong for this.  In this example, there are two conflicting signals: username with a space - leans toward QUERY; trailing slash - leans toward URL.  I could see the balance coming out either way.\n\nFundamentally, I don\u0027t like the early UNKNOWN return for a different reason.  This function grows by people adding heuristics in particular places.  Putting the early return here will make all additions of QUERY heuristics later in the function more likely to break because they won\u0027t be reached.  Having the username_has_space only on exactly the clauses to which it matters make later additions to this already-complex function more likely to work as intended.",
      "parentUuid": "c0b193b8_03f82791",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2743fb9_7cf05037",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-12T19:31:19Z",
      "side": 1,
      "message": "I would like that argument if this were applied solely to \"the clauses to which it matters\", which I read as \"if the username has a space, it\u0027s not really a username; this info should be considered by any clause which wants to know if we have a username\".  So for example, the NumNonHostComponents() clause is, among other things, checking whether a username exists; knowing that we don\u0027t have a username would affect that.\n\nBut honestly, I think what we logically want is \"we passed the point of looking for an explicit scheme; since we didn\u0027t have one, if the \"username\" has a space in it, this isn\u0027t a URL\".  I think the only good reason not to return UNKNOWN here is that it downgrades QUERY to UNKNOWN for the 123.45 case.  With more thinking, I\u0027m increasingly unconvinced that \"a b@c\" + ctrl-enter should result in \"a%20b@c.com\" any more than \"a b@123.45\" + ctrl-enter results in \"a%20b@123.45.com\".\n\nIn the end, I think it\u0027d be better to do:\n\n  if (parts-\u003epath.is_nonempty() \u0026\u0026 !username_has_space) {\n    ...\n  }\n\n  if (bad IP address)\n    ...\n\n  if (username_has_space)\n    return UNKNOWN;\n\n  ...\n\nPractically, this has the same effect as your current code except for disabling ctrl-enter on these, which I think is honestly correct.  Maintenance-wise, I think it\u0027s more correct and safe.",
      "parentUuid": "18d07cfa_c49af3d7",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4048e67a_46d0fcfa",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 380,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-11T22:16:22Z",
      "side": 1,
      "message": "Nit: The example here isn\u0027t actually applicable to this specific check. \n Maybe instead the added text should be \"However, if the username has a space, this may be input like \"dep missing: @test/\", which should not be parsed as a URL (with the username \"dep missing: \").\"",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27a0285d_f4664952",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 380,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T04:52:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4048e67a_46d0fcfa",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16e14849_484cc8be",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 397,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-11T22:16:22Z",
      "side": 1,
      "message": "Nit: again help prevent -\u003e prevents; returning URL -\u003e being treated as URLs",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2e246d8_e7b1ad3e",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 397,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T04:52:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "16e14849_484cc8be",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7e0684a2_6338fd44",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 412,
      "author": {
        "id": 1115920
      },
      "writtenOn": "2017-09-12T17:30:52Z",
      "side": 1,
      "message": "!username_has_space here?\n\nE.g. something like:\ncan\u0027t login @localhost:8080",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "293a9f74_9c804fe3",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 412,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-12T18:22:07Z",
      "side": 1,
      "message": "Unless the user hit ctrl-enter, this case will have already been classified as UNKNOWN by the conditional just above.\n\nIf they do hit ctrl-enter, this will be converted to \"http://can\u0027t login @localhost.com:8080\", which is kinda weird but Mark feels is correct.  I\u0027m not certain he\u0027s wrong.",
      "parentUuid": "7e0684a2_6338fd44",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "45f73ca8_69d41431",
        "filename": "components/omnibox/browser/autocomplete_input.cc",
        "patchSetId": 2
      },
      "lineNbr": 412,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T19:12:10Z",
      "side": 1,
      "message": "Yup, Peter said it.  username_has_space is unnecessary here because if a username existed, then the flow generally cannot reach here.  It can only reach here if the user presses-control enter, in which case I\u0027ll take that as a sign that the user is seeking a URL and override the username-space heuristic.",
      "parentUuid": "293a9f74_9c804fe3",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "01a9bfe6_2564c52f",
        "filename": "components/omnibox/browser/autocomplete_input_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 75,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-11T22:16:22Z",
      "side": 1,
      "message": "Nit: I\u0027d use \"space\" instead of \"unexpected\" here to match below.\n\nI\u0027d also put these cases below the \"user:pass@foo.com\" case, since they seem inserted in the middle as-is.",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7485510b_ad175cf1",
        "filename": "components/omnibox/browser/autocomplete_input_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 75,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T04:52:00Z",
      "side": 1,
      "message": "Did both.",
      "parentUuid": "01a9bfe6_2564c52f",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b3238256_9de12a49",
        "filename": "components/omnibox/browser/autocomplete_input_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1000805
      },
      "writtenOn": "2017-09-11T22:16:22Z",
      "side": 1,
      "message": "What about without double slashes?",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d7c5f2a4_909ae0b1",
        "filename": "components/omnibox/browser/autocomplete_input_unittest.cc",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1001310
      },
      "writtenOn": "2017-09-12T04:52:00Z",
      "side": 1,
      "message": "Added test.  (Correctly also decides that URL is a good guess.)",
      "parentUuid": "b3238256_9de12a49",
      "revId": "56158157cac5b20ad72490e0a45d55362864fb08",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}