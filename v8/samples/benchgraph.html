<html>
<head>
<script>

// Benchpress: A collection of micro-benchmarks.

var TEST_RUN_TIME = 500;   // Run each test for this amount of time.
var GRAPH_MAX = 30;        // Maximum value of the graph.  (relative to FF)
var GRAPH_WIDTH = 600;     // Width of the graph in pixels.
var USDISPLAY = false;     // Set to true to display us instead of %
var gReferenceBrowser;     // Changed with radio button.


// -----------------------------------------------------------------------------
// F r a m e w o r k
// -----------------------------------------------------------------------------
function Browser(name, code, jpg) {
  this.name = name;
  this.code = code;
  this.jpg = jpg;
  this.button = undefined;

  this.setOnChangeHandler = function() {
    this.button.onchange = changecomparison;
  }

  this.displayKey = function() {
    var table = document.getElementById("key");
    if (!table) {
      alert("no key table!");
    }
    var row = document.createElement("tr");  // needs id

    var radioboxColumn = document.createElement("td");
    // On IE you can't set the name after you created the object.  But you
    // can set it using an HTML snippet in document.createElement.  The
    // HTML snippet doesn't work in Firefox.
    // http://codingforums.com/archive/index.php?t-41314.html
    // Opera doesn't have invisible document.all, but it doesn't like
    // xml in createElement (throws an exception).
    this.button = document.createElement((document.all&&!window.opera)?"<input name =\"comparison-radiobox\">":"input");
    this.button.setAttribute("type", "radio");
    this.button.setAttribute("name", "comparison-radiobox");
    this.button.setAttribute("checked", true);
    radioboxColumn.appendChild(this.button);
    row.appendChild(radioboxColumn);

    var jpgColumn = document.createElement("td");
    var img = document.createElement("img");
    img.setAttribute("src", jpg);
    jpgColumn.appendChild(img);
    row.appendChild(jpgColumn);

    var nameColumn = document.createElement("td");
    var b = document.createTextNode(name);
    nameColumn.appendChild(b);
    row.appendChild(nameColumn);

    table.appendChild(row);
  }

  this.createScore = function(benchmark) {
    var benchmarkName = benchmark.name;
    if (this[benchmarkName] == undefined &&
        this.code != "this") {
      return;
    }

    var table = document.getElementById("results");
    if (!table) {
      alert("no table!");
    }
    var row = document.createElement("tr");

    var checkboxColumn = document.createElement("td");
    if (this.code == "this") {
      benchmark.addCheckBox(checkboxColumn);
    }
    row.appendChild(checkboxColumn);

    var nameColumn = document.createElement("td");
    if (this.code != "this") {
      nameColumn.setAttribute("class", "browser-name");
      nameColumn.setAttribute("className", "browser-name"); // IE
      var nameWidget = document.createTextNode(this.name);
      nameColumn.appendChild(nameWidget);
    } else {
      var nameWidget = document.createTextNode(benchmarkName);
      nameColumn.appendChild(nameWidget);
    }
    row.appendChild(nameColumn);

    var resultColumn = document.createElement("td");
    resultColumn.setAttribute("id", this.code + "-" + benchmarkName + "-result");
    if (this.code == "this") {
      resultColumn.setAttribute("class", "myresult");
    }
    resultColumn.innerHTML = "-";
    row.appendChild(resultColumn);

    var graphColumn = document.createElement("td");
    graphColumn.setAttribute("width", GRAPH_WIDTH);

    var graph = document.createElement("img");
    graph.setAttribute("id", this.code + "-" + benchmarkName + "-graph");
    graph.setAttribute("src", jpg);
    graph.setAttribute("height", "16");
    graph.setAttribute("width", 0);
    graphColumn.appendChild(graph);

    row.appendChild(graphColumn);

    table.appendChild(row);
  }
}
  
function Benchmark(name, run) {
  this.name = name;
  this.test = run;

  this.addCheckBox = function(checkedColumn) {
    var checkbox = document.createElement("input");
    checkbox.setAttribute("id", this.name + "checked");
    checkbox.setAttribute("type", "checkbox");
    checkbox.setAttribute("checked", "1");
    checkedColumn.appendChild(checkbox);
  }

  this.display = function() {
    for (var index = 0; index < browsers.length; index++) {
      browsers[index].createScore(this);
    }
  }

  this.enable = function(value) {
    var checkbox = document.getElementById(this.name + "checked");
    if (checkbox) {
      checkbox.checked = value;
    }
  }

  this.enabled = function() {
    if (!USDISPLAY && !this.referenceLatency())
      return false;
    var checkbox = document.getElementById(this.name + "checked");
    if (checkbox) {
      if (checkbox.checked) {
        return true;
      }
    }
    return false;
  }

  this.run = function() {
    // Runs the test for one second, count the iterations.
    var elapsed = 0;
    var start = new Date();
    for (var n = 1; elapsed < TEST_RUN_TIME; n++) {
      this.test();
      elapsed = new Date() - start;
    }
    var usec = elapsed * 1000;
    var latency = Math.floor(usec / n);

    ThisBrowser[this.name] = latency;

    this.drawGraph(ThisBrowser);
  }

  this.referenceLatency = function() {
    if (!gReferenceBrowser) {
      return undefined;
    }
    return gReferenceBrowser[this.name];
  }

  this.clear = function(browser) {
    browser[this.name] = undefined;
    this.drawGraph(browser);
  }

  this.drawGraph = function(browser) {
    var us = browser[this.name];
    var ffus = this.referenceLatency();
    var valueWidth;
    if (us == undefined || ffus == undefined || us == 0) {
      valueWidth = 0;
    } else {
      var value = Math.floor(1000000 / us);
      valueWidth = GRAPH_WIDTH * ffus / (us * GRAPH_MAX);
      if (valueWidth > GRAPH_WIDTH) {
        valueWidth = GRAPH_WIDTH;
      }
    }
    var graph = document.getElementById(browser.code + "-" + this.name + "-graph");
    if (!graph) {
      return;
    }
    graph.setAttribute("width", valueWidth);

    var result = document.getElementById(browser.code + "-" + this.name + "-result");
    if (us == undefined) {
      result.innerHTML = "-";
    } else {
      if (USDISPLAY) {
        result.innerHTML = us.toString() + "us";
      } else {
        if (ffus == undefined) {
          result.innerHTML = "";
        } else {
          result.innerHTML = "" + Math.floor(ffus * 100 / us) + "%";
        }
      }
    }
  }
}

function error(name) {
  document.getElementById("errors").innerHTML += name + '<br/>\n';
}

function changecomparison() {
  for (var index = 0; index < browsers.length; index++) {
    var b = browsers[index];
    if (b.button.checked) {
      gReferenceBrowser = b;
    }
  }
  for (var browser = 0; browser < browsers.length; browser++) {
    for (var benchmark = 0; benchmark < benchmarks.length; benchmark++) {
      benchmarks[benchmark].drawGraph(browsers[browser]);
    }
  }
}


// -----------------------------------------------------------------------------
// N o o p
// -----------------------------------------------------------------------------
function noop() {
}

var Noop = new Benchmark("Noop", noop);

// -----------------------------------------------------------------------------
// F i b o n a c c i
// -----------------------------------------------------------------------------
function doFib(n) {
  if (n <= 1) return 1;
  return doFib(n - 1) + doFib(n - 2);
}

function fib() {
  var result = doFib(20);
  if (result != 10946) error("Wrong result: " + result + " should be: 10946");
}

var Fibonacci = new Benchmark("Fibonacci", fib);


// -----------------------------------------------------------------------------
// L o o p
// -----------------------------------------------------------------------------
function loop() {
  var sum = 0;
  for (var i = 0; i < 200; i++) {
    for (var j = 0; j < 100; j++) {
      sum++;
    }
  }
  if (sum != 20000) error("Wrong result: " + sum + " should be: 20000");
}

var Loop = new Benchmark("Loop", loop);


// -----------------------------------------------------------------------------
// T o w e r s
// -----------------------------------------------------------------------------
var towersPiles, towersMovesDone;

function TowersDisk(size) {
  this.size = size;
  this.next = null;
}

function towersPush(pile, disk) {
  var top = towersPiles[pile];
  if ((top != null) && (disk.size >= top.size))
    error("Cannot put a big disk on a smaller disk");
  disk.next = top;
  towersPiles[pile] = disk;
}

function towersPop(pile) {
  var top = towersPiles[pile];
  if (top == null) error("Attempting to remove a disk from an empty pile");
  towersPiles[pile] = top.next;
  top.next = null;
  return top;
}

function towersMoveTop(from, to) {
  towersPush(to, towersPop(from));
  towersMovesDone++;
}

function towersMove(from, to, disks) {
  if (disks == 1) {
    towersMoveTop(from, to);
  } else {
    var other = 3 - from - to;
    towersMove(from, other, disks - 1);
    towersMoveTop(from, to);
    towersMove(other, to, disks - 1);
  }
}

function towersBuild(pile, disks) {
  for (var i = disks - 1; i >= 0; i--) {
    towersPush(pile, new TowersDisk(i));
  }
}

function towers() {
  towersPiles = [ null, null, null ];
  towersBuild(0, 13);
  towersMovesDone = 0;
  towersMove(0, 1, 13);
  if (towersMovesDone != 8191) 
    error("Error in result: " + towersMovesDone + " should be: 8191");
}

var Towers = new Benchmark("Towers", towers);


// -----------------------------------------------------------------------------
// S i e v e 
// -----------------------------------------------------------------------------
function doSieve(flags, size) {
  var primeCount = 0, i;
  for (i = 1; i < size; i++) flags[i] = true;
  for (i = 2; i < size; i++) {
    if (flags[i]) {
      primeCount++;
      for (var k = i + 1; k <= size; k+=i) flags[k - 1] = false;
    }
  } 
  return primeCount;
}

function sieve() {
  var flags = new Array(1001);
  var result = doSieve(flags, 1000);
  if (result != 168) 
    error("Wrong result: " + result + " should be: 168");
}

var Sieve = new Benchmark("Sieve", sieve);


// -----------------------------------------------------------------------------
// P e r m u t e
// -----------------------------------------------------------------------------
var permuteCount;
 
function swap(n, k, array) {
  var tmp = array[n];
  array[n] = array[k];
  array[k] = tmp;
}

function doPermute(n, array) {
  permuteCount++;
  if (n != 1) {
    doPermute(n - 1, array);
    for (var k = n - 1; k >= 1; k--) {
      swap(n, k, array);
      doPermute(n - 1, array);
      swap(n, k, array);
    }
  }
}

function permute() {
  var array = new Array(8);
  for (var i = 1; i <= 7; i++) array[i] = i - 1;
  permuteCount = 0;
  doPermute(7, array);
  if (permuteCount != 8660) error("Wrong result: " + permuteCount + " should be: 8660");
}

var Permute = new Benchmark("Permute", permute);


// -----------------------------------------------------------------------------
// Q u e e n s
// -----------------------------------------------------------------------------
function tryQueens(i, a, b, c, x) {
  var j = 0, q = false;
  while ((!q) && (j != 8)) {
    j++;
    q = false;
    if (b[j] && a[i + j] && c[i - j + 7]) {
      x[i] = j;
      b[j] = false;
      a[i + j] = false;
      c[i - j + 7] = false;
      if (i < 8) {
        q = tryQueens(i + 1, a, b, c, x);
        if (!q) {
          b[j] = true;
          a[i + j] = true;
          c[i - j + 7] = true;
        }
      } else {
        q = true;
      }
    }
  }
  return q;
}

function queens() {
  var a = new Array(9);
  var b = new Array(17);
  var c = new Array(15);
  var x = new Array(9);
  for (var i = -7; i <= 16; i++) {
    if ((i >= 1) && (i <= 8)) a[i] = true;
    if (i >= 2) b[i] = true;
    if (i <= 7) c[i + 7] = true;
  }

  if (!tryQueens(1, b, a, c, x)) 
    error("Error in queens");
}

var Queens = new Benchmark("Queens", queens);


// -----------------------------------------------------------------------------
// R e c u r s e
// -----------------------------------------------------------------------------
function recurse(n) {
  if (n <= 0) return 1;
  recurse(n - 1);
  return recurse(n - 1);
}

var Recurse = new Benchmark("Recurse", function () { recurse(13); });


// -----------------------------------------------------------------------------
// S u m
// -----------------------------------------------------------------------------
function doSum(start, end) {
  var sum = 0;
  for (var i = start; i <= end; i++) sum += i;
  return sum;
}

function sum() {
  var result = doSum(1, 10000);
  if (result != 50005000) error("Wrong result: " + result + " should be: 50005000");
}

var Sum = new Benchmark("Sum", sum);


// -----------------------------------------------------------------------------
// H e l p e r   f u n c t i o n s   f o r   s o r t s
// -----------------------------------------------------------------------------
var randomInitialSeed = 74755; 
var randomSeed;
function random() {
  randomSeed = ((randomSeed * 1309) + 13849) % 65536;
  return randomSeed;
}

function SortData(length) {
  randomSeed = randomInitialSeed;
  var array = new Array(length);
  for (var i = 0; i < length; i++) array[i] = random();

  var min, max; 
  min = max = array[0];
  for (var i = 0; i < length; i++) {
    var e = array[i];
    if (e > max) max = e;
    if (e < min) min = e;
  }

  this.min = min;
  this.max = max;
  this.array = array;
  this.length = length;
}

function check(data) {
  var a = data.array;
  var len = data.length;
  if ((a[0] != data.min) || (a[len - 1] != data.max))
    error("Array is not sorted");
  for (var i = 1; i < len; i++) {
    if (a[i - 1] > a[i]) error("Array is not sorted");
  }
}


// -----------------------------------------------------------------------------
// B u b b l e S o r t
// -----------------------------------------------------------------------------
function doBubblesort(a, len) {
  for (var i = len - 2; i >= 0; i--) {
    for (var j = 0; j <= i; j++) {
      var c = a[j], n = a[j + 1];
      if (c > n) {
        a[j] = n;
        a[j + 1] = c;
      }
    }
  }
}

function bubblesort() {
  var data = new SortData(130);
  doBubblesort(data.array, data.length);
  check(data);
}

var BubbleSort = new Benchmark("BubbleSort", bubblesort);


// -----------------------------------------------------------------------------
// Q u i c k S o r t
// -----------------------------------------------------------------------------
function doQuicksort(a, low, high) {
  var pivot = a[(low + high) >> 1];
  var i = low, j = high;
  while (i <= j) {
    while (a[i] < pivot) i++;
    while (pivot < a[j]) j--;
    if (i <= j) {
      var tmp = a[i];
      a[i] = a[j];
      a[j] = tmp;
      i++;
      j--;
    }
  }

  if (low < j) doQuicksort(a, low, j);
  if (i < high) doQuicksort(a, i, high);
}

function quicksort() {
  var data = new SortData(800);
  doQuicksort(data.array, 0, data.length - 1);
  check(data);
}

var QuickSort = new Benchmark("QuickSort", quicksort);


// -----------------------------------------------------------------------------
// T r e e S o r t
// -----------------------------------------------------------------------------
function TreeNode(value) {
  this.value = value;
  this.left = null;
  this.right = null;
}

TreeNode.prototype.insert = function (n) {
  if (n < this.value) {
    if (this.left == null) this.left = new TreeNode(n);
    else this.left.insert(n);
  } else {
    if (this.right == null) this.right = new TreeNode(n);
    else this.right.insert(n);
  }
};

TreeNode.prototype.check = function () {
  var left = this.left, right = this.right, value = this.value;
  return ((left == null)  || ((left.value  <  value) && left.check())) &&
         ((right == null) || ((right.value >= value) && right.check()));
};

function treesort() {
  var data = new SortData(1000);
  var a = data.array;
  var len = data.length;
  var tree = new TreeNode(a[0]);
  for (var i = 1; i < len; i++) tree.insert(a[i]);
  if (!tree.check()) error("Invalid result, tree not sorted");
}

var TreeSort = new Benchmark("TreeSort", treesort);


// -----------------------------------------------------------------------------
//  T a k
// -----------------------------------------------------------------------------
function tak(x, y, z) {
 if (y >= x) return z;    
 return tak(tak(x-1, y, z), tak(y-1, z, x), tak(z-1, x, y));   
}

var Tak = new Benchmark("Tak", function () { tak(18,12,6); });


// -----------------------------------------------------------------------------
//  T a k l
// -----------------------------------------------------------------------------
function ListElement(length, next) {
  this.length = length;
  this.next = next;
}

function makeList(length) {
  if (length == 0) return null;
  return new ListElement(length, makeList(length - 1));
}

function isShorter(x, y) {
  var xTail = x, yTail = y;
  while (yTail != null) {
    if (xTail == null) return true;
    xTail = xTail.next;
    yTail = yTail.next;
  }
  return false;
}

function doTakl(x, y, z) {
  if (isShorter(y, x)) {
    return doTakl(doTakl(x.next, y, z), 
                  doTakl(y.next, z, x), 
                  doTakl(z.next, x, y));
  } else {
    return z;
  }
}

function takl() {
  var result = doTakl(makeList(15), makeList(10), makeList(6));
  if (result.length != 10) 
    error("Wrong result: " + result.length + " should be: 10");
}

var Takl = new Benchmark("Takl", takl);

function domWalk() {
  var items = document.getElementById("walker-area").getElementsByTagName("*");
  var i = 0;
  var item;
  for (var index=0; index<items.length; index++) {
    item = items[i];
    var name = item.nodeName;
  }
  if (items.length < 29 || items.length > 29) {
    error("Dom walk failed.  Should have walked 29-29 nodes, but walked " + items.length);
  }
}

var DomWalk = new Benchmark("DomWalk", domWalk);

function WalkNodes(node) {
    var child = node.firstChild;
    var counter = 1;
    while (child != null)
    {
        counter += WalkNodes(child);
        child = child.nextSibling;
    }
    return counter;
}

function domWalkRecursive() {
  var counter = WalkNodes(document.getElementById("walker-area"));
  // Safari finds 84
  // Chrome finds 84
  // Firefox finds 84
  // Kestrel (Opera) finds 62
  // IE7 finds only 56
  if (counter < 56 || counter > 84) {
    error("Recursive dom walk failed.  Should have walked 56-84 nodes, but walked " + counter);
  }
}

var DomWalkRecursive = new Benchmark("DomWalkRecursive", domWalkRecursive);

// -----------------------------------------------------------------------------
// C r y p t o
// -----------------------------------------------------------------------------

</script><script src="cryptobench.js"></script><script>

function crypto() {
  var plainText = "In this way the infinite-dimensional invariance group erodes the distinction between observer and observed";
  var encrypted = encrypt(plainText, 1);
  var decrypted = decrypt(encrypted, 1);
  if (decrypted != plainText)
    error("Decryption failed");
}

var Crypto = new Benchmark("Crypto", crypto);

// If we choose the best crypto engine dynamically instead of using
// the one that V8 likes we get 9-10% better performance on Firefox
// and IE7, but the page takes a long time to load.
//calibrateEngine();

// -----------------------------------------------------------------------------
// D e l t a   B l u e
// -----------------------------------------------------------------------------

</script><script src="delta-blue.js"></script><script>

function runDeltaBlue() {
  deltaBlue(1);
}

var DeltaBlue = new Benchmark("DeltaBlue", runDeltaBlue);

// -----------------------------------------------------------------------------
// R i c h a r d s
// -----------------------------------------------------------------------------

</script><script src="richards.js"></script><script>

var Richards = new Benchmark("Richards", runRichards);

// -----------------------------------------------------------------------------
// G e o m e t r i c   M e a n
// -----------------------------------------------------------------------------

var Geometric = new Benchmark("GeometricMean", noop);

Geometric.run = function() {
  for (var brow = 0; brow < browsers.length; brow++) {
    var product = 1.0;
    var referenceProduct = 1.0;
    var benchmarkCount = 0;
    var browser = browsers[brow];
    for (var i = 0; i < benchmarks.length; i++) {
      var bench = benchmarks[i];
      if (bench == this) {
        continue;
      }
      var usec = browser[bench.name];
      var refUsec = bench.referenceLatency();
      if (usec != undefined && refUsec != undefined && bench.enabled()) {
        benchmarkCount++;
        product *= usec;
        referenceProduct *= refUsec;
      }
    }
    if (benchmarkCount > 0) {
      var geometricReferenceUsec = Math.floor(Math.pow(referenceProduct, 1.0/benchmarkCount));
      var geometricUsec = Math.floor(Math.pow(product, 1.0/benchmarkCount));
      gReferenceBrowser.GeometricMean = geometricReferenceUsec;
      browser.GeometricMean = geometricUsec;
    } else {
      gReferenceBrowser.GeometricMean = undefined;
      browser.GeometricMean = undefined;
    }
    this.drawGraph(browser);
  }
}

Geometric.addCheckBox = function(checkedColumn) {
}


var Firefox =     new Browser("Firefox 2.0.0.6, Win, 3GHz P4", "ff", "grad2.jpg");
Firefox.Fibonacci = 10638;
Firefox.Loop = 2049;
Firefox.Towers = 27777;
Firefox.Sieve = 1858;
Firefox.Permute = 15176;
Firefox.Queens = 764;
Firefox.Recurse = 7352;
Firefox.Sum = 1798;
Firefox.BubbleSort = 5000;
Firefox.QuickSort = 5617;
Firefox.TreeSort = 17241;
Firefox.Tak = 26315;
Firefox.Takl = 8333;
Firefox.DomWalk = 939;
Firefox.DomWalkRecursive = 2008;
Firefox.Crypto = 929500;
Firefox.DeltaBlue = 96333;
Firefox.Richards = 2697500;
Firefox.GeometricMean = 5041;

// Figures for dom out of date
var Explorer =    new Browser("Internet Explorer 6.0.2900.2180, 3GHz P4", "ie", "grad4.jpg");
Explorer.Fibonacci = 54486;
Explorer.Loop = 3100;
Explorer.Towers = 117647;
Explorer.Sieve = 2306;
Explorer.Permute = 65516;
Explorer.Queens = 1350;
Explorer.Recurse = 40620;
Explorer.Sum = 1964;
Explorer.BubbleSort = 11976;
Explorer.QuickSort = 16528;
Explorer.TreeSort = 59294;
Explorer.Tak = 149571;
Explorer.Takl = 28000;
Explorer.DomWalk = 103200;
Explorer.DomWalkRecursive = 14735;
Explorer.GeometricMean = 10096;

// Figures for dom out of date
var ChromeKJS =   new Browser("Chrome 2007-09-10 kjs, 3GHz P4", "kjs", "grad5.jpg");
ChromeKJS.Fibonacci = 21500;
ChromeKJS.Loop = 8474;
ChromeKJS.Towers = 106200;
ChromeKJS.Sieve = 1792;
ChromeKJS.Permute = 68375;
ChromeKJS.Queens = 1736;
ChromeKJS.Recurse = 16612;
ChromeKJS.Sum = 4237;
ChromeKJS.BubbleSort = 10000;
ChromeKJS.QuickSort = 13888;
ChromeKJS.TreeSort = 25000;
ChromeKJS.Tak = 152250;
ChromeKJS.Takl = 29411;
ChromeKJS.DomWalk = 3572;
ChromeKJS.DomWalkRecursive = 4310;
ChromeKJS.GeometricMean = 7488;

var Kestrel =   new Browser("Opera 9.5 pre-release, Win, 3GHz P4", "kestrel", "grad3.jpg");
Kestrel.Fibonacci = 7692;
Kestrel.Loop = 1805;
Kestrel.Towers = 25000;
Kestrel.Sieve = 1333;
Kestrel.Permute = 14285;
Kestrel.Queens = 611;
Kestrel.Recurse = 6024;
Kestrel.Sum = 1199;
Kestrel.BubbleSort = 5208;
Kestrel.QuickSort = 6410;
Kestrel.TreeSort = 10204;
Kestrel.Tak = 22727;
Kestrel.Takl = 6666;
Kestrel.DomWalk = 102;
Kestrel.DomWalkRecursive = 98;
Kestrel.Crypto = 757500
Kestrel.DeltaBlue = 66375;
Kestrel.Richards = 2070500;
Kestrel.GeometricMean = 3009;

var Safari = new Browser("Safari 3 beta, Win, 3GHz P4", "safari", "grad5.jpg");
Safari.Fibonacci = 28666;
Safari.Loop = 10000;
Safari.Towers = 78142;
Safari.Sieve = 1968;
Safari.Permute = 50000;
Safari.Queens = 1754;
Safari.Recurse = 21739;
Safari.Sum = 4950;
Safari.BubbleSort = 14285;
Safari.QuickSort = 15151;
Safari.TreeSort = 25800;
Safari.Tak = 101666;
Safari.Takl = 23809;
Safari.DomWalk = 247;
Safari.DomWalkRecursive = 295;
Safari.Crypto = 2875000;
// Safari.Richards - gets slow script dialog.
Safari.DeltaBlue = 148500;
Safari.GeometricMean = 9422;

var IE7 = new Browser("Internet Explorer 7, Win, 3GHz P4", "ie7", "grad4.jpg");
IE7.Fibonacci = 54700;
IE7.Loop = 3048;
IE7.Towers = 106200;
IE7.Sieve = 2314;
IE7.Permute = 64375;
IE7.Queens = 1336;
IE7.Recurse = 42916;
IE7.Sum = 1633;
IE7.BubbleSort = 10638;
IE7.QuickSort = 16129;
IE7.TreeSort = 59000;
IE7.Tak = 136750;
IE7.Takl = 27777;
IE7.DomWalk = 784;
IE7.DomWalkRecursive = 1362;
IE7.Crypto = 1265500;
IE7.DeltaBlue = 312666;
IE7.Richards = 10024000;
IE7.GeometricMean = 11669;

var ThisBrowser = new Browser("This browser", "this", "grad1.jpg");

// -----------------------------------------------------------------------------
// M a i n
// -----------------------------------------------------------------------------

var browsers = [ ThisBrowser,
                 IE7,
                 Firefox,
                 Safari,
                 Kestrel
               ];

var benchmarks = [ Fibonacci,
                   Loop,
                   Towers,
                   Sieve,
                   Permute,
                   Queens,
                   Recurse,
                   Sum,
                   BubbleSort,
                   QuickSort,
                   TreeSort,
                   Tak,
                   Takl,
                   DomWalk,
                   DomWalkRecursive,
                   Crypto,
                   DeltaBlue,
                   Richards,
                   Geometric               // Must be last
                 ];

var current = 0;

function RunNext() {
  var test;
  do {
    test = benchmarks[current++];
  } while ((current < benchmarks.length) && !test.enabled());

  test.run();
  if (current < benchmarks.length) {
    window.setTimeout(RunNext, 1);
  }
}

function setup() {
  for (var index = 0; index < browsers.length; index++) {
    browsers[index].displayKey();
  }
  for (var index = 0; index < benchmarks.length; index++) {
    benchmarks[index].display();
  }
  for (var index = 0; index < browsers.length; index++) {
    browsers[index].setOnChangeHandler();
  }
  changecomparison();
}

function runtests() {
  current = 0;
  for (var i = 0; i < benchmarks.length; i++) {
    benchmarks[i].clear(ThisBrowser);
  }

  window.setTimeout(RunNext, 1000);
}

function checkall(val) {
  for (var index=0; index<benchmarks.length; index++)
    benchmarks[index].enable(val);
}

</script>

<style>
body { font-family: arial; }
.resulttable { background-color: lightgray; border: 1px solid black; }
.myresult { color: red; }
.browser-name { color: #808080; text-align: right; }
</style>
</head>

<body>
<h1>Benchpress - JavaScript Benchmarks</h1>

<h2> Normalize relative to: </h2>
<form>
<table class="keytable">
<tbody id="key">
</tbody>
</table>
</form>

<table class="resulttable">
<tbody id="results">
<tr>
<th></th><th>Test</th><th>Performance</th><th>Operations per second relative to reference browser<br/>(bigger is better)</th>
</tr>
</tbody>
</table>
<p id="errors"></p>
<input type="button" value="Run Tests" onclick="runtests()">
<a href="javascript:checkall(true)">check all</a>
<a href="javascript:checkall(false);">uncheck all</a>

<script>
setup();
</script>

<div id="walker-area" style="display: none;">
  <h1>
    Invisible content
  </h1>
  <p>
    This is <i>invisible</i> and is <b>only</b> for <div>use</div> by the
    <div class="foo">benchies</div> benchmarks.
  </p>
  <p>
    <img src="http://www.google.com/intl/en_ALL/images/logo.gif" alt="Google" />
    Hell&oslash; Kitty!
  </p>
  <table>
    <tr>
      <td>
        Foo
      </td>
      <td>
        Bar
      </td>
      <td>
        Baz
      </td>
      <td>
        Fizz
      </td>
      <td>
        Buzz
      </td>
    </tr>
    <tr>
      <td>
        One
      </td>
      <td>
        Two
      </td>
      <td>
        Three
      </td>
      <td>
        Four
      </td>
      <td>
        Five
      </td>
    </tr>
    <tr>
      <td>
        Bush
      </td>
      <td>
        Clinton
      </td>
      <td>
        Clinton
      </td>
      <td>
        Bush
      </td>
      <td>
        Bush
      </td>
    </tr>
  </table>
</div>

</body>
</html>
