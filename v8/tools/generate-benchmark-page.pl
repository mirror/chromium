#!/usr/bin/perl -w

if (@ARGV < 1) {
  print("Usage: generate-benchmark-page.pl <benchmark1> <benchmark2> ...\n");
  exit();
}

for $arg (@ARGV) {
  unless ($arg =~ /.*\.js/) {
    die("Illegal benchmark $arg");
  }
}

print "<!-- HTML Generated by generate-benchmark-page.pl -->\n";
print "<html>\n";
print "  <head>\n";
print "    <title>Browser Benchmark</title>\n";
print "  </head>\n";
print "  <body>\n";
print "    <script type=\"text/javascript\">\n";
print "      function print(str) {\n";
print "        document.write(str);\n";
print "        document.write('<br/>');\n";
print "      }\n";
my @all;

sub to_title_case($) {
  my ($arg) = @_;
  $arg =~ s/_/ /g;
  return uc(substr($arg, 0, 1)) . substr($arg, 1);
}

for $arg (@ARGV) {
  my @parts = split('/', $arg);
  # Perly but hideous code -- my eyes... the goggles do nothing!"
  my $file_name = $parts[@parts - 1];
  my $benchmark_name = substr($file_name, 0, -3);
  # Replace - with _
  $benchmark_name =~ s/-/_/g;
  push(@all, $benchmark_name);
  print("      function run_$benchmark_name() {\n");
  my $title = to_title_case($benchmark_name);
  print("        document.write('<b>$title</b><br/>');\n");
  open(BENCHMARK, $arg) or die "Couldn't open $arg";
  while ($line = <BENCHMARK>) {
    print "        ", $line;
  }
  close(BENCHMARK);
  print("      }\n");
}

print "      function run_all_benchmarks() {\n";
my $first = 1;
for $name (@all) {
  if ($first) { $first = 0; }
  else { print "        document.write('<hr/>');\n"; }
  print "        run_$name();\n";
}
print "      }\n";

print "    </script>\n";
print "    Select a benchmark to run:<br/>\n";
print "    <ul>\n";
for $name (@all) {
  my $title = to_title_case($name);
  print "      <li><a href=\"javascript:run_$name()\">$title</a></li>\n";  
}
print "      <li><a href=\"javascript:run_all_benchmarks()\"><b>All</b></a></li>\n";
print "    </ul>\n";
($sec,$min,$hour,$mday,$mon,$year)=localtime(time);
print "    <i>Generated by generate-benchmark-page.pl on ";
printf "%4d-%02d-%02d %02d:%02d:%02d",$year+1900,$mon+1,$mday,$hour,$min,$sec;
print ".</i>\n";
print "  </body>\n";
print "</html>\n";
