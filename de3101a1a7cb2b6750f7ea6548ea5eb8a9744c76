{
  "comments": [
    {
      "key": {
        "uuid": "c6eb8109_d18f6d5d",
        "filename": "components/variations/service/variations_field_trial_creator_unittest.cc",
        "patchSetId": 6
      },
      "lineNbr": 281,
      "author": {
        "id": 1103654
      },
      "writtenOn": "2017-07-18T19:33:06Z",
      "side": 1,
      "message": "I don\u0027t think this is the right way to test this.\n\nCan\u0027t we just reproduce the crash that happened in prod without adding these special ForTesting() methods?\n\nLike, why not just construct VariationsService and pass in a client object? Without the fix that should crash, no?\n\nIs it because TestVariationsService is masking the crash? (If so, could we do a different subclass that doesn\u0027t mask it?)\n\nAlso, I think this test case should be in variations_service_unittest.cc since that\u0027s where the crash was.",
      "range": {
        "startLine": 281,
        "startChar": 62,
        "endLine": 281,
        "endChar": 63
      },
      "revId": "de3101a1a7cb2b6750f7ea6548ea5eb8a9744c76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12510756_d6d79237",
        "filename": "components/variations/service/variations_field_trial_creator_unittest.cc",
        "patchSetId": 6
      },
      "lineNbr": 281,
      "author": {
        "id": 1223121
      },
      "writtenOn": "2017-07-18T20:18:21Z",
      "side": 1,
      "message": "I\u0027ll try to explain the bug better:\n\nIn the VariationsService constructor I first called std::move(client) and then client.get(), the .get() call returns nullptr on some platforms, so VariationsFieldTrialCreator\u0027s client_ was nullptr. The crash didn\u0027t actually occur until an attempt to dereference client_ inside GetClientFilterableStateForVersion().",
      "parentUuid": "c6eb8109_d18f6d5d",
      "range": {
        "startLine": 281,
        "startChar": 62,
        "endLine": 281,
        "endChar": 63
      },
      "revId": "de3101a1a7cb2b6750f7ea6548ea5eb8a9744c76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd07c11e_6fdbd095",
        "filename": "components/variations/service/variations_field_trial_creator_unittest.cc",
        "patchSetId": 6
      },
      "lineNbr": 281,
      "author": {
        "id": 1103654
      },
      "writtenOn": "2017-07-18T20:21:54Z",
      "side": 1,
      "message": "Ah, that makes sense. So then we just need to trigger the same codepath in the unit test - i.e. the one that calls GetClientFilterableStateForVersion().",
      "parentUuid": "12510756_d6d79237",
      "range": {
        "startLine": 281,
        "startChar": 62,
        "endLine": 281,
        "endChar": 63
      },
      "revId": "de3101a1a7cb2b6750f7ea6548ea5eb8a9744c76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3e2ebbc_632f62f0",
        "filename": "components/variations/service/variations_field_trial_creator_unittest.cc",
        "patchSetId": 6
      },
      "lineNbr": 281,
      "author": {
        "id": 1223121
      },
      "writtenOn": "2017-07-18T22:47:59Z",
      "side": 1,
      "message": "Alright, I\u0027ve changed it some.  The original crash occurs when CreateTrialsFromSeed() calls GetClientFilterableStateForVersion().  The way all the tests work for calling CreateTrialsFromSeed() is by overriding LoadSeed() and StoreSeed() to fake the loading and storing. In this case we want to indirectly create VariationsFieldTrialCreator via VariationsService, so we can\u0027t override those two methods and call CreateTrialsFromSeed().\n\nHopefully that makes sense, but please let me know what you think.",
      "parentUuid": "bd07c11e_6fdbd095",
      "range": {
        "startLine": 281,
        "startChar": 62,
        "endLine": 281,
        "endChar": 63
      },
      "revId": "de3101a1a7cb2b6750f7ea6548ea5eb8a9744c76",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}