{
  "comments": [
    {
      "key": {
        "uuid": "81cae575_f19b21d3",
        "filename": "chrome/browser/ui/views/page_info/page_info_bubble_view.cc",
        "patchSetId": 3
      },
      "lineNbr": 934,
      "author": {
        "id": 1002092
      },
      "writtenOn": "2017-12-15T03:08:11Z",
      "side": 1,
      "message": "oops - I guess this should be\n\nfor (auto\u0026 row : selector_rows_)\n  row-\u003eSizeSecondaryText(width());",
      "revId": "9f15fead043e41297bcbdc4de3f41ac131acfdde",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c8d18d6f_66dc27f6",
        "filename": "chrome/browser/ui/views/page_info/page_info_bubble_view.cc",
        "patchSetId": 3
      },
      "lineNbr": 934,
      "author": {
        "id": 1160861
      },
      "writtenOn": "2018-01-05T00:38:07Z",
      "side": 1,
      "message": "Deleted since no longer necessary :)",
      "parentUuid": "81cae575_f19b21d3",
      "revId": "9f15fead043e41297bcbdc4de3f41ac131acfdde",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "efff1011_f1f2cf9f",
        "filename": "chrome/browser/ui/views/page_info/page_info_bubble_view.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1002092
      },
      "writtenOn": "2017-12-15T03:08:11Z",
      "side": 1,
      "message": "So I think this could invalidate layout. Which means the size could be different. So I think another SizeToContents() call is required after this.\n\nI expect it currently works on the initial bubble showing, since there\u0027s also a SizeToContents call in BubbleDialogDelegateView::CreateBubble(). \n\nBut if something calls PageInfoBubbleView::SetPermissionInfo() while the bubble is still visible, then there won\u0027t be a SizeToContents after this.\n\nWhich I think means we need a SizeToContents after this?\n\n\nBut a double layout might start affecting performance..  Usually that SizeToContents in BubbleDialogDelegateView::CreateBubble() does nothing because the size doesn\u0027t change. When it *does* change, it ~doubles the time it takes for the widget to appear.\n\nWe\u0027ve been running into performance issues with the profile switcher -- See http://crbug.com/789118\n\nIt might be worth comparing some chrome://tracing before/after this change -- I can show you how to do that.\n\n\nIs there a way to avoid the second Layout pass?\n\n\nI\u0027m thinking something like\n\n - inherit from views::Label for |secondary_label_|\n - constructor takes a View* |match_width_view|\n - override CalculatePreferredSize() like\n {\n   int width \u003d match_width_view-\u003eGetPreferredSize().width();\n   return gfx::Size(width, GetHeightForWidth(width));\n }",
      "revId": "9f15fead043e41297bcbdc4de3f41ac131acfdde",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "057bd8e6_10bfdfd6",
        "filename": "chrome/browser/ui/views/page_info/page_info_bubble_view.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1160861
      },
      "writtenOn": "2018-01-02T04:15:19Z",
      "side": 1,
      "message": "I think the suggestion you had doesn\u0027t work because the whole permission section of the Page Info bubble is a single column set. When there are comboboxes that are bigger that the max threshold size, the permission label column width might not go all the way up to the start of the combobox like in the diagram below:\n\n  *-----------------------------------------------*\n  | .____. | .______________. |        .________. |\n  | |Icon| | |Location      | |        |Block  v| |\n  | \u0027¯¯¯¯\u0027 | :\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d: |        \u0027¯¯¯¯¯¯¯¯\u0027 |\n  |        | |Automatically | |                   |\n  |        | |blocked       | |                   |\n  |        | \u0027¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u0027 |                   |\n  *-----------------------------------------------*\n  | .____. | .______________. | ._______________. |\n  | |Icon| | |Flash         | | |Ask (default) v| |\n  | \u0027¯¯¯¯\u0027 | \u0027¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u0027 | \u0027¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u0027 |\n  *-----------------------------------------------*\n\nOne possible solution is to just give every permission row its own columnset instead. The problem with this may be that sometimes this might happen:\n\n  *---------------------------------------------------------------------*\n  | .____. | .___________________________________________. | .________. |\n  | |Icon| | |A really long translated name for Location?| | |Block  v| |\n  | \u0027¯¯¯¯\u0027 | \u0027¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u0027 | \u0027¯¯¯¯¯¯¯¯\u0027 |\n  *\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d*\n  | .____. | .____________________________________. | ._______________. |\n  | |Icon| | |A less long name for Flash          | | |Ask (default) v| |\n  | \u0027¯¯¯¯\u0027 | \u0027¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u0027 | \u0027¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u0027 |\n  *---------------------------------------------------------------------*\n\nWhere the permission title might overlap with the combobox area - this probably only looks really bad if you have \u003e 2 permissions that overlap though, so I\u0027m not sure how much we care about this case.\n\nI did notice that SetPermissionInfo() already calls SizeToContents() (at the end) though, so maybe doing this won\u0027t introduce any regressions? Would it be OK if we set the size of the label in PageInfoBubbleView::CalculatePreferredSize() instead? (So, piggyback off of layouts that are already occurring instead of standalone in SetPermissionInfo()?) Or is doing it then too late?",
      "parentUuid": "efff1011_f1f2cf9f",
      "revId": "9f15fead043e41297bcbdc4de3f41ac131acfdde",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0ba83748_dbcc93d7",
        "filename": "chrome/browser/ui/views/page_info/page_info_bubble_view.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1002092
      },
      "writtenOn": "2018-01-03T02:58:14Z",
      "side": 1,
      "message": "as discussed - I think the first layout looks OK (although, I suppose it depends on how strongly UX feel about it).\n\nI don\u0027t think there\u0027s any general purpose layout algorithm that could cater for having the secondary text extending beyond the view above it (and its column) but not into the space that a view occupies in the column after it.\n\nWe should also spot-check performance in chrome://tracing. Ideally the SizeToContents call in BubbleDialogDelegateView::CreateBubble() is always a no-op (Widget::Init should pick the right size to begin with).\n\nIt looks as though the current latency is ~100ms on Mac. If that were to double, it would be very noticable.",
      "parentUuid": "057bd8e6_10bfdfd6",
      "revId": "9f15fead043e41297bcbdc4de3f41ac131acfdde",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b9f948a_ed7162b5",
        "filename": "chrome/browser/ui/views/page_info/page_info_bubble_view.cc",
        "patchSetId": 3
      },
      "lineNbr": 935,
      "author": {
        "id": 1160861
      },
      "writtenOn": "2018-01-05T00:38:07Z",
      "side": 1,
      "message": "OK, switched to the first layout :) I checked a couple of verbose languages, and they look bad, but I think they might have looked bad anyway because they have really long words that cause them to wrap early. Here\u0027s a screenshot of German (Russian is pretty similar): https://drive.google.com/file/d/1P6d6DhjVLUZcBiI81grTXQgm_6CclsrJ/view?usp\u003dsharing\n\nWill send this via maxwalker@ to approve when he is back from OOO.\n\nchrome://tracing on Mac says the Page Info bubble takes ~30ms more on average with this patch than without :( (Tested on a layout showing 5 permissions, two which have the secondary text underneath.) Opening and closing it really fast feels OK to me though. WDYT?",
      "parentUuid": "0ba83748_dbcc93d7",
      "revId": "9f15fead043e41297bcbdc4de3f41ac131acfdde",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}