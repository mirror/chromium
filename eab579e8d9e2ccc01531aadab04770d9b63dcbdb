{
  "comments": [
    {
      "key": {
        "uuid": "9fc5d877_421fedf4",
        "filename": "cc/trees/layer_tree_host_unittest_scroll.cc",
        "patchSetId": 2
      },
      "lineNbr": 1044,
      "author": {
        "id": 1145109
      },
      "writtenOn": "2017-07-25T04:17:31Z",
      "side": 1,
      "message": "May be these assertions could also go in CommitCompleteOnThread above? That function runs after UpdateDrawProperties so it should have updated the state on the TranformTree if it was marked dirty.",
      "range": {
        "startLine": 1044,
        "startChar": 7,
        "endLine": 1044,
        "endChar": 40
      },
      "revId": "eab579e8d9e2ccc01531aadab04770d9b63dcbdb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "61ca9e72_f70ef33b",
        "filename": "cc/trees/property_tree.cc",
        "patchSetId": 2
      },
      "lineNbr": 1442,
      "author": {
        "id": 1145109
      },
      "writtenOn": "2017-07-25T04:17:31Z",
      "side": 1,
      "message": "I think PushFromMainThread itself should return based on whether the current value on the pending tree changed after pushing this update. That would keep it consistent with PushPendingToActive, which is already doing this (it checks the base and delta values).\n\nThere are only 2 call-sites that use the return value and each of them wants to know if the current value on the pending tree changed. For the page scale, we are doing a Delta() check in addition to the current check (https://cs.chromium.org/chromium/src/cc/trees/layer_tree_impl.cc?sq\u003dpackage:chromium\u0026l\u003d777), which I suspect is to work around the same issue your change had. But I think that creates cases where we unnecessarily assume a scale change. For instance, if the main thread simply reflects back the delta sent, Delta() would not be identity, but the pending tree value would be the same as the main thread value.",
      "range": {
        "startLine": 1442,
        "startChar": 37,
        "endLine": 1442,
        "endChar": 55
      },
      "revId": "eab579e8d9e2ccc01531aadab04770d9b63dcbdb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "432fd21a_0e46509f",
        "filename": "cc/trees/property_tree.cc",
        "patchSetId": 2
      },
      "lineNbr": 1442,
      "author": {
        "id": 1110037
      },
      "writtenOn": "2017-07-25T23:36:39Z",
      "side": 1,
      "message": "The issue is that the value is not really changing in PushFromMainThread.\n\nIn the test, the main thread value equals the current pending base (and current active base), but there\u0027s a delta. The DidUpdateScrollOffset call below uses the current scroll offset value to update the transform node\u0027s scroll offset, and the current scroll offset value includes the base plus delta. The main value equals the pending and only differs from the current value (pending + delta).\n\nI wonder if we should change this logic entirely to do something more like:\nif (map_entry.second !\u003d synced_scroll_offset-\u003eCurrent(property_trees()-\u003eis_active))\n  sync_tree-\u003eDidUpdateScrollOffset(id);",
      "parentUuid": "61ca9e72_f70ef33b",
      "range": {
        "startLine": 1442,
        "startChar": 37,
        "endLine": 1442,
        "endChar": 55
      },
      "revId": "eab579e8d9e2ccc01531aadab04770d9b63dcbdb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fa4eae20_e9f5750d",
        "filename": "cc/trees/property_tree.cc",
        "patchSetId": 2
      },
      "lineNbr": 1442,
      "author": {
        "id": 1145109
      },
      "writtenOn": "2017-07-26T07:19:49Z",
      "side": 1,
      "message": "That does sound much better. Could we do this for the page scale as well?",
      "parentUuid": "432fd21a_0e46509f",
      "range": {
        "startLine": 1442,
        "startChar": 37,
        "endLine": 1442,
        "endChar": 55
      },
      "revId": "eab579e8d9e2ccc01531aadab04770d9b63dcbdb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}